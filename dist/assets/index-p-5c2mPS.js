(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))n(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const l of a.addedNodes)l.tagName==="LINK"&&l.rel==="modulepreload"&&n(l)}).observe(document,{childList:!0,subtree:!0});function t(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerPolicy&&(a.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?a.credentials="include":r.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(r){if(r.ep)return;r.ep=!0;const a=t(r);fetch(r.href,a)}})();var ju={exports:{}},Ei={},Vu={exports:{}},ke={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var fm;function pE(){if(fm)return ke;fm=1;var i=Symbol.for("react.element"),e=Symbol.for("react.portal"),t=Symbol.for("react.fragment"),n=Symbol.for("react.strict_mode"),r=Symbol.for("react.profiler"),a=Symbol.for("react.provider"),l=Symbol.for("react.context"),u=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),c=Symbol.for("react.memo"),h=Symbol.for("react.lazy"),m=Symbol.iterator;function g(C){return C===null||typeof C!="object"?null:(C=m&&C[m]||C["@@iterator"],typeof C=="function"?C:null)}var E={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},y=Object.assign,T={};function S(C,U,le){this.props=C,this.context=U,this.refs=T,this.updater=le||E}S.prototype.isReactComponent={},S.prototype.setState=function(C,U){if(typeof C!="object"&&typeof C!="function"&&C!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,C,U,"setState")},S.prototype.forceUpdate=function(C){this.updater.enqueueForceUpdate(this,C,"forceUpdate")};function A(){}A.prototype=S.prototype;function w(C,U,le){this.props=C,this.context=U,this.refs=T,this.updater=le||E}var I=w.prototype=new A;I.constructor=w,y(I,S.prototype),I.isPureReactComponent=!0;var b=Array.isArray,P=Object.prototype.hasOwnProperty,G={current:null},D={key:!0,ref:!0,__self:!0,__source:!0};function M(C,U,le){var ue,ge={},he=null,Le=null;if(U!=null)for(ue in U.ref!==void 0&&(Le=U.ref),U.key!==void 0&&(he=""+U.key),U)P.call(U,ue)&&!D.hasOwnProperty(ue)&&(ge[ue]=U[ue]);var we=arguments.length-2;if(we===1)ge.children=le;else if(1<we){for(var be=Array(we),$e=0;$e<we;$e++)be[$e]=arguments[$e+2];ge.children=be}if(C&&C.defaultProps)for(ue in we=C.defaultProps,we)ge[ue]===void 0&&(ge[ue]=we[ue]);return{$$typeof:i,type:C,key:he,ref:Le,props:ge,_owner:G.current}}function B(C,U){return{$$typeof:i,type:C.type,key:U,ref:C.ref,props:C.props,_owner:C._owner}}function O(C){return typeof C=="object"&&C!==null&&C.$$typeof===i}function X(C){var U={"=":"=0",":":"=2"};return"$"+C.replace(/[=:]/g,function(le){return U[le]})}var re=/\/+/g;function de(C,U){return typeof C=="object"&&C!==null&&C.key!=null?X(""+C.key):U.toString(36)}function ae(C,U,le,ue,ge){var he=typeof C;(he==="undefined"||he==="boolean")&&(C=null);var Le=!1;if(C===null)Le=!0;else switch(he){case"string":case"number":Le=!0;break;case"object":switch(C.$$typeof){case i:case e:Le=!0}}if(Le)return Le=C,ge=ge(Le),C=ue===""?"."+de(Le,0):ue,b(ge)?(le="",C!=null&&(le=C.replace(re,"$&/")+"/"),ae(ge,U,le,"",function($e){return $e})):ge!=null&&(O(ge)&&(ge=B(ge,le+(!ge.key||Le&&Le.key===ge.key?"":(""+ge.key).replace(re,"$&/")+"/")+C)),U.push(ge)),1;if(Le=0,ue=ue===""?".":ue+":",b(C))for(var we=0;we<C.length;we++){he=C[we];var be=ue+de(he,we);Le+=ae(he,U,le,be,ge)}else if(be=g(C),typeof be=="function")for(C=be.call(C),we=0;!(he=C.next()).done;)he=he.value,be=ue+de(he,we++),Le+=ae(he,U,le,be,ge);else if(he==="object")throw U=String(C),Error("Objects are not valid as a React child (found: "+(U==="[object Object]"?"object with keys {"+Object.keys(C).join(", ")+"}":U)+"). If you meant to render a collection of children, use an array instead.");return Le}function oe(C,U,le){if(C==null)return C;var ue=[],ge=0;return ae(C,ue,"","",function(he){return U.call(le,he,ge++)}),ue}function ie(C){if(C._status===-1){var U=C._result;U=U(),U.then(function(le){(C._status===0||C._status===-1)&&(C._status=1,C._result=le)},function(le){(C._status===0||C._status===-1)&&(C._status=2,C._result=le)}),C._status===-1&&(C._status=0,C._result=U)}if(C._status===1)return C._result.default;throw C._result}var ee={current:null},$={transition:null},J={ReactCurrentDispatcher:ee,ReactCurrentBatchConfig:$,ReactCurrentOwner:G};function q(){throw Error("act(...) is not supported in production builds of React.")}return ke.Children={map:oe,forEach:function(C,U,le){oe(C,function(){U.apply(this,arguments)},le)},count:function(C){var U=0;return oe(C,function(){U++}),U},toArray:function(C){return oe(C,function(U){return U})||[]},only:function(C){if(!O(C))throw Error("React.Children.only expected to receive a single React element child.");return C}},ke.Component=S,ke.Fragment=t,ke.Profiler=r,ke.PureComponent=w,ke.StrictMode=n,ke.Suspense=f,ke.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=J,ke.act=q,ke.cloneElement=function(C,U,le){if(C==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+C+".");var ue=y({},C.props),ge=C.key,he=C.ref,Le=C._owner;if(U!=null){if(U.ref!==void 0&&(he=U.ref,Le=G.current),U.key!==void 0&&(ge=""+U.key),C.type&&C.type.defaultProps)var we=C.type.defaultProps;for(be in U)P.call(U,be)&&!D.hasOwnProperty(be)&&(ue[be]=U[be]===void 0&&we!==void 0?we[be]:U[be])}var be=arguments.length-2;if(be===1)ue.children=le;else if(1<be){we=Array(be);for(var $e=0;$e<be;$e++)we[$e]=arguments[$e+2];ue.children=we}return{$$typeof:i,type:C.type,key:ge,ref:he,props:ue,_owner:Le}},ke.createContext=function(C){return C={$$typeof:l,_currentValue:C,_currentValue2:C,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},C.Provider={$$typeof:a,_context:C},C.Consumer=C},ke.createElement=M,ke.createFactory=function(C){var U=M.bind(null,C);return U.type=C,U},ke.createRef=function(){return{current:null}},ke.forwardRef=function(C){return{$$typeof:u,render:C}},ke.isValidElement=O,ke.lazy=function(C){return{$$typeof:h,_payload:{_status:-1,_result:C},_init:ie}},ke.memo=function(C,U){return{$$typeof:c,type:C,compare:U===void 0?null:U}},ke.startTransition=function(C){var U=$.transition;$.transition={};try{C()}finally{$.transition=U}},ke.unstable_act=q,ke.useCallback=function(C,U){return ee.current.useCallback(C,U)},ke.useContext=function(C){return ee.current.useContext(C)},ke.useDebugValue=function(){},ke.useDeferredValue=function(C){return ee.current.useDeferredValue(C)},ke.useEffect=function(C,U){return ee.current.useEffect(C,U)},ke.useId=function(){return ee.current.useId()},ke.useImperativeHandle=function(C,U,le){return ee.current.useImperativeHandle(C,U,le)},ke.useInsertionEffect=function(C,U){return ee.current.useInsertionEffect(C,U)},ke.useLayoutEffect=function(C,U){return ee.current.useLayoutEffect(C,U)},ke.useMemo=function(C,U){return ee.current.useMemo(C,U)},ke.useReducer=function(C,U,le){return ee.current.useReducer(C,U,le)},ke.useRef=function(C){return ee.current.useRef(C)},ke.useState=function(C){return ee.current.useState(C)},ke.useSyncExternalStore=function(C,U,le){return ee.current.useSyncExternalStore(C,U,le)},ke.useTransition=function(){return ee.current.useTransition()},ke.version="18.3.1",ke}var hm;function Yc(){return hm||(hm=1,Vu.exports=pE()),Vu.exports}/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var mm;function gE(){if(mm)return Ei;mm=1;var i=Yc(),e=Symbol.for("react.element"),t=Symbol.for("react.fragment"),n=Object.prototype.hasOwnProperty,r=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,a={key:!0,ref:!0,__self:!0,__source:!0};function l(u,f,c){var h,m={},g=null,E=null;c!==void 0&&(g=""+c),f.key!==void 0&&(g=""+f.key),f.ref!==void 0&&(E=f.ref);for(h in f)n.call(f,h)&&!a.hasOwnProperty(h)&&(m[h]=f[h]);if(u&&u.defaultProps)for(h in f=u.defaultProps,f)m[h]===void 0&&(m[h]=f[h]);return{$$typeof:e,type:u,key:g,ref:E,props:m,_owner:r.current}}return Ei.Fragment=t,Ei.jsx=l,Ei.jsxs=l,Ei}var pm;function yE(){return pm||(pm=1,ju.exports=gE()),ju.exports}var _=yE(),W=Yc(),Qa={},Hu={exports:{}},kt={},Ku={exports:{}},zu={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var gm;function vE(){return gm||(gm=1,function(i){function e($,J){var q=$.length;$.push(J);e:for(;0<q;){var C=q-1>>>1,U=$[C];if(0<r(U,J))$[C]=J,$[q]=U,q=C;else break e}}function t($){return $.length===0?null:$[0]}function n($){if($.length===0)return null;var J=$[0],q=$.pop();if(q!==J){$[0]=q;e:for(var C=0,U=$.length,le=U>>>1;C<le;){var ue=2*(C+1)-1,ge=$[ue],he=ue+1,Le=$[he];if(0>r(ge,q))he<U&&0>r(Le,ge)?($[C]=Le,$[he]=q,C=he):($[C]=ge,$[ue]=q,C=ue);else if(he<U&&0>r(Le,q))$[C]=Le,$[he]=q,C=he;else break e}}return J}function r($,J){var q=$.sortIndex-J.sortIndex;return q!==0?q:$.id-J.id}if(typeof performance=="object"&&typeof performance.now=="function"){var a=performance;i.unstable_now=function(){return a.now()}}else{var l=Date,u=l.now();i.unstable_now=function(){return l.now()-u}}var f=[],c=[],h=1,m=null,g=3,E=!1,y=!1,T=!1,S=typeof setTimeout=="function"?setTimeout:null,A=typeof clearTimeout=="function"?clearTimeout:null,w=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function I($){for(var J=t(c);J!==null;){if(J.callback===null)n(c);else if(J.startTime<=$)n(c),J.sortIndex=J.expirationTime,e(f,J);else break;J=t(c)}}function b($){if(T=!1,I($),!y)if(t(f)!==null)y=!0,ie(P);else{var J=t(c);J!==null&&ee(b,J.startTime-$)}}function P($,J){y=!1,T&&(T=!1,A(M),M=-1),E=!0;var q=g;try{for(I(J),m=t(f);m!==null&&(!(m.expirationTime>J)||$&&!X());){var C=m.callback;if(typeof C=="function"){m.callback=null,g=m.priorityLevel;var U=C(m.expirationTime<=J);J=i.unstable_now(),typeof U=="function"?m.callback=U:m===t(f)&&n(f),I(J)}else n(f);m=t(f)}if(m!==null)var le=!0;else{var ue=t(c);ue!==null&&ee(b,ue.startTime-J),le=!1}return le}finally{m=null,g=q,E=!1}}var G=!1,D=null,M=-1,B=5,O=-1;function X(){return!(i.unstable_now()-O<B)}function re(){if(D!==null){var $=i.unstable_now();O=$;var J=!0;try{J=D(!0,$)}finally{J?de():(G=!1,D=null)}}else G=!1}var de;if(typeof w=="function")de=function(){w(re)};else if(typeof MessageChannel<"u"){var ae=new MessageChannel,oe=ae.port2;ae.port1.onmessage=re,de=function(){oe.postMessage(null)}}else de=function(){S(re,0)};function ie($){D=$,G||(G=!0,de())}function ee($,J){M=S(function(){$(i.unstable_now())},J)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function($){$.callback=null},i.unstable_continueExecution=function(){y||E||(y=!0,ie(P))},i.unstable_forceFrameRate=function($){0>$||125<$?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):B=0<$?Math.floor(1e3/$):5},i.unstable_getCurrentPriorityLevel=function(){return g},i.unstable_getFirstCallbackNode=function(){return t(f)},i.unstable_next=function($){switch(g){case 1:case 2:case 3:var J=3;break;default:J=g}var q=g;g=J;try{return $()}finally{g=q}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function($,J){switch($){case 1:case 2:case 3:case 4:case 5:break;default:$=3}var q=g;g=$;try{return J()}finally{g=q}},i.unstable_scheduleCallback=function($,J,q){var C=i.unstable_now();switch(typeof q=="object"&&q!==null?(q=q.delay,q=typeof q=="number"&&0<q?C+q:C):q=C,$){case 1:var U=-1;break;case 2:U=250;break;case 5:U=1073741823;break;case 4:U=1e4;break;default:U=5e3}return U=q+U,$={id:h++,callback:J,priorityLevel:$,startTime:q,expirationTime:U,sortIndex:-1},q>C?($.sortIndex=q,e(c,$),t(f)===null&&$===t(c)&&(T?(A(M),M=-1):T=!0,ee(b,q-C))):($.sortIndex=U,e(f,$),y||E||(y=!0,ie(P))),$},i.unstable_shouldYield=X,i.unstable_wrapCallback=function($){var J=g;return function(){var q=g;g=J;try{return $.apply(this,arguments)}finally{g=q}}}}(zu)),zu}var ym;function EE(){return ym||(ym=1,Ku.exports=vE()),Ku.exports}/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var vm;function xE(){if(vm)return kt;vm=1;var i=Yc(),e=EE();function t(s){for(var o="https://reactjs.org/docs/error-decoder.html?invariant="+s,d=1;d<arguments.length;d++)o+="&args[]="+encodeURIComponent(arguments[d]);return"Minified React error #"+s+"; visit "+o+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var n=new Set,r={};function a(s,o){l(s,o),l(s+"Capture",o)}function l(s,o){for(r[s]=o,s=0;s<o.length;s++)n.add(o[s])}var u=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f=Object.prototype.hasOwnProperty,c=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,h={},m={};function g(s){return f.call(m,s)?!0:f.call(h,s)?!1:c.test(s)?m[s]=!0:(h[s]=!0,!1)}function E(s,o,d,p){if(d!==null&&d.type===0)return!1;switch(typeof o){case"function":case"symbol":return!0;case"boolean":return p?!1:d!==null?!d.acceptsBooleans:(s=s.toLowerCase().slice(0,5),s!=="data-"&&s!=="aria-");default:return!1}}function y(s,o,d,p){if(o===null||typeof o>"u"||E(s,o,d,p))return!0;if(p)return!1;if(d!==null)switch(d.type){case 3:return!o;case 4:return o===!1;case 5:return isNaN(o);case 6:return isNaN(o)||1>o}return!1}function T(s,o,d,p,v,x,R){this.acceptsBooleans=o===2||o===3||o===4,this.attributeName=p,this.attributeNamespace=v,this.mustUseProperty=d,this.propertyName=s,this.type=o,this.sanitizeURL=x,this.removeEmptyString=R}var S={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(s){S[s]=new T(s,0,!1,s,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(s){var o=s[0];S[o]=new T(o,1,!1,s[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(s){S[s]=new T(s,2,!1,s.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(s){S[s]=new T(s,2,!1,s,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(s){S[s]=new T(s,3,!1,s.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(s){S[s]=new T(s,3,!0,s,null,!1,!1)}),["capture","download"].forEach(function(s){S[s]=new T(s,4,!1,s,null,!1,!1)}),["cols","rows","size","span"].forEach(function(s){S[s]=new T(s,6,!1,s,null,!1,!1)}),["rowSpan","start"].forEach(function(s){S[s]=new T(s,5,!1,s.toLowerCase(),null,!1,!1)});var A=/[\-:]([a-z])/g;function w(s){return s[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(s){var o=s.replace(A,w);S[o]=new T(o,1,!1,s,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(s){var o=s.replace(A,w);S[o]=new T(o,1,!1,s,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(s){var o=s.replace(A,w);S[o]=new T(o,1,!1,s,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(s){S[s]=new T(s,1,!1,s.toLowerCase(),null,!1,!1)}),S.xlinkHref=new T("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(s){S[s]=new T(s,1,!1,s.toLowerCase(),null,!0,!0)});function I(s,o,d,p){var v=S.hasOwnProperty(o)?S[o]:null;(v!==null?v.type!==0:p||!(2<o.length)||o[0]!=="o"&&o[0]!=="O"||o[1]!=="n"&&o[1]!=="N")&&(y(o,d,v,p)&&(d=null),p||v===null?g(o)&&(d===null?s.removeAttribute(o):s.setAttribute(o,""+d)):v.mustUseProperty?s[v.propertyName]=d===null?v.type===3?!1:"":d:(o=v.attributeName,p=v.attributeNamespace,d===null?s.removeAttribute(o):(v=v.type,d=v===3||v===4&&d===!0?"":""+d,p?s.setAttributeNS(p,o,d):s.setAttribute(o,d))))}var b=i.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,P=Symbol.for("react.element"),G=Symbol.for("react.portal"),D=Symbol.for("react.fragment"),M=Symbol.for("react.strict_mode"),B=Symbol.for("react.profiler"),O=Symbol.for("react.provider"),X=Symbol.for("react.context"),re=Symbol.for("react.forward_ref"),de=Symbol.for("react.suspense"),ae=Symbol.for("react.suspense_list"),oe=Symbol.for("react.memo"),ie=Symbol.for("react.lazy"),ee=Symbol.for("react.offscreen"),$=Symbol.iterator;function J(s){return s===null||typeof s!="object"?null:(s=$&&s[$]||s["@@iterator"],typeof s=="function"?s:null)}var q=Object.assign,C;function U(s){if(C===void 0)try{throw Error()}catch(d){var o=d.stack.trim().match(/\n( *(at )?)/);C=o&&o[1]||""}return`
`+C+s}var le=!1;function ue(s,o){if(!s||le)return"";le=!0;var d=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(o)if(o=function(){throw Error()},Object.defineProperty(o.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(o,[])}catch(z){var p=z}Reflect.construct(s,[],o)}else{try{o.call()}catch(z){p=z}s.call(o.prototype)}else{try{throw Error()}catch(z){p=z}s()}}catch(z){if(z&&p&&typeof z.stack=="string"){for(var v=z.stack.split(`
`),x=p.stack.split(`
`),R=v.length-1,k=x.length-1;1<=R&&0<=k&&v[R]!==x[k];)k--;for(;1<=R&&0<=k;R--,k--)if(v[R]!==x[k]){if(R!==1||k!==1)do if(R--,k--,0>k||v[R]!==x[k]){var N=`
`+v[R].replace(" at new "," at ");return s.displayName&&N.includes("<anonymous>")&&(N=N.replace("<anonymous>",s.displayName)),N}while(1<=R&&0<=k);break}}}finally{le=!1,Error.prepareStackTrace=d}return(s=s?s.displayName||s.name:"")?U(s):""}function ge(s){switch(s.tag){case 5:return U(s.type);case 16:return U("Lazy");case 13:return U("Suspense");case 19:return U("SuspenseList");case 0:case 2:case 15:return s=ue(s.type,!1),s;case 11:return s=ue(s.type.render,!1),s;case 1:return s=ue(s.type,!0),s;default:return""}}function he(s){if(s==null)return null;if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s;switch(s){case D:return"Fragment";case G:return"Portal";case B:return"Profiler";case M:return"StrictMode";case de:return"Suspense";case ae:return"SuspenseList"}if(typeof s=="object")switch(s.$$typeof){case X:return(s.displayName||"Context")+".Consumer";case O:return(s._context.displayName||"Context")+".Provider";case re:var o=s.render;return s=s.displayName,s||(s=o.displayName||o.name||"",s=s!==""?"ForwardRef("+s+")":"ForwardRef"),s;case oe:return o=s.displayName||null,o!==null?o:he(s.type)||"Memo";case ie:o=s._payload,s=s._init;try{return he(s(o))}catch{}}return null}function Le(s){var o=s.type;switch(s.tag){case 24:return"Cache";case 9:return(o.displayName||"Context")+".Consumer";case 10:return(o._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return s=o.render,s=s.displayName||s.name||"",o.displayName||(s!==""?"ForwardRef("+s+")":"ForwardRef");case 7:return"Fragment";case 5:return o;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return he(o);case 8:return o===M?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof o=="function")return o.displayName||o.name||null;if(typeof o=="string")return o}return null}function we(s){switch(typeof s){case"boolean":case"number":case"string":case"undefined":return s;case"object":return s;default:return""}}function be(s){var o=s.type;return(s=s.nodeName)&&s.toLowerCase()==="input"&&(o==="checkbox"||o==="radio")}function $e(s){var o=be(s)?"checked":"value",d=Object.getOwnPropertyDescriptor(s.constructor.prototype,o),p=""+s[o];if(!s.hasOwnProperty(o)&&typeof d<"u"&&typeof d.get=="function"&&typeof d.set=="function"){var v=d.get,x=d.set;return Object.defineProperty(s,o,{configurable:!0,get:function(){return v.call(this)},set:function(R){p=""+R,x.call(this,R)}}),Object.defineProperty(s,o,{enumerable:d.enumerable}),{getValue:function(){return p},setValue:function(R){p=""+R},stopTracking:function(){s._valueTracker=null,delete s[o]}}}}function Ht(s){s._valueTracker||(s._valueTracker=$e(s))}function Vi(s){if(!s)return!1;var o=s._valueTracker;if(!o)return!0;var d=o.getValue(),p="";return s&&(p=be(s)?s.checked?"true":"false":s.value),s=p,s!==d?(o.setValue(s),!0):!1}function Wn(s){if(s=s||(typeof document<"u"?document:void 0),typeof s>"u")return null;try{return s.activeElement||s.body}catch{return s.body}}function Tr(s,o){var d=o.checked;return q({},o,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:d??s._wrapperState.initialChecked})}function Zo(s,o){var d=o.defaultValue==null?"":o.defaultValue,p=o.checked!=null?o.checked:o.defaultChecked;d=we(o.value!=null?o.value:d),s._wrapperState={initialChecked:p,initialValue:d,controlled:o.type==="checkbox"||o.type==="radio"?o.checked!=null:o.value!=null}}function Pe(s,o){o=o.checked,o!=null&&I(s,"checked",o,!1)}function nt(s,o){Pe(s,o);var d=we(o.value),p=o.type;if(d!=null)p==="number"?(d===0&&s.value===""||s.value!=d)&&(s.value=""+d):s.value!==""+d&&(s.value=""+d);else if(p==="submit"||p==="reset"){s.removeAttribute("value");return}o.hasOwnProperty("value")?tn(s,o.type,d):o.hasOwnProperty("defaultValue")&&tn(s,o.type,we(o.defaultValue)),o.checked==null&&o.defaultChecked!=null&&(s.defaultChecked=!!o.defaultChecked)}function Lt(s,o,d){if(o.hasOwnProperty("value")||o.hasOwnProperty("defaultValue")){var p=o.type;if(!(p!=="submit"&&p!=="reset"||o.value!==void 0&&o.value!==null))return;o=""+s._wrapperState.initialValue,d||o===s.value||(s.value=o),s.defaultValue=o}d=s.name,d!==""&&(s.name=""),s.defaultChecked=!!s._wrapperState.initialChecked,d!==""&&(s.name=d)}function tn(s,o,d){(o!=="number"||Wn(s.ownerDocument)!==s)&&(d==null?s.defaultValue=""+s._wrapperState.initialValue:s.defaultValue!==""+d&&(s.defaultValue=""+d))}var mt=Array.isArray;function Ft(s,o,d,p){if(s=s.options,o){o={};for(var v=0;v<d.length;v++)o["$"+d[v]]=!0;for(d=0;d<s.length;d++)v=o.hasOwnProperty("$"+s[d].value),s[d].selected!==v&&(s[d].selected=v),v&&p&&(s[d].defaultSelected=!0)}else{for(d=""+we(d),o=null,v=0;v<s.length;v++){if(s[v].value===d){s[v].selected=!0,p&&(s[v].defaultSelected=!0);return}o!==null||s[v].disabled||(o=s[v])}o!==null&&(o.selected=!0)}}function nn(s,o){if(o.dangerouslySetInnerHTML!=null)throw Error(t(91));return q({},o,{value:void 0,defaultValue:void 0,children:""+s._wrapperState.initialValue})}function Os(s,o){var d=o.value;if(d==null){if(d=o.children,o=o.defaultValue,d!=null){if(o!=null)throw Error(t(92));if(mt(d)){if(1<d.length)throw Error(t(93));d=d[0]}o=d}o==null&&(o=""),d=o}s._wrapperState={initialValue:we(d)}}function Lr(s,o){var d=we(o.value),p=we(o.defaultValue);d!=null&&(d=""+d,d!==s.value&&(s.value=d),o.defaultValue==null&&s.defaultValue!==d&&(s.defaultValue=d)),p!=null&&(s.defaultValue=""+p)}function Ns(s){var o=s.textContent;o===s._wrapperState.initialValue&&o!==""&&o!==null&&(s.value=o)}function Yn(s){switch(s){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function Kr(s,o){return s==null||s==="http://www.w3.org/1999/xhtml"?Yn(o):s==="http://www.w3.org/2000/svg"&&o==="foreignObject"?"http://www.w3.org/1999/xhtml":s}var zr,Fs=function(s){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(o,d,p,v){MSApp.execUnsafeLocalFunction(function(){return s(o,d,p,v)})}:s}(function(s,o){if(s.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in s)s.innerHTML=o;else{for(zr=zr||document.createElement("div"),zr.innerHTML="<svg>"+o.valueOf().toString()+"</svg>",o=zr.firstChild;s.firstChild;)s.removeChild(s.firstChild);for(;o.firstChild;)s.appendChild(o.firstChild)}});function qn(s,o){if(o){var d=s.firstChild;if(d&&d===s.lastChild&&d.nodeType===3){d.nodeValue=o;return}}s.textContent=o}var rn={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},Ey=["Webkit","ms","Moz","O"];Object.keys(rn).forEach(function(s){Ey.forEach(function(o){o=o+s.charAt(0).toUpperCase()+s.substring(1),rn[o]=rn[s]})});function Id(s,o,d){return o==null||typeof o=="boolean"||o===""?"":d||typeof o!="number"||o===0||rn.hasOwnProperty(s)&&rn[s]?(""+o).trim():o+"px"}function wd(s,o){s=s.style;for(var d in o)if(o.hasOwnProperty(d)){var p=d.indexOf("--")===0,v=Id(d,o[d],p);d==="float"&&(d="cssFloat"),p?s.setProperty(d,v):s[d]=v}}var xy=q({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function el(s,o){if(o){if(xy[s]&&(o.children!=null||o.dangerouslySetInnerHTML!=null))throw Error(t(137,s));if(o.dangerouslySetInnerHTML!=null){if(o.children!=null)throw Error(t(60));if(typeof o.dangerouslySetInnerHTML!="object"||!("__html"in o.dangerouslySetInnerHTML))throw Error(t(61))}if(o.style!=null&&typeof o.style!="object")throw Error(t(62))}}function tl(s,o){if(s.indexOf("-")===-1)return typeof o.is=="string";switch(s){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var nl=null;function rl(s){return s=s.target||s.srcElement||window,s.correspondingUseElement&&(s=s.correspondingUseElement),s.nodeType===3?s.parentNode:s}var sl=null,Wr=null,Yr=null;function _d(s){if(s=si(s)){if(typeof sl!="function")throw Error(t(280));var o=s.stateNode;o&&(o=fa(o),sl(s.stateNode,s.type,o))}}function bd(s){Wr?Yr?Yr.push(s):Yr=[s]:Wr=s}function Cd(){if(Wr){var s=Wr,o=Yr;if(Yr=Wr=null,_d(s),o)for(s=0;s<o.length;s++)_d(o[s])}}function kd(s,o){return s(o)}function Dd(){}var il=!1;function Pd(s,o,d){if(il)return s(o,d);il=!0;try{return kd(s,o,d)}finally{il=!1,(Wr!==null||Yr!==null)&&(Dd(),Cd())}}function Ms(s,o){var d=s.stateNode;if(d===null)return null;var p=fa(d);if(p===null)return null;d=p[o];e:switch(o){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(p=!p.disabled)||(s=s.type,p=!(s==="button"||s==="input"||s==="select"||s==="textarea")),s=!p;break e;default:s=!1}if(s)return null;if(d&&typeof d!="function")throw Error(t(231,o,typeof d));return d}var al=!1;if(u)try{var Us={};Object.defineProperty(Us,"passive",{get:function(){al=!0}}),window.addEventListener("test",Us,Us),window.removeEventListener("test",Us,Us)}catch{al=!1}function Sy(s,o,d,p,v,x,R,k,N){var z=Array.prototype.slice.call(arguments,3);try{o.apply(d,z)}catch(te){this.onError(te)}}var Bs=!1,Hi=null,Ki=!1,ol=null,Ty={onError:function(s){Bs=!0,Hi=s}};function Ly(s,o,d,p,v,x,R,k,N){Bs=!1,Hi=null,Sy.apply(Ty,arguments)}function Ay(s,o,d,p,v,x,R,k,N){if(Ly.apply(this,arguments),Bs){if(Bs){var z=Hi;Bs=!1,Hi=null}else throw Error(t(198));Ki||(Ki=!0,ol=z)}}function Ar(s){var o=s,d=s;if(s.alternate)for(;o.return;)o=o.return;else{s=o;do o=s,(o.flags&4098)!==0&&(d=o.return),s=o.return;while(s)}return o.tag===3?d:null}function Od(s){if(s.tag===13){var o=s.memoizedState;if(o===null&&(s=s.alternate,s!==null&&(o=s.memoizedState)),o!==null)return o.dehydrated}return null}function Nd(s){if(Ar(s)!==s)throw Error(t(188))}function Ry(s){var o=s.alternate;if(!o){if(o=Ar(s),o===null)throw Error(t(188));return o!==s?null:s}for(var d=s,p=o;;){var v=d.return;if(v===null)break;var x=v.alternate;if(x===null){if(p=v.return,p!==null){d=p;continue}break}if(v.child===x.child){for(x=v.child;x;){if(x===d)return Nd(v),s;if(x===p)return Nd(v),o;x=x.sibling}throw Error(t(188))}if(d.return!==p.return)d=v,p=x;else{for(var R=!1,k=v.child;k;){if(k===d){R=!0,d=v,p=x;break}if(k===p){R=!0,p=v,d=x;break}k=k.sibling}if(!R){for(k=x.child;k;){if(k===d){R=!0,d=x,p=v;break}if(k===p){R=!0,p=x,d=v;break}k=k.sibling}if(!R)throw Error(t(189))}}if(d.alternate!==p)throw Error(t(190))}if(d.tag!==3)throw Error(t(188));return d.stateNode.current===d?s:o}function Fd(s){return s=Ry(s),s!==null?Md(s):null}function Md(s){if(s.tag===5||s.tag===6)return s;for(s=s.child;s!==null;){var o=Md(s);if(o!==null)return o;s=s.sibling}return null}var Ud=e.unstable_scheduleCallback,Bd=e.unstable_cancelCallback,Iy=e.unstable_shouldYield,wy=e.unstable_requestPaint,Je=e.unstable_now,_y=e.unstable_getCurrentPriorityLevel,ll=e.unstable_ImmediatePriority,$d=e.unstable_UserBlockingPriority,zi=e.unstable_NormalPriority,by=e.unstable_LowPriority,Gd=e.unstable_IdlePriority,Wi=null,yn=null;function Cy(s){if(yn&&typeof yn.onCommitFiberRoot=="function")try{yn.onCommitFiberRoot(Wi,s,void 0,(s.current.flags&128)===128)}catch{}}var sn=Math.clz32?Math.clz32:Py,ky=Math.log,Dy=Math.LN2;function Py(s){return s>>>=0,s===0?32:31-(ky(s)/Dy|0)|0}var Yi=64,qi=4194304;function $s(s){switch(s&-s){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return s&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return s}}function Xi(s,o){var d=s.pendingLanes;if(d===0)return 0;var p=0,v=s.suspendedLanes,x=s.pingedLanes,R=d&268435455;if(R!==0){var k=R&~v;k!==0?p=$s(k):(x&=R,x!==0&&(p=$s(x)))}else R=d&~v,R!==0?p=$s(R):x!==0&&(p=$s(x));if(p===0)return 0;if(o!==0&&o!==p&&(o&v)===0&&(v=p&-p,x=o&-o,v>=x||v===16&&(x&4194240)!==0))return o;if((p&4)!==0&&(p|=d&16),o=s.entangledLanes,o!==0)for(s=s.entanglements,o&=p;0<o;)d=31-sn(o),v=1<<d,p|=s[d],o&=~v;return p}function Oy(s,o){switch(s){case 1:case 2:case 4:return o+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return o+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Ny(s,o){for(var d=s.suspendedLanes,p=s.pingedLanes,v=s.expirationTimes,x=s.pendingLanes;0<x;){var R=31-sn(x),k=1<<R,N=v[R];N===-1?((k&d)===0||(k&p)!==0)&&(v[R]=Oy(k,o)):N<=o&&(s.expiredLanes|=k),x&=~k}}function ul(s){return s=s.pendingLanes&-1073741825,s!==0?s:s&1073741824?1073741824:0}function jd(){var s=Yi;return Yi<<=1,(Yi&4194240)===0&&(Yi=64),s}function cl(s){for(var o=[],d=0;31>d;d++)o.push(s);return o}function Gs(s,o,d){s.pendingLanes|=o,o!==536870912&&(s.suspendedLanes=0,s.pingedLanes=0),s=s.eventTimes,o=31-sn(o),s[o]=d}function Fy(s,o){var d=s.pendingLanes&~o;s.pendingLanes=o,s.suspendedLanes=0,s.pingedLanes=0,s.expiredLanes&=o,s.mutableReadLanes&=o,s.entangledLanes&=o,o=s.entanglements;var p=s.eventTimes;for(s=s.expirationTimes;0<d;){var v=31-sn(d),x=1<<v;o[v]=0,p[v]=-1,s[v]=-1,d&=~x}}function dl(s,o){var d=s.entangledLanes|=o;for(s=s.entanglements;d;){var p=31-sn(d),v=1<<p;v&o|s[p]&o&&(s[p]|=o),d&=~v}}var Me=0;function Vd(s){return s&=-s,1<s?4<s?(s&268435455)!==0?16:536870912:4:1}var Hd,fl,Kd,zd,Wd,hl=!1,Qi=[],Xn=null,Qn=null,Jn=null,js=new Map,Vs=new Map,Zn=[],My="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function Yd(s,o){switch(s){case"focusin":case"focusout":Xn=null;break;case"dragenter":case"dragleave":Qn=null;break;case"mouseover":case"mouseout":Jn=null;break;case"pointerover":case"pointerout":js.delete(o.pointerId);break;case"gotpointercapture":case"lostpointercapture":Vs.delete(o.pointerId)}}function Hs(s,o,d,p,v,x){return s===null||s.nativeEvent!==x?(s={blockedOn:o,domEventName:d,eventSystemFlags:p,nativeEvent:x,targetContainers:[v]},o!==null&&(o=si(o),o!==null&&fl(o)),s):(s.eventSystemFlags|=p,o=s.targetContainers,v!==null&&o.indexOf(v)===-1&&o.push(v),s)}function Uy(s,o,d,p,v){switch(o){case"focusin":return Xn=Hs(Xn,s,o,d,p,v),!0;case"dragenter":return Qn=Hs(Qn,s,o,d,p,v),!0;case"mouseover":return Jn=Hs(Jn,s,o,d,p,v),!0;case"pointerover":var x=v.pointerId;return js.set(x,Hs(js.get(x)||null,s,o,d,p,v)),!0;case"gotpointercapture":return x=v.pointerId,Vs.set(x,Hs(Vs.get(x)||null,s,o,d,p,v)),!0}return!1}function qd(s){var o=Rr(s.target);if(o!==null){var d=Ar(o);if(d!==null){if(o=d.tag,o===13){if(o=Od(d),o!==null){s.blockedOn=o,Wd(s.priority,function(){Kd(d)});return}}else if(o===3&&d.stateNode.current.memoizedState.isDehydrated){s.blockedOn=d.tag===3?d.stateNode.containerInfo:null;return}}}s.blockedOn=null}function Ji(s){if(s.blockedOn!==null)return!1;for(var o=s.targetContainers;0<o.length;){var d=pl(s.domEventName,s.eventSystemFlags,o[0],s.nativeEvent);if(d===null){d=s.nativeEvent;var p=new d.constructor(d.type,d);nl=p,d.target.dispatchEvent(p),nl=null}else return o=si(d),o!==null&&fl(o),s.blockedOn=d,!1;o.shift()}return!0}function Xd(s,o,d){Ji(s)&&d.delete(o)}function By(){hl=!1,Xn!==null&&Ji(Xn)&&(Xn=null),Qn!==null&&Ji(Qn)&&(Qn=null),Jn!==null&&Ji(Jn)&&(Jn=null),js.forEach(Xd),Vs.forEach(Xd)}function Ks(s,o){s.blockedOn===o&&(s.blockedOn=null,hl||(hl=!0,e.unstable_scheduleCallback(e.unstable_NormalPriority,By)))}function zs(s){function o(v){return Ks(v,s)}if(0<Qi.length){Ks(Qi[0],s);for(var d=1;d<Qi.length;d++){var p=Qi[d];p.blockedOn===s&&(p.blockedOn=null)}}for(Xn!==null&&Ks(Xn,s),Qn!==null&&Ks(Qn,s),Jn!==null&&Ks(Jn,s),js.forEach(o),Vs.forEach(o),d=0;d<Zn.length;d++)p=Zn[d],p.blockedOn===s&&(p.blockedOn=null);for(;0<Zn.length&&(d=Zn[0],d.blockedOn===null);)qd(d),d.blockedOn===null&&Zn.shift()}var qr=b.ReactCurrentBatchConfig,Zi=!0;function $y(s,o,d,p){var v=Me,x=qr.transition;qr.transition=null;try{Me=1,ml(s,o,d,p)}finally{Me=v,qr.transition=x}}function Gy(s,o,d,p){var v=Me,x=qr.transition;qr.transition=null;try{Me=4,ml(s,o,d,p)}finally{Me=v,qr.transition=x}}function ml(s,o,d,p){if(Zi){var v=pl(s,o,d,p);if(v===null)Dl(s,o,p,ea,d),Yd(s,p);else if(Uy(v,s,o,d,p))p.stopPropagation();else if(Yd(s,p),o&4&&-1<My.indexOf(s)){for(;v!==null;){var x=si(v);if(x!==null&&Hd(x),x=pl(s,o,d,p),x===null&&Dl(s,o,p,ea,d),x===v)break;v=x}v!==null&&p.stopPropagation()}else Dl(s,o,p,null,d)}}var ea=null;function pl(s,o,d,p){if(ea=null,s=rl(p),s=Rr(s),s!==null)if(o=Ar(s),o===null)s=null;else if(d=o.tag,d===13){if(s=Od(o),s!==null)return s;s=null}else if(d===3){if(o.stateNode.current.memoizedState.isDehydrated)return o.tag===3?o.stateNode.containerInfo:null;s=null}else o!==s&&(s=null);return ea=s,null}function Qd(s){switch(s){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(_y()){case ll:return 1;case $d:return 4;case zi:case by:return 16;case Gd:return 536870912;default:return 16}default:return 16}}var er=null,gl=null,ta=null;function Jd(){if(ta)return ta;var s,o=gl,d=o.length,p,v="value"in er?er.value:er.textContent,x=v.length;for(s=0;s<d&&o[s]===v[s];s++);var R=d-s;for(p=1;p<=R&&o[d-p]===v[x-p];p++);return ta=v.slice(s,1<p?1-p:void 0)}function na(s){var o=s.keyCode;return"charCode"in s?(s=s.charCode,s===0&&o===13&&(s=13)):s=o,s===10&&(s=13),32<=s||s===13?s:0}function ra(){return!0}function Zd(){return!1}function Mt(s){function o(d,p,v,x,R){this._reactName=d,this._targetInst=v,this.type=p,this.nativeEvent=x,this.target=R,this.currentTarget=null;for(var k in s)s.hasOwnProperty(k)&&(d=s[k],this[k]=d?d(x):x[k]);return this.isDefaultPrevented=(x.defaultPrevented!=null?x.defaultPrevented:x.returnValue===!1)?ra:Zd,this.isPropagationStopped=Zd,this}return q(o.prototype,{preventDefault:function(){this.defaultPrevented=!0;var d=this.nativeEvent;d&&(d.preventDefault?d.preventDefault():typeof d.returnValue!="unknown"&&(d.returnValue=!1),this.isDefaultPrevented=ra)},stopPropagation:function(){var d=this.nativeEvent;d&&(d.stopPropagation?d.stopPropagation():typeof d.cancelBubble!="unknown"&&(d.cancelBubble=!0),this.isPropagationStopped=ra)},persist:function(){},isPersistent:ra}),o}var Xr={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(s){return s.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},yl=Mt(Xr),Ws=q({},Xr,{view:0,detail:0}),jy=Mt(Ws),vl,El,Ys,sa=q({},Ws,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:Sl,button:0,buttons:0,relatedTarget:function(s){return s.relatedTarget===void 0?s.fromElement===s.srcElement?s.toElement:s.fromElement:s.relatedTarget},movementX:function(s){return"movementX"in s?s.movementX:(s!==Ys&&(Ys&&s.type==="mousemove"?(vl=s.screenX-Ys.screenX,El=s.screenY-Ys.screenY):El=vl=0,Ys=s),vl)},movementY:function(s){return"movementY"in s?s.movementY:El}}),ef=Mt(sa),Vy=q({},sa,{dataTransfer:0}),Hy=Mt(Vy),Ky=q({},Ws,{relatedTarget:0}),xl=Mt(Ky),zy=q({},Xr,{animationName:0,elapsedTime:0,pseudoElement:0}),Wy=Mt(zy),Yy=q({},Xr,{clipboardData:function(s){return"clipboardData"in s?s.clipboardData:window.clipboardData}}),qy=Mt(Yy),Xy=q({},Xr,{data:0}),tf=Mt(Xy),Qy={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Jy={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Zy={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function ev(s){var o=this.nativeEvent;return o.getModifierState?o.getModifierState(s):(s=Zy[s])?!!o[s]:!1}function Sl(){return ev}var tv=q({},Ws,{key:function(s){if(s.key){var o=Qy[s.key]||s.key;if(o!=="Unidentified")return o}return s.type==="keypress"?(s=na(s),s===13?"Enter":String.fromCharCode(s)):s.type==="keydown"||s.type==="keyup"?Jy[s.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:Sl,charCode:function(s){return s.type==="keypress"?na(s):0},keyCode:function(s){return s.type==="keydown"||s.type==="keyup"?s.keyCode:0},which:function(s){return s.type==="keypress"?na(s):s.type==="keydown"||s.type==="keyup"?s.keyCode:0}}),nv=Mt(tv),rv=q({},sa,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),nf=Mt(rv),sv=q({},Ws,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:Sl}),iv=Mt(sv),av=q({},Xr,{propertyName:0,elapsedTime:0,pseudoElement:0}),ov=Mt(av),lv=q({},sa,{deltaX:function(s){return"deltaX"in s?s.deltaX:"wheelDeltaX"in s?-s.wheelDeltaX:0},deltaY:function(s){return"deltaY"in s?s.deltaY:"wheelDeltaY"in s?-s.wheelDeltaY:"wheelDelta"in s?-s.wheelDelta:0},deltaZ:0,deltaMode:0}),uv=Mt(lv),cv=[9,13,27,32],Tl=u&&"CompositionEvent"in window,qs=null;u&&"documentMode"in document&&(qs=document.documentMode);var dv=u&&"TextEvent"in window&&!qs,rf=u&&(!Tl||qs&&8<qs&&11>=qs),sf=" ",af=!1;function of(s,o){switch(s){case"keyup":return cv.indexOf(o.keyCode)!==-1;case"keydown":return o.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function lf(s){return s=s.detail,typeof s=="object"&&"data"in s?s.data:null}var Qr=!1;function fv(s,o){switch(s){case"compositionend":return lf(o);case"keypress":return o.which!==32?null:(af=!0,sf);case"textInput":return s=o.data,s===sf&&af?null:s;default:return null}}function hv(s,o){if(Qr)return s==="compositionend"||!Tl&&of(s,o)?(s=Jd(),ta=gl=er=null,Qr=!1,s):null;switch(s){case"paste":return null;case"keypress":if(!(o.ctrlKey||o.altKey||o.metaKey)||o.ctrlKey&&o.altKey){if(o.char&&1<o.char.length)return o.char;if(o.which)return String.fromCharCode(o.which)}return null;case"compositionend":return rf&&o.locale!=="ko"?null:o.data;default:return null}}var mv={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function uf(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o==="input"?!!mv[s.type]:o==="textarea"}function cf(s,o,d,p){bd(p),o=ua(o,"onChange"),0<o.length&&(d=new yl("onChange","change",null,d,p),s.push({event:d,listeners:o}))}var Xs=null,Qs=null;function pv(s){_f(s,0)}function ia(s){var o=ns(s);if(Vi(o))return s}function gv(s,o){if(s==="change")return o}var df=!1;if(u){var Ll;if(u){var Al="oninput"in document;if(!Al){var ff=document.createElement("div");ff.setAttribute("oninput","return;"),Al=typeof ff.oninput=="function"}Ll=Al}else Ll=!1;df=Ll&&(!document.documentMode||9<document.documentMode)}function hf(){Xs&&(Xs.detachEvent("onpropertychange",mf),Qs=Xs=null)}function mf(s){if(s.propertyName==="value"&&ia(Qs)){var o=[];cf(o,Qs,s,rl(s)),Pd(pv,o)}}function yv(s,o,d){s==="focusin"?(hf(),Xs=o,Qs=d,Xs.attachEvent("onpropertychange",mf)):s==="focusout"&&hf()}function vv(s){if(s==="selectionchange"||s==="keyup"||s==="keydown")return ia(Qs)}function Ev(s,o){if(s==="click")return ia(o)}function xv(s,o){if(s==="input"||s==="change")return ia(o)}function Sv(s,o){return s===o&&(s!==0||1/s===1/o)||s!==s&&o!==o}var an=typeof Object.is=="function"?Object.is:Sv;function Js(s,o){if(an(s,o))return!0;if(typeof s!="object"||s===null||typeof o!="object"||o===null)return!1;var d=Object.keys(s),p=Object.keys(o);if(d.length!==p.length)return!1;for(p=0;p<d.length;p++){var v=d[p];if(!f.call(o,v)||!an(s[v],o[v]))return!1}return!0}function pf(s){for(;s&&s.firstChild;)s=s.firstChild;return s}function gf(s,o){var d=pf(s);s=0;for(var p;d;){if(d.nodeType===3){if(p=s+d.textContent.length,s<=o&&p>=o)return{node:d,offset:o-s};s=p}e:{for(;d;){if(d.nextSibling){d=d.nextSibling;break e}d=d.parentNode}d=void 0}d=pf(d)}}function yf(s,o){return s&&o?s===o?!0:s&&s.nodeType===3?!1:o&&o.nodeType===3?yf(s,o.parentNode):"contains"in s?s.contains(o):s.compareDocumentPosition?!!(s.compareDocumentPosition(o)&16):!1:!1}function vf(){for(var s=window,o=Wn();o instanceof s.HTMLIFrameElement;){try{var d=typeof o.contentWindow.location.href=="string"}catch{d=!1}if(d)s=o.contentWindow;else break;o=Wn(s.document)}return o}function Rl(s){var o=s&&s.nodeName&&s.nodeName.toLowerCase();return o&&(o==="input"&&(s.type==="text"||s.type==="search"||s.type==="tel"||s.type==="url"||s.type==="password")||o==="textarea"||s.contentEditable==="true")}function Tv(s){var o=vf(),d=s.focusedElem,p=s.selectionRange;if(o!==d&&d&&d.ownerDocument&&yf(d.ownerDocument.documentElement,d)){if(p!==null&&Rl(d)){if(o=p.start,s=p.end,s===void 0&&(s=o),"selectionStart"in d)d.selectionStart=o,d.selectionEnd=Math.min(s,d.value.length);else if(s=(o=d.ownerDocument||document)&&o.defaultView||window,s.getSelection){s=s.getSelection();var v=d.textContent.length,x=Math.min(p.start,v);p=p.end===void 0?x:Math.min(p.end,v),!s.extend&&x>p&&(v=p,p=x,x=v),v=gf(d,x);var R=gf(d,p);v&&R&&(s.rangeCount!==1||s.anchorNode!==v.node||s.anchorOffset!==v.offset||s.focusNode!==R.node||s.focusOffset!==R.offset)&&(o=o.createRange(),o.setStart(v.node,v.offset),s.removeAllRanges(),x>p?(s.addRange(o),s.extend(R.node,R.offset)):(o.setEnd(R.node,R.offset),s.addRange(o)))}}for(o=[],s=d;s=s.parentNode;)s.nodeType===1&&o.push({element:s,left:s.scrollLeft,top:s.scrollTop});for(typeof d.focus=="function"&&d.focus(),d=0;d<o.length;d++)s=o[d],s.element.scrollLeft=s.left,s.element.scrollTop=s.top}}var Lv=u&&"documentMode"in document&&11>=document.documentMode,Jr=null,Il=null,Zs=null,wl=!1;function Ef(s,o,d){var p=d.window===d?d.document:d.nodeType===9?d:d.ownerDocument;wl||Jr==null||Jr!==Wn(p)||(p=Jr,"selectionStart"in p&&Rl(p)?p={start:p.selectionStart,end:p.selectionEnd}:(p=(p.ownerDocument&&p.ownerDocument.defaultView||window).getSelection(),p={anchorNode:p.anchorNode,anchorOffset:p.anchorOffset,focusNode:p.focusNode,focusOffset:p.focusOffset}),Zs&&Js(Zs,p)||(Zs=p,p=ua(Il,"onSelect"),0<p.length&&(o=new yl("onSelect","select",null,o,d),s.push({event:o,listeners:p}),o.target=Jr)))}function aa(s,o){var d={};return d[s.toLowerCase()]=o.toLowerCase(),d["Webkit"+s]="webkit"+o,d["Moz"+s]="moz"+o,d}var Zr={animationend:aa("Animation","AnimationEnd"),animationiteration:aa("Animation","AnimationIteration"),animationstart:aa("Animation","AnimationStart"),transitionend:aa("Transition","TransitionEnd")},_l={},xf={};u&&(xf=document.createElement("div").style,"AnimationEvent"in window||(delete Zr.animationend.animation,delete Zr.animationiteration.animation,delete Zr.animationstart.animation),"TransitionEvent"in window||delete Zr.transitionend.transition);function oa(s){if(_l[s])return _l[s];if(!Zr[s])return s;var o=Zr[s],d;for(d in o)if(o.hasOwnProperty(d)&&d in xf)return _l[s]=o[d];return s}var Sf=oa("animationend"),Tf=oa("animationiteration"),Lf=oa("animationstart"),Af=oa("transitionend"),Rf=new Map,If="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function tr(s,o){Rf.set(s,o),a(o,[s])}for(var bl=0;bl<If.length;bl++){var Cl=If[bl],Av=Cl.toLowerCase(),Rv=Cl[0].toUpperCase()+Cl.slice(1);tr(Av,"on"+Rv)}tr(Sf,"onAnimationEnd"),tr(Tf,"onAnimationIteration"),tr(Lf,"onAnimationStart"),tr("dblclick","onDoubleClick"),tr("focusin","onFocus"),tr("focusout","onBlur"),tr(Af,"onTransitionEnd"),l("onMouseEnter",["mouseout","mouseover"]),l("onMouseLeave",["mouseout","mouseover"]),l("onPointerEnter",["pointerout","pointerover"]),l("onPointerLeave",["pointerout","pointerover"]),a("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),a("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),a("onBeforeInput",["compositionend","keypress","textInput","paste"]),a("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),a("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var ei="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Iv=new Set("cancel close invalid load scroll toggle".split(" ").concat(ei));function wf(s,o,d){var p=s.type||"unknown-event";s.currentTarget=d,Ay(p,o,void 0,s),s.currentTarget=null}function _f(s,o){o=(o&4)!==0;for(var d=0;d<s.length;d++){var p=s[d],v=p.event;p=p.listeners;e:{var x=void 0;if(o)for(var R=p.length-1;0<=R;R--){var k=p[R],N=k.instance,z=k.currentTarget;if(k=k.listener,N!==x&&v.isPropagationStopped())break e;wf(v,k,z),x=N}else for(R=0;R<p.length;R++){if(k=p[R],N=k.instance,z=k.currentTarget,k=k.listener,N!==x&&v.isPropagationStopped())break e;wf(v,k,z),x=N}}}if(Ki)throw s=ol,Ki=!1,ol=null,s}function Ve(s,o){var d=o[Ul];d===void 0&&(d=o[Ul]=new Set);var p=s+"__bubble";d.has(p)||(bf(o,s,2,!1),d.add(p))}function kl(s,o,d){var p=0;o&&(p|=4),bf(d,s,p,o)}var la="_reactListening"+Math.random().toString(36).slice(2);function ti(s){if(!s[la]){s[la]=!0,n.forEach(function(d){d!=="selectionchange"&&(Iv.has(d)||kl(d,!1,s),kl(d,!0,s))});var o=s.nodeType===9?s:s.ownerDocument;o===null||o[la]||(o[la]=!0,kl("selectionchange",!1,o))}}function bf(s,o,d,p){switch(Qd(o)){case 1:var v=$y;break;case 4:v=Gy;break;default:v=ml}d=v.bind(null,o,d,s),v=void 0,!al||o!=="touchstart"&&o!=="touchmove"&&o!=="wheel"||(v=!0),p?v!==void 0?s.addEventListener(o,d,{capture:!0,passive:v}):s.addEventListener(o,d,!0):v!==void 0?s.addEventListener(o,d,{passive:v}):s.addEventListener(o,d,!1)}function Dl(s,o,d,p,v){var x=p;if((o&1)===0&&(o&2)===0&&p!==null)e:for(;;){if(p===null)return;var R=p.tag;if(R===3||R===4){var k=p.stateNode.containerInfo;if(k===v||k.nodeType===8&&k.parentNode===v)break;if(R===4)for(R=p.return;R!==null;){var N=R.tag;if((N===3||N===4)&&(N=R.stateNode.containerInfo,N===v||N.nodeType===8&&N.parentNode===v))return;R=R.return}for(;k!==null;){if(R=Rr(k),R===null)return;if(N=R.tag,N===5||N===6){p=x=R;continue e}k=k.parentNode}}p=p.return}Pd(function(){var z=x,te=rl(d),ne=[];e:{var Z=Rf.get(s);if(Z!==void 0){var fe=yl,ye=s;switch(s){case"keypress":if(na(d)===0)break e;case"keydown":case"keyup":fe=nv;break;case"focusin":ye="focus",fe=xl;break;case"focusout":ye="blur",fe=xl;break;case"beforeblur":case"afterblur":fe=xl;break;case"click":if(d.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":fe=ef;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":fe=Hy;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":fe=iv;break;case Sf:case Tf:case Lf:fe=Wy;break;case Af:fe=ov;break;case"scroll":fe=jy;break;case"wheel":fe=uv;break;case"copy":case"cut":case"paste":fe=qy;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":fe=nf}var ve=(o&4)!==0,Ze=!ve&&s==="scroll",V=ve?Z!==null?Z+"Capture":null:Z;ve=[];for(var F=z,K;F!==null;){K=F;var se=K.stateNode;if(K.tag===5&&se!==null&&(K=se,V!==null&&(se=Ms(F,V),se!=null&&ve.push(ni(F,se,K)))),Ze)break;F=F.return}0<ve.length&&(Z=new fe(Z,ye,null,d,te),ne.push({event:Z,listeners:ve}))}}if((o&7)===0){e:{if(Z=s==="mouseover"||s==="pointerover",fe=s==="mouseout"||s==="pointerout",Z&&d!==nl&&(ye=d.relatedTarget||d.fromElement)&&(Rr(ye)||ye[kn]))break e;if((fe||Z)&&(Z=te.window===te?te:(Z=te.ownerDocument)?Z.defaultView||Z.parentWindow:window,fe?(ye=d.relatedTarget||d.toElement,fe=z,ye=ye?Rr(ye):null,ye!==null&&(Ze=Ar(ye),ye!==Ze||ye.tag!==5&&ye.tag!==6)&&(ye=null)):(fe=null,ye=z),fe!==ye)){if(ve=ef,se="onMouseLeave",V="onMouseEnter",F="mouse",(s==="pointerout"||s==="pointerover")&&(ve=nf,se="onPointerLeave",V="onPointerEnter",F="pointer"),Ze=fe==null?Z:ns(fe),K=ye==null?Z:ns(ye),Z=new ve(se,F+"leave",fe,d,te),Z.target=Ze,Z.relatedTarget=K,se=null,Rr(te)===z&&(ve=new ve(V,F+"enter",ye,d,te),ve.target=K,ve.relatedTarget=Ze,se=ve),Ze=se,fe&&ye)t:{for(ve=fe,V=ye,F=0,K=ve;K;K=es(K))F++;for(K=0,se=V;se;se=es(se))K++;for(;0<F-K;)ve=es(ve),F--;for(;0<K-F;)V=es(V),K--;for(;F--;){if(ve===V||V!==null&&ve===V.alternate)break t;ve=es(ve),V=es(V)}ve=null}else ve=null;fe!==null&&Cf(ne,Z,fe,ve,!1),ye!==null&&Ze!==null&&Cf(ne,Ze,ye,ve,!0)}}e:{if(Z=z?ns(z):window,fe=Z.nodeName&&Z.nodeName.toLowerCase(),fe==="select"||fe==="input"&&Z.type==="file")var Ee=gv;else if(uf(Z))if(df)Ee=xv;else{Ee=vv;var Se=yv}else(fe=Z.nodeName)&&fe.toLowerCase()==="input"&&(Z.type==="checkbox"||Z.type==="radio")&&(Ee=Ev);if(Ee&&(Ee=Ee(s,z))){cf(ne,Ee,d,te);break e}Se&&Se(s,Z,z),s==="focusout"&&(Se=Z._wrapperState)&&Se.controlled&&Z.type==="number"&&tn(Z,"number",Z.value)}switch(Se=z?ns(z):window,s){case"focusin":(uf(Se)||Se.contentEditable==="true")&&(Jr=Se,Il=z,Zs=null);break;case"focusout":Zs=Il=Jr=null;break;case"mousedown":wl=!0;break;case"contextmenu":case"mouseup":case"dragend":wl=!1,Ef(ne,d,te);break;case"selectionchange":if(Lv)break;case"keydown":case"keyup":Ef(ne,d,te)}var Te;if(Tl)e:{switch(s){case"compositionstart":var Ae="onCompositionStart";break e;case"compositionend":Ae="onCompositionEnd";break e;case"compositionupdate":Ae="onCompositionUpdate";break e}Ae=void 0}else Qr?of(s,d)&&(Ae="onCompositionEnd"):s==="keydown"&&d.keyCode===229&&(Ae="onCompositionStart");Ae&&(rf&&d.locale!=="ko"&&(Qr||Ae!=="onCompositionStart"?Ae==="onCompositionEnd"&&Qr&&(Te=Jd()):(er=te,gl="value"in er?er.value:er.textContent,Qr=!0)),Se=ua(z,Ae),0<Se.length&&(Ae=new tf(Ae,s,null,d,te),ne.push({event:Ae,listeners:Se}),Te?Ae.data=Te:(Te=lf(d),Te!==null&&(Ae.data=Te)))),(Te=dv?fv(s,d):hv(s,d))&&(z=ua(z,"onBeforeInput"),0<z.length&&(te=new tf("onBeforeInput","beforeinput",null,d,te),ne.push({event:te,listeners:z}),te.data=Te))}_f(ne,o)})}function ni(s,o,d){return{instance:s,listener:o,currentTarget:d}}function ua(s,o){for(var d=o+"Capture",p=[];s!==null;){var v=s,x=v.stateNode;v.tag===5&&x!==null&&(v=x,x=Ms(s,d),x!=null&&p.unshift(ni(s,x,v)),x=Ms(s,o),x!=null&&p.push(ni(s,x,v))),s=s.return}return p}function es(s){if(s===null)return null;do s=s.return;while(s&&s.tag!==5);return s||null}function Cf(s,o,d,p,v){for(var x=o._reactName,R=[];d!==null&&d!==p;){var k=d,N=k.alternate,z=k.stateNode;if(N!==null&&N===p)break;k.tag===5&&z!==null&&(k=z,v?(N=Ms(d,x),N!=null&&R.unshift(ni(d,N,k))):v||(N=Ms(d,x),N!=null&&R.push(ni(d,N,k)))),d=d.return}R.length!==0&&s.push({event:o,listeners:R})}var wv=/\r\n?/g,_v=/\u0000|\uFFFD/g;function kf(s){return(typeof s=="string"?s:""+s).replace(wv,`
`).replace(_v,"")}function ca(s,o,d){if(o=kf(o),kf(s)!==o&&d)throw Error(t(425))}function da(){}var Pl=null,Ol=null;function Nl(s,o){return s==="textarea"||s==="noscript"||typeof o.children=="string"||typeof o.children=="number"||typeof o.dangerouslySetInnerHTML=="object"&&o.dangerouslySetInnerHTML!==null&&o.dangerouslySetInnerHTML.__html!=null}var Fl=typeof setTimeout=="function"?setTimeout:void 0,bv=typeof clearTimeout=="function"?clearTimeout:void 0,Df=typeof Promise=="function"?Promise:void 0,Cv=typeof queueMicrotask=="function"?queueMicrotask:typeof Df<"u"?function(s){return Df.resolve(null).then(s).catch(kv)}:Fl;function kv(s){setTimeout(function(){throw s})}function Ml(s,o){var d=o,p=0;do{var v=d.nextSibling;if(s.removeChild(d),v&&v.nodeType===8)if(d=v.data,d==="/$"){if(p===0){s.removeChild(v),zs(o);return}p--}else d!=="$"&&d!=="$?"&&d!=="$!"||p++;d=v}while(d);zs(o)}function nr(s){for(;s!=null;s=s.nextSibling){var o=s.nodeType;if(o===1||o===3)break;if(o===8){if(o=s.data,o==="$"||o==="$!"||o==="$?")break;if(o==="/$")return null}}return s}function Pf(s){s=s.previousSibling;for(var o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="$"||d==="$!"||d==="$?"){if(o===0)return s;o--}else d==="/$"&&o++}s=s.previousSibling}return null}var ts=Math.random().toString(36).slice(2),vn="__reactFiber$"+ts,ri="__reactProps$"+ts,kn="__reactContainer$"+ts,Ul="__reactEvents$"+ts,Dv="__reactListeners$"+ts,Pv="__reactHandles$"+ts;function Rr(s){var o=s[vn];if(o)return o;for(var d=s.parentNode;d;){if(o=d[kn]||d[vn]){if(d=o.alternate,o.child!==null||d!==null&&d.child!==null)for(s=Pf(s);s!==null;){if(d=s[vn])return d;s=Pf(s)}return o}s=d,d=s.parentNode}return null}function si(s){return s=s[vn]||s[kn],!s||s.tag!==5&&s.tag!==6&&s.tag!==13&&s.tag!==3?null:s}function ns(s){if(s.tag===5||s.tag===6)return s.stateNode;throw Error(t(33))}function fa(s){return s[ri]||null}var Bl=[],rs=-1;function rr(s){return{current:s}}function He(s){0>rs||(s.current=Bl[rs],Bl[rs]=null,rs--)}function je(s,o){rs++,Bl[rs]=s.current,s.current=o}var sr={},yt=rr(sr),It=rr(!1),Ir=sr;function ss(s,o){var d=s.type.contextTypes;if(!d)return sr;var p=s.stateNode;if(p&&p.__reactInternalMemoizedUnmaskedChildContext===o)return p.__reactInternalMemoizedMaskedChildContext;var v={},x;for(x in d)v[x]=o[x];return p&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=o,s.__reactInternalMemoizedMaskedChildContext=v),v}function wt(s){return s=s.childContextTypes,s!=null}function ha(){He(It),He(yt)}function Of(s,o,d){if(yt.current!==sr)throw Error(t(168));je(yt,o),je(It,d)}function Nf(s,o,d){var p=s.stateNode;if(o=o.childContextTypes,typeof p.getChildContext!="function")return d;p=p.getChildContext();for(var v in p)if(!(v in o))throw Error(t(108,Le(s)||"Unknown",v));return q({},d,p)}function ma(s){return s=(s=s.stateNode)&&s.__reactInternalMemoizedMergedChildContext||sr,Ir=yt.current,je(yt,s),je(It,It.current),!0}function Ff(s,o,d){var p=s.stateNode;if(!p)throw Error(t(169));d?(s=Nf(s,o,Ir),p.__reactInternalMemoizedMergedChildContext=s,He(It),He(yt),je(yt,s)):He(It),je(It,d)}var Dn=null,pa=!1,$l=!1;function Mf(s){Dn===null?Dn=[s]:Dn.push(s)}function Ov(s){pa=!0,Mf(s)}function ir(){if(!$l&&Dn!==null){$l=!0;var s=0,o=Me;try{var d=Dn;for(Me=1;s<d.length;s++){var p=d[s];do p=p(!0);while(p!==null)}Dn=null,pa=!1}catch(v){throw Dn!==null&&(Dn=Dn.slice(s+1)),Ud(ll,ir),v}finally{Me=o,$l=!1}}return null}var is=[],as=0,ga=null,ya=0,Kt=[],zt=0,wr=null,Pn=1,On="";function _r(s,o){is[as++]=ya,is[as++]=ga,ga=s,ya=o}function Uf(s,o,d){Kt[zt++]=Pn,Kt[zt++]=On,Kt[zt++]=wr,wr=s;var p=Pn;s=On;var v=32-sn(p)-1;p&=~(1<<v),d+=1;var x=32-sn(o)+v;if(30<x){var R=v-v%5;x=(p&(1<<R)-1).toString(32),p>>=R,v-=R,Pn=1<<32-sn(o)+v|d<<v|p,On=x+s}else Pn=1<<x|d<<v|p,On=s}function Gl(s){s.return!==null&&(_r(s,1),Uf(s,1,0))}function jl(s){for(;s===ga;)ga=is[--as],is[as]=null,ya=is[--as],is[as]=null;for(;s===wr;)wr=Kt[--zt],Kt[zt]=null,On=Kt[--zt],Kt[zt]=null,Pn=Kt[--zt],Kt[zt]=null}var Ut=null,Bt=null,ze=!1,on=null;function Bf(s,o){var d=Xt(5,null,null,0);d.elementType="DELETED",d.stateNode=o,d.return=s,o=s.deletions,o===null?(s.deletions=[d],s.flags|=16):o.push(d)}function $f(s,o){switch(s.tag){case 5:var d=s.type;return o=o.nodeType!==1||d.toLowerCase()!==o.nodeName.toLowerCase()?null:o,o!==null?(s.stateNode=o,Ut=s,Bt=nr(o.firstChild),!0):!1;case 6:return o=s.pendingProps===""||o.nodeType!==3?null:o,o!==null?(s.stateNode=o,Ut=s,Bt=null,!0):!1;case 13:return o=o.nodeType!==8?null:o,o!==null?(d=wr!==null?{id:Pn,overflow:On}:null,s.memoizedState={dehydrated:o,treeContext:d,retryLane:1073741824},d=Xt(18,null,null,0),d.stateNode=o,d.return=s,s.child=d,Ut=s,Bt=null,!0):!1;default:return!1}}function Vl(s){return(s.mode&1)!==0&&(s.flags&128)===0}function Hl(s){if(ze){var o=Bt;if(o){var d=o;if(!$f(s,o)){if(Vl(s))throw Error(t(418));o=nr(d.nextSibling);var p=Ut;o&&$f(s,o)?Bf(p,d):(s.flags=s.flags&-4097|2,ze=!1,Ut=s)}}else{if(Vl(s))throw Error(t(418));s.flags=s.flags&-4097|2,ze=!1,Ut=s}}}function Gf(s){for(s=s.return;s!==null&&s.tag!==5&&s.tag!==3&&s.tag!==13;)s=s.return;Ut=s}function va(s){if(s!==Ut)return!1;if(!ze)return Gf(s),ze=!0,!1;var o;if((o=s.tag!==3)&&!(o=s.tag!==5)&&(o=s.type,o=o!=="head"&&o!=="body"&&!Nl(s.type,s.memoizedProps)),o&&(o=Bt)){if(Vl(s))throw jf(),Error(t(418));for(;o;)Bf(s,o),o=nr(o.nextSibling)}if(Gf(s),s.tag===13){if(s=s.memoizedState,s=s!==null?s.dehydrated:null,!s)throw Error(t(317));e:{for(s=s.nextSibling,o=0;s;){if(s.nodeType===8){var d=s.data;if(d==="/$"){if(o===0){Bt=nr(s.nextSibling);break e}o--}else d!=="$"&&d!=="$!"&&d!=="$?"||o++}s=s.nextSibling}Bt=null}}else Bt=Ut?nr(s.stateNode.nextSibling):null;return!0}function jf(){for(var s=Bt;s;)s=nr(s.nextSibling)}function os(){Bt=Ut=null,ze=!1}function Kl(s){on===null?on=[s]:on.push(s)}var Nv=b.ReactCurrentBatchConfig;function ii(s,o,d){if(s=d.ref,s!==null&&typeof s!="function"&&typeof s!="object"){if(d._owner){if(d=d._owner,d){if(d.tag!==1)throw Error(t(309));var p=d.stateNode}if(!p)throw Error(t(147,s));var v=p,x=""+s;return o!==null&&o.ref!==null&&typeof o.ref=="function"&&o.ref._stringRef===x?o.ref:(o=function(R){var k=v.refs;R===null?delete k[x]:k[x]=R},o._stringRef=x,o)}if(typeof s!="string")throw Error(t(284));if(!d._owner)throw Error(t(290,s))}return s}function Ea(s,o){throw s=Object.prototype.toString.call(o),Error(t(31,s==="[object Object]"?"object with keys {"+Object.keys(o).join(", ")+"}":s))}function Vf(s){var o=s._init;return o(s._payload)}function Hf(s){function o(V,F){if(s){var K=V.deletions;K===null?(V.deletions=[F],V.flags|=16):K.push(F)}}function d(V,F){if(!s)return null;for(;F!==null;)o(V,F),F=F.sibling;return null}function p(V,F){for(V=new Map;F!==null;)F.key!==null?V.set(F.key,F):V.set(F.index,F),F=F.sibling;return V}function v(V,F){return V=hr(V,F),V.index=0,V.sibling=null,V}function x(V,F,K){return V.index=K,s?(K=V.alternate,K!==null?(K=K.index,K<F?(V.flags|=2,F):K):(V.flags|=2,F)):(V.flags|=1048576,F)}function R(V){return s&&V.alternate===null&&(V.flags|=2),V}function k(V,F,K,se){return F===null||F.tag!==6?(F=Fu(K,V.mode,se),F.return=V,F):(F=v(F,K),F.return=V,F)}function N(V,F,K,se){var Ee=K.type;return Ee===D?te(V,F,K.props.children,se,K.key):F!==null&&(F.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===ie&&Vf(Ee)===F.type)?(se=v(F,K.props),se.ref=ii(V,F,K),se.return=V,se):(se=Va(K.type,K.key,K.props,null,V.mode,se),se.ref=ii(V,F,K),se.return=V,se)}function z(V,F,K,se){return F===null||F.tag!==4||F.stateNode.containerInfo!==K.containerInfo||F.stateNode.implementation!==K.implementation?(F=Mu(K,V.mode,se),F.return=V,F):(F=v(F,K.children||[]),F.return=V,F)}function te(V,F,K,se,Ee){return F===null||F.tag!==7?(F=Fr(K,V.mode,se,Ee),F.return=V,F):(F=v(F,K),F.return=V,F)}function ne(V,F,K){if(typeof F=="string"&&F!==""||typeof F=="number")return F=Fu(""+F,V.mode,K),F.return=V,F;if(typeof F=="object"&&F!==null){switch(F.$$typeof){case P:return K=Va(F.type,F.key,F.props,null,V.mode,K),K.ref=ii(V,null,F),K.return=V,K;case G:return F=Mu(F,V.mode,K),F.return=V,F;case ie:var se=F._init;return ne(V,se(F._payload),K)}if(mt(F)||J(F))return F=Fr(F,V.mode,K,null),F.return=V,F;Ea(V,F)}return null}function Z(V,F,K,se){var Ee=F!==null?F.key:null;if(typeof K=="string"&&K!==""||typeof K=="number")return Ee!==null?null:k(V,F,""+K,se);if(typeof K=="object"&&K!==null){switch(K.$$typeof){case P:return K.key===Ee?N(V,F,K,se):null;case G:return K.key===Ee?z(V,F,K,se):null;case ie:return Ee=K._init,Z(V,F,Ee(K._payload),se)}if(mt(K)||J(K))return Ee!==null?null:te(V,F,K,se,null);Ea(V,K)}return null}function fe(V,F,K,se,Ee){if(typeof se=="string"&&se!==""||typeof se=="number")return V=V.get(K)||null,k(F,V,""+se,Ee);if(typeof se=="object"&&se!==null){switch(se.$$typeof){case P:return V=V.get(se.key===null?K:se.key)||null,N(F,V,se,Ee);case G:return V=V.get(se.key===null?K:se.key)||null,z(F,V,se,Ee);case ie:var Se=se._init;return fe(V,F,K,Se(se._payload),Ee)}if(mt(se)||J(se))return V=V.get(K)||null,te(F,V,se,Ee,null);Ea(F,se)}return null}function ye(V,F,K,se){for(var Ee=null,Se=null,Te=F,Ae=F=0,dt=null;Te!==null&&Ae<K.length;Ae++){Te.index>Ae?(dt=Te,Te=null):dt=Te.sibling;var Ne=Z(V,Te,K[Ae],se);if(Ne===null){Te===null&&(Te=dt);break}s&&Te&&Ne.alternate===null&&o(V,Te),F=x(Ne,F,Ae),Se===null?Ee=Ne:Se.sibling=Ne,Se=Ne,Te=dt}if(Ae===K.length)return d(V,Te),ze&&_r(V,Ae),Ee;if(Te===null){for(;Ae<K.length;Ae++)Te=ne(V,K[Ae],se),Te!==null&&(F=x(Te,F,Ae),Se===null?Ee=Te:Se.sibling=Te,Se=Te);return ze&&_r(V,Ae),Ee}for(Te=p(V,Te);Ae<K.length;Ae++)dt=fe(Te,V,Ae,K[Ae],se),dt!==null&&(s&&dt.alternate!==null&&Te.delete(dt.key===null?Ae:dt.key),F=x(dt,F,Ae),Se===null?Ee=dt:Se.sibling=dt,Se=dt);return s&&Te.forEach(function(mr){return o(V,mr)}),ze&&_r(V,Ae),Ee}function ve(V,F,K,se){var Ee=J(K);if(typeof Ee!="function")throw Error(t(150));if(K=Ee.call(K),K==null)throw Error(t(151));for(var Se=Ee=null,Te=F,Ae=F=0,dt=null,Ne=K.next();Te!==null&&!Ne.done;Ae++,Ne=K.next()){Te.index>Ae?(dt=Te,Te=null):dt=Te.sibling;var mr=Z(V,Te,Ne.value,se);if(mr===null){Te===null&&(Te=dt);break}s&&Te&&mr.alternate===null&&o(V,Te),F=x(mr,F,Ae),Se===null?Ee=mr:Se.sibling=mr,Se=mr,Te=dt}if(Ne.done)return d(V,Te),ze&&_r(V,Ae),Ee;if(Te===null){for(;!Ne.done;Ae++,Ne=K.next())Ne=ne(V,Ne.value,se),Ne!==null&&(F=x(Ne,F,Ae),Se===null?Ee=Ne:Se.sibling=Ne,Se=Ne);return ze&&_r(V,Ae),Ee}for(Te=p(V,Te);!Ne.done;Ae++,Ne=K.next())Ne=fe(Te,V,Ae,Ne.value,se),Ne!==null&&(s&&Ne.alternate!==null&&Te.delete(Ne.key===null?Ae:Ne.key),F=x(Ne,F,Ae),Se===null?Ee=Ne:Se.sibling=Ne,Se=Ne);return s&&Te.forEach(function(mE){return o(V,mE)}),ze&&_r(V,Ae),Ee}function Ze(V,F,K,se){if(typeof K=="object"&&K!==null&&K.type===D&&K.key===null&&(K=K.props.children),typeof K=="object"&&K!==null){switch(K.$$typeof){case P:e:{for(var Ee=K.key,Se=F;Se!==null;){if(Se.key===Ee){if(Ee=K.type,Ee===D){if(Se.tag===7){d(V,Se.sibling),F=v(Se,K.props.children),F.return=V,V=F;break e}}else if(Se.elementType===Ee||typeof Ee=="object"&&Ee!==null&&Ee.$$typeof===ie&&Vf(Ee)===Se.type){d(V,Se.sibling),F=v(Se,K.props),F.ref=ii(V,Se,K),F.return=V,V=F;break e}d(V,Se);break}else o(V,Se);Se=Se.sibling}K.type===D?(F=Fr(K.props.children,V.mode,se,K.key),F.return=V,V=F):(se=Va(K.type,K.key,K.props,null,V.mode,se),se.ref=ii(V,F,K),se.return=V,V=se)}return R(V);case G:e:{for(Se=K.key;F!==null;){if(F.key===Se)if(F.tag===4&&F.stateNode.containerInfo===K.containerInfo&&F.stateNode.implementation===K.implementation){d(V,F.sibling),F=v(F,K.children||[]),F.return=V,V=F;break e}else{d(V,F);break}else o(V,F);F=F.sibling}F=Mu(K,V.mode,se),F.return=V,V=F}return R(V);case ie:return Se=K._init,Ze(V,F,Se(K._payload),se)}if(mt(K))return ye(V,F,K,se);if(J(K))return ve(V,F,K,se);Ea(V,K)}return typeof K=="string"&&K!==""||typeof K=="number"?(K=""+K,F!==null&&F.tag===6?(d(V,F.sibling),F=v(F,K),F.return=V,V=F):(d(V,F),F=Fu(K,V.mode,se),F.return=V,V=F),R(V)):d(V,F)}return Ze}var ls=Hf(!0),Kf=Hf(!1),xa=rr(null),Sa=null,us=null,zl=null;function Wl(){zl=us=Sa=null}function Yl(s){var o=xa.current;He(xa),s._currentValue=o}function ql(s,o,d){for(;s!==null;){var p=s.alternate;if((s.childLanes&o)!==o?(s.childLanes|=o,p!==null&&(p.childLanes|=o)):p!==null&&(p.childLanes&o)!==o&&(p.childLanes|=o),s===d)break;s=s.return}}function cs(s,o){Sa=s,zl=us=null,s=s.dependencies,s!==null&&s.firstContext!==null&&((s.lanes&o)!==0&&(_t=!0),s.firstContext=null)}function Wt(s){var o=s._currentValue;if(zl!==s)if(s={context:s,memoizedValue:o,next:null},us===null){if(Sa===null)throw Error(t(308));us=s,Sa.dependencies={lanes:0,firstContext:s}}else us=us.next=s;return o}var br=null;function Xl(s){br===null?br=[s]:br.push(s)}function zf(s,o,d,p){var v=o.interleaved;return v===null?(d.next=d,Xl(o)):(d.next=v.next,v.next=d),o.interleaved=d,Nn(s,p)}function Nn(s,o){s.lanes|=o;var d=s.alternate;for(d!==null&&(d.lanes|=o),d=s,s=s.return;s!==null;)s.childLanes|=o,d=s.alternate,d!==null&&(d.childLanes|=o),d=s,s=s.return;return d.tag===3?d.stateNode:null}var ar=!1;function Ql(s){s.updateQueue={baseState:s.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function Wf(s,o){s=s.updateQueue,o.updateQueue===s&&(o.updateQueue={baseState:s.baseState,firstBaseUpdate:s.firstBaseUpdate,lastBaseUpdate:s.lastBaseUpdate,shared:s.shared,effects:s.effects})}function Fn(s,o){return{eventTime:s,lane:o,tag:0,payload:null,callback:null,next:null}}function or(s,o,d){var p=s.updateQueue;if(p===null)return null;if(p=p.shared,(Oe&2)!==0){var v=p.pending;return v===null?o.next=o:(o.next=v.next,v.next=o),p.pending=o,Nn(s,d)}return v=p.interleaved,v===null?(o.next=o,Xl(p)):(o.next=v.next,v.next=o),p.interleaved=o,Nn(s,d)}function Ta(s,o,d){if(o=o.updateQueue,o!==null&&(o=o.shared,(d&4194240)!==0)){var p=o.lanes;p&=s.pendingLanes,d|=p,o.lanes=d,dl(s,d)}}function Yf(s,o){var d=s.updateQueue,p=s.alternate;if(p!==null&&(p=p.updateQueue,d===p)){var v=null,x=null;if(d=d.firstBaseUpdate,d!==null){do{var R={eventTime:d.eventTime,lane:d.lane,tag:d.tag,payload:d.payload,callback:d.callback,next:null};x===null?v=x=R:x=x.next=R,d=d.next}while(d!==null);x===null?v=x=o:x=x.next=o}else v=x=o;d={baseState:p.baseState,firstBaseUpdate:v,lastBaseUpdate:x,shared:p.shared,effects:p.effects},s.updateQueue=d;return}s=d.lastBaseUpdate,s===null?d.firstBaseUpdate=o:s.next=o,d.lastBaseUpdate=o}function La(s,o,d,p){var v=s.updateQueue;ar=!1;var x=v.firstBaseUpdate,R=v.lastBaseUpdate,k=v.shared.pending;if(k!==null){v.shared.pending=null;var N=k,z=N.next;N.next=null,R===null?x=z:R.next=z,R=N;var te=s.alternate;te!==null&&(te=te.updateQueue,k=te.lastBaseUpdate,k!==R&&(k===null?te.firstBaseUpdate=z:k.next=z,te.lastBaseUpdate=N))}if(x!==null){var ne=v.baseState;R=0,te=z=N=null,k=x;do{var Z=k.lane,fe=k.eventTime;if((p&Z)===Z){te!==null&&(te=te.next={eventTime:fe,lane:0,tag:k.tag,payload:k.payload,callback:k.callback,next:null});e:{var ye=s,ve=k;switch(Z=o,fe=d,ve.tag){case 1:if(ye=ve.payload,typeof ye=="function"){ne=ye.call(fe,ne,Z);break e}ne=ye;break e;case 3:ye.flags=ye.flags&-65537|128;case 0:if(ye=ve.payload,Z=typeof ye=="function"?ye.call(fe,ne,Z):ye,Z==null)break e;ne=q({},ne,Z);break e;case 2:ar=!0}}k.callback!==null&&k.lane!==0&&(s.flags|=64,Z=v.effects,Z===null?v.effects=[k]:Z.push(k))}else fe={eventTime:fe,lane:Z,tag:k.tag,payload:k.payload,callback:k.callback,next:null},te===null?(z=te=fe,N=ne):te=te.next=fe,R|=Z;if(k=k.next,k===null){if(k=v.shared.pending,k===null)break;Z=k,k=Z.next,Z.next=null,v.lastBaseUpdate=Z,v.shared.pending=null}}while(!0);if(te===null&&(N=ne),v.baseState=N,v.firstBaseUpdate=z,v.lastBaseUpdate=te,o=v.shared.interleaved,o!==null){v=o;do R|=v.lane,v=v.next;while(v!==o)}else x===null&&(v.shared.lanes=0);Dr|=R,s.lanes=R,s.memoizedState=ne}}function qf(s,o,d){if(s=o.effects,o.effects=null,s!==null)for(o=0;o<s.length;o++){var p=s[o],v=p.callback;if(v!==null){if(p.callback=null,p=d,typeof v!="function")throw Error(t(191,v));v.call(p)}}}var ai={},En=rr(ai),oi=rr(ai),li=rr(ai);function Cr(s){if(s===ai)throw Error(t(174));return s}function Jl(s,o){switch(je(li,o),je(oi,s),je(En,ai),s=o.nodeType,s){case 9:case 11:o=(o=o.documentElement)?o.namespaceURI:Kr(null,"");break;default:s=s===8?o.parentNode:o,o=s.namespaceURI||null,s=s.tagName,o=Kr(o,s)}He(En),je(En,o)}function ds(){He(En),He(oi),He(li)}function Xf(s){Cr(li.current);var o=Cr(En.current),d=Kr(o,s.type);o!==d&&(je(oi,s),je(En,d))}function Zl(s){oi.current===s&&(He(En),He(oi))}var We=rr(0);function Aa(s){for(var o=s;o!==null;){if(o.tag===13){var d=o.memoizedState;if(d!==null&&(d=d.dehydrated,d===null||d.data==="$?"||d.data==="$!"))return o}else if(o.tag===19&&o.memoizedProps.revealOrder!==void 0){if((o.flags&128)!==0)return o}else if(o.child!==null){o.child.return=o,o=o.child;continue}if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return null;o=o.return}o.sibling.return=o.return,o=o.sibling}return null}var eu=[];function tu(){for(var s=0;s<eu.length;s++)eu[s]._workInProgressVersionPrimary=null;eu.length=0}var Ra=b.ReactCurrentDispatcher,nu=b.ReactCurrentBatchConfig,kr=0,Ye=null,it=null,ut=null,Ia=!1,ui=!1,ci=0,Fv=0;function vt(){throw Error(t(321))}function ru(s,o){if(o===null)return!1;for(var d=0;d<o.length&&d<s.length;d++)if(!an(s[d],o[d]))return!1;return!0}function su(s,o,d,p,v,x){if(kr=x,Ye=o,o.memoizedState=null,o.updateQueue=null,o.lanes=0,Ra.current=s===null||s.memoizedState===null?$v:Gv,s=d(p,v),ui){x=0;do{if(ui=!1,ci=0,25<=x)throw Error(t(301));x+=1,ut=it=null,o.updateQueue=null,Ra.current=jv,s=d(p,v)}while(ui)}if(Ra.current=ba,o=it!==null&&it.next!==null,kr=0,ut=it=Ye=null,Ia=!1,o)throw Error(t(300));return s}function iu(){var s=ci!==0;return ci=0,s}function xn(){var s={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return ut===null?Ye.memoizedState=ut=s:ut=ut.next=s,ut}function Yt(){if(it===null){var s=Ye.alternate;s=s!==null?s.memoizedState:null}else s=it.next;var o=ut===null?Ye.memoizedState:ut.next;if(o!==null)ut=o,it=s;else{if(s===null)throw Error(t(310));it=s,s={memoizedState:it.memoizedState,baseState:it.baseState,baseQueue:it.baseQueue,queue:it.queue,next:null},ut===null?Ye.memoizedState=ut=s:ut=ut.next=s}return ut}function di(s,o){return typeof o=="function"?o(s):o}function au(s){var o=Yt(),d=o.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=s;var p=it,v=p.baseQueue,x=d.pending;if(x!==null){if(v!==null){var R=v.next;v.next=x.next,x.next=R}p.baseQueue=v=x,d.pending=null}if(v!==null){x=v.next,p=p.baseState;var k=R=null,N=null,z=x;do{var te=z.lane;if((kr&te)===te)N!==null&&(N=N.next={lane:0,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null}),p=z.hasEagerState?z.eagerState:s(p,z.action);else{var ne={lane:te,action:z.action,hasEagerState:z.hasEagerState,eagerState:z.eagerState,next:null};N===null?(k=N=ne,R=p):N=N.next=ne,Ye.lanes|=te,Dr|=te}z=z.next}while(z!==null&&z!==x);N===null?R=p:N.next=k,an(p,o.memoizedState)||(_t=!0),o.memoizedState=p,o.baseState=R,o.baseQueue=N,d.lastRenderedState=p}if(s=d.interleaved,s!==null){v=s;do x=v.lane,Ye.lanes|=x,Dr|=x,v=v.next;while(v!==s)}else v===null&&(d.lanes=0);return[o.memoizedState,d.dispatch]}function ou(s){var o=Yt(),d=o.queue;if(d===null)throw Error(t(311));d.lastRenderedReducer=s;var p=d.dispatch,v=d.pending,x=o.memoizedState;if(v!==null){d.pending=null;var R=v=v.next;do x=s(x,R.action),R=R.next;while(R!==v);an(x,o.memoizedState)||(_t=!0),o.memoizedState=x,o.baseQueue===null&&(o.baseState=x),d.lastRenderedState=x}return[x,p]}function Qf(){}function Jf(s,o){var d=Ye,p=Yt(),v=o(),x=!an(p.memoizedState,v);if(x&&(p.memoizedState=v,_t=!0),p=p.queue,lu(th.bind(null,d,p,s),[s]),p.getSnapshot!==o||x||ut!==null&&ut.memoizedState.tag&1){if(d.flags|=2048,fi(9,eh.bind(null,d,p,v,o),void 0,null),ct===null)throw Error(t(349));(kr&30)!==0||Zf(d,o,v)}return v}function Zf(s,o,d){s.flags|=16384,s={getSnapshot:o,value:d},o=Ye.updateQueue,o===null?(o={lastEffect:null,stores:null},Ye.updateQueue=o,o.stores=[s]):(d=o.stores,d===null?o.stores=[s]:d.push(s))}function eh(s,o,d,p){o.value=d,o.getSnapshot=p,nh(o)&&rh(s)}function th(s,o,d){return d(function(){nh(o)&&rh(s)})}function nh(s){var o=s.getSnapshot;s=s.value;try{var d=o();return!an(s,d)}catch{return!0}}function rh(s){var o=Nn(s,1);o!==null&&dn(o,s,1,-1)}function sh(s){var o=xn();return typeof s=="function"&&(s=s()),o.memoizedState=o.baseState=s,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:di,lastRenderedState:s},o.queue=s,s=s.dispatch=Bv.bind(null,Ye,s),[o.memoizedState,s]}function fi(s,o,d,p){return s={tag:s,create:o,destroy:d,deps:p,next:null},o=Ye.updateQueue,o===null?(o={lastEffect:null,stores:null},Ye.updateQueue=o,o.lastEffect=s.next=s):(d=o.lastEffect,d===null?o.lastEffect=s.next=s:(p=d.next,d.next=s,s.next=p,o.lastEffect=s)),s}function ih(){return Yt().memoizedState}function wa(s,o,d,p){var v=xn();Ye.flags|=s,v.memoizedState=fi(1|o,d,void 0,p===void 0?null:p)}function _a(s,o,d,p){var v=Yt();p=p===void 0?null:p;var x=void 0;if(it!==null){var R=it.memoizedState;if(x=R.destroy,p!==null&&ru(p,R.deps)){v.memoizedState=fi(o,d,x,p);return}}Ye.flags|=s,v.memoizedState=fi(1|o,d,x,p)}function ah(s,o){return wa(8390656,8,s,o)}function lu(s,o){return _a(2048,8,s,o)}function oh(s,o){return _a(4,2,s,o)}function lh(s,o){return _a(4,4,s,o)}function uh(s,o){if(typeof o=="function")return s=s(),o(s),function(){o(null)};if(o!=null)return s=s(),o.current=s,function(){o.current=null}}function ch(s,o,d){return d=d!=null?d.concat([s]):null,_a(4,4,uh.bind(null,o,s),d)}function uu(){}function dh(s,o){var d=Yt();o=o===void 0?null:o;var p=d.memoizedState;return p!==null&&o!==null&&ru(o,p[1])?p[0]:(d.memoizedState=[s,o],s)}function fh(s,o){var d=Yt();o=o===void 0?null:o;var p=d.memoizedState;return p!==null&&o!==null&&ru(o,p[1])?p[0]:(s=s(),d.memoizedState=[s,o],s)}function hh(s,o,d){return(kr&21)===0?(s.baseState&&(s.baseState=!1,_t=!0),s.memoizedState=d):(an(d,o)||(d=jd(),Ye.lanes|=d,Dr|=d,s.baseState=!0),o)}function Mv(s,o){var d=Me;Me=d!==0&&4>d?d:4,s(!0);var p=nu.transition;nu.transition={};try{s(!1),o()}finally{Me=d,nu.transition=p}}function mh(){return Yt().memoizedState}function Uv(s,o,d){var p=dr(s);if(d={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null},ph(s))gh(o,d);else if(d=zf(s,o,d,p),d!==null){var v=Rt();dn(d,s,p,v),yh(d,o,p)}}function Bv(s,o,d){var p=dr(s),v={lane:p,action:d,hasEagerState:!1,eagerState:null,next:null};if(ph(s))gh(o,v);else{var x=s.alternate;if(s.lanes===0&&(x===null||x.lanes===0)&&(x=o.lastRenderedReducer,x!==null))try{var R=o.lastRenderedState,k=x(R,d);if(v.hasEagerState=!0,v.eagerState=k,an(k,R)){var N=o.interleaved;N===null?(v.next=v,Xl(o)):(v.next=N.next,N.next=v),o.interleaved=v;return}}catch{}finally{}d=zf(s,o,v,p),d!==null&&(v=Rt(),dn(d,s,p,v),yh(d,o,p))}}function ph(s){var o=s.alternate;return s===Ye||o!==null&&o===Ye}function gh(s,o){ui=Ia=!0;var d=s.pending;d===null?o.next=o:(o.next=d.next,d.next=o),s.pending=o}function yh(s,o,d){if((d&4194240)!==0){var p=o.lanes;p&=s.pendingLanes,d|=p,o.lanes=d,dl(s,d)}}var ba={readContext:Wt,useCallback:vt,useContext:vt,useEffect:vt,useImperativeHandle:vt,useInsertionEffect:vt,useLayoutEffect:vt,useMemo:vt,useReducer:vt,useRef:vt,useState:vt,useDebugValue:vt,useDeferredValue:vt,useTransition:vt,useMutableSource:vt,useSyncExternalStore:vt,useId:vt,unstable_isNewReconciler:!1},$v={readContext:Wt,useCallback:function(s,o){return xn().memoizedState=[s,o===void 0?null:o],s},useContext:Wt,useEffect:ah,useImperativeHandle:function(s,o,d){return d=d!=null?d.concat([s]):null,wa(4194308,4,uh.bind(null,o,s),d)},useLayoutEffect:function(s,o){return wa(4194308,4,s,o)},useInsertionEffect:function(s,o){return wa(4,2,s,o)},useMemo:function(s,o){var d=xn();return o=o===void 0?null:o,s=s(),d.memoizedState=[s,o],s},useReducer:function(s,o,d){var p=xn();return o=d!==void 0?d(o):o,p.memoizedState=p.baseState=o,s={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:s,lastRenderedState:o},p.queue=s,s=s.dispatch=Uv.bind(null,Ye,s),[p.memoizedState,s]},useRef:function(s){var o=xn();return s={current:s},o.memoizedState=s},useState:sh,useDebugValue:uu,useDeferredValue:function(s){return xn().memoizedState=s},useTransition:function(){var s=sh(!1),o=s[0];return s=Mv.bind(null,s[1]),xn().memoizedState=s,[o,s]},useMutableSource:function(){},useSyncExternalStore:function(s,o,d){var p=Ye,v=xn();if(ze){if(d===void 0)throw Error(t(407));d=d()}else{if(d=o(),ct===null)throw Error(t(349));(kr&30)!==0||Zf(p,o,d)}v.memoizedState=d;var x={value:d,getSnapshot:o};return v.queue=x,ah(th.bind(null,p,x,s),[s]),p.flags|=2048,fi(9,eh.bind(null,p,x,d,o),void 0,null),d},useId:function(){var s=xn(),o=ct.identifierPrefix;if(ze){var d=On,p=Pn;d=(p&~(1<<32-sn(p)-1)).toString(32)+d,o=":"+o+"R"+d,d=ci++,0<d&&(o+="H"+d.toString(32)),o+=":"}else d=Fv++,o=":"+o+"r"+d.toString(32)+":";return s.memoizedState=o},unstable_isNewReconciler:!1},Gv={readContext:Wt,useCallback:dh,useContext:Wt,useEffect:lu,useImperativeHandle:ch,useInsertionEffect:oh,useLayoutEffect:lh,useMemo:fh,useReducer:au,useRef:ih,useState:function(){return au(di)},useDebugValue:uu,useDeferredValue:function(s){var o=Yt();return hh(o,it.memoizedState,s)},useTransition:function(){var s=au(di)[0],o=Yt().memoizedState;return[s,o]},useMutableSource:Qf,useSyncExternalStore:Jf,useId:mh,unstable_isNewReconciler:!1},jv={readContext:Wt,useCallback:dh,useContext:Wt,useEffect:lu,useImperativeHandle:ch,useInsertionEffect:oh,useLayoutEffect:lh,useMemo:fh,useReducer:ou,useRef:ih,useState:function(){return ou(di)},useDebugValue:uu,useDeferredValue:function(s){var o=Yt();return it===null?o.memoizedState=s:hh(o,it.memoizedState,s)},useTransition:function(){var s=ou(di)[0],o=Yt().memoizedState;return[s,o]},useMutableSource:Qf,useSyncExternalStore:Jf,useId:mh,unstable_isNewReconciler:!1};function ln(s,o){if(s&&s.defaultProps){o=q({},o),s=s.defaultProps;for(var d in s)o[d]===void 0&&(o[d]=s[d]);return o}return o}function cu(s,o,d,p){o=s.memoizedState,d=d(p,o),d=d==null?o:q({},o,d),s.memoizedState=d,s.lanes===0&&(s.updateQueue.baseState=d)}var Ca={isMounted:function(s){return(s=s._reactInternals)?Ar(s)===s:!1},enqueueSetState:function(s,o,d){s=s._reactInternals;var p=Rt(),v=dr(s),x=Fn(p,v);x.payload=o,d!=null&&(x.callback=d),o=or(s,x,v),o!==null&&(dn(o,s,v,p),Ta(o,s,v))},enqueueReplaceState:function(s,o,d){s=s._reactInternals;var p=Rt(),v=dr(s),x=Fn(p,v);x.tag=1,x.payload=o,d!=null&&(x.callback=d),o=or(s,x,v),o!==null&&(dn(o,s,v,p),Ta(o,s,v))},enqueueForceUpdate:function(s,o){s=s._reactInternals;var d=Rt(),p=dr(s),v=Fn(d,p);v.tag=2,o!=null&&(v.callback=o),o=or(s,v,p),o!==null&&(dn(o,s,p,d),Ta(o,s,p))}};function vh(s,o,d,p,v,x,R){return s=s.stateNode,typeof s.shouldComponentUpdate=="function"?s.shouldComponentUpdate(p,x,R):o.prototype&&o.prototype.isPureReactComponent?!Js(d,p)||!Js(v,x):!0}function Eh(s,o,d){var p=!1,v=sr,x=o.contextType;return typeof x=="object"&&x!==null?x=Wt(x):(v=wt(o)?Ir:yt.current,p=o.contextTypes,x=(p=p!=null)?ss(s,v):sr),o=new o(d,x),s.memoizedState=o.state!==null&&o.state!==void 0?o.state:null,o.updater=Ca,s.stateNode=o,o._reactInternals=s,p&&(s=s.stateNode,s.__reactInternalMemoizedUnmaskedChildContext=v,s.__reactInternalMemoizedMaskedChildContext=x),o}function xh(s,o,d,p){s=o.state,typeof o.componentWillReceiveProps=="function"&&o.componentWillReceiveProps(d,p),typeof o.UNSAFE_componentWillReceiveProps=="function"&&o.UNSAFE_componentWillReceiveProps(d,p),o.state!==s&&Ca.enqueueReplaceState(o,o.state,null)}function du(s,o,d,p){var v=s.stateNode;v.props=d,v.state=s.memoizedState,v.refs={},Ql(s);var x=o.contextType;typeof x=="object"&&x!==null?v.context=Wt(x):(x=wt(o)?Ir:yt.current,v.context=ss(s,x)),v.state=s.memoizedState,x=o.getDerivedStateFromProps,typeof x=="function"&&(cu(s,o,x,d),v.state=s.memoizedState),typeof o.getDerivedStateFromProps=="function"||typeof v.getSnapshotBeforeUpdate=="function"||typeof v.UNSAFE_componentWillMount!="function"&&typeof v.componentWillMount!="function"||(o=v.state,typeof v.componentWillMount=="function"&&v.componentWillMount(),typeof v.UNSAFE_componentWillMount=="function"&&v.UNSAFE_componentWillMount(),o!==v.state&&Ca.enqueueReplaceState(v,v.state,null),La(s,d,v,p),v.state=s.memoizedState),typeof v.componentDidMount=="function"&&(s.flags|=4194308)}function fs(s,o){try{var d="",p=o;do d+=ge(p),p=p.return;while(p);var v=d}catch(x){v=`
Error generating stack: `+x.message+`
`+x.stack}return{value:s,source:o,stack:v,digest:null}}function fu(s,o,d){return{value:s,source:null,stack:d??null,digest:o??null}}function hu(s,o){try{console.error(o.value)}catch(d){setTimeout(function(){throw d})}}var Vv=typeof WeakMap=="function"?WeakMap:Map;function Sh(s,o,d){d=Fn(-1,d),d.tag=3,d.payload={element:null};var p=o.value;return d.callback=function(){Ma||(Ma=!0,_u=p),hu(s,o)},d}function Th(s,o,d){d=Fn(-1,d),d.tag=3;var p=s.type.getDerivedStateFromError;if(typeof p=="function"){var v=o.value;d.payload=function(){return p(v)},d.callback=function(){hu(s,o)}}var x=s.stateNode;return x!==null&&typeof x.componentDidCatch=="function"&&(d.callback=function(){hu(s,o),typeof p!="function"&&(ur===null?ur=new Set([this]):ur.add(this));var R=o.stack;this.componentDidCatch(o.value,{componentStack:R!==null?R:""})}),d}function Lh(s,o,d){var p=s.pingCache;if(p===null){p=s.pingCache=new Vv;var v=new Set;p.set(o,v)}else v=p.get(o),v===void 0&&(v=new Set,p.set(o,v));v.has(d)||(v.add(d),s=rE.bind(null,s,o,d),o.then(s,s))}function Ah(s){do{var o;if((o=s.tag===13)&&(o=s.memoizedState,o=o!==null?o.dehydrated!==null:!0),o)return s;s=s.return}while(s!==null);return null}function Rh(s,o,d,p,v){return(s.mode&1)===0?(s===o?s.flags|=65536:(s.flags|=128,d.flags|=131072,d.flags&=-52805,d.tag===1&&(d.alternate===null?d.tag=17:(o=Fn(-1,1),o.tag=2,or(d,o,1))),d.lanes|=1),s):(s.flags|=65536,s.lanes=v,s)}var Hv=b.ReactCurrentOwner,_t=!1;function At(s,o,d,p){o.child=s===null?Kf(o,null,d,p):ls(o,s.child,d,p)}function Ih(s,o,d,p,v){d=d.render;var x=o.ref;return cs(o,v),p=su(s,o,d,p,x,v),d=iu(),s!==null&&!_t?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~v,Mn(s,o,v)):(ze&&d&&Gl(o),o.flags|=1,At(s,o,p,v),o.child)}function wh(s,o,d,p,v){if(s===null){var x=d.type;return typeof x=="function"&&!Nu(x)&&x.defaultProps===void 0&&d.compare===null&&d.defaultProps===void 0?(o.tag=15,o.type=x,_h(s,o,x,p,v)):(s=Va(d.type,null,p,o,o.mode,v),s.ref=o.ref,s.return=o,o.child=s)}if(x=s.child,(s.lanes&v)===0){var R=x.memoizedProps;if(d=d.compare,d=d!==null?d:Js,d(R,p)&&s.ref===o.ref)return Mn(s,o,v)}return o.flags|=1,s=hr(x,p),s.ref=o.ref,s.return=o,o.child=s}function _h(s,o,d,p,v){if(s!==null){var x=s.memoizedProps;if(Js(x,p)&&s.ref===o.ref)if(_t=!1,o.pendingProps=p=x,(s.lanes&v)!==0)(s.flags&131072)!==0&&(_t=!0);else return o.lanes=s.lanes,Mn(s,o,v)}return mu(s,o,d,p,v)}function bh(s,o,d){var p=o.pendingProps,v=p.children,x=s!==null?s.memoizedState:null;if(p.mode==="hidden")if((o.mode&1)===0)o.memoizedState={baseLanes:0,cachePool:null,transitions:null},je(ms,$t),$t|=d;else{if((d&1073741824)===0)return s=x!==null?x.baseLanes|d:d,o.lanes=o.childLanes=1073741824,o.memoizedState={baseLanes:s,cachePool:null,transitions:null},o.updateQueue=null,je(ms,$t),$t|=s,null;o.memoizedState={baseLanes:0,cachePool:null,transitions:null},p=x!==null?x.baseLanes:d,je(ms,$t),$t|=p}else x!==null?(p=x.baseLanes|d,o.memoizedState=null):p=d,je(ms,$t),$t|=p;return At(s,o,v,d),o.child}function Ch(s,o){var d=o.ref;(s===null&&d!==null||s!==null&&s.ref!==d)&&(o.flags|=512,o.flags|=2097152)}function mu(s,o,d,p,v){var x=wt(d)?Ir:yt.current;return x=ss(o,x),cs(o,v),d=su(s,o,d,p,x,v),p=iu(),s!==null&&!_t?(o.updateQueue=s.updateQueue,o.flags&=-2053,s.lanes&=~v,Mn(s,o,v)):(ze&&p&&Gl(o),o.flags|=1,At(s,o,d,v),o.child)}function kh(s,o,d,p,v){if(wt(d)){var x=!0;ma(o)}else x=!1;if(cs(o,v),o.stateNode===null)Da(s,o),Eh(o,d,p),du(o,d,p,v),p=!0;else if(s===null){var R=o.stateNode,k=o.memoizedProps;R.props=k;var N=R.context,z=d.contextType;typeof z=="object"&&z!==null?z=Wt(z):(z=wt(d)?Ir:yt.current,z=ss(o,z));var te=d.getDerivedStateFromProps,ne=typeof te=="function"||typeof R.getSnapshotBeforeUpdate=="function";ne||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(k!==p||N!==z)&&xh(o,R,p,z),ar=!1;var Z=o.memoizedState;R.state=Z,La(o,p,R,v),N=o.memoizedState,k!==p||Z!==N||It.current||ar?(typeof te=="function"&&(cu(o,d,te,p),N=o.memoizedState),(k=ar||vh(o,d,k,p,Z,N,z))?(ne||typeof R.UNSAFE_componentWillMount!="function"&&typeof R.componentWillMount!="function"||(typeof R.componentWillMount=="function"&&R.componentWillMount(),typeof R.UNSAFE_componentWillMount=="function"&&R.UNSAFE_componentWillMount()),typeof R.componentDidMount=="function"&&(o.flags|=4194308)):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),o.memoizedProps=p,o.memoizedState=N),R.props=p,R.state=N,R.context=z,p=k):(typeof R.componentDidMount=="function"&&(o.flags|=4194308),p=!1)}else{R=o.stateNode,Wf(s,o),k=o.memoizedProps,z=o.type===o.elementType?k:ln(o.type,k),R.props=z,ne=o.pendingProps,Z=R.context,N=d.contextType,typeof N=="object"&&N!==null?N=Wt(N):(N=wt(d)?Ir:yt.current,N=ss(o,N));var fe=d.getDerivedStateFromProps;(te=typeof fe=="function"||typeof R.getSnapshotBeforeUpdate=="function")||typeof R.UNSAFE_componentWillReceiveProps!="function"&&typeof R.componentWillReceiveProps!="function"||(k!==ne||Z!==N)&&xh(o,R,p,N),ar=!1,Z=o.memoizedState,R.state=Z,La(o,p,R,v);var ye=o.memoizedState;k!==ne||Z!==ye||It.current||ar?(typeof fe=="function"&&(cu(o,d,fe,p),ye=o.memoizedState),(z=ar||vh(o,d,z,p,Z,ye,N)||!1)?(te||typeof R.UNSAFE_componentWillUpdate!="function"&&typeof R.componentWillUpdate!="function"||(typeof R.componentWillUpdate=="function"&&R.componentWillUpdate(p,ye,N),typeof R.UNSAFE_componentWillUpdate=="function"&&R.UNSAFE_componentWillUpdate(p,ye,N)),typeof R.componentDidUpdate=="function"&&(o.flags|=4),typeof R.getSnapshotBeforeUpdate=="function"&&(o.flags|=1024)):(typeof R.componentDidUpdate!="function"||k===s.memoizedProps&&Z===s.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&Z===s.memoizedState||(o.flags|=1024),o.memoizedProps=p,o.memoizedState=ye),R.props=p,R.state=ye,R.context=N,p=z):(typeof R.componentDidUpdate!="function"||k===s.memoizedProps&&Z===s.memoizedState||(o.flags|=4),typeof R.getSnapshotBeforeUpdate!="function"||k===s.memoizedProps&&Z===s.memoizedState||(o.flags|=1024),p=!1)}return pu(s,o,d,p,x,v)}function pu(s,o,d,p,v,x){Ch(s,o);var R=(o.flags&128)!==0;if(!p&&!R)return v&&Ff(o,d,!1),Mn(s,o,x);p=o.stateNode,Hv.current=o;var k=R&&typeof d.getDerivedStateFromError!="function"?null:p.render();return o.flags|=1,s!==null&&R?(o.child=ls(o,s.child,null,x),o.child=ls(o,null,k,x)):At(s,o,k,x),o.memoizedState=p.state,v&&Ff(o,d,!0),o.child}function Dh(s){var o=s.stateNode;o.pendingContext?Of(s,o.pendingContext,o.pendingContext!==o.context):o.context&&Of(s,o.context,!1),Jl(s,o.containerInfo)}function Ph(s,o,d,p,v){return os(),Kl(v),o.flags|=256,At(s,o,d,p),o.child}var gu={dehydrated:null,treeContext:null,retryLane:0};function yu(s){return{baseLanes:s,cachePool:null,transitions:null}}function Oh(s,o,d){var p=o.pendingProps,v=We.current,x=!1,R=(o.flags&128)!==0,k;if((k=R)||(k=s!==null&&s.memoizedState===null?!1:(v&2)!==0),k?(x=!0,o.flags&=-129):(s===null||s.memoizedState!==null)&&(v|=1),je(We,v&1),s===null)return Hl(o),s=o.memoizedState,s!==null&&(s=s.dehydrated,s!==null)?((o.mode&1)===0?o.lanes=1:s.data==="$!"?o.lanes=8:o.lanes=1073741824,null):(R=p.children,s=p.fallback,x?(p=o.mode,x=o.child,R={mode:"hidden",children:R},(p&1)===0&&x!==null?(x.childLanes=0,x.pendingProps=R):x=Ha(R,p,0,null),s=Fr(s,p,d,null),x.return=o,s.return=o,x.sibling=s,o.child=x,o.child.memoizedState=yu(d),o.memoizedState=gu,s):vu(o,R));if(v=s.memoizedState,v!==null&&(k=v.dehydrated,k!==null))return Kv(s,o,R,p,k,v,d);if(x){x=p.fallback,R=o.mode,v=s.child,k=v.sibling;var N={mode:"hidden",children:p.children};return(R&1)===0&&o.child!==v?(p=o.child,p.childLanes=0,p.pendingProps=N,o.deletions=null):(p=hr(v,N),p.subtreeFlags=v.subtreeFlags&14680064),k!==null?x=hr(k,x):(x=Fr(x,R,d,null),x.flags|=2),x.return=o,p.return=o,p.sibling=x,o.child=p,p=x,x=o.child,R=s.child.memoizedState,R=R===null?yu(d):{baseLanes:R.baseLanes|d,cachePool:null,transitions:R.transitions},x.memoizedState=R,x.childLanes=s.childLanes&~d,o.memoizedState=gu,p}return x=s.child,s=x.sibling,p=hr(x,{mode:"visible",children:p.children}),(o.mode&1)===0&&(p.lanes=d),p.return=o,p.sibling=null,s!==null&&(d=o.deletions,d===null?(o.deletions=[s],o.flags|=16):d.push(s)),o.child=p,o.memoizedState=null,p}function vu(s,o){return o=Ha({mode:"visible",children:o},s.mode,0,null),o.return=s,s.child=o}function ka(s,o,d,p){return p!==null&&Kl(p),ls(o,s.child,null,d),s=vu(o,o.pendingProps.children),s.flags|=2,o.memoizedState=null,s}function Kv(s,o,d,p,v,x,R){if(d)return o.flags&256?(o.flags&=-257,p=fu(Error(t(422))),ka(s,o,R,p)):o.memoizedState!==null?(o.child=s.child,o.flags|=128,null):(x=p.fallback,v=o.mode,p=Ha({mode:"visible",children:p.children},v,0,null),x=Fr(x,v,R,null),x.flags|=2,p.return=o,x.return=o,p.sibling=x,o.child=p,(o.mode&1)!==0&&ls(o,s.child,null,R),o.child.memoizedState=yu(R),o.memoizedState=gu,x);if((o.mode&1)===0)return ka(s,o,R,null);if(v.data==="$!"){if(p=v.nextSibling&&v.nextSibling.dataset,p)var k=p.dgst;return p=k,x=Error(t(419)),p=fu(x,p,void 0),ka(s,o,R,p)}if(k=(R&s.childLanes)!==0,_t||k){if(p=ct,p!==null){switch(R&-R){case 4:v=2;break;case 16:v=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:v=32;break;case 536870912:v=268435456;break;default:v=0}v=(v&(p.suspendedLanes|R))!==0?0:v,v!==0&&v!==x.retryLane&&(x.retryLane=v,Nn(s,v),dn(p,s,v,-1))}return Ou(),p=fu(Error(t(421))),ka(s,o,R,p)}return v.data==="$?"?(o.flags|=128,o.child=s.child,o=sE.bind(null,s),v._reactRetry=o,null):(s=x.treeContext,Bt=nr(v.nextSibling),Ut=o,ze=!0,on=null,s!==null&&(Kt[zt++]=Pn,Kt[zt++]=On,Kt[zt++]=wr,Pn=s.id,On=s.overflow,wr=o),o=vu(o,p.children),o.flags|=4096,o)}function Nh(s,o,d){s.lanes|=o;var p=s.alternate;p!==null&&(p.lanes|=o),ql(s.return,o,d)}function Eu(s,o,d,p,v){var x=s.memoizedState;x===null?s.memoizedState={isBackwards:o,rendering:null,renderingStartTime:0,last:p,tail:d,tailMode:v}:(x.isBackwards=o,x.rendering=null,x.renderingStartTime=0,x.last=p,x.tail=d,x.tailMode=v)}function Fh(s,o,d){var p=o.pendingProps,v=p.revealOrder,x=p.tail;if(At(s,o,p.children,d),p=We.current,(p&2)!==0)p=p&1|2,o.flags|=128;else{if(s!==null&&(s.flags&128)!==0)e:for(s=o.child;s!==null;){if(s.tag===13)s.memoizedState!==null&&Nh(s,d,o);else if(s.tag===19)Nh(s,d,o);else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===o)break e;for(;s.sibling===null;){if(s.return===null||s.return===o)break e;s=s.return}s.sibling.return=s.return,s=s.sibling}p&=1}if(je(We,p),(o.mode&1)===0)o.memoizedState=null;else switch(v){case"forwards":for(d=o.child,v=null;d!==null;)s=d.alternate,s!==null&&Aa(s)===null&&(v=d),d=d.sibling;d=v,d===null?(v=o.child,o.child=null):(v=d.sibling,d.sibling=null),Eu(o,!1,v,d,x);break;case"backwards":for(d=null,v=o.child,o.child=null;v!==null;){if(s=v.alternate,s!==null&&Aa(s)===null){o.child=v;break}s=v.sibling,v.sibling=d,d=v,v=s}Eu(o,!0,d,null,x);break;case"together":Eu(o,!1,null,null,void 0);break;default:o.memoizedState=null}return o.child}function Da(s,o){(o.mode&1)===0&&s!==null&&(s.alternate=null,o.alternate=null,o.flags|=2)}function Mn(s,o,d){if(s!==null&&(o.dependencies=s.dependencies),Dr|=o.lanes,(d&o.childLanes)===0)return null;if(s!==null&&o.child!==s.child)throw Error(t(153));if(o.child!==null){for(s=o.child,d=hr(s,s.pendingProps),o.child=d,d.return=o;s.sibling!==null;)s=s.sibling,d=d.sibling=hr(s,s.pendingProps),d.return=o;d.sibling=null}return o.child}function zv(s,o,d){switch(o.tag){case 3:Dh(o),os();break;case 5:Xf(o);break;case 1:wt(o.type)&&ma(o);break;case 4:Jl(o,o.stateNode.containerInfo);break;case 10:var p=o.type._context,v=o.memoizedProps.value;je(xa,p._currentValue),p._currentValue=v;break;case 13:if(p=o.memoizedState,p!==null)return p.dehydrated!==null?(je(We,We.current&1),o.flags|=128,null):(d&o.child.childLanes)!==0?Oh(s,o,d):(je(We,We.current&1),s=Mn(s,o,d),s!==null?s.sibling:null);je(We,We.current&1);break;case 19:if(p=(d&o.childLanes)!==0,(s.flags&128)!==0){if(p)return Fh(s,o,d);o.flags|=128}if(v=o.memoizedState,v!==null&&(v.rendering=null,v.tail=null,v.lastEffect=null),je(We,We.current),p)break;return null;case 22:case 23:return o.lanes=0,bh(s,o,d)}return Mn(s,o,d)}var Mh,xu,Uh,Bh;Mh=function(s,o){for(var d=o.child;d!==null;){if(d.tag===5||d.tag===6)s.appendChild(d.stateNode);else if(d.tag!==4&&d.child!==null){d.child.return=d,d=d.child;continue}if(d===o)break;for(;d.sibling===null;){if(d.return===null||d.return===o)return;d=d.return}d.sibling.return=d.return,d=d.sibling}},xu=function(){},Uh=function(s,o,d,p){var v=s.memoizedProps;if(v!==p){s=o.stateNode,Cr(En.current);var x=null;switch(d){case"input":v=Tr(s,v),p=Tr(s,p),x=[];break;case"select":v=q({},v,{value:void 0}),p=q({},p,{value:void 0}),x=[];break;case"textarea":v=nn(s,v),p=nn(s,p),x=[];break;default:typeof v.onClick!="function"&&typeof p.onClick=="function"&&(s.onclick=da)}el(d,p);var R;d=null;for(z in v)if(!p.hasOwnProperty(z)&&v.hasOwnProperty(z)&&v[z]!=null)if(z==="style"){var k=v[z];for(R in k)k.hasOwnProperty(R)&&(d||(d={}),d[R]="")}else z!=="dangerouslySetInnerHTML"&&z!=="children"&&z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&z!=="autoFocus"&&(r.hasOwnProperty(z)?x||(x=[]):(x=x||[]).push(z,null));for(z in p){var N=p[z];if(k=v!=null?v[z]:void 0,p.hasOwnProperty(z)&&N!==k&&(N!=null||k!=null))if(z==="style")if(k){for(R in k)!k.hasOwnProperty(R)||N&&N.hasOwnProperty(R)||(d||(d={}),d[R]="");for(R in N)N.hasOwnProperty(R)&&k[R]!==N[R]&&(d||(d={}),d[R]=N[R])}else d||(x||(x=[]),x.push(z,d)),d=N;else z==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,k=k?k.__html:void 0,N!=null&&k!==N&&(x=x||[]).push(z,N)):z==="children"?typeof N!="string"&&typeof N!="number"||(x=x||[]).push(z,""+N):z!=="suppressContentEditableWarning"&&z!=="suppressHydrationWarning"&&(r.hasOwnProperty(z)?(N!=null&&z==="onScroll"&&Ve("scroll",s),x||k===N||(x=[])):(x=x||[]).push(z,N))}d&&(x=x||[]).push("style",d);var z=x;(o.updateQueue=z)&&(o.flags|=4)}},Bh=function(s,o,d,p){d!==p&&(o.flags|=4)};function hi(s,o){if(!ze)switch(s.tailMode){case"hidden":o=s.tail;for(var d=null;o!==null;)o.alternate!==null&&(d=o),o=o.sibling;d===null?s.tail=null:d.sibling=null;break;case"collapsed":d=s.tail;for(var p=null;d!==null;)d.alternate!==null&&(p=d),d=d.sibling;p===null?o||s.tail===null?s.tail=null:s.tail.sibling=null:p.sibling=null}}function Et(s){var o=s.alternate!==null&&s.alternate.child===s.child,d=0,p=0;if(o)for(var v=s.child;v!==null;)d|=v.lanes|v.childLanes,p|=v.subtreeFlags&14680064,p|=v.flags&14680064,v.return=s,v=v.sibling;else for(v=s.child;v!==null;)d|=v.lanes|v.childLanes,p|=v.subtreeFlags,p|=v.flags,v.return=s,v=v.sibling;return s.subtreeFlags|=p,s.childLanes=d,o}function Wv(s,o,d){var p=o.pendingProps;switch(jl(o),o.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return Et(o),null;case 1:return wt(o.type)&&ha(),Et(o),null;case 3:return p=o.stateNode,ds(),He(It),He(yt),tu(),p.pendingContext&&(p.context=p.pendingContext,p.pendingContext=null),(s===null||s.child===null)&&(va(o)?o.flags|=4:s===null||s.memoizedState.isDehydrated&&(o.flags&256)===0||(o.flags|=1024,on!==null&&(ku(on),on=null))),xu(s,o),Et(o),null;case 5:Zl(o);var v=Cr(li.current);if(d=o.type,s!==null&&o.stateNode!=null)Uh(s,o,d,p,v),s.ref!==o.ref&&(o.flags|=512,o.flags|=2097152);else{if(!p){if(o.stateNode===null)throw Error(t(166));return Et(o),null}if(s=Cr(En.current),va(o)){p=o.stateNode,d=o.type;var x=o.memoizedProps;switch(p[vn]=o,p[ri]=x,s=(o.mode&1)!==0,d){case"dialog":Ve("cancel",p),Ve("close",p);break;case"iframe":case"object":case"embed":Ve("load",p);break;case"video":case"audio":for(v=0;v<ei.length;v++)Ve(ei[v],p);break;case"source":Ve("error",p);break;case"img":case"image":case"link":Ve("error",p),Ve("load",p);break;case"details":Ve("toggle",p);break;case"input":Zo(p,x),Ve("invalid",p);break;case"select":p._wrapperState={wasMultiple:!!x.multiple},Ve("invalid",p);break;case"textarea":Os(p,x),Ve("invalid",p)}el(d,x),v=null;for(var R in x)if(x.hasOwnProperty(R)){var k=x[R];R==="children"?typeof k=="string"?p.textContent!==k&&(x.suppressHydrationWarning!==!0&&ca(p.textContent,k,s),v=["children",k]):typeof k=="number"&&p.textContent!==""+k&&(x.suppressHydrationWarning!==!0&&ca(p.textContent,k,s),v=["children",""+k]):r.hasOwnProperty(R)&&k!=null&&R==="onScroll"&&Ve("scroll",p)}switch(d){case"input":Ht(p),Lt(p,x,!0);break;case"textarea":Ht(p),Ns(p);break;case"select":case"option":break;default:typeof x.onClick=="function"&&(p.onclick=da)}p=v,o.updateQueue=p,p!==null&&(o.flags|=4)}else{R=v.nodeType===9?v:v.ownerDocument,s==="http://www.w3.org/1999/xhtml"&&(s=Yn(d)),s==="http://www.w3.org/1999/xhtml"?d==="script"?(s=R.createElement("div"),s.innerHTML="<script><\/script>",s=s.removeChild(s.firstChild)):typeof p.is=="string"?s=R.createElement(d,{is:p.is}):(s=R.createElement(d),d==="select"&&(R=s,p.multiple?R.multiple=!0:p.size&&(R.size=p.size))):s=R.createElementNS(s,d),s[vn]=o,s[ri]=p,Mh(s,o,!1,!1),o.stateNode=s;e:{switch(R=tl(d,p),d){case"dialog":Ve("cancel",s),Ve("close",s),v=p;break;case"iframe":case"object":case"embed":Ve("load",s),v=p;break;case"video":case"audio":for(v=0;v<ei.length;v++)Ve(ei[v],s);v=p;break;case"source":Ve("error",s),v=p;break;case"img":case"image":case"link":Ve("error",s),Ve("load",s),v=p;break;case"details":Ve("toggle",s),v=p;break;case"input":Zo(s,p),v=Tr(s,p),Ve("invalid",s);break;case"option":v=p;break;case"select":s._wrapperState={wasMultiple:!!p.multiple},v=q({},p,{value:void 0}),Ve("invalid",s);break;case"textarea":Os(s,p),v=nn(s,p),Ve("invalid",s);break;default:v=p}el(d,v),k=v;for(x in k)if(k.hasOwnProperty(x)){var N=k[x];x==="style"?wd(s,N):x==="dangerouslySetInnerHTML"?(N=N?N.__html:void 0,N!=null&&Fs(s,N)):x==="children"?typeof N=="string"?(d!=="textarea"||N!=="")&&qn(s,N):typeof N=="number"&&qn(s,""+N):x!=="suppressContentEditableWarning"&&x!=="suppressHydrationWarning"&&x!=="autoFocus"&&(r.hasOwnProperty(x)?N!=null&&x==="onScroll"&&Ve("scroll",s):N!=null&&I(s,x,N,R))}switch(d){case"input":Ht(s),Lt(s,p,!1);break;case"textarea":Ht(s),Ns(s);break;case"option":p.value!=null&&s.setAttribute("value",""+we(p.value));break;case"select":s.multiple=!!p.multiple,x=p.value,x!=null?Ft(s,!!p.multiple,x,!1):p.defaultValue!=null&&Ft(s,!!p.multiple,p.defaultValue,!0);break;default:typeof v.onClick=="function"&&(s.onclick=da)}switch(d){case"button":case"input":case"select":case"textarea":p=!!p.autoFocus;break e;case"img":p=!0;break e;default:p=!1}}p&&(o.flags|=4)}o.ref!==null&&(o.flags|=512,o.flags|=2097152)}return Et(o),null;case 6:if(s&&o.stateNode!=null)Bh(s,o,s.memoizedProps,p);else{if(typeof p!="string"&&o.stateNode===null)throw Error(t(166));if(d=Cr(li.current),Cr(En.current),va(o)){if(p=o.stateNode,d=o.memoizedProps,p[vn]=o,(x=p.nodeValue!==d)&&(s=Ut,s!==null))switch(s.tag){case 3:ca(p.nodeValue,d,(s.mode&1)!==0);break;case 5:s.memoizedProps.suppressHydrationWarning!==!0&&ca(p.nodeValue,d,(s.mode&1)!==0)}x&&(o.flags|=4)}else p=(d.nodeType===9?d:d.ownerDocument).createTextNode(p),p[vn]=o,o.stateNode=p}return Et(o),null;case 13:if(He(We),p=o.memoizedState,s===null||s.memoizedState!==null&&s.memoizedState.dehydrated!==null){if(ze&&Bt!==null&&(o.mode&1)!==0&&(o.flags&128)===0)jf(),os(),o.flags|=98560,x=!1;else if(x=va(o),p!==null&&p.dehydrated!==null){if(s===null){if(!x)throw Error(t(318));if(x=o.memoizedState,x=x!==null?x.dehydrated:null,!x)throw Error(t(317));x[vn]=o}else os(),(o.flags&128)===0&&(o.memoizedState=null),o.flags|=4;Et(o),x=!1}else on!==null&&(ku(on),on=null),x=!0;if(!x)return o.flags&65536?o:null}return(o.flags&128)!==0?(o.lanes=d,o):(p=p!==null,p!==(s!==null&&s.memoizedState!==null)&&p&&(o.child.flags|=8192,(o.mode&1)!==0&&(s===null||(We.current&1)!==0?at===0&&(at=3):Ou())),o.updateQueue!==null&&(o.flags|=4),Et(o),null);case 4:return ds(),xu(s,o),s===null&&ti(o.stateNode.containerInfo),Et(o),null;case 10:return Yl(o.type._context),Et(o),null;case 17:return wt(o.type)&&ha(),Et(o),null;case 19:if(He(We),x=o.memoizedState,x===null)return Et(o),null;if(p=(o.flags&128)!==0,R=x.rendering,R===null)if(p)hi(x,!1);else{if(at!==0||s!==null&&(s.flags&128)!==0)for(s=o.child;s!==null;){if(R=Aa(s),R!==null){for(o.flags|=128,hi(x,!1),p=R.updateQueue,p!==null&&(o.updateQueue=p,o.flags|=4),o.subtreeFlags=0,p=d,d=o.child;d!==null;)x=d,s=p,x.flags&=14680066,R=x.alternate,R===null?(x.childLanes=0,x.lanes=s,x.child=null,x.subtreeFlags=0,x.memoizedProps=null,x.memoizedState=null,x.updateQueue=null,x.dependencies=null,x.stateNode=null):(x.childLanes=R.childLanes,x.lanes=R.lanes,x.child=R.child,x.subtreeFlags=0,x.deletions=null,x.memoizedProps=R.memoizedProps,x.memoizedState=R.memoizedState,x.updateQueue=R.updateQueue,x.type=R.type,s=R.dependencies,x.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext}),d=d.sibling;return je(We,We.current&1|2),o.child}s=s.sibling}x.tail!==null&&Je()>ps&&(o.flags|=128,p=!0,hi(x,!1),o.lanes=4194304)}else{if(!p)if(s=Aa(R),s!==null){if(o.flags|=128,p=!0,d=s.updateQueue,d!==null&&(o.updateQueue=d,o.flags|=4),hi(x,!0),x.tail===null&&x.tailMode==="hidden"&&!R.alternate&&!ze)return Et(o),null}else 2*Je()-x.renderingStartTime>ps&&d!==1073741824&&(o.flags|=128,p=!0,hi(x,!1),o.lanes=4194304);x.isBackwards?(R.sibling=o.child,o.child=R):(d=x.last,d!==null?d.sibling=R:o.child=R,x.last=R)}return x.tail!==null?(o=x.tail,x.rendering=o,x.tail=o.sibling,x.renderingStartTime=Je(),o.sibling=null,d=We.current,je(We,p?d&1|2:d&1),o):(Et(o),null);case 22:case 23:return Pu(),p=o.memoizedState!==null,s!==null&&s.memoizedState!==null!==p&&(o.flags|=8192),p&&(o.mode&1)!==0?($t&1073741824)!==0&&(Et(o),o.subtreeFlags&6&&(o.flags|=8192)):Et(o),null;case 24:return null;case 25:return null}throw Error(t(156,o.tag))}function Yv(s,o){switch(jl(o),o.tag){case 1:return wt(o.type)&&ha(),s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 3:return ds(),He(It),He(yt),tu(),s=o.flags,(s&65536)!==0&&(s&128)===0?(o.flags=s&-65537|128,o):null;case 5:return Zl(o),null;case 13:if(He(We),s=o.memoizedState,s!==null&&s.dehydrated!==null){if(o.alternate===null)throw Error(t(340));os()}return s=o.flags,s&65536?(o.flags=s&-65537|128,o):null;case 19:return He(We),null;case 4:return ds(),null;case 10:return Yl(o.type._context),null;case 22:case 23:return Pu(),null;case 24:return null;default:return null}}var Pa=!1,xt=!1,qv=typeof WeakSet=="function"?WeakSet:Set,me=null;function hs(s,o){var d=s.ref;if(d!==null)if(typeof d=="function")try{d(null)}catch(p){Qe(s,o,p)}else d.current=null}function Su(s,o,d){try{d()}catch(p){Qe(s,o,p)}}var $h=!1;function Xv(s,o){if(Pl=Zi,s=vf(),Rl(s)){if("selectionStart"in s)var d={start:s.selectionStart,end:s.selectionEnd};else e:{d=(d=s.ownerDocument)&&d.defaultView||window;var p=d.getSelection&&d.getSelection();if(p&&p.rangeCount!==0){d=p.anchorNode;var v=p.anchorOffset,x=p.focusNode;p=p.focusOffset;try{d.nodeType,x.nodeType}catch{d=null;break e}var R=0,k=-1,N=-1,z=0,te=0,ne=s,Z=null;t:for(;;){for(var fe;ne!==d||v!==0&&ne.nodeType!==3||(k=R+v),ne!==x||p!==0&&ne.nodeType!==3||(N=R+p),ne.nodeType===3&&(R+=ne.nodeValue.length),(fe=ne.firstChild)!==null;)Z=ne,ne=fe;for(;;){if(ne===s)break t;if(Z===d&&++z===v&&(k=R),Z===x&&++te===p&&(N=R),(fe=ne.nextSibling)!==null)break;ne=Z,Z=ne.parentNode}ne=fe}d=k===-1||N===-1?null:{start:k,end:N}}else d=null}d=d||{start:0,end:0}}else d=null;for(Ol={focusedElem:s,selectionRange:d},Zi=!1,me=o;me!==null;)if(o=me,s=o.child,(o.subtreeFlags&1028)!==0&&s!==null)s.return=o,me=s;else for(;me!==null;){o=me;try{var ye=o.alternate;if((o.flags&1024)!==0)switch(o.tag){case 0:case 11:case 15:break;case 1:if(ye!==null){var ve=ye.memoizedProps,Ze=ye.memoizedState,V=o.stateNode,F=V.getSnapshotBeforeUpdate(o.elementType===o.type?ve:ln(o.type,ve),Ze);V.__reactInternalSnapshotBeforeUpdate=F}break;case 3:var K=o.stateNode.containerInfo;K.nodeType===1?K.textContent="":K.nodeType===9&&K.documentElement&&K.removeChild(K.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(t(163))}}catch(se){Qe(o,o.return,se)}if(s=o.sibling,s!==null){s.return=o.return,me=s;break}me=o.return}return ye=$h,$h=!1,ye}function mi(s,o,d){var p=o.updateQueue;if(p=p!==null?p.lastEffect:null,p!==null){var v=p=p.next;do{if((v.tag&s)===s){var x=v.destroy;v.destroy=void 0,x!==void 0&&Su(o,d,x)}v=v.next}while(v!==p)}}function Oa(s,o){if(o=o.updateQueue,o=o!==null?o.lastEffect:null,o!==null){var d=o=o.next;do{if((d.tag&s)===s){var p=d.create;d.destroy=p()}d=d.next}while(d!==o)}}function Tu(s){var o=s.ref;if(o!==null){var d=s.stateNode;switch(s.tag){case 5:s=d;break;default:s=d}typeof o=="function"?o(s):o.current=s}}function Gh(s){var o=s.alternate;o!==null&&(s.alternate=null,Gh(o)),s.child=null,s.deletions=null,s.sibling=null,s.tag===5&&(o=s.stateNode,o!==null&&(delete o[vn],delete o[ri],delete o[Ul],delete o[Dv],delete o[Pv])),s.stateNode=null,s.return=null,s.dependencies=null,s.memoizedProps=null,s.memoizedState=null,s.pendingProps=null,s.stateNode=null,s.updateQueue=null}function jh(s){return s.tag===5||s.tag===3||s.tag===4}function Vh(s){e:for(;;){for(;s.sibling===null;){if(s.return===null||jh(s.return))return null;s=s.return}for(s.sibling.return=s.return,s=s.sibling;s.tag!==5&&s.tag!==6&&s.tag!==18;){if(s.flags&2||s.child===null||s.tag===4)continue e;s.child.return=s,s=s.child}if(!(s.flags&2))return s.stateNode}}function Lu(s,o,d){var p=s.tag;if(p===5||p===6)s=s.stateNode,o?d.nodeType===8?d.parentNode.insertBefore(s,o):d.insertBefore(s,o):(d.nodeType===8?(o=d.parentNode,o.insertBefore(s,d)):(o=d,o.appendChild(s)),d=d._reactRootContainer,d!=null||o.onclick!==null||(o.onclick=da));else if(p!==4&&(s=s.child,s!==null))for(Lu(s,o,d),s=s.sibling;s!==null;)Lu(s,o,d),s=s.sibling}function Au(s,o,d){var p=s.tag;if(p===5||p===6)s=s.stateNode,o?d.insertBefore(s,o):d.appendChild(s);else if(p!==4&&(s=s.child,s!==null))for(Au(s,o,d),s=s.sibling;s!==null;)Au(s,o,d),s=s.sibling}var pt=null,un=!1;function lr(s,o,d){for(d=d.child;d!==null;)Hh(s,o,d),d=d.sibling}function Hh(s,o,d){if(yn&&typeof yn.onCommitFiberUnmount=="function")try{yn.onCommitFiberUnmount(Wi,d)}catch{}switch(d.tag){case 5:xt||hs(d,o);case 6:var p=pt,v=un;pt=null,lr(s,o,d),pt=p,un=v,pt!==null&&(un?(s=pt,d=d.stateNode,s.nodeType===8?s.parentNode.removeChild(d):s.removeChild(d)):pt.removeChild(d.stateNode));break;case 18:pt!==null&&(un?(s=pt,d=d.stateNode,s.nodeType===8?Ml(s.parentNode,d):s.nodeType===1&&Ml(s,d),zs(s)):Ml(pt,d.stateNode));break;case 4:p=pt,v=un,pt=d.stateNode.containerInfo,un=!0,lr(s,o,d),pt=p,un=v;break;case 0:case 11:case 14:case 15:if(!xt&&(p=d.updateQueue,p!==null&&(p=p.lastEffect,p!==null))){v=p=p.next;do{var x=v,R=x.destroy;x=x.tag,R!==void 0&&((x&2)!==0||(x&4)!==0)&&Su(d,o,R),v=v.next}while(v!==p)}lr(s,o,d);break;case 1:if(!xt&&(hs(d,o),p=d.stateNode,typeof p.componentWillUnmount=="function"))try{p.props=d.memoizedProps,p.state=d.memoizedState,p.componentWillUnmount()}catch(k){Qe(d,o,k)}lr(s,o,d);break;case 21:lr(s,o,d);break;case 22:d.mode&1?(xt=(p=xt)||d.memoizedState!==null,lr(s,o,d),xt=p):lr(s,o,d);break;default:lr(s,o,d)}}function Kh(s){var o=s.updateQueue;if(o!==null){s.updateQueue=null;var d=s.stateNode;d===null&&(d=s.stateNode=new qv),o.forEach(function(p){var v=iE.bind(null,s,p);d.has(p)||(d.add(p),p.then(v,v))})}}function cn(s,o){var d=o.deletions;if(d!==null)for(var p=0;p<d.length;p++){var v=d[p];try{var x=s,R=o,k=R;e:for(;k!==null;){switch(k.tag){case 5:pt=k.stateNode,un=!1;break e;case 3:pt=k.stateNode.containerInfo,un=!0;break e;case 4:pt=k.stateNode.containerInfo,un=!0;break e}k=k.return}if(pt===null)throw Error(t(160));Hh(x,R,v),pt=null,un=!1;var N=v.alternate;N!==null&&(N.return=null),v.return=null}catch(z){Qe(v,o,z)}}if(o.subtreeFlags&12854)for(o=o.child;o!==null;)zh(o,s),o=o.sibling}function zh(s,o){var d=s.alternate,p=s.flags;switch(s.tag){case 0:case 11:case 14:case 15:if(cn(o,s),Sn(s),p&4){try{mi(3,s,s.return),Oa(3,s)}catch(ve){Qe(s,s.return,ve)}try{mi(5,s,s.return)}catch(ve){Qe(s,s.return,ve)}}break;case 1:cn(o,s),Sn(s),p&512&&d!==null&&hs(d,d.return);break;case 5:if(cn(o,s),Sn(s),p&512&&d!==null&&hs(d,d.return),s.flags&32){var v=s.stateNode;try{qn(v,"")}catch(ve){Qe(s,s.return,ve)}}if(p&4&&(v=s.stateNode,v!=null)){var x=s.memoizedProps,R=d!==null?d.memoizedProps:x,k=s.type,N=s.updateQueue;if(s.updateQueue=null,N!==null)try{k==="input"&&x.type==="radio"&&x.name!=null&&Pe(v,x),tl(k,R);var z=tl(k,x);for(R=0;R<N.length;R+=2){var te=N[R],ne=N[R+1];te==="style"?wd(v,ne):te==="dangerouslySetInnerHTML"?Fs(v,ne):te==="children"?qn(v,ne):I(v,te,ne,z)}switch(k){case"input":nt(v,x);break;case"textarea":Lr(v,x);break;case"select":var Z=v._wrapperState.wasMultiple;v._wrapperState.wasMultiple=!!x.multiple;var fe=x.value;fe!=null?Ft(v,!!x.multiple,fe,!1):Z!==!!x.multiple&&(x.defaultValue!=null?Ft(v,!!x.multiple,x.defaultValue,!0):Ft(v,!!x.multiple,x.multiple?[]:"",!1))}v[ri]=x}catch(ve){Qe(s,s.return,ve)}}break;case 6:if(cn(o,s),Sn(s),p&4){if(s.stateNode===null)throw Error(t(162));v=s.stateNode,x=s.memoizedProps;try{v.nodeValue=x}catch(ve){Qe(s,s.return,ve)}}break;case 3:if(cn(o,s),Sn(s),p&4&&d!==null&&d.memoizedState.isDehydrated)try{zs(o.containerInfo)}catch(ve){Qe(s,s.return,ve)}break;case 4:cn(o,s),Sn(s);break;case 13:cn(o,s),Sn(s),v=s.child,v.flags&8192&&(x=v.memoizedState!==null,v.stateNode.isHidden=x,!x||v.alternate!==null&&v.alternate.memoizedState!==null||(wu=Je())),p&4&&Kh(s);break;case 22:if(te=d!==null&&d.memoizedState!==null,s.mode&1?(xt=(z=xt)||te,cn(o,s),xt=z):cn(o,s),Sn(s),p&8192){if(z=s.memoizedState!==null,(s.stateNode.isHidden=z)&&!te&&(s.mode&1)!==0)for(me=s,te=s.child;te!==null;){for(ne=me=te;me!==null;){switch(Z=me,fe=Z.child,Z.tag){case 0:case 11:case 14:case 15:mi(4,Z,Z.return);break;case 1:hs(Z,Z.return);var ye=Z.stateNode;if(typeof ye.componentWillUnmount=="function"){p=Z,d=Z.return;try{o=p,ye.props=o.memoizedProps,ye.state=o.memoizedState,ye.componentWillUnmount()}catch(ve){Qe(p,d,ve)}}break;case 5:hs(Z,Z.return);break;case 22:if(Z.memoizedState!==null){qh(ne);continue}}fe!==null?(fe.return=Z,me=fe):qh(ne)}te=te.sibling}e:for(te=null,ne=s;;){if(ne.tag===5){if(te===null){te=ne;try{v=ne.stateNode,z?(x=v.style,typeof x.setProperty=="function"?x.setProperty("display","none","important"):x.display="none"):(k=ne.stateNode,N=ne.memoizedProps.style,R=N!=null&&N.hasOwnProperty("display")?N.display:null,k.style.display=Id("display",R))}catch(ve){Qe(s,s.return,ve)}}}else if(ne.tag===6){if(te===null)try{ne.stateNode.nodeValue=z?"":ne.memoizedProps}catch(ve){Qe(s,s.return,ve)}}else if((ne.tag!==22&&ne.tag!==23||ne.memoizedState===null||ne===s)&&ne.child!==null){ne.child.return=ne,ne=ne.child;continue}if(ne===s)break e;for(;ne.sibling===null;){if(ne.return===null||ne.return===s)break e;te===ne&&(te=null),ne=ne.return}te===ne&&(te=null),ne.sibling.return=ne.return,ne=ne.sibling}}break;case 19:cn(o,s),Sn(s),p&4&&Kh(s);break;case 21:break;default:cn(o,s),Sn(s)}}function Sn(s){var o=s.flags;if(o&2){try{e:{for(var d=s.return;d!==null;){if(jh(d)){var p=d;break e}d=d.return}throw Error(t(160))}switch(p.tag){case 5:var v=p.stateNode;p.flags&32&&(qn(v,""),p.flags&=-33);var x=Vh(s);Au(s,x,v);break;case 3:case 4:var R=p.stateNode.containerInfo,k=Vh(s);Lu(s,k,R);break;default:throw Error(t(161))}}catch(N){Qe(s,s.return,N)}s.flags&=-3}o&4096&&(s.flags&=-4097)}function Qv(s,o,d){me=s,Wh(s)}function Wh(s,o,d){for(var p=(s.mode&1)!==0;me!==null;){var v=me,x=v.child;if(v.tag===22&&p){var R=v.memoizedState!==null||Pa;if(!R){var k=v.alternate,N=k!==null&&k.memoizedState!==null||xt;k=Pa;var z=xt;if(Pa=R,(xt=N)&&!z)for(me=v;me!==null;)R=me,N=R.child,R.tag===22&&R.memoizedState!==null?Xh(v):N!==null?(N.return=R,me=N):Xh(v);for(;x!==null;)me=x,Wh(x),x=x.sibling;me=v,Pa=k,xt=z}Yh(s)}else(v.subtreeFlags&8772)!==0&&x!==null?(x.return=v,me=x):Yh(s)}}function Yh(s){for(;me!==null;){var o=me;if((o.flags&8772)!==0){var d=o.alternate;try{if((o.flags&8772)!==0)switch(o.tag){case 0:case 11:case 15:xt||Oa(5,o);break;case 1:var p=o.stateNode;if(o.flags&4&&!xt)if(d===null)p.componentDidMount();else{var v=o.elementType===o.type?d.memoizedProps:ln(o.type,d.memoizedProps);p.componentDidUpdate(v,d.memoizedState,p.__reactInternalSnapshotBeforeUpdate)}var x=o.updateQueue;x!==null&&qf(o,x,p);break;case 3:var R=o.updateQueue;if(R!==null){if(d=null,o.child!==null)switch(o.child.tag){case 5:d=o.child.stateNode;break;case 1:d=o.child.stateNode}qf(o,R,d)}break;case 5:var k=o.stateNode;if(d===null&&o.flags&4){d=k;var N=o.memoizedProps;switch(o.type){case"button":case"input":case"select":case"textarea":N.autoFocus&&d.focus();break;case"img":N.src&&(d.src=N.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(o.memoizedState===null){var z=o.alternate;if(z!==null){var te=z.memoizedState;if(te!==null){var ne=te.dehydrated;ne!==null&&zs(ne)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(t(163))}xt||o.flags&512&&Tu(o)}catch(Z){Qe(o,o.return,Z)}}if(o===s){me=null;break}if(d=o.sibling,d!==null){d.return=o.return,me=d;break}me=o.return}}function qh(s){for(;me!==null;){var o=me;if(o===s){me=null;break}var d=o.sibling;if(d!==null){d.return=o.return,me=d;break}me=o.return}}function Xh(s){for(;me!==null;){var o=me;try{switch(o.tag){case 0:case 11:case 15:var d=o.return;try{Oa(4,o)}catch(N){Qe(o,d,N)}break;case 1:var p=o.stateNode;if(typeof p.componentDidMount=="function"){var v=o.return;try{p.componentDidMount()}catch(N){Qe(o,v,N)}}var x=o.return;try{Tu(o)}catch(N){Qe(o,x,N)}break;case 5:var R=o.return;try{Tu(o)}catch(N){Qe(o,R,N)}}}catch(N){Qe(o,o.return,N)}if(o===s){me=null;break}var k=o.sibling;if(k!==null){k.return=o.return,me=k;break}me=o.return}}var Jv=Math.ceil,Na=b.ReactCurrentDispatcher,Ru=b.ReactCurrentOwner,qt=b.ReactCurrentBatchConfig,Oe=0,ct=null,rt=null,gt=0,$t=0,ms=rr(0),at=0,pi=null,Dr=0,Fa=0,Iu=0,gi=null,bt=null,wu=0,ps=1/0,Un=null,Ma=!1,_u=null,ur=null,Ua=!1,cr=null,Ba=0,yi=0,bu=null,$a=-1,Ga=0;function Rt(){return(Oe&6)!==0?Je():$a!==-1?$a:$a=Je()}function dr(s){return(s.mode&1)===0?1:(Oe&2)!==0&&gt!==0?gt&-gt:Nv.transition!==null?(Ga===0&&(Ga=jd()),Ga):(s=Me,s!==0||(s=window.event,s=s===void 0?16:Qd(s.type)),s)}function dn(s,o,d,p){if(50<yi)throw yi=0,bu=null,Error(t(185));Gs(s,d,p),((Oe&2)===0||s!==ct)&&(s===ct&&((Oe&2)===0&&(Fa|=d),at===4&&fr(s,gt)),Ct(s,p),d===1&&Oe===0&&(o.mode&1)===0&&(ps=Je()+500,pa&&ir()))}function Ct(s,o){var d=s.callbackNode;Ny(s,o);var p=Xi(s,s===ct?gt:0);if(p===0)d!==null&&Bd(d),s.callbackNode=null,s.callbackPriority=0;else if(o=p&-p,s.callbackPriority!==o){if(d!=null&&Bd(d),o===1)s.tag===0?Ov(Jh.bind(null,s)):Mf(Jh.bind(null,s)),Cv(function(){(Oe&6)===0&&ir()}),d=null;else{switch(Vd(p)){case 1:d=ll;break;case 4:d=$d;break;case 16:d=zi;break;case 536870912:d=Gd;break;default:d=zi}d=am(d,Qh.bind(null,s))}s.callbackPriority=o,s.callbackNode=d}}function Qh(s,o){if($a=-1,Ga=0,(Oe&6)!==0)throw Error(t(327));var d=s.callbackNode;if(gs()&&s.callbackNode!==d)return null;var p=Xi(s,s===ct?gt:0);if(p===0)return null;if((p&30)!==0||(p&s.expiredLanes)!==0||o)o=ja(s,p);else{o=p;var v=Oe;Oe|=2;var x=em();(ct!==s||gt!==o)&&(Un=null,ps=Je()+500,Or(s,o));do try{tE();break}catch(k){Zh(s,k)}while(!0);Wl(),Na.current=x,Oe=v,rt!==null?o=0:(ct=null,gt=0,o=at)}if(o!==0){if(o===2&&(v=ul(s),v!==0&&(p=v,o=Cu(s,v))),o===1)throw d=pi,Or(s,0),fr(s,p),Ct(s,Je()),d;if(o===6)fr(s,p);else{if(v=s.current.alternate,(p&30)===0&&!Zv(v)&&(o=ja(s,p),o===2&&(x=ul(s),x!==0&&(p=x,o=Cu(s,x))),o===1))throw d=pi,Or(s,0),fr(s,p),Ct(s,Je()),d;switch(s.finishedWork=v,s.finishedLanes=p,o){case 0:case 1:throw Error(t(345));case 2:Nr(s,bt,Un);break;case 3:if(fr(s,p),(p&130023424)===p&&(o=wu+500-Je(),10<o)){if(Xi(s,0)!==0)break;if(v=s.suspendedLanes,(v&p)!==p){Rt(),s.pingedLanes|=s.suspendedLanes&v;break}s.timeoutHandle=Fl(Nr.bind(null,s,bt,Un),o);break}Nr(s,bt,Un);break;case 4:if(fr(s,p),(p&4194240)===p)break;for(o=s.eventTimes,v=-1;0<p;){var R=31-sn(p);x=1<<R,R=o[R],R>v&&(v=R),p&=~x}if(p=v,p=Je()-p,p=(120>p?120:480>p?480:1080>p?1080:1920>p?1920:3e3>p?3e3:4320>p?4320:1960*Jv(p/1960))-p,10<p){s.timeoutHandle=Fl(Nr.bind(null,s,bt,Un),p);break}Nr(s,bt,Un);break;case 5:Nr(s,bt,Un);break;default:throw Error(t(329))}}}return Ct(s,Je()),s.callbackNode===d?Qh.bind(null,s):null}function Cu(s,o){var d=gi;return s.current.memoizedState.isDehydrated&&(Or(s,o).flags|=256),s=ja(s,o),s!==2&&(o=bt,bt=d,o!==null&&ku(o)),s}function ku(s){bt===null?bt=s:bt.push.apply(bt,s)}function Zv(s){for(var o=s;;){if(o.flags&16384){var d=o.updateQueue;if(d!==null&&(d=d.stores,d!==null))for(var p=0;p<d.length;p++){var v=d[p],x=v.getSnapshot;v=v.value;try{if(!an(x(),v))return!1}catch{return!1}}}if(d=o.child,o.subtreeFlags&16384&&d!==null)d.return=o,o=d;else{if(o===s)break;for(;o.sibling===null;){if(o.return===null||o.return===s)return!0;o=o.return}o.sibling.return=o.return,o=o.sibling}}return!0}function fr(s,o){for(o&=~Iu,o&=~Fa,s.suspendedLanes|=o,s.pingedLanes&=~o,s=s.expirationTimes;0<o;){var d=31-sn(o),p=1<<d;s[d]=-1,o&=~p}}function Jh(s){if((Oe&6)!==0)throw Error(t(327));gs();var o=Xi(s,0);if((o&1)===0)return Ct(s,Je()),null;var d=ja(s,o);if(s.tag!==0&&d===2){var p=ul(s);p!==0&&(o=p,d=Cu(s,p))}if(d===1)throw d=pi,Or(s,0),fr(s,o),Ct(s,Je()),d;if(d===6)throw Error(t(345));return s.finishedWork=s.current.alternate,s.finishedLanes=o,Nr(s,bt,Un),Ct(s,Je()),null}function Du(s,o){var d=Oe;Oe|=1;try{return s(o)}finally{Oe=d,Oe===0&&(ps=Je()+500,pa&&ir())}}function Pr(s){cr!==null&&cr.tag===0&&(Oe&6)===0&&gs();var o=Oe;Oe|=1;var d=qt.transition,p=Me;try{if(qt.transition=null,Me=1,s)return s()}finally{Me=p,qt.transition=d,Oe=o,(Oe&6)===0&&ir()}}function Pu(){$t=ms.current,He(ms)}function Or(s,o){s.finishedWork=null,s.finishedLanes=0;var d=s.timeoutHandle;if(d!==-1&&(s.timeoutHandle=-1,bv(d)),rt!==null)for(d=rt.return;d!==null;){var p=d;switch(jl(p),p.tag){case 1:p=p.type.childContextTypes,p!=null&&ha();break;case 3:ds(),He(It),He(yt),tu();break;case 5:Zl(p);break;case 4:ds();break;case 13:He(We);break;case 19:He(We);break;case 10:Yl(p.type._context);break;case 22:case 23:Pu()}d=d.return}if(ct=s,rt=s=hr(s.current,null),gt=$t=o,at=0,pi=null,Iu=Fa=Dr=0,bt=gi=null,br!==null){for(o=0;o<br.length;o++)if(d=br[o],p=d.interleaved,p!==null){d.interleaved=null;var v=p.next,x=d.pending;if(x!==null){var R=x.next;x.next=v,p.next=R}d.pending=p}br=null}return s}function Zh(s,o){do{var d=rt;try{if(Wl(),Ra.current=ba,Ia){for(var p=Ye.memoizedState;p!==null;){var v=p.queue;v!==null&&(v.pending=null),p=p.next}Ia=!1}if(kr=0,ut=it=Ye=null,ui=!1,ci=0,Ru.current=null,d===null||d.return===null){at=1,pi=o,rt=null;break}e:{var x=s,R=d.return,k=d,N=o;if(o=gt,k.flags|=32768,N!==null&&typeof N=="object"&&typeof N.then=="function"){var z=N,te=k,ne=te.tag;if((te.mode&1)===0&&(ne===0||ne===11||ne===15)){var Z=te.alternate;Z?(te.updateQueue=Z.updateQueue,te.memoizedState=Z.memoizedState,te.lanes=Z.lanes):(te.updateQueue=null,te.memoizedState=null)}var fe=Ah(R);if(fe!==null){fe.flags&=-257,Rh(fe,R,k,x,o),fe.mode&1&&Lh(x,z,o),o=fe,N=z;var ye=o.updateQueue;if(ye===null){var ve=new Set;ve.add(N),o.updateQueue=ve}else ye.add(N);break e}else{if((o&1)===0){Lh(x,z,o),Ou();break e}N=Error(t(426))}}else if(ze&&k.mode&1){var Ze=Ah(R);if(Ze!==null){(Ze.flags&65536)===0&&(Ze.flags|=256),Rh(Ze,R,k,x,o),Kl(fs(N,k));break e}}x=N=fs(N,k),at!==4&&(at=2),gi===null?gi=[x]:gi.push(x),x=R;do{switch(x.tag){case 3:x.flags|=65536,o&=-o,x.lanes|=o;var V=Sh(x,N,o);Yf(x,V);break e;case 1:k=N;var F=x.type,K=x.stateNode;if((x.flags&128)===0&&(typeof F.getDerivedStateFromError=="function"||K!==null&&typeof K.componentDidCatch=="function"&&(ur===null||!ur.has(K)))){x.flags|=65536,o&=-o,x.lanes|=o;var se=Th(x,k,o);Yf(x,se);break e}}x=x.return}while(x!==null)}nm(d)}catch(Ee){o=Ee,rt===d&&d!==null&&(rt=d=d.return);continue}break}while(!0)}function em(){var s=Na.current;return Na.current=ba,s===null?ba:s}function Ou(){(at===0||at===3||at===2)&&(at=4),ct===null||(Dr&268435455)===0&&(Fa&268435455)===0||fr(ct,gt)}function ja(s,o){var d=Oe;Oe|=2;var p=em();(ct!==s||gt!==o)&&(Un=null,Or(s,o));do try{eE();break}catch(v){Zh(s,v)}while(!0);if(Wl(),Oe=d,Na.current=p,rt!==null)throw Error(t(261));return ct=null,gt=0,at}function eE(){for(;rt!==null;)tm(rt)}function tE(){for(;rt!==null&&!Iy();)tm(rt)}function tm(s){var o=im(s.alternate,s,$t);s.memoizedProps=s.pendingProps,o===null?nm(s):rt=o,Ru.current=null}function nm(s){var o=s;do{var d=o.alternate;if(s=o.return,(o.flags&32768)===0){if(d=Wv(d,o,$t),d!==null){rt=d;return}}else{if(d=Yv(d,o),d!==null){d.flags&=32767,rt=d;return}if(s!==null)s.flags|=32768,s.subtreeFlags=0,s.deletions=null;else{at=6,rt=null;return}}if(o=o.sibling,o!==null){rt=o;return}rt=o=s}while(o!==null);at===0&&(at=5)}function Nr(s,o,d){var p=Me,v=qt.transition;try{qt.transition=null,Me=1,nE(s,o,d,p)}finally{qt.transition=v,Me=p}return null}function nE(s,o,d,p){do gs();while(cr!==null);if((Oe&6)!==0)throw Error(t(327));d=s.finishedWork;var v=s.finishedLanes;if(d===null)return null;if(s.finishedWork=null,s.finishedLanes=0,d===s.current)throw Error(t(177));s.callbackNode=null,s.callbackPriority=0;var x=d.lanes|d.childLanes;if(Fy(s,x),s===ct&&(rt=ct=null,gt=0),(d.subtreeFlags&2064)===0&&(d.flags&2064)===0||Ua||(Ua=!0,am(zi,function(){return gs(),null})),x=(d.flags&15990)!==0,(d.subtreeFlags&15990)!==0||x){x=qt.transition,qt.transition=null;var R=Me;Me=1;var k=Oe;Oe|=4,Ru.current=null,Xv(s,d),zh(d,s),Tv(Ol),Zi=!!Pl,Ol=Pl=null,s.current=d,Qv(d),wy(),Oe=k,Me=R,qt.transition=x}else s.current=d;if(Ua&&(Ua=!1,cr=s,Ba=v),x=s.pendingLanes,x===0&&(ur=null),Cy(d.stateNode),Ct(s,Je()),o!==null)for(p=s.onRecoverableError,d=0;d<o.length;d++)v=o[d],p(v.value,{componentStack:v.stack,digest:v.digest});if(Ma)throw Ma=!1,s=_u,_u=null,s;return(Ba&1)!==0&&s.tag!==0&&gs(),x=s.pendingLanes,(x&1)!==0?s===bu?yi++:(yi=0,bu=s):yi=0,ir(),null}function gs(){if(cr!==null){var s=Vd(Ba),o=qt.transition,d=Me;try{if(qt.transition=null,Me=16>s?16:s,cr===null)var p=!1;else{if(s=cr,cr=null,Ba=0,(Oe&6)!==0)throw Error(t(331));var v=Oe;for(Oe|=4,me=s.current;me!==null;){var x=me,R=x.child;if((me.flags&16)!==0){var k=x.deletions;if(k!==null){for(var N=0;N<k.length;N++){var z=k[N];for(me=z;me!==null;){var te=me;switch(te.tag){case 0:case 11:case 15:mi(8,te,x)}var ne=te.child;if(ne!==null)ne.return=te,me=ne;else for(;me!==null;){te=me;var Z=te.sibling,fe=te.return;if(Gh(te),te===z){me=null;break}if(Z!==null){Z.return=fe,me=Z;break}me=fe}}}var ye=x.alternate;if(ye!==null){var ve=ye.child;if(ve!==null){ye.child=null;do{var Ze=ve.sibling;ve.sibling=null,ve=Ze}while(ve!==null)}}me=x}}if((x.subtreeFlags&2064)!==0&&R!==null)R.return=x,me=R;else e:for(;me!==null;){if(x=me,(x.flags&2048)!==0)switch(x.tag){case 0:case 11:case 15:mi(9,x,x.return)}var V=x.sibling;if(V!==null){V.return=x.return,me=V;break e}me=x.return}}var F=s.current;for(me=F;me!==null;){R=me;var K=R.child;if((R.subtreeFlags&2064)!==0&&K!==null)K.return=R,me=K;else e:for(R=F;me!==null;){if(k=me,(k.flags&2048)!==0)try{switch(k.tag){case 0:case 11:case 15:Oa(9,k)}}catch(Ee){Qe(k,k.return,Ee)}if(k===R){me=null;break e}var se=k.sibling;if(se!==null){se.return=k.return,me=se;break e}me=k.return}}if(Oe=v,ir(),yn&&typeof yn.onPostCommitFiberRoot=="function")try{yn.onPostCommitFiberRoot(Wi,s)}catch{}p=!0}return p}finally{Me=d,qt.transition=o}}return!1}function rm(s,o,d){o=fs(d,o),o=Sh(s,o,1),s=or(s,o,1),o=Rt(),s!==null&&(Gs(s,1,o),Ct(s,o))}function Qe(s,o,d){if(s.tag===3)rm(s,s,d);else for(;o!==null;){if(o.tag===3){rm(o,s,d);break}else if(o.tag===1){var p=o.stateNode;if(typeof o.type.getDerivedStateFromError=="function"||typeof p.componentDidCatch=="function"&&(ur===null||!ur.has(p))){s=fs(d,s),s=Th(o,s,1),o=or(o,s,1),s=Rt(),o!==null&&(Gs(o,1,s),Ct(o,s));break}}o=o.return}}function rE(s,o,d){var p=s.pingCache;p!==null&&p.delete(o),o=Rt(),s.pingedLanes|=s.suspendedLanes&d,ct===s&&(gt&d)===d&&(at===4||at===3&&(gt&130023424)===gt&&500>Je()-wu?Or(s,0):Iu|=d),Ct(s,o)}function sm(s,o){o===0&&((s.mode&1)===0?o=1:(o=qi,qi<<=1,(qi&130023424)===0&&(qi=4194304)));var d=Rt();s=Nn(s,o),s!==null&&(Gs(s,o,d),Ct(s,d))}function sE(s){var o=s.memoizedState,d=0;o!==null&&(d=o.retryLane),sm(s,d)}function iE(s,o){var d=0;switch(s.tag){case 13:var p=s.stateNode,v=s.memoizedState;v!==null&&(d=v.retryLane);break;case 19:p=s.stateNode;break;default:throw Error(t(314))}p!==null&&p.delete(o),sm(s,d)}var im;im=function(s,o,d){if(s!==null)if(s.memoizedProps!==o.pendingProps||It.current)_t=!0;else{if((s.lanes&d)===0&&(o.flags&128)===0)return _t=!1,zv(s,o,d);_t=(s.flags&131072)!==0}else _t=!1,ze&&(o.flags&1048576)!==0&&Uf(o,ya,o.index);switch(o.lanes=0,o.tag){case 2:var p=o.type;Da(s,o),s=o.pendingProps;var v=ss(o,yt.current);cs(o,d),v=su(null,o,p,s,v,d);var x=iu();return o.flags|=1,typeof v=="object"&&v!==null&&typeof v.render=="function"&&v.$$typeof===void 0?(o.tag=1,o.memoizedState=null,o.updateQueue=null,wt(p)?(x=!0,ma(o)):x=!1,o.memoizedState=v.state!==null&&v.state!==void 0?v.state:null,Ql(o),v.updater=Ca,o.stateNode=v,v._reactInternals=o,du(o,p,s,d),o=pu(null,o,p,!0,x,d)):(o.tag=0,ze&&x&&Gl(o),At(null,o,v,d),o=o.child),o;case 16:p=o.elementType;e:{switch(Da(s,o),s=o.pendingProps,v=p._init,p=v(p._payload),o.type=p,v=o.tag=oE(p),s=ln(p,s),v){case 0:o=mu(null,o,p,s,d);break e;case 1:o=kh(null,o,p,s,d);break e;case 11:o=Ih(null,o,p,s,d);break e;case 14:o=wh(null,o,p,ln(p.type,s),d);break e}throw Error(t(306,p,""))}return o;case 0:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:ln(p,v),mu(s,o,p,v,d);case 1:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:ln(p,v),kh(s,o,p,v,d);case 3:e:{if(Dh(o),s===null)throw Error(t(387));p=o.pendingProps,x=o.memoizedState,v=x.element,Wf(s,o),La(o,p,null,d);var R=o.memoizedState;if(p=R.element,x.isDehydrated)if(x={element:p,isDehydrated:!1,cache:R.cache,pendingSuspenseBoundaries:R.pendingSuspenseBoundaries,transitions:R.transitions},o.updateQueue.baseState=x,o.memoizedState=x,o.flags&256){v=fs(Error(t(423)),o),o=Ph(s,o,p,d,v);break e}else if(p!==v){v=fs(Error(t(424)),o),o=Ph(s,o,p,d,v);break e}else for(Bt=nr(o.stateNode.containerInfo.firstChild),Ut=o,ze=!0,on=null,d=Kf(o,null,p,d),o.child=d;d;)d.flags=d.flags&-3|4096,d=d.sibling;else{if(os(),p===v){o=Mn(s,o,d);break e}At(s,o,p,d)}o=o.child}return o;case 5:return Xf(o),s===null&&Hl(o),p=o.type,v=o.pendingProps,x=s!==null?s.memoizedProps:null,R=v.children,Nl(p,v)?R=null:x!==null&&Nl(p,x)&&(o.flags|=32),Ch(s,o),At(s,o,R,d),o.child;case 6:return s===null&&Hl(o),null;case 13:return Oh(s,o,d);case 4:return Jl(o,o.stateNode.containerInfo),p=o.pendingProps,s===null?o.child=ls(o,null,p,d):At(s,o,p,d),o.child;case 11:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:ln(p,v),Ih(s,o,p,v,d);case 7:return At(s,o,o.pendingProps,d),o.child;case 8:return At(s,o,o.pendingProps.children,d),o.child;case 12:return At(s,o,o.pendingProps.children,d),o.child;case 10:e:{if(p=o.type._context,v=o.pendingProps,x=o.memoizedProps,R=v.value,je(xa,p._currentValue),p._currentValue=R,x!==null)if(an(x.value,R)){if(x.children===v.children&&!It.current){o=Mn(s,o,d);break e}}else for(x=o.child,x!==null&&(x.return=o);x!==null;){var k=x.dependencies;if(k!==null){R=x.child;for(var N=k.firstContext;N!==null;){if(N.context===p){if(x.tag===1){N=Fn(-1,d&-d),N.tag=2;var z=x.updateQueue;if(z!==null){z=z.shared;var te=z.pending;te===null?N.next=N:(N.next=te.next,te.next=N),z.pending=N}}x.lanes|=d,N=x.alternate,N!==null&&(N.lanes|=d),ql(x.return,d,o),k.lanes|=d;break}N=N.next}}else if(x.tag===10)R=x.type===o.type?null:x.child;else if(x.tag===18){if(R=x.return,R===null)throw Error(t(341));R.lanes|=d,k=R.alternate,k!==null&&(k.lanes|=d),ql(R,d,o),R=x.sibling}else R=x.child;if(R!==null)R.return=x;else for(R=x;R!==null;){if(R===o){R=null;break}if(x=R.sibling,x!==null){x.return=R.return,R=x;break}R=R.return}x=R}At(s,o,v.children,d),o=o.child}return o;case 9:return v=o.type,p=o.pendingProps.children,cs(o,d),v=Wt(v),p=p(v),o.flags|=1,At(s,o,p,d),o.child;case 14:return p=o.type,v=ln(p,o.pendingProps),v=ln(p.type,v),wh(s,o,p,v,d);case 15:return _h(s,o,o.type,o.pendingProps,d);case 17:return p=o.type,v=o.pendingProps,v=o.elementType===p?v:ln(p,v),Da(s,o),o.tag=1,wt(p)?(s=!0,ma(o)):s=!1,cs(o,d),Eh(o,p,v),du(o,p,v,d),pu(null,o,p,!0,s,d);case 19:return Fh(s,o,d);case 22:return bh(s,o,d)}throw Error(t(156,o.tag))};function am(s,o){return Ud(s,o)}function aE(s,o,d,p){this.tag=s,this.key=d,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=o,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=p,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Xt(s,o,d,p){return new aE(s,o,d,p)}function Nu(s){return s=s.prototype,!(!s||!s.isReactComponent)}function oE(s){if(typeof s=="function")return Nu(s)?1:0;if(s!=null){if(s=s.$$typeof,s===re)return 11;if(s===oe)return 14}return 2}function hr(s,o){var d=s.alternate;return d===null?(d=Xt(s.tag,o,s.key,s.mode),d.elementType=s.elementType,d.type=s.type,d.stateNode=s.stateNode,d.alternate=s,s.alternate=d):(d.pendingProps=o,d.type=s.type,d.flags=0,d.subtreeFlags=0,d.deletions=null),d.flags=s.flags&14680064,d.childLanes=s.childLanes,d.lanes=s.lanes,d.child=s.child,d.memoizedProps=s.memoizedProps,d.memoizedState=s.memoizedState,d.updateQueue=s.updateQueue,o=s.dependencies,d.dependencies=o===null?null:{lanes:o.lanes,firstContext:o.firstContext},d.sibling=s.sibling,d.index=s.index,d.ref=s.ref,d}function Va(s,o,d,p,v,x){var R=2;if(p=s,typeof s=="function")Nu(s)&&(R=1);else if(typeof s=="string")R=5;else e:switch(s){case D:return Fr(d.children,v,x,o);case M:R=8,v|=8;break;case B:return s=Xt(12,d,o,v|2),s.elementType=B,s.lanes=x,s;case de:return s=Xt(13,d,o,v),s.elementType=de,s.lanes=x,s;case ae:return s=Xt(19,d,o,v),s.elementType=ae,s.lanes=x,s;case ee:return Ha(d,v,x,o);default:if(typeof s=="object"&&s!==null)switch(s.$$typeof){case O:R=10;break e;case X:R=9;break e;case re:R=11;break e;case oe:R=14;break e;case ie:R=16,p=null;break e}throw Error(t(130,s==null?s:typeof s,""))}return o=Xt(R,d,o,v),o.elementType=s,o.type=p,o.lanes=x,o}function Fr(s,o,d,p){return s=Xt(7,s,p,o),s.lanes=d,s}function Ha(s,o,d,p){return s=Xt(22,s,p,o),s.elementType=ee,s.lanes=d,s.stateNode={isHidden:!1},s}function Fu(s,o,d){return s=Xt(6,s,null,o),s.lanes=d,s}function Mu(s,o,d){return o=Xt(4,s.children!==null?s.children:[],s.key,o),o.lanes=d,o.stateNode={containerInfo:s.containerInfo,pendingChildren:null,implementation:s.implementation},o}function lE(s,o,d,p,v){this.tag=o,this.containerInfo=s,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=cl(0),this.expirationTimes=cl(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=cl(0),this.identifierPrefix=p,this.onRecoverableError=v,this.mutableSourceEagerHydrationData=null}function Uu(s,o,d,p,v,x,R,k,N){return s=new lE(s,o,d,k,N),o===1?(o=1,x===!0&&(o|=8)):o=0,x=Xt(3,null,null,o),s.current=x,x.stateNode=s,x.memoizedState={element:p,isDehydrated:d,cache:null,transitions:null,pendingSuspenseBoundaries:null},Ql(x),s}function uE(s,o,d){var p=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:G,key:p==null?null:""+p,children:s,containerInfo:o,implementation:d}}function om(s){if(!s)return sr;s=s._reactInternals;e:{if(Ar(s)!==s||s.tag!==1)throw Error(t(170));var o=s;do{switch(o.tag){case 3:o=o.stateNode.context;break e;case 1:if(wt(o.type)){o=o.stateNode.__reactInternalMemoizedMergedChildContext;break e}}o=o.return}while(o!==null);throw Error(t(171))}if(s.tag===1){var d=s.type;if(wt(d))return Nf(s,d,o)}return o}function lm(s,o,d,p,v,x,R,k,N){return s=Uu(d,p,!0,s,v,x,R,k,N),s.context=om(null),d=s.current,p=Rt(),v=dr(d),x=Fn(p,v),x.callback=o??null,or(d,x,v),s.current.lanes=v,Gs(s,v,p),Ct(s,p),s}function Ka(s,o,d,p){var v=o.current,x=Rt(),R=dr(v);return d=om(d),o.context===null?o.context=d:o.pendingContext=d,o=Fn(x,R),o.payload={element:s},p=p===void 0?null:p,p!==null&&(o.callback=p),s=or(v,o,R),s!==null&&(dn(s,v,R,x),Ta(s,v,R)),R}function za(s){if(s=s.current,!s.child)return null;switch(s.child.tag){case 5:return s.child.stateNode;default:return s.child.stateNode}}function um(s,o){if(s=s.memoizedState,s!==null&&s.dehydrated!==null){var d=s.retryLane;s.retryLane=d!==0&&d<o?d:o}}function Bu(s,o){um(s,o),(s=s.alternate)&&um(s,o)}function cE(){return null}var cm=typeof reportError=="function"?reportError:function(s){console.error(s)};function $u(s){this._internalRoot=s}Wa.prototype.render=$u.prototype.render=function(s){var o=this._internalRoot;if(o===null)throw Error(t(409));Ka(s,o,null,null)},Wa.prototype.unmount=$u.prototype.unmount=function(){var s=this._internalRoot;if(s!==null){this._internalRoot=null;var o=s.containerInfo;Pr(function(){Ka(null,s,null,null)}),o[kn]=null}};function Wa(s){this._internalRoot=s}Wa.prototype.unstable_scheduleHydration=function(s){if(s){var o=zd();s={blockedOn:null,target:s,priority:o};for(var d=0;d<Zn.length&&o!==0&&o<Zn[d].priority;d++);Zn.splice(d,0,s),d===0&&qd(s)}};function Gu(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11)}function Ya(s){return!(!s||s.nodeType!==1&&s.nodeType!==9&&s.nodeType!==11&&(s.nodeType!==8||s.nodeValue!==" react-mount-point-unstable "))}function dm(){}function dE(s,o,d,p,v){if(v){if(typeof p=="function"){var x=p;p=function(){var z=za(R);x.call(z)}}var R=lm(o,p,s,0,null,!1,!1,"",dm);return s._reactRootContainer=R,s[kn]=R.current,ti(s.nodeType===8?s.parentNode:s),Pr(),R}for(;v=s.lastChild;)s.removeChild(v);if(typeof p=="function"){var k=p;p=function(){var z=za(N);k.call(z)}}var N=Uu(s,0,!1,null,null,!1,!1,"",dm);return s._reactRootContainer=N,s[kn]=N.current,ti(s.nodeType===8?s.parentNode:s),Pr(function(){Ka(o,N,d,p)}),N}function qa(s,o,d,p,v){var x=d._reactRootContainer;if(x){var R=x;if(typeof v=="function"){var k=v;v=function(){var N=za(R);k.call(N)}}Ka(o,R,s,v)}else R=dE(d,o,s,v,p);return za(R)}Hd=function(s){switch(s.tag){case 3:var o=s.stateNode;if(o.current.memoizedState.isDehydrated){var d=$s(o.pendingLanes);d!==0&&(dl(o,d|1),Ct(o,Je()),(Oe&6)===0&&(ps=Je()+500,ir()))}break;case 13:Pr(function(){var p=Nn(s,1);if(p!==null){var v=Rt();dn(p,s,1,v)}}),Bu(s,1)}},fl=function(s){if(s.tag===13){var o=Nn(s,134217728);if(o!==null){var d=Rt();dn(o,s,134217728,d)}Bu(s,134217728)}},Kd=function(s){if(s.tag===13){var o=dr(s),d=Nn(s,o);if(d!==null){var p=Rt();dn(d,s,o,p)}Bu(s,o)}},zd=function(){return Me},Wd=function(s,o){var d=Me;try{return Me=s,o()}finally{Me=d}},sl=function(s,o,d){switch(o){case"input":if(nt(s,d),o=d.name,d.type==="radio"&&o!=null){for(d=s;d.parentNode;)d=d.parentNode;for(d=d.querySelectorAll("input[name="+JSON.stringify(""+o)+'][type="radio"]'),o=0;o<d.length;o++){var p=d[o];if(p!==s&&p.form===s.form){var v=fa(p);if(!v)throw Error(t(90));Vi(p),nt(p,v)}}}break;case"textarea":Lr(s,d);break;case"select":o=d.value,o!=null&&Ft(s,!!d.multiple,o,!1)}},kd=Du,Dd=Pr;var fE={usingClientEntryPoint:!1,Events:[si,ns,fa,bd,Cd,Du]},vi={findFiberByHostInstance:Rr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},hE={bundleType:vi.bundleType,version:vi.version,rendererPackageName:vi.rendererPackageName,rendererConfig:vi.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:b.ReactCurrentDispatcher,findHostInstanceByFiber:function(s){return s=Fd(s),s===null?null:s.stateNode},findFiberByHostInstance:vi.findFiberByHostInstance||cE,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Xa=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Xa.isDisabled&&Xa.supportsFiber)try{Wi=Xa.inject(hE),yn=Xa}catch{}}return kt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=fE,kt.createPortal=function(s,o){var d=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Gu(o))throw Error(t(200));return uE(s,o,null,d)},kt.createRoot=function(s,o){if(!Gu(s))throw Error(t(299));var d=!1,p="",v=cm;return o!=null&&(o.unstable_strictMode===!0&&(d=!0),o.identifierPrefix!==void 0&&(p=o.identifierPrefix),o.onRecoverableError!==void 0&&(v=o.onRecoverableError)),o=Uu(s,1,!1,null,null,d,!1,p,v),s[kn]=o.current,ti(s.nodeType===8?s.parentNode:s),new $u(o)},kt.findDOMNode=function(s){if(s==null)return null;if(s.nodeType===1)return s;var o=s._reactInternals;if(o===void 0)throw typeof s.render=="function"?Error(t(188)):(s=Object.keys(s).join(","),Error(t(268,s)));return s=Fd(o),s=s===null?null:s.stateNode,s},kt.flushSync=function(s){return Pr(s)},kt.hydrate=function(s,o,d){if(!Ya(o))throw Error(t(200));return qa(null,s,o,!0,d)},kt.hydrateRoot=function(s,o,d){if(!Gu(s))throw Error(t(405));var p=d!=null&&d.hydratedSources||null,v=!1,x="",R=cm;if(d!=null&&(d.unstable_strictMode===!0&&(v=!0),d.identifierPrefix!==void 0&&(x=d.identifierPrefix),d.onRecoverableError!==void 0&&(R=d.onRecoverableError)),o=lm(o,null,s,1,d??null,v,!1,x,R),s[kn]=o.current,ti(s),p)for(s=0;s<p.length;s++)d=p[s],v=d._getVersion,v=v(d._source),o.mutableSourceEagerHydrationData==null?o.mutableSourceEagerHydrationData=[d,v]:o.mutableSourceEagerHydrationData.push(d,v);return new Wa(o)},kt.render=function(s,o,d){if(!Ya(o))throw Error(t(200));return qa(null,s,o,!1,d)},kt.unmountComponentAtNode=function(s){if(!Ya(s))throw Error(t(40));return s._reactRootContainer?(Pr(function(){qa(null,null,s,!1,function(){s._reactRootContainer=null,s[kn]=null})}),!0):!1},kt.unstable_batchedUpdates=Du,kt.unstable_renderSubtreeIntoContainer=function(s,o,d,p){if(!Ya(d))throw Error(t(200));if(s==null||s._reactInternals===void 0)throw Error(t(38));return qa(s,o,d,!1,p)},kt.version="18.3.1-next-f1338f8080-20240426",kt}var Em;function SE(){if(Em)return Hu.exports;Em=1;function i(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(i)}catch(e){console.error(e)}}return i(),Hu.exports=xE(),Hu.exports}var xm;function TE(){if(xm)return Qa;xm=1;var i=SE();return Qa.createRoot=i.createRoot,Qa.hydrateRoot=i.hydrateRoot,Qa}var LE=TE(),xi={},Sm;function AE(){if(Sm)return xi;Sm=1,Object.defineProperty(xi,"__esModule",{value:!0}),xi.parse=l,xi.serialize=c;const i=/^[\u0021-\u003A\u003C\u003E-\u007E]+$/,e=/^[\u0021-\u003A\u003C-\u007E]*$/,t=/^([.]?[a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)([.][a-z0-9]([a-z0-9-]{0,61}[a-z0-9])?)*$/i,n=/^[\u0020-\u003A\u003D-\u007E]*$/,r=Object.prototype.toString,a=(()=>{const g=function(){};return g.prototype=Object.create(null),g})();function l(g,E){const y=new a,T=g.length;if(T<2)return y;const S=(E==null?void 0:E.decode)||h;let A=0;do{const w=g.indexOf("=",A);if(w===-1)break;const I=g.indexOf(";",A),b=I===-1?T:I;if(w>b){A=g.lastIndexOf(";",w-1)+1;continue}const P=u(g,A,w),G=f(g,w,P),D=g.slice(P,G);if(y[D]===void 0){let M=u(g,w+1,b),B=f(g,b,M);const O=S(g.slice(M,B));y[D]=O}A=b+1}while(A<T);return y}function u(g,E,y){do{const T=g.charCodeAt(E);if(T!==32&&T!==9)return E}while(++E<y);return y}function f(g,E,y){for(;E>y;){const T=g.charCodeAt(--E);if(T!==32&&T!==9)return E+1}return y}function c(g,E,y){const T=(y==null?void 0:y.encode)||encodeURIComponent;if(!i.test(g))throw new TypeError(`argument name is invalid: ${g}`);const S=T(E);if(!e.test(S))throw new TypeError(`argument val is invalid: ${E}`);let A=g+"="+S;if(!y)return A;if(y.maxAge!==void 0){if(!Number.isInteger(y.maxAge))throw new TypeError(`option maxAge is invalid: ${y.maxAge}`);A+="; Max-Age="+y.maxAge}if(y.domain){if(!t.test(y.domain))throw new TypeError(`option domain is invalid: ${y.domain}`);A+="; Domain="+y.domain}if(y.path){if(!n.test(y.path))throw new TypeError(`option path is invalid: ${y.path}`);A+="; Path="+y.path}if(y.expires){if(!m(y.expires)||!Number.isFinite(y.expires.valueOf()))throw new TypeError(`option expires is invalid: ${y.expires}`);A+="; Expires="+y.expires.toUTCString()}if(y.httpOnly&&(A+="; HttpOnly"),y.secure&&(A+="; Secure"),y.partitioned&&(A+="; Partitioned"),y.priority)switch(typeof y.priority=="string"?y.priority.toLowerCase():void 0){case"low":A+="; Priority=Low";break;case"medium":A+="; Priority=Medium";break;case"high":A+="; Priority=High";break;default:throw new TypeError(`option priority is invalid: ${y.priority}`)}if(y.sameSite)switch(typeof y.sameSite=="string"?y.sameSite.toLowerCase():y.sameSite){case!0:case"strict":A+="; SameSite=Strict";break;case"lax":A+="; SameSite=Lax";break;case"none":A+="; SameSite=None";break;default:throw new TypeError(`option sameSite is invalid: ${y.sameSite}`)}return A}function h(g){if(g.indexOf("%")===-1)return g;try{return decodeURIComponent(g)}catch{return g}}function m(g){return r.call(g)==="[object Date]"}return xi}AE();var Tm="popstate";function RE(i={}){function e(n,r){let{pathname:a,search:l,hash:u}=n.location;return Ec("",{pathname:a,search:l,hash:u},r.state&&r.state.usr||null,r.state&&r.state.key||"default")}function t(n,r){return typeof r=="string"?r:bi(r)}return wE(e,t,null,i)}function Xe(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}function _n(i,e){if(!i){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function IE(){return Math.random().toString(36).substring(2,10)}function Lm(i,e){return{usr:i.state,key:i.key,idx:e}}function Ec(i,e,t=null,n){return{pathname:typeof i=="string"?i:i.pathname,search:"",hash:"",...typeof e=="string"?Cs(e):e,state:t,key:e&&e.key||n||IE()}}function bi({pathname:i="/",search:e="",hash:t=""}){return e&&e!=="?"&&(i+=e.charAt(0)==="?"?e:"?"+e),t&&t!=="#"&&(i+=t.charAt(0)==="#"?t:"#"+t),i}function Cs(i){let e={};if(i){let t=i.indexOf("#");t>=0&&(e.hash=i.substring(t),i=i.substring(0,t));let n=i.indexOf("?");n>=0&&(e.search=i.substring(n),i=i.substring(0,n)),i&&(e.pathname=i)}return e}function wE(i,e,t,n={}){let{window:r=document.defaultView,v5Compat:a=!1}=n,l=r.history,u="POP",f=null,c=h();c==null&&(c=0,l.replaceState({...l.state,idx:c},""));function h(){return(l.state||{idx:null}).idx}function m(){u="POP";let S=h(),A=S==null?null:S-c;c=S,f&&f({action:u,location:T.location,delta:A})}function g(S,A){u="PUSH";let w=Ec(T.location,S,A);c=h()+1;let I=Lm(w,c),b=T.createHref(w);try{l.pushState(I,"",b)}catch(P){if(P instanceof DOMException&&P.name==="DataCloneError")throw P;r.location.assign(b)}a&&f&&f({action:u,location:T.location,delta:1})}function E(S,A){u="REPLACE";let w=Ec(T.location,S,A);c=h();let I=Lm(w,c),b=T.createHref(w);l.replaceState(I,"",b),a&&f&&f({action:u,location:T.location,delta:0})}function y(S){return _E(S)}let T={get action(){return u},get location(){return i(r,l)},listen(S){if(f)throw new Error("A history only accepts one active listener");return r.addEventListener(Tm,m),f=S,()=>{r.removeEventListener(Tm,m),f=null}},createHref(S){return e(r,S)},createURL:y,encodeLocation(S){let A=y(S);return{pathname:A.pathname,search:A.search,hash:A.hash}},push:g,replace:E,go(S){return l.go(S)}};return T}function _E(i,e=!1){let t="http://localhost";typeof window<"u"&&(t=window.location.origin!=="null"?window.location.origin:window.location.href),Xe(t,"No window.location.(origin|href) available to create URL");let n=typeof i=="string"?i:bi(i);return n=n.replace(/ $/,"%20"),!e&&n.startsWith("//")&&(n=t+n),new URL(n,t)}function og(i,e,t="/"){return bE(i,e,t,!1)}function bE(i,e,t,n){let r=typeof e=="string"?Cs(e):e,a=Hn(r.pathname||"/",t);if(a==null)return null;let l=lg(i);CE(l);let u=null;for(let f=0;u==null&&f<l.length;++f){let c=GE(a);u=BE(l[f],c,n)}return u}function lg(i,e=[],t=[],n=""){let r=(a,l,u)=>{let f={relativePath:u===void 0?a.path||"":u,caseSensitive:a.caseSensitive===!0,childrenIndex:l,route:a};f.relativePath.startsWith("/")&&(Xe(f.relativePath.startsWith(n),`Absolute route path "${f.relativePath}" nested under path "${n}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),f.relativePath=f.relativePath.slice(n.length));let c=Vn([n,f.relativePath]),h=t.concat(f);a.children&&a.children.length>0&&(Xe(a.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${c}".`),lg(a.children,e,h,c)),!(a.path==null&&!a.index)&&e.push({path:c,score:ME(c,a.index),routesMeta:h})};return i.forEach((a,l)=>{var u;if(a.path===""||!((u=a.path)!=null&&u.includes("?")))r(a,l);else for(let f of ug(a.path))r(a,l,f)}),e}function ug(i){let e=i.split("/");if(e.length===0)return[];let[t,...n]=e,r=t.endsWith("?"),a=t.replace(/\?$/,"");if(n.length===0)return r?[a,""]:[a];let l=ug(n.join("/")),u=[];return u.push(...l.map(f=>f===""?a:[a,f].join("/"))),r&&u.push(...l),u.map(f=>i.startsWith("/")&&f===""?"/":f)}function CE(i){i.sort((e,t)=>e.score!==t.score?t.score-e.score:UE(e.routesMeta.map(n=>n.childrenIndex),t.routesMeta.map(n=>n.childrenIndex)))}var kE=/^:[\w-]+$/,DE=3,PE=2,OE=1,NE=10,FE=-2,Am=i=>i==="*";function ME(i,e){let t=i.split("/"),n=t.length;return t.some(Am)&&(n+=FE),e&&(n+=PE),t.filter(r=>!Am(r)).reduce((r,a)=>r+(kE.test(a)?DE:a===""?OE:NE),n)}function UE(i,e){return i.length===e.length&&i.slice(0,-1).every((n,r)=>n===e[r])?i[i.length-1]-e[e.length-1]:0}function BE(i,e,t=!1){let{routesMeta:n}=i,r={},a="/",l=[];for(let u=0;u<n.length;++u){let f=n[u],c=u===n.length-1,h=a==="/"?e:e.slice(a.length)||"/",m=Io({path:f.relativePath,caseSensitive:f.caseSensitive,end:c},h),g=f.route;if(!m&&c&&t&&!n[n.length-1].route.index&&(m=Io({path:f.relativePath,caseSensitive:f.caseSensitive,end:!1},h)),!m)return null;Object.assign(r,m.params),l.push({params:r,pathname:Vn([a,m.pathname]),pathnameBase:KE(Vn([a,m.pathnameBase])),route:g}),m.pathnameBase!=="/"&&(a=Vn([a,m.pathnameBase]))}return l}function Io(i,e){typeof i=="string"&&(i={path:i,caseSensitive:!1,end:!0});let[t,n]=$E(i.path,i.caseSensitive,i.end),r=e.match(t);if(!r)return null;let a=r[0],l=a.replace(/(.)\/+$/,"$1"),u=r.slice(1);return{params:n.reduce((c,{paramName:h,isOptional:m},g)=>{if(h==="*"){let y=u[g]||"";l=a.slice(0,a.length-y.length).replace(/(.)\/+$/,"$1")}const E=u[g];return m&&!E?c[h]=void 0:c[h]=(E||"").replace(/%2F/g,"/"),c},{}),pathname:a,pathnameBase:l,pattern:i}}function $E(i,e=!1,t=!0){_n(i==="*"||!i.endsWith("*")||i.endsWith("/*"),`Route path "${i}" will be treated as if it were "${i.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${i.replace(/\*$/,"/*")}".`);let n=[],r="^"+i.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(l,u,f)=>(n.push({paramName:u,isOptional:f!=null}),f?"/?([^\\/]+)?":"/([^\\/]+)"));return i.endsWith("*")?(n.push({paramName:"*"}),r+=i==="*"||i==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):t?r+="\\/*$":i!==""&&i!=="/"&&(r+="(?:(?=\\/|$))"),[new RegExp(r,e?void 0:"i"),n]}function GE(i){try{return i.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return _n(!1,`The URL path "${i}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),i}}function Hn(i,e){if(e==="/")return i;if(!i.toLowerCase().startsWith(e.toLowerCase()))return null;let t=e.endsWith("/")?e.length-1:e.length,n=i.charAt(t);return n&&n!=="/"?null:i.slice(t)||"/"}function jE(i,e="/"){let{pathname:t,search:n="",hash:r=""}=typeof i=="string"?Cs(i):i;return{pathname:t?t.startsWith("/")?t:VE(t,e):e,search:zE(n),hash:WE(r)}}function VE(i,e){let t=e.replace(/\/+$/,"").split("/");return i.split("/").forEach(r=>{r===".."?t.length>1&&t.pop():r!=="."&&t.push(r)}),t.length>1?t.join("/"):"/"}function Wu(i,e,t,n){return`Cannot include a '${i}' character in a manually specified \`to.${e}\` field [${JSON.stringify(n)}].  Please separate it out to the \`to.${t}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function HE(i){return i.filter((e,t)=>t===0||e.route.path&&e.route.path.length>0)}function cg(i){let e=HE(i);return e.map((t,n)=>n===e.length-1?t.pathname:t.pathnameBase)}function dg(i,e,t,n=!1){let r;typeof i=="string"?r=Cs(i):(r={...i},Xe(!r.pathname||!r.pathname.includes("?"),Wu("?","pathname","search",r)),Xe(!r.pathname||!r.pathname.includes("#"),Wu("#","pathname","hash",r)),Xe(!r.search||!r.search.includes("#"),Wu("#","search","hash",r)));let a=i===""||r.pathname==="",l=a?"/":r.pathname,u;if(l==null)u=t;else{let m=e.length-1;if(!n&&l.startsWith("..")){let g=l.split("/");for(;g[0]==="..";)g.shift(),m-=1;r.pathname=g.join("/")}u=m>=0?e[m]:"/"}let f=jE(r,u),c=l&&l!=="/"&&l.endsWith("/"),h=(a||l===".")&&t.endsWith("/");return!f.pathname.endsWith("/")&&(c||h)&&(f.pathname+="/"),f}var Vn=i=>i.join("/").replace(/\/\/+/g,"/"),KE=i=>i.replace(/\/+$/,"").replace(/^\/*/,"/"),zE=i=>!i||i==="?"?"":i.startsWith("?")?i:"?"+i,WE=i=>!i||i==="#"?"":i.startsWith("#")?i:"#"+i;function YE(i){return i!=null&&typeof i.status=="number"&&typeof i.statusText=="string"&&typeof i.internal=="boolean"&&"data"in i}var fg=["POST","PUT","PATCH","DELETE"];new Set(fg);var qE=["GET",...fg];new Set(qE);var ks=W.createContext(null);ks.displayName="DataRouter";var $o=W.createContext(null);$o.displayName="DataRouterState";var hg=W.createContext({isTransitioning:!1});hg.displayName="ViewTransition";var XE=W.createContext(new Map);XE.displayName="Fetchers";var QE=W.createContext(null);QE.displayName="Await";var Cn=W.createContext(null);Cn.displayName="Navigation";var Ui=W.createContext(null);Ui.displayName="Location";var Kn=W.createContext({outlet:null,matches:[],isDataRoute:!1});Kn.displayName="Route";var qc=W.createContext(null);qc.displayName="RouteError";function JE(i,{relative:e}={}){Xe(Bi(),"useHref() may be used only in the context of a <Router> component.");let{basename:t,navigator:n}=W.useContext(Cn),{hash:r,pathname:a,search:l}=$i(i,{relative:e}),u=a;return t!=="/"&&(u=a==="/"?t:Vn([t,a])),n.createHref({pathname:u,search:l,hash:r})}function Bi(){return W.useContext(Ui)!=null}function Sr(){return Xe(Bi(),"useLocation() may be used only in the context of a <Router> component."),W.useContext(Ui).location}var mg="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function pg(i){W.useContext(Cn).static||W.useLayoutEffect(i)}function ZE(){let{isDataRoute:i}=W.useContext(Kn);return i?fx():ex()}function ex(){Xe(Bi(),"useNavigate() may be used only in the context of a <Router> component.");let i=W.useContext(ks),{basename:e,navigator:t}=W.useContext(Cn),{matches:n}=W.useContext(Kn),{pathname:r}=Sr(),a=JSON.stringify(cg(n)),l=W.useRef(!1);return pg(()=>{l.current=!0}),W.useCallback((f,c={})=>{if(_n(l.current,mg),!l.current)return;if(typeof f=="number"){t.go(f);return}let h=dg(f,JSON.parse(a),r,c.relative==="path");i==null&&e!=="/"&&(h.pathname=h.pathname==="/"?e:Vn([e,h.pathname])),(c.replace?t.replace:t.push)(h,c.state,c)},[e,t,a,r,i])}W.createContext(null);function $i(i,{relative:e}={}){let{matches:t}=W.useContext(Kn),{pathname:n}=Sr(),r=JSON.stringify(cg(t));return W.useMemo(()=>dg(i,JSON.parse(r),n,e==="path"),[i,r,n,e])}function tx(i,e){return gg(i,e)}function gg(i,e,t,n){var A;Xe(Bi(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:r}=W.useContext(Cn),{matches:a}=W.useContext(Kn),l=a[a.length-1],u=l?l.params:{},f=l?l.pathname:"/",c=l?l.pathnameBase:"/",h=l&&l.route;{let w=h&&h.path||"";yg(f,!h||w.endsWith("*")||w.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${f}" (under <Route path="${w}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${w}"> to <Route path="${w==="/"?"*":`${w}/*`}">.`)}let m=Sr(),g;if(e){let w=typeof e=="string"?Cs(e):e;Xe(c==="/"||((A=w.pathname)==null?void 0:A.startsWith(c)),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${c}" but pathname "${w.pathname}" was given in the \`location\` prop.`),g=w}else g=m;let E=g.pathname||"/",y=E;if(c!=="/"){let w=c.replace(/^\//,"").split("/");y="/"+E.replace(/^\//,"").split("/").slice(w.length).join("/")}let T=og(i,{pathname:y});_n(h||T!=null,`No routes matched location "${g.pathname}${g.search}${g.hash}" `),_n(T==null||T[T.length-1].route.element!==void 0||T[T.length-1].route.Component!==void 0||T[T.length-1].route.lazy!==void 0,`Matched leaf route at location "${g.pathname}${g.search}${g.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let S=ax(T&&T.map(w=>Object.assign({},w,{params:Object.assign({},u,w.params),pathname:Vn([c,r.encodeLocation?r.encodeLocation(w.pathname).pathname:w.pathname]),pathnameBase:w.pathnameBase==="/"?c:Vn([c,r.encodeLocation?r.encodeLocation(w.pathnameBase).pathname:w.pathnameBase])})),a,t,n);return e&&S?W.createElement(Ui.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...g},navigationType:"POP"}},S):S}function nx(){let i=dx(),e=YE(i)?`${i.status} ${i.statusText}`:i instanceof Error?i.message:JSON.stringify(i),t=i instanceof Error?i.stack:null,n="rgba(200,200,200, 0.5)",r={padding:"0.5rem",backgroundColor:n},a={padding:"2px 4px",backgroundColor:n},l=null;return console.error("Error handled by React Router default ErrorBoundary:",i),l=W.createElement(W.Fragment,null,W.createElement("p",null,"💿 Hey developer 👋"),W.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",W.createElement("code",{style:a},"ErrorBoundary")," or"," ",W.createElement("code",{style:a},"errorElement")," prop on your route.")),W.createElement(W.Fragment,null,W.createElement("h2",null,"Unexpected Application Error!"),W.createElement("h3",{style:{fontStyle:"italic"}},e),t?W.createElement("pre",{style:r},t):null,l)}var rx=W.createElement(nx,null),sx=class extends W.Component{constructor(i){super(i),this.state={location:i.location,revalidation:i.revalidation,error:i.error}}static getDerivedStateFromError(i){return{error:i}}static getDerivedStateFromProps(i,e){return e.location!==i.location||e.revalidation!=="idle"&&i.revalidation==="idle"?{error:i.error,location:i.location,revalidation:i.revalidation}:{error:i.error!==void 0?i.error:e.error,location:e.location,revalidation:i.revalidation||e.revalidation}}componentDidCatch(i,e){console.error("React Router caught the following error during render",i,e)}render(){return this.state.error!==void 0?W.createElement(Kn.Provider,{value:this.props.routeContext},W.createElement(qc.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function ix({routeContext:i,match:e,children:t}){let n=W.useContext(ks);return n&&n.static&&n.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(n.staticContext._deepestRenderedBoundaryId=e.route.id),W.createElement(Kn.Provider,{value:i},t)}function ax(i,e=[],t=null,n=null){if(i==null){if(!t)return null;if(t.errors)i=t.matches;else if(e.length===0&&!t.initialized&&t.matches.length>0)i=t.matches;else return null}let r=i,a=t==null?void 0:t.errors;if(a!=null){let f=r.findIndex(c=>c.route.id&&(a==null?void 0:a[c.route.id])!==void 0);Xe(f>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(a).join(",")}`),r=r.slice(0,Math.min(r.length,f+1))}let l=!1,u=-1;if(t)for(let f=0;f<r.length;f++){let c=r[f];if((c.route.HydrateFallback||c.route.hydrateFallbackElement)&&(u=f),c.route.id){let{loaderData:h,errors:m}=t,g=c.route.loader&&!h.hasOwnProperty(c.route.id)&&(!m||m[c.route.id]===void 0);if(c.route.lazy||g){l=!0,u>=0?r=r.slice(0,u+1):r=[r[0]];break}}}return r.reduceRight((f,c,h)=>{let m,g=!1,E=null,y=null;t&&(m=a&&c.route.id?a[c.route.id]:void 0,E=c.route.errorElement||rx,l&&(u<0&&h===0?(yg("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),g=!0,y=null):u===h&&(g=!0,y=c.route.hydrateFallbackElement||null)));let T=e.concat(r.slice(0,h+1)),S=()=>{let A;return m?A=E:g?A=y:c.route.Component?A=W.createElement(c.route.Component,null):c.route.element?A=c.route.element:A=f,W.createElement(ix,{match:c,routeContext:{outlet:f,matches:T,isDataRoute:t!=null},children:A})};return t&&(c.route.ErrorBoundary||c.route.errorElement||h===0)?W.createElement(sx,{location:t.location,revalidation:t.revalidation,component:E,error:m,children:S(),routeContext:{outlet:null,matches:T,isDataRoute:!0}}):S()},null)}function Xc(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function ox(i){let e=W.useContext(ks);return Xe(e,Xc(i)),e}function lx(i){let e=W.useContext($o);return Xe(e,Xc(i)),e}function ux(i){let e=W.useContext(Kn);return Xe(e,Xc(i)),e}function Qc(i){let e=ux(i),t=e.matches[e.matches.length-1];return Xe(t.route.id,`${i} can only be used on routes that contain a unique "id"`),t.route.id}function cx(){return Qc("useRouteId")}function dx(){var n;let i=W.useContext(qc),e=lx("useRouteError"),t=Qc("useRouteError");return i!==void 0?i:(n=e.errors)==null?void 0:n[t]}function fx(){let{router:i}=ox("useNavigate"),e=Qc("useNavigate"),t=W.useRef(!1);return pg(()=>{t.current=!0}),W.useCallback(async(r,a={})=>{_n(t.current,mg),t.current&&(typeof r=="number"?i.navigate(r):await i.navigate(r,{fromRouteId:e,...a}))},[i,e])}var Rm={};function yg(i,e,t){!e&&!Rm[i]&&(Rm[i]=!0,_n(!1,t))}W.memo(hx);function hx({routes:i,future:e,state:t}){return gg(i,void 0,t,e)}function Ai(i){Xe(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function mx({basename:i="/",children:e=null,location:t,navigationType:n="POP",navigator:r,static:a=!1}){Xe(!Bi(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let l=i.replace(/^\/*/,"/"),u=W.useMemo(()=>({basename:l,navigator:r,static:a,future:{}}),[l,r,a]);typeof t=="string"&&(t=Cs(t));let{pathname:f="/",search:c="",hash:h="",state:m=null,key:g="default"}=t,E=W.useMemo(()=>{let y=Hn(f,l);return y==null?null:{location:{pathname:y,search:c,hash:h,state:m,key:g},navigationType:n}},[l,f,c,h,m,g,n]);return _n(E!=null,`<Router basename="${l}"> is not able to match the URL "${f}${c}${h}" because it does not start with the basename, so the <Router> won't render anything.`),E==null?null:W.createElement(Cn.Provider,{value:u},W.createElement(Ui.Provider,{children:e,value:E}))}function px({children:i,location:e}){return tx(xc(i),e)}function xc(i,e=[]){let t=[];return W.Children.forEach(i,(n,r)=>{if(!W.isValidElement(n))return;let a=[...e,r];if(n.type===W.Fragment){t.push.apply(t,xc(n.props.children,a));return}Xe(n.type===Ai,`[${typeof n.type=="string"?n.type:n.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),Xe(!n.props.index||!n.props.children,"An index route cannot have child routes.");let l={id:n.props.id||a.join("-"),caseSensitive:n.props.caseSensitive,element:n.props.element,Component:n.props.Component,index:n.props.index,path:n.props.path,loader:n.props.loader,action:n.props.action,hydrateFallbackElement:n.props.hydrateFallbackElement,HydrateFallback:n.props.HydrateFallback,errorElement:n.props.errorElement,ErrorBoundary:n.props.ErrorBoundary,hasErrorBoundary:n.props.hasErrorBoundary===!0||n.props.ErrorBoundary!=null||n.props.errorElement!=null,shouldRevalidate:n.props.shouldRevalidate,handle:n.props.handle,lazy:n.props.lazy};n.props.children&&(l.children=xc(n.props.children,a)),t.push(l)}),t}var ho="get",mo="application/x-www-form-urlencoded";function Go(i){return i!=null&&typeof i.tagName=="string"}function gx(i){return Go(i)&&i.tagName.toLowerCase()==="button"}function yx(i){return Go(i)&&i.tagName.toLowerCase()==="form"}function vx(i){return Go(i)&&i.tagName.toLowerCase()==="input"}function Ex(i){return!!(i.metaKey||i.altKey||i.ctrlKey||i.shiftKey)}function xx(i,e){return i.button===0&&(!e||e==="_self")&&!Ex(i)}var Ja=null;function Sx(){if(Ja===null)try{new FormData(document.createElement("form"),0),Ja=!1}catch{Ja=!0}return Ja}var Tx=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function Yu(i){return i!=null&&!Tx.has(i)?(_n(!1,`"${i}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${mo}"`),null):i}function Lx(i,e){let t,n,r,a,l;if(yx(i)){let u=i.getAttribute("action");n=u?Hn(u,e):null,t=i.getAttribute("method")||ho,r=Yu(i.getAttribute("enctype"))||mo,a=new FormData(i)}else if(gx(i)||vx(i)&&(i.type==="submit"||i.type==="image")){let u=i.form;if(u==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let f=i.getAttribute("formaction")||u.getAttribute("action");if(n=f?Hn(f,e):null,t=i.getAttribute("formmethod")||u.getAttribute("method")||ho,r=Yu(i.getAttribute("formenctype"))||Yu(u.getAttribute("enctype"))||mo,a=new FormData(u,i),!Sx()){let{name:c,type:h,value:m}=i;if(h==="image"){let g=c?`${c}.`:"";a.append(`${g}x`,"0"),a.append(`${g}y`,"0")}else c&&a.append(c,m)}}else{if(Go(i))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');t=ho,n=null,r=mo,l=i}return a&&r==="text/plain"&&(l=a,a=void 0),{action:n,method:t.toLowerCase(),encType:r,formData:a,body:l}}function Jc(i,e){if(i===!1||i===null||typeof i>"u")throw new Error(e)}async function Ax(i,e){if(i.id in e)return e[i.id];try{let t=await import(i.module);return e[i.id]=t,t}catch(t){return console.error(`Error loading route module \`${i.module}\`, reloading page...`),console.error(t),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function Rx(i){return i==null?!1:i.href==null?i.rel==="preload"&&typeof i.imageSrcSet=="string"&&typeof i.imageSizes=="string":typeof i.rel=="string"&&typeof i.href=="string"}async function Ix(i,e,t){let n=await Promise.all(i.map(async r=>{let a=e.routes[r.route.id];if(a){let l=await Ax(a,t);return l.links?l.links():[]}return[]}));return Cx(n.flat(1).filter(Rx).filter(r=>r.rel==="stylesheet"||r.rel==="preload").map(r=>r.rel==="stylesheet"?{...r,rel:"prefetch",as:"style"}:{...r,rel:"prefetch"}))}function Im(i,e,t,n,r,a){let l=(f,c)=>t[c]?f.route.id!==t[c].route.id:!0,u=(f,c)=>{var h;return t[c].pathname!==f.pathname||((h=t[c].route.path)==null?void 0:h.endsWith("*"))&&t[c].params["*"]!==f.params["*"]};return a==="assets"?e.filter((f,c)=>l(f,c)||u(f,c)):a==="data"?e.filter((f,c)=>{var m;let h=n.routes[f.route.id];if(!h||!h.hasLoader)return!1;if(l(f,c)||u(f,c))return!0;if(f.route.shouldRevalidate){let g=f.route.shouldRevalidate({currentUrl:new URL(r.pathname+r.search+r.hash,window.origin),currentParams:((m=t[0])==null?void 0:m.params)||{},nextUrl:new URL(i,window.origin),nextParams:f.params,defaultShouldRevalidate:!0});if(typeof g=="boolean")return g}return!0}):[]}function wx(i,e,{includeHydrateFallback:t}={}){return _x(i.map(n=>{let r=e.routes[n.route.id];if(!r)return[];let a=[r.module];return r.clientActionModule&&(a=a.concat(r.clientActionModule)),r.clientLoaderModule&&(a=a.concat(r.clientLoaderModule)),t&&r.hydrateFallbackModule&&(a=a.concat(r.hydrateFallbackModule)),r.imports&&(a=a.concat(r.imports)),a}).flat(1))}function _x(i){return[...new Set(i)]}function bx(i){let e={},t=Object.keys(i).sort();for(let n of t)e[n]=i[n];return e}function Cx(i,e){let t=new Set;return new Set(e),i.reduce((n,r)=>{let a=JSON.stringify(bx(r));return t.has(a)||(t.add(a),n.push({key:a,link:r})),n},[])}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");var kx=new Set([100,101,204,205]);function Dx(i,e){let t=typeof i=="string"?new URL(i,typeof window>"u"?"server://singlefetch/":window.location.origin):i;return t.pathname==="/"?t.pathname="_root.data":e&&Hn(t.pathname,e)==="/"?t.pathname=`${e.replace(/\/$/,"")}/_root.data`:t.pathname=`${t.pathname.replace(/\/$/,"")}.data`,t}function vg(){let i=W.useContext(ks);return Jc(i,"You must render this element inside a <DataRouterContext.Provider> element"),i}function Px(){let i=W.useContext($o);return Jc(i,"You must render this element inside a <DataRouterStateContext.Provider> element"),i}var Zc=W.createContext(void 0);Zc.displayName="FrameworkContext";function Eg(){let i=W.useContext(Zc);return Jc(i,"You must render this element inside a <HydratedRouter> element"),i}function Ox(i,e){let t=W.useContext(Zc),[n,r]=W.useState(!1),[a,l]=W.useState(!1),{onFocus:u,onBlur:f,onMouseEnter:c,onMouseLeave:h,onTouchStart:m}=e,g=W.useRef(null);W.useEffect(()=>{if(i==="render"&&l(!0),i==="viewport"){let T=A=>{A.forEach(w=>{l(w.isIntersecting)})},S=new IntersectionObserver(T,{threshold:.5});return g.current&&S.observe(g.current),()=>{S.disconnect()}}},[i]),W.useEffect(()=>{if(n){let T=setTimeout(()=>{l(!0)},100);return()=>{clearTimeout(T)}}},[n]);let E=()=>{r(!0)},y=()=>{r(!1),l(!1)};return t?i!=="intent"?[a,g,{}]:[a,g,{onFocus:Si(u,E),onBlur:Si(f,y),onMouseEnter:Si(c,E),onMouseLeave:Si(h,y),onTouchStart:Si(m,E)}]:[!1,g,{}]}function Si(i,e){return t=>{i&&i(t),t.defaultPrevented||e(t)}}function Nx({page:i,...e}){let{router:t}=vg(),n=W.useMemo(()=>og(t.routes,i,t.basename),[t.routes,i,t.basename]);return n?W.createElement(Mx,{page:i,matches:n,...e}):null}function Fx(i){let{manifest:e,routeModules:t}=Eg(),[n,r]=W.useState([]);return W.useEffect(()=>{let a=!1;return Ix(i,e,t).then(l=>{a||r(l)}),()=>{a=!0}},[i,e,t]),n}function Mx({page:i,matches:e,...t}){let n=Sr(),{manifest:r,routeModules:a}=Eg(),{basename:l}=vg(),{loaderData:u,matches:f}=Px(),c=W.useMemo(()=>Im(i,e,f,r,n,"data"),[i,e,f,r,n]),h=W.useMemo(()=>Im(i,e,f,r,n,"assets"),[i,e,f,r,n]),m=W.useMemo(()=>{if(i===n.pathname+n.search+n.hash)return[];let y=new Set,T=!1;if(e.forEach(A=>{var I;let w=r.routes[A.route.id];!w||!w.hasLoader||(!c.some(b=>b.route.id===A.route.id)&&A.route.id in u&&((I=a[A.route.id])!=null&&I.shouldRevalidate)||w.hasClientLoader?T=!0:y.add(A.route.id))}),y.size===0)return[];let S=Dx(i,l);return T&&y.size>0&&S.searchParams.set("_routes",e.filter(A=>y.has(A.route.id)).map(A=>A.route.id).join(",")),[S.pathname+S.search]},[l,u,n,r,c,e,i,a]),g=W.useMemo(()=>wx(h,r),[h,r]),E=Fx(h);return W.createElement(W.Fragment,null,m.map(y=>W.createElement("link",{key:y,rel:"prefetch",as:"fetch",href:y,...t})),g.map(y=>W.createElement("link",{key:y,rel:"modulepreload",href:y,...t})),E.map(({key:y,link:T})=>W.createElement("link",{key:y,...T})))}function Ux(...i){return e=>{i.forEach(t=>{typeof t=="function"?t(e):t!=null&&(t.current=e)})}}var xg=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{xg&&(window.__reactRouterVersion="7.6.3")}catch{}function Bx({basename:i,children:e,window:t}){let n=W.useRef();n.current==null&&(n.current=RE({window:t,v5Compat:!0}));let r=n.current,[a,l]=W.useState({action:r.action,location:r.location}),u=W.useCallback(f=>{W.startTransition(()=>l(f))},[l]);return W.useLayoutEffect(()=>r.listen(u),[r,u]),W.createElement(mx,{basename:i,children:e,location:a.location,navigationType:a.action,navigator:r})}var Sg=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,Ls=W.forwardRef(function({onClick:e,discover:t="render",prefetch:n="none",relative:r,reloadDocument:a,replace:l,state:u,target:f,to:c,preventScrollReset:h,viewTransition:m,...g},E){let{basename:y}=W.useContext(Cn),T=typeof c=="string"&&Sg.test(c),S,A=!1;if(typeof c=="string"&&T&&(S=c,xg))try{let B=new URL(window.location.href),O=c.startsWith("//")?new URL(B.protocol+c):new URL(c),X=Hn(O.pathname,y);O.origin===B.origin&&X!=null?c=X+O.search+O.hash:A=!0}catch{_n(!1,`<Link to="${c}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let w=JE(c,{relative:r}),[I,b,P]=Ox(n,g),G=Vx(c,{replace:l,state:u,target:f,preventScrollReset:h,relative:r,viewTransition:m});function D(B){e&&e(B),B.defaultPrevented||G(B)}let M=W.createElement("a",{...g,...P,href:S||w,onClick:A||a?e:D,ref:Ux(E,b),target:f,"data-discover":!T&&t==="render"?"true":void 0});return I&&!T?W.createElement(W.Fragment,null,M,W.createElement(Nx,{page:w})):M});Ls.displayName="Link";var $x=W.forwardRef(function({"aria-current":e="page",caseSensitive:t=!1,className:n="",end:r=!1,style:a,to:l,viewTransition:u,children:f,...c},h){let m=$i(l,{relative:c.relative}),g=Sr(),E=W.useContext($o),{navigator:y,basename:T}=W.useContext(Cn),S=E!=null&&Yx(m)&&u===!0,A=y.encodeLocation?y.encodeLocation(m).pathname:m.pathname,w=g.pathname,I=E&&E.navigation&&E.navigation.location?E.navigation.location.pathname:null;t||(w=w.toLowerCase(),I=I?I.toLowerCase():null,A=A.toLowerCase()),I&&T&&(I=Hn(I,T)||I);const b=A!=="/"&&A.endsWith("/")?A.length-1:A.length;let P=w===A||!r&&w.startsWith(A)&&w.charAt(b)==="/",G=I!=null&&(I===A||!r&&I.startsWith(A)&&I.charAt(A.length)==="/"),D={isActive:P,isPending:G,isTransitioning:S},M=P?e:void 0,B;typeof n=="function"?B=n(D):B=[n,P?"active":null,G?"pending":null,S?"transitioning":null].filter(Boolean).join(" ");let O=typeof a=="function"?a(D):a;return W.createElement(Ls,{...c,"aria-current":M,className:B,ref:h,style:O,to:l,viewTransition:u},typeof f=="function"?f(D):f)});$x.displayName="NavLink";var Gx=W.forwardRef(({discover:i="render",fetcherKey:e,navigate:t,reloadDocument:n,replace:r,state:a,method:l=ho,action:u,onSubmit:f,relative:c,preventScrollReset:h,viewTransition:m,...g},E)=>{let y=zx(),T=Wx(u,{relative:c}),S=l.toLowerCase()==="get"?"get":"post",A=typeof u=="string"&&Sg.test(u),w=I=>{if(f&&f(I),I.defaultPrevented)return;I.preventDefault();let b=I.nativeEvent.submitter,P=(b==null?void 0:b.getAttribute("formmethod"))||l;y(b||I.currentTarget,{fetcherKey:e,method:P,navigate:t,replace:r,state:a,relative:c,preventScrollReset:h,viewTransition:m})};return W.createElement("form",{ref:E,method:S,action:T,onSubmit:n?f:w,...g,"data-discover":!A&&i==="render"?"true":void 0})});Gx.displayName="Form";function jx(i){return`${i} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function Tg(i){let e=W.useContext(ks);return Xe(e,jx(i)),e}function Vx(i,{target:e,replace:t,state:n,preventScrollReset:r,relative:a,viewTransition:l}={}){let u=ZE(),f=Sr(),c=$i(i,{relative:a});return W.useCallback(h=>{if(xx(h,e)){h.preventDefault();let m=t!==void 0?t:bi(f)===bi(c);u(i,{replace:m,state:n,preventScrollReset:r,relative:a,viewTransition:l})}},[f,u,c,t,n,e,i,r,a,l])}var Hx=0,Kx=()=>`__${String(++Hx)}__`;function zx(){let{router:i}=Tg("useSubmit"),{basename:e}=W.useContext(Cn),t=cx();return W.useCallback(async(n,r={})=>{let{action:a,method:l,encType:u,formData:f,body:c}=Lx(n,e);if(r.navigate===!1){let h=r.fetcherKey||Kx();await i.fetch(h,t,r.action||a,{preventScrollReset:r.preventScrollReset,formData:f,body:c,formMethod:r.method||l,formEncType:r.encType||u,flushSync:r.flushSync})}else await i.navigate(r.action||a,{preventScrollReset:r.preventScrollReset,formData:f,body:c,formMethod:r.method||l,formEncType:r.encType||u,replace:r.replace,state:r.state,fromRouteId:t,flushSync:r.flushSync,viewTransition:r.viewTransition})},[i,e,t])}function Wx(i,{relative:e}={}){let{basename:t}=W.useContext(Cn),n=W.useContext(Kn);Xe(n,"useFormAction must be used inside a RouteContext");let[r]=n.matches.slice(-1),a={...$i(i||".",{relative:e})},l=Sr();if(i==null){a.search=l.search;let u=new URLSearchParams(a.search),f=u.getAll("index");if(f.some(h=>h==="")){u.delete("index"),f.filter(m=>m).forEach(m=>u.append("index",m));let h=u.toString();a.search=h?`?${h}`:""}}return(!i||i===".")&&r.route.index&&(a.search=a.search?a.search.replace(/^\?/,"?index&"):"?index"),t!=="/"&&(a.pathname=a.pathname==="/"?t:Vn([t,a.pathname])),bi(a)}function Yx(i,e={}){let t=W.useContext(hg);Xe(t!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:n}=Tg("useViewTransitionState"),r=$i(i,{relative:e.relative});if(!t.isTransitioning)return!1;let a=Hn(t.currentLocation.pathname,n)||t.currentLocation.pathname,l=Hn(t.nextLocation.pathname,n)||t.nextLocation.pathname;return Io(r.pathname,l)!=null||Io(r.pathname,a)!=null}[...kx];/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var qx={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Xx=i=>i.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase().trim(),lt=(i,e)=>{const t=W.forwardRef(({color:n="currentColor",size:r=24,strokeWidth:a=2,absoluteStrokeWidth:l,className:u="",children:f,...c},h)=>W.createElement("svg",{ref:h,...qx,width:r,height:r,stroke:n,strokeWidth:l?Number(a)*24/Number(r):a,className:["lucide",`lucide-${Xx(i)}`,u].join(" "),...c},[...e.map(([m,g])=>W.createElement(m,g)),...Array.isArray(f)?f:[f]]));return t.displayName=`${i}`,t};/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wm=lt("AlertCircle",[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"12",x2:"12",y1:"8",y2:"12",key:"1pkeuh"}],["line",{x1:"12",x2:"12.01",y1:"16",y2:"16",key:"4dfq90"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Qx=lt("EyeOff",[["path",{d:"M9.88 9.88a3 3 0 1 0 4.24 4.24",key:"1jxqfv"}],["path",{d:"M10.73 5.08A10.43 10.43 0 0 1 12 5c7 0 10 7 10 7a13.16 13.16 0 0 1-1.67 2.68",key:"9wicm4"}],["path",{d:"M6.61 6.61A13.526 13.526 0 0 0 2 12s3 7 10 7a9.74 9.74 0 0 0 5.39-1.61",key:"1jreej"}],["line",{x1:"2",x2:"22",y1:"2",y2:"22",key:"a6p6uj"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Jx=lt("Eye",[["path",{d:"M2 12s3-7 10-7 10 7 10 7-3 7-10 7-10-7-10-7Z",key:"rwhkz3"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Zx=lt("Home",[["path",{d:"m3 9 9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z",key:"y5dka4"}],["polyline",{points:"9 22 9 12 15 12 15 22",key:"e2us08"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Sc=lt("Layers",[["path",{d:"m12.83 2.18a2 2 0 0 0-1.66 0L2.6 6.08a1 1 0 0 0 0 1.83l8.58 3.91a2 2 0 0 0 1.66 0l8.58-3.9a1 1 0 0 0 0-1.83Z",key:"8b97xw"}],["path",{d:"m22 17.65-9.17 4.16a2 2 0 0 1-1.66 0L2 17.65",key:"dd6zsq"}],["path",{d:"m22 12.65-9.17 4.16a2 2 0 0 1-1.66 0L2 12.65",key:"ep9fru"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const eS=lt("Maximize",[["path",{d:"M8 3H5a2 2 0 0 0-2 2v3",key:"1dcmit"}],["path",{d:"M21 8V5a2 2 0 0 0-2-2h-3",key:"1e4gt3"}],["path",{d:"M3 16v3a2 2 0 0 0 2 2h3",key:"wsl5sc"}],["path",{d:"M16 21h3a2 2 0 0 0 2-2v-3",key:"18trek"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _m=lt("Monitor",[["rect",{width:"20",height:"14",x:"2",y:"3",rx:"2",key:"48i651"}],["line",{x1:"8",x2:"16",y1:"21",y2:"21",key:"1svkeh"}],["line",{x1:"12",x2:"12",y1:"17",y2:"21",key:"vw1qmm"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const tS=lt("Pause",[["rect",{width:"4",height:"16",x:"6",y:"4",key:"iffhe4"}],["rect",{width:"4",height:"16",x:"14",y:"4",key:"sjin7j"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const wo=lt("Play",[["polygon",{points:"5 3 19 12 5 21 5 3",key:"191637"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const nS=lt("Plus",[["path",{d:"M5 12h14",key:"1ays0h"}],["path",{d:"M12 5v14",key:"s699le"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rS=lt("RefreshCw",[["path",{d:"M3 12a9 9 0 0 1 9-9 9.75 9.75 0 0 1 6.74 2.74L21 8",key:"v9h5vc"}],["path",{d:"M21 3v5h-5",key:"1q7to0"}],["path",{d:"M21 12a9 9 0 0 1-9 9 9.75 9.75 0 0 1-6.74-2.74L3 16",key:"3uifl3"}],["path",{d:"M8 16H3v5",key:"1cv678"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sS=lt("Save",[["path",{d:"M19 21H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11l5 5v11a2 2 0 0 1-2 2z",key:"1owoqh"}],["polyline",{points:"17 21 17 13 7 13 7 21",key:"1md35c"}],["polyline",{points:"7 3 7 8 15 8",key:"8nz8an"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const Lg=lt("Settings",[["path",{d:"M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.74l-.15.09a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.39a2 2 0 0 0-.73-2.73l-.15-.08a2 2 0 0 1-1-1.74v-.5a2 2 0 0 1 1-1.74l.15-.09a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z",key:"1qme2f"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const iS=lt("SquarePen",[["path",{d:"M12 3H5a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7",key:"1m0v6g"}],["path",{d:"M18.375 2.625a2.121 2.121 0 1 1 3 3L12 15l-4 1 1-4Z",key:"1lpok0"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aS=lt("Trash2",[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}],["line",{x1:"10",x2:"10",y1:"11",y2:"17",key:"1uufr5"}],["line",{x1:"14",x2:"14",y1:"11",y2:"17",key:"xtxkd"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const oS=lt("Volume2",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["path",{d:"M15.54 8.46a5 5 0 0 1 0 7.07",key:"ltjumu"}],["path",{d:"M19.07 4.93a10 10 0 0 1 0 14.14",key:"1kegas"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const lS=lt("VolumeX",[["polygon",{points:"11 5 6 9 2 9 2 15 6 15 11 19 11 5",key:"16drj5"}],["line",{x1:"22",x2:"16",y1:"9",y2:"15",key:"1ewh16"}],["line",{x1:"16",x2:"22",y1:"9",y2:"15",key:"5ykzw1"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uS=lt("Wifi",[["path",{d:"M12 20h.01",key:"zekei9"}],["path",{d:"M2 8.82a15 15 0 0 1 20 0",key:"dnpr2z"}],["path",{d:"M5 12.859a10 10 0 0 1 14 0",key:"1x1e6c"}],["path",{d:"M8.5 16.429a5 5 0 0 1 7 0",key:"1bycff"}]]);/**
 * @license lucide-react v0.344.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cS=lt("X",[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]]);function Ag(i,e){return function(){return i.apply(e,arguments)}}const{toString:dS}=Object.prototype,{getPrototypeOf:ed}=Object,{iterator:jo,toStringTag:Rg}=Symbol,Vo=(i=>e=>{const t=dS.call(e);return i[t]||(i[t]=t.slice(8,-1).toLowerCase())})(Object.create(null)),pn=i=>(i=i.toLowerCase(),e=>Vo(e)===i),Ho=i=>e=>typeof e===i,{isArray:Ds}=Array,Ci=Ho("undefined");function fS(i){return i!==null&&!Ci(i)&&i.constructor!==null&&!Ci(i.constructor)&&Ot(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const Ig=pn("ArrayBuffer");function hS(i){let e;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?e=ArrayBuffer.isView(i):e=i&&i.buffer&&Ig(i.buffer),e}const mS=Ho("string"),Ot=Ho("function"),wg=Ho("number"),Ko=i=>i!==null&&typeof i=="object",pS=i=>i===!0||i===!1,po=i=>{if(Vo(i)!=="object")return!1;const e=ed(i);return(e===null||e===Object.prototype||Object.getPrototypeOf(e)===null)&&!(Rg in i)&&!(jo in i)},gS=pn("Date"),yS=pn("File"),vS=pn("Blob"),ES=pn("FileList"),xS=i=>Ko(i)&&Ot(i.pipe),SS=i=>{let e;return i&&(typeof FormData=="function"&&i instanceof FormData||Ot(i.append)&&((e=Vo(i))==="formdata"||e==="object"&&Ot(i.toString)&&i.toString()==="[object FormData]"))},TS=pn("URLSearchParams"),[LS,AS,RS,IS]=["ReadableStream","Request","Response","Headers"].map(pn),wS=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function Gi(i,e,{allOwnKeys:t=!1}={}){if(i===null||typeof i>"u")return;let n,r;if(typeof i!="object"&&(i=[i]),Ds(i))for(n=0,r=i.length;n<r;n++)e.call(null,i[n],n,i);else{const a=t?Object.getOwnPropertyNames(i):Object.keys(i),l=a.length;let u;for(n=0;n<l;n++)u=a[n],e.call(null,i[u],u,i)}}function _g(i,e){e=e.toLowerCase();const t=Object.keys(i);let n=t.length,r;for(;n-- >0;)if(r=t[n],e===r.toLowerCase())return r;return null}const $r=typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global,bg=i=>!Ci(i)&&i!==$r;function Tc(){const{caseless:i}=bg(this)&&this||{},e={},t=(n,r)=>{const a=i&&_g(e,r)||r;po(e[a])&&po(n)?e[a]=Tc(e[a],n):po(n)?e[a]=Tc({},n):Ds(n)?e[a]=n.slice():e[a]=n};for(let n=0,r=arguments.length;n<r;n++)arguments[n]&&Gi(arguments[n],t);return e}const _S=(i,e,t,{allOwnKeys:n}={})=>(Gi(e,(r,a)=>{t&&Ot(r)?i[a]=Ag(r,t):i[a]=r},{allOwnKeys:n}),i),bS=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),CS=(i,e,t,n)=>{i.prototype=Object.create(e.prototype,n),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:e.prototype}),t&&Object.assign(i.prototype,t)},kS=(i,e,t,n)=>{let r,a,l;const u={};if(e=e||{},i==null)return e;do{for(r=Object.getOwnPropertyNames(i),a=r.length;a-- >0;)l=r[a],(!n||n(l,i,e))&&!u[l]&&(e[l]=i[l],u[l]=!0);i=t!==!1&&ed(i)}while(i&&(!t||t(i,e))&&i!==Object.prototype);return e},DS=(i,e,t)=>{i=String(i),(t===void 0||t>i.length)&&(t=i.length),t-=e.length;const n=i.indexOf(e,t);return n!==-1&&n===t},PS=i=>{if(!i)return null;if(Ds(i))return i;let e=i.length;if(!wg(e))return null;const t=new Array(e);for(;e-- >0;)t[e]=i[e];return t},OS=(i=>e=>i&&e instanceof i)(typeof Uint8Array<"u"&&ed(Uint8Array)),NS=(i,e)=>{const n=(i&&i[jo]).call(i);let r;for(;(r=n.next())&&!r.done;){const a=r.value;e.call(i,a[0],a[1])}},FS=(i,e)=>{let t;const n=[];for(;(t=i.exec(e))!==null;)n.push(t);return n},MS=pn("HTMLFormElement"),US=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(t,n,r){return n.toUpperCase()+r}),bm=(({hasOwnProperty:i})=>(e,t)=>i.call(e,t))(Object.prototype),BS=pn("RegExp"),Cg=(i,e)=>{const t=Object.getOwnPropertyDescriptors(i),n={};Gi(t,(r,a)=>{let l;(l=e(r,a,i))!==!1&&(n[a]=l||r)}),Object.defineProperties(i,n)},$S=i=>{Cg(i,(e,t)=>{if(Ot(i)&&["arguments","caller","callee"].indexOf(t)!==-1)return!1;const n=i[t];if(Ot(n)){if(e.enumerable=!1,"writable"in e){e.writable=!1;return}e.set||(e.set=()=>{throw Error("Can not rewrite read-only method '"+t+"'")})}})},GS=(i,e)=>{const t={},n=r=>{r.forEach(a=>{t[a]=!0})};return Ds(i)?n(i):n(String(i).split(e)),t},jS=()=>{},VS=(i,e)=>i!=null&&Number.isFinite(i=+i)?i:e;function HS(i){return!!(i&&Ot(i.append)&&i[Rg]==="FormData"&&i[jo])}const KS=i=>{const e=new Array(10),t=(n,r)=>{if(Ko(n)){if(e.indexOf(n)>=0)return;if(!("toJSON"in n)){e[r]=n;const a=Ds(n)?[]:{};return Gi(n,(l,u)=>{const f=t(l,r+1);!Ci(f)&&(a[u]=f)}),e[r]=void 0,a}}return n};return t(i,0)},zS=pn("AsyncFunction"),WS=i=>i&&(Ko(i)||Ot(i))&&Ot(i.then)&&Ot(i.catch),kg=((i,e)=>i?setImmediate:e?((t,n)=>($r.addEventListener("message",({source:r,data:a})=>{r===$r&&a===t&&n.length&&n.shift()()},!1),r=>{n.push(r),$r.postMessage(t,"*")}))(`axios@${Math.random()}`,[]):t=>setTimeout(t))(typeof setImmediate=="function",Ot($r.postMessage)),YS=typeof queueMicrotask<"u"?queueMicrotask.bind($r):typeof process<"u"&&process.nextTick||kg,qS=i=>i!=null&&Ot(i[jo]),Y={isArray:Ds,isArrayBuffer:Ig,isBuffer:fS,isFormData:SS,isArrayBufferView:hS,isString:mS,isNumber:wg,isBoolean:pS,isObject:Ko,isPlainObject:po,isReadableStream:LS,isRequest:AS,isResponse:RS,isHeaders:IS,isUndefined:Ci,isDate:gS,isFile:yS,isBlob:vS,isRegExp:BS,isFunction:Ot,isStream:xS,isURLSearchParams:TS,isTypedArray:OS,isFileList:ES,forEach:Gi,merge:Tc,extend:_S,trim:wS,stripBOM:bS,inherits:CS,toFlatObject:kS,kindOf:Vo,kindOfTest:pn,endsWith:DS,toArray:PS,forEachEntry:NS,matchAll:FS,isHTMLForm:MS,hasOwnProperty:bm,hasOwnProp:bm,reduceDescriptors:Cg,freezeMethods:$S,toObjectSet:GS,toCamelCase:US,noop:jS,toFiniteNumber:VS,findKey:_g,global:$r,isContextDefined:bg,isSpecCompliantForm:HS,toJSONObject:KS,isAsyncFn:zS,isThenable:WS,setImmediate:kg,asap:YS,isIterable:qS};function _e(i,e,t,n,r){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",e&&(this.code=e),t&&(this.config=t),n&&(this.request=n),r&&(this.response=r,this.status=r.status?r.status:null)}Y.inherits(_e,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:Y.toJSONObject(this.config),code:this.code,status:this.status}}});const Dg=_e.prototype,Pg={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{Pg[i]={value:i}});Object.defineProperties(_e,Pg);Object.defineProperty(Dg,"isAxiosError",{value:!0});_e.from=(i,e,t,n,r,a)=>{const l=Object.create(Dg);return Y.toFlatObject(i,l,function(f){return f!==Error.prototype},u=>u!=="isAxiosError"),_e.call(l,i.message,e,t,n,r),l.cause=i,l.name=i.name,a&&Object.assign(l,a),l};const XS=null;function Lc(i){return Y.isPlainObject(i)||Y.isArray(i)}function Og(i){return Y.endsWith(i,"[]")?i.slice(0,-2):i}function Cm(i,e,t){return i?i.concat(e).map(function(r,a){return r=Og(r),!t&&a?"["+r+"]":r}).join(t?".":""):e}function QS(i){return Y.isArray(i)&&!i.some(Lc)}const JS=Y.toFlatObject(Y,{},null,function(e){return/^is[A-Z]/.test(e)});function zo(i,e,t){if(!Y.isObject(i))throw new TypeError("target must be an object");e=e||new FormData,t=Y.toFlatObject(t,{metaTokens:!0,dots:!1,indexes:!1},!1,function(T,S){return!Y.isUndefined(S[T])});const n=t.metaTokens,r=t.visitor||h,a=t.dots,l=t.indexes,f=(t.Blob||typeof Blob<"u"&&Blob)&&Y.isSpecCompliantForm(e);if(!Y.isFunction(r))throw new TypeError("visitor must be a function");function c(y){if(y===null)return"";if(Y.isDate(y))return y.toISOString();if(Y.isBoolean(y))return y.toString();if(!f&&Y.isBlob(y))throw new _e("Blob is not supported. Use a Buffer instead.");return Y.isArrayBuffer(y)||Y.isTypedArray(y)?f&&typeof Blob=="function"?new Blob([y]):Buffer.from(y):y}function h(y,T,S){let A=y;if(y&&!S&&typeof y=="object"){if(Y.endsWith(T,"{}"))T=n?T:T.slice(0,-2),y=JSON.stringify(y);else if(Y.isArray(y)&&QS(y)||(Y.isFileList(y)||Y.endsWith(T,"[]"))&&(A=Y.toArray(y)))return T=Og(T),A.forEach(function(I,b){!(Y.isUndefined(I)||I===null)&&e.append(l===!0?Cm([T],b,a):l===null?T:T+"[]",c(I))}),!1}return Lc(y)?!0:(e.append(Cm(S,T,a),c(y)),!1)}const m=[],g=Object.assign(JS,{defaultVisitor:h,convertValue:c,isVisitable:Lc});function E(y,T){if(!Y.isUndefined(y)){if(m.indexOf(y)!==-1)throw Error("Circular reference detected in "+T.join("."));m.push(y),Y.forEach(y,function(A,w){(!(Y.isUndefined(A)||A===null)&&r.call(e,A,Y.isString(w)?w.trim():w,T,g))===!0&&E(A,T?T.concat(w):[w])}),m.pop()}}if(!Y.isObject(i))throw new TypeError("data must be an object");return E(i),e}function km(i){const e={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(n){return e[n]})}function td(i,e){this._pairs=[],i&&zo(i,this,e)}const Ng=td.prototype;Ng.append=function(e,t){this._pairs.push([e,t])};Ng.toString=function(e){const t=e?function(n){return e.call(this,n,km)}:km;return this._pairs.map(function(r){return t(r[0])+"="+t(r[1])},"").join("&")};function ZS(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function Fg(i,e,t){if(!e)return i;const n=t&&t.encode||ZS;Y.isFunction(t)&&(t={serialize:t});const r=t&&t.serialize;let a;if(r?a=r(e,t):a=Y.isURLSearchParams(e)?e.toString():new td(e,t).toString(n),a){const l=i.indexOf("#");l!==-1&&(i=i.slice(0,l)),i+=(i.indexOf("?")===-1?"?":"&")+a}return i}class Dm{constructor(){this.handlers=[]}use(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:n?n.synchronous:!1,runWhen:n?n.runWhen:null}),this.handlers.length-1}eject(e){this.handlers[e]&&(this.handlers[e]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(e){Y.forEach(this.handlers,function(n){n!==null&&e(n)})}}const Mg={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},eT=typeof URLSearchParams<"u"?URLSearchParams:td,tT=typeof FormData<"u"?FormData:null,nT=typeof Blob<"u"?Blob:null,rT={isBrowser:!0,classes:{URLSearchParams:eT,FormData:tT,Blob:nT},protocols:["http","https","file","blob","url","data"]},nd=typeof window<"u"&&typeof document<"u",Ac=typeof navigator=="object"&&navigator||void 0,sT=nd&&(!Ac||["ReactNative","NativeScript","NS"].indexOf(Ac.product)<0),iT=typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function",aT=nd&&window.location.href||"http://localhost",oT=Object.freeze(Object.defineProperty({__proto__:null,hasBrowserEnv:nd,hasStandardBrowserEnv:sT,hasStandardBrowserWebWorkerEnv:iT,navigator:Ac,origin:aT},Symbol.toStringTag,{value:"Module"})),Tt={...oT,...rT};function lT(i,e){return zo(i,new Tt.classes.URLSearchParams,Object.assign({visitor:function(t,n,r,a){return Tt.isNode&&Y.isBuffer(t)?(this.append(n,t.toString("base64")),!1):a.defaultVisitor.apply(this,arguments)}},e))}function uT(i){return Y.matchAll(/\w+|\[(\w*)]/g,i).map(e=>e[0]==="[]"?"":e[1]||e[0])}function cT(i){const e={},t=Object.keys(i);let n;const r=t.length;let a;for(n=0;n<r;n++)a=t[n],e[a]=i[a];return e}function Ug(i){function e(t,n,r,a){let l=t[a++];if(l==="__proto__")return!0;const u=Number.isFinite(+l),f=a>=t.length;return l=!l&&Y.isArray(r)?r.length:l,f?(Y.hasOwnProp(r,l)?r[l]=[r[l],n]:r[l]=n,!u):((!r[l]||!Y.isObject(r[l]))&&(r[l]=[]),e(t,n,r[l],a)&&Y.isArray(r[l])&&(r[l]=cT(r[l])),!u)}if(Y.isFormData(i)&&Y.isFunction(i.entries)){const t={};return Y.forEachEntry(i,(n,r)=>{e(uT(n),r,t,0)}),t}return null}function dT(i,e,t){if(Y.isString(i))try{return(e||JSON.parse)(i),Y.trim(i)}catch(n){if(n.name!=="SyntaxError")throw n}return(t||JSON.stringify)(i)}const ji={transitional:Mg,adapter:["xhr","http","fetch"],transformRequest:[function(e,t){const n=t.getContentType()||"",r=n.indexOf("application/json")>-1,a=Y.isObject(e);if(a&&Y.isHTMLForm(e)&&(e=new FormData(e)),Y.isFormData(e))return r?JSON.stringify(Ug(e)):e;if(Y.isArrayBuffer(e)||Y.isBuffer(e)||Y.isStream(e)||Y.isFile(e)||Y.isBlob(e)||Y.isReadableStream(e))return e;if(Y.isArrayBufferView(e))return e.buffer;if(Y.isURLSearchParams(e))return t.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),e.toString();let u;if(a){if(n.indexOf("application/x-www-form-urlencoded")>-1)return lT(e,this.formSerializer).toString();if((u=Y.isFileList(e))||n.indexOf("multipart/form-data")>-1){const f=this.env&&this.env.FormData;return zo(u?{"files[]":e}:e,f&&new f,this.formSerializer)}}return a||r?(t.setContentType("application/json",!1),dT(e)):e}],transformResponse:[function(e){const t=this.transitional||ji.transitional,n=t&&t.forcedJSONParsing,r=this.responseType==="json";if(Y.isResponse(e)||Y.isReadableStream(e))return e;if(e&&Y.isString(e)&&(n&&!this.responseType||r)){const l=!(t&&t.silentJSONParsing)&&r;try{return JSON.parse(e)}catch(u){if(l)throw u.name==="SyntaxError"?_e.from(u,_e.ERR_BAD_RESPONSE,this,null,this.response):u}}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:Tt.classes.FormData,Blob:Tt.classes.Blob},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*","Content-Type":void 0}}};Y.forEach(["delete","get","head","post","put","patch"],i=>{ji.headers[i]={}});const fT=Y.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),hT=i=>{const e={};let t,n,r;return i&&i.split(`
`).forEach(function(l){r=l.indexOf(":"),t=l.substring(0,r).trim().toLowerCase(),n=l.substring(r+1).trim(),!(!t||e[t]&&fT[t])&&(t==="set-cookie"?e[t]?e[t].push(n):e[t]=[n]:e[t]=e[t]?e[t]+", "+n:n)}),e},Pm=Symbol("internals");function Ti(i){return i&&String(i).trim().toLowerCase()}function go(i){return i===!1||i==null?i:Y.isArray(i)?i.map(go):String(i)}function mT(i){const e=Object.create(null),t=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let n;for(;n=t.exec(i);)e[n[1]]=n[2];return e}const pT=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function qu(i,e,t,n,r){if(Y.isFunction(n))return n.call(this,e,t);if(r&&(e=t),!!Y.isString(e)){if(Y.isString(n))return e.indexOf(n)!==-1;if(Y.isRegExp(n))return n.test(e)}}function gT(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(e,t,n)=>t.toUpperCase()+n)}function yT(i,e){const t=Y.toCamelCase(" "+e);["get","set","has"].forEach(n=>{Object.defineProperty(i,n+t,{value:function(r,a,l){return this[n].call(this,e,r,a,l)},configurable:!0})})}let Nt=class{constructor(e){e&&this.set(e)}set(e,t,n){const r=this;function a(u,f,c){const h=Ti(f);if(!h)throw new Error("header name must be a non-empty string");const m=Y.findKey(r,h);(!m||r[m]===void 0||c===!0||c===void 0&&r[m]!==!1)&&(r[m||f]=go(u))}const l=(u,f)=>Y.forEach(u,(c,h)=>a(c,h,f));if(Y.isPlainObject(e)||e instanceof this.constructor)l(e,t);else if(Y.isString(e)&&(e=e.trim())&&!pT(e))l(hT(e),t);else if(Y.isObject(e)&&Y.isIterable(e)){let u={},f,c;for(const h of e){if(!Y.isArray(h))throw TypeError("Object iterator must return a key-value pair");u[c=h[0]]=(f=u[c])?Y.isArray(f)?[...f,h[1]]:[f,h[1]]:h[1]}l(u,t)}else e!=null&&a(t,e,n);return this}get(e,t){if(e=Ti(e),e){const n=Y.findKey(this,e);if(n){const r=this[n];if(!t)return r;if(t===!0)return mT(r);if(Y.isFunction(t))return t.call(this,r,n);if(Y.isRegExp(t))return t.exec(r);throw new TypeError("parser must be boolean|regexp|function")}}}has(e,t){if(e=Ti(e),e){const n=Y.findKey(this,e);return!!(n&&this[n]!==void 0&&(!t||qu(this,this[n],n,t)))}return!1}delete(e,t){const n=this;let r=!1;function a(l){if(l=Ti(l),l){const u=Y.findKey(n,l);u&&(!t||qu(n,n[u],u,t))&&(delete n[u],r=!0)}}return Y.isArray(e)?e.forEach(a):a(e),r}clear(e){const t=Object.keys(this);let n=t.length,r=!1;for(;n--;){const a=t[n];(!e||qu(this,this[a],a,e,!0))&&(delete this[a],r=!0)}return r}normalize(e){const t=this,n={};return Y.forEach(this,(r,a)=>{const l=Y.findKey(n,a);if(l){t[l]=go(r),delete t[a];return}const u=e?gT(a):String(a).trim();u!==a&&delete t[a],t[u]=go(r),n[u]=!0}),this}concat(...e){return this.constructor.concat(this,...e)}toJSON(e){const t=Object.create(null);return Y.forEach(this,(n,r)=>{n!=null&&n!==!1&&(t[r]=e&&Y.isArray(n)?n.join(", "):n)}),t}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([e,t])=>e+": "+t).join(`
`)}getSetCookie(){return this.get("set-cookie")||[]}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(e){return e instanceof this?e:new this(e)}static concat(e,...t){const n=new this(e);return t.forEach(r=>n.set(r)),n}static accessor(e){const n=(this[Pm]=this[Pm]={accessors:{}}).accessors,r=this.prototype;function a(l){const u=Ti(l);n[u]||(yT(r,l),n[u]=!0)}return Y.isArray(e)?e.forEach(a):a(e),this}};Nt.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);Y.reduceDescriptors(Nt.prototype,({value:i},e)=>{let t=e[0].toUpperCase()+e.slice(1);return{get:()=>i,set(n){this[t]=n}}});Y.freezeMethods(Nt);function Xu(i,e){const t=this||ji,n=e||t,r=Nt.from(n.headers);let a=n.data;return Y.forEach(i,function(u){a=u.call(t,a,r.normalize(),e?e.status:void 0)}),r.normalize(),a}function Bg(i){return!!(i&&i.__CANCEL__)}function Ps(i,e,t){_e.call(this,i??"canceled",_e.ERR_CANCELED,e,t),this.name="CanceledError"}Y.inherits(Ps,_e,{__CANCEL__:!0});function $g(i,e,t){const n=t.config.validateStatus;!t.status||!n||n(t.status)?i(t):e(new _e("Request failed with status code "+t.status,[_e.ERR_BAD_REQUEST,_e.ERR_BAD_RESPONSE][Math.floor(t.status/100)-4],t.config,t.request,t))}function vT(i){const e=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return e&&e[1]||""}function ET(i,e){i=i||10;const t=new Array(i),n=new Array(i);let r=0,a=0,l;return e=e!==void 0?e:1e3,function(f){const c=Date.now(),h=n[a];l||(l=c),t[r]=f,n[r]=c;let m=a,g=0;for(;m!==r;)g+=t[m++],m=m%i;if(r=(r+1)%i,r===a&&(a=(a+1)%i),c-l<e)return;const E=h&&c-h;return E?Math.round(g*1e3/E):void 0}}function xT(i,e){let t=0,n=1e3/e,r,a;const l=(c,h=Date.now())=>{t=h,r=null,a&&(clearTimeout(a),a=null),i.apply(null,c)};return[(...c)=>{const h=Date.now(),m=h-t;m>=n?l(c,h):(r=c,a||(a=setTimeout(()=>{a=null,l(r)},n-m)))},()=>r&&l(r)]}const _o=(i,e,t=3)=>{let n=0;const r=ET(50,250);return xT(a=>{const l=a.loaded,u=a.lengthComputable?a.total:void 0,f=l-n,c=r(f),h=l<=u;n=l;const m={loaded:l,total:u,progress:u?l/u:void 0,bytes:f,rate:c||void 0,estimated:c&&u&&h?(u-l)/c:void 0,event:a,lengthComputable:u!=null,[e?"download":"upload"]:!0};i(m)},t)},Om=(i,e)=>{const t=i!=null;return[n=>e[0]({lengthComputable:t,total:i,loaded:n}),e[1]]},Nm=i=>(...e)=>Y.asap(()=>i(...e)),ST=Tt.hasStandardBrowserEnv?((i,e)=>t=>(t=new URL(t,Tt.origin),i.protocol===t.protocol&&i.host===t.host&&(e||i.port===t.port)))(new URL(Tt.origin),Tt.navigator&&/(msie|trident)/i.test(Tt.navigator.userAgent)):()=>!0,TT=Tt.hasStandardBrowserEnv?{write(i,e,t,n,r,a){const l=[i+"="+encodeURIComponent(e)];Y.isNumber(t)&&l.push("expires="+new Date(t).toGMTString()),Y.isString(n)&&l.push("path="+n),Y.isString(r)&&l.push("domain="+r),a===!0&&l.push("secure"),document.cookie=l.join("; ")},read(i){const e=document.cookie.match(new RegExp("(^|;\\s*)("+i+")=([^;]*)"));return e?decodeURIComponent(e[3]):null},remove(i){this.write(i,"",Date.now()-864e5)}}:{write(){},read(){return null},remove(){}};function LT(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function AT(i,e){return e?i.replace(/\/?\/$/,"")+"/"+e.replace(/^\/+/,""):i}function Gg(i,e,t){let n=!LT(e);return i&&(n||t==!1)?AT(i,e):e}const Fm=i=>i instanceof Nt?{...i}:i;function Vr(i,e){e=e||{};const t={};function n(c,h,m,g){return Y.isPlainObject(c)&&Y.isPlainObject(h)?Y.merge.call({caseless:g},c,h):Y.isPlainObject(h)?Y.merge({},h):Y.isArray(h)?h.slice():h}function r(c,h,m,g){if(Y.isUndefined(h)){if(!Y.isUndefined(c))return n(void 0,c,m,g)}else return n(c,h,m,g)}function a(c,h){if(!Y.isUndefined(h))return n(void 0,h)}function l(c,h){if(Y.isUndefined(h)){if(!Y.isUndefined(c))return n(void 0,c)}else return n(void 0,h)}function u(c,h,m){if(m in e)return n(c,h);if(m in i)return n(void 0,c)}const f={url:a,method:a,data:a,baseURL:l,transformRequest:l,transformResponse:l,paramsSerializer:l,timeout:l,timeoutMessage:l,withCredentials:l,withXSRFToken:l,adapter:l,responseType:l,xsrfCookieName:l,xsrfHeaderName:l,onUploadProgress:l,onDownloadProgress:l,decompress:l,maxContentLength:l,maxBodyLength:l,beforeRedirect:l,transport:l,httpAgent:l,httpsAgent:l,cancelToken:l,socketPath:l,responseEncoding:l,validateStatus:u,headers:(c,h,m)=>r(Fm(c),Fm(h),m,!0)};return Y.forEach(Object.keys(Object.assign({},i,e)),function(h){const m=f[h]||r,g=m(i[h],e[h],h);Y.isUndefined(g)&&m!==u||(t[h]=g)}),t}const jg=i=>{const e=Vr({},i);let{data:t,withXSRFToken:n,xsrfHeaderName:r,xsrfCookieName:a,headers:l,auth:u}=e;e.headers=l=Nt.from(l),e.url=Fg(Gg(e.baseURL,e.url,e.allowAbsoluteUrls),i.params,i.paramsSerializer),u&&l.set("Authorization","Basic "+btoa((u.username||"")+":"+(u.password?unescape(encodeURIComponent(u.password)):"")));let f;if(Y.isFormData(t)){if(Tt.hasStandardBrowserEnv||Tt.hasStandardBrowserWebWorkerEnv)l.setContentType(void 0);else if((f=l.getContentType())!==!1){const[c,...h]=f?f.split(";").map(m=>m.trim()).filter(Boolean):[];l.setContentType([c||"multipart/form-data",...h].join("; "))}}if(Tt.hasStandardBrowserEnv&&(n&&Y.isFunction(n)&&(n=n(e)),n||n!==!1&&ST(e.url))){const c=r&&a&&TT.read(a);c&&l.set(r,c)}return e},RT=typeof XMLHttpRequest<"u",IT=RT&&function(i){return new Promise(function(t,n){const r=jg(i);let a=r.data;const l=Nt.from(r.headers).normalize();let{responseType:u,onUploadProgress:f,onDownloadProgress:c}=r,h,m,g,E,y;function T(){E&&E(),y&&y(),r.cancelToken&&r.cancelToken.unsubscribe(h),r.signal&&r.signal.removeEventListener("abort",h)}let S=new XMLHttpRequest;S.open(r.method.toUpperCase(),r.url,!0),S.timeout=r.timeout;function A(){if(!S)return;const I=Nt.from("getAllResponseHeaders"in S&&S.getAllResponseHeaders()),P={data:!u||u==="text"||u==="json"?S.responseText:S.response,status:S.status,statusText:S.statusText,headers:I,config:i,request:S};$g(function(D){t(D),T()},function(D){n(D),T()},P),S=null}"onloadend"in S?S.onloadend=A:S.onreadystatechange=function(){!S||S.readyState!==4||S.status===0&&!(S.responseURL&&S.responseURL.indexOf("file:")===0)||setTimeout(A)},S.onabort=function(){S&&(n(new _e("Request aborted",_e.ECONNABORTED,i,S)),S=null)},S.onerror=function(){n(new _e("Network Error",_e.ERR_NETWORK,i,S)),S=null},S.ontimeout=function(){let b=r.timeout?"timeout of "+r.timeout+"ms exceeded":"timeout exceeded";const P=r.transitional||Mg;r.timeoutErrorMessage&&(b=r.timeoutErrorMessage),n(new _e(b,P.clarifyTimeoutError?_e.ETIMEDOUT:_e.ECONNABORTED,i,S)),S=null},a===void 0&&l.setContentType(null),"setRequestHeader"in S&&Y.forEach(l.toJSON(),function(b,P){S.setRequestHeader(P,b)}),Y.isUndefined(r.withCredentials)||(S.withCredentials=!!r.withCredentials),u&&u!=="json"&&(S.responseType=r.responseType),c&&([g,y]=_o(c,!0),S.addEventListener("progress",g)),f&&S.upload&&([m,E]=_o(f),S.upload.addEventListener("progress",m),S.upload.addEventListener("loadend",E)),(r.cancelToken||r.signal)&&(h=I=>{S&&(n(!I||I.type?new Ps(null,i,S):I),S.abort(),S=null)},r.cancelToken&&r.cancelToken.subscribe(h),r.signal&&(r.signal.aborted?h():r.signal.addEventListener("abort",h)));const w=vT(r.url);if(w&&Tt.protocols.indexOf(w)===-1){n(new _e("Unsupported protocol "+w+":",_e.ERR_BAD_REQUEST,i));return}S.send(a||null)})},wT=(i,e)=>{const{length:t}=i=i?i.filter(Boolean):[];if(e||t){let n=new AbortController,r;const a=function(c){if(!r){r=!0,u();const h=c instanceof Error?c:this.reason;n.abort(h instanceof _e?h:new Ps(h instanceof Error?h.message:h))}};let l=e&&setTimeout(()=>{l=null,a(new _e(`timeout ${e} of ms exceeded`,_e.ETIMEDOUT))},e);const u=()=>{i&&(l&&clearTimeout(l),l=null,i.forEach(c=>{c.unsubscribe?c.unsubscribe(a):c.removeEventListener("abort",a)}),i=null)};i.forEach(c=>c.addEventListener("abort",a));const{signal:f}=n;return f.unsubscribe=()=>Y.asap(u),f}},_T=function*(i,e){let t=i.byteLength;if(t<e){yield i;return}let n=0,r;for(;n<t;)r=n+e,yield i.slice(n,r),n=r},bT=async function*(i,e){for await(const t of CT(i))yield*_T(t,e)},CT=async function*(i){if(i[Symbol.asyncIterator]){yield*i;return}const e=i.getReader();try{for(;;){const{done:t,value:n}=await e.read();if(t)break;yield n}}finally{await e.cancel()}},Mm=(i,e,t,n)=>{const r=bT(i,e);let a=0,l,u=f=>{l||(l=!0,n&&n(f))};return new ReadableStream({async pull(f){try{const{done:c,value:h}=await r.next();if(c){u(),f.close();return}let m=h.byteLength;if(t){let g=a+=m;t(g)}f.enqueue(new Uint8Array(h))}catch(c){throw u(c),c}},cancel(f){return u(f),r.return()}},{highWaterMark:2})},Wo=typeof fetch=="function"&&typeof Request=="function"&&typeof Response=="function",Vg=Wo&&typeof ReadableStream=="function",kT=Wo&&(typeof TextEncoder=="function"?(i=>e=>i.encode(e))(new TextEncoder):async i=>new Uint8Array(await new Response(i).arrayBuffer())),Hg=(i,...e)=>{try{return!!i(...e)}catch{return!1}},DT=Vg&&Hg(()=>{let i=!1;const e=new Request(Tt.origin,{body:new ReadableStream,method:"POST",get duplex(){return i=!0,"half"}}).headers.has("Content-Type");return i&&!e}),Um=64*1024,Rc=Vg&&Hg(()=>Y.isReadableStream(new Response("").body)),bo={stream:Rc&&(i=>i.body)};Wo&&(i=>{["text","arrayBuffer","blob","formData","stream"].forEach(e=>{!bo[e]&&(bo[e]=Y.isFunction(i[e])?t=>t[e]():(t,n)=>{throw new _e(`Response type '${e}' is not supported`,_e.ERR_NOT_SUPPORT,n)})})})(new Response);const PT=async i=>{if(i==null)return 0;if(Y.isBlob(i))return i.size;if(Y.isSpecCompliantForm(i))return(await new Request(Tt.origin,{method:"POST",body:i}).arrayBuffer()).byteLength;if(Y.isArrayBufferView(i)||Y.isArrayBuffer(i))return i.byteLength;if(Y.isURLSearchParams(i)&&(i=i+""),Y.isString(i))return(await kT(i)).byteLength},OT=async(i,e)=>{const t=Y.toFiniteNumber(i.getContentLength());return t??PT(e)},NT=Wo&&(async i=>{let{url:e,method:t,data:n,signal:r,cancelToken:a,timeout:l,onDownloadProgress:u,onUploadProgress:f,responseType:c,headers:h,withCredentials:m="same-origin",fetchOptions:g}=jg(i);c=c?(c+"").toLowerCase():"text";let E=wT([r,a&&a.toAbortSignal()],l),y;const T=E&&E.unsubscribe&&(()=>{E.unsubscribe()});let S;try{if(f&&DT&&t!=="get"&&t!=="head"&&(S=await OT(h,n))!==0){let P=new Request(e,{method:"POST",body:n,duplex:"half"}),G;if(Y.isFormData(n)&&(G=P.headers.get("content-type"))&&h.setContentType(G),P.body){const[D,M]=Om(S,_o(Nm(f)));n=Mm(P.body,Um,D,M)}}Y.isString(m)||(m=m?"include":"omit");const A="credentials"in Request.prototype;y=new Request(e,{...g,signal:E,method:t.toUpperCase(),headers:h.normalize().toJSON(),body:n,duplex:"half",credentials:A?m:void 0});let w=await fetch(y,g);const I=Rc&&(c==="stream"||c==="response");if(Rc&&(u||I&&T)){const P={};["status","statusText","headers"].forEach(B=>{P[B]=w[B]});const G=Y.toFiniteNumber(w.headers.get("content-length")),[D,M]=u&&Om(G,_o(Nm(u),!0))||[];w=new Response(Mm(w.body,Um,D,()=>{M&&M(),T&&T()}),P)}c=c||"text";let b=await bo[Y.findKey(bo,c)||"text"](w,i);return!I&&T&&T(),await new Promise((P,G)=>{$g(P,G,{data:b,headers:Nt.from(w.headers),status:w.status,statusText:w.statusText,config:i,request:y})})}catch(A){throw T&&T(),A&&A.name==="TypeError"&&/Load failed|fetch/i.test(A.message)?Object.assign(new _e("Network Error",_e.ERR_NETWORK,i,y),{cause:A.cause||A}):_e.from(A,A&&A.code,i,y)}}),Ic={http:XS,xhr:IT,fetch:NT};Y.forEach(Ic,(i,e)=>{if(i){try{Object.defineProperty(i,"name",{value:e})}catch{}Object.defineProperty(i,"adapterName",{value:e})}});const Bm=i=>`- ${i}`,FT=i=>Y.isFunction(i)||i===null||i===!1,Kg={getAdapter:i=>{i=Y.isArray(i)?i:[i];const{length:e}=i;let t,n;const r={};for(let a=0;a<e;a++){t=i[a];let l;if(n=t,!FT(t)&&(n=Ic[(l=String(t)).toLowerCase()],n===void 0))throw new _e(`Unknown adapter '${l}'`);if(n)break;r[l||"#"+a]=n}if(!n){const a=Object.entries(r).map(([u,f])=>`adapter ${u} `+(f===!1?"is not supported by the environment":"is not available in the build"));let l=e?a.length>1?`since :
`+a.map(Bm).join(`
`):" "+Bm(a[0]):"as no adapter specified";throw new _e("There is no suitable adapter to dispatch the request "+l,"ERR_NOT_SUPPORT")}return n},adapters:Ic};function Qu(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new Ps(null,i)}function $m(i){return Qu(i),i.headers=Nt.from(i.headers),i.data=Xu.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),Kg.getAdapter(i.adapter||ji.adapter)(i).then(function(n){return Qu(i),n.data=Xu.call(i,i.transformResponse,n),n.headers=Nt.from(n.headers),n},function(n){return Bg(n)||(Qu(i),n&&n.response&&(n.response.data=Xu.call(i,i.transformResponse,n.response),n.response.headers=Nt.from(n.response.headers))),Promise.reject(n)})}const zg="1.10.0",Yo={};["object","boolean","number","function","string","symbol"].forEach((i,e)=>{Yo[i]=function(n){return typeof n===i||"a"+(e<1?"n ":" ")+i}});const Gm={};Yo.transitional=function(e,t,n){function r(a,l){return"[Axios v"+zg+"] Transitional option '"+a+"'"+l+(n?". "+n:"")}return(a,l,u)=>{if(e===!1)throw new _e(r(l," has been removed"+(t?" in "+t:"")),_e.ERR_DEPRECATED);return t&&!Gm[l]&&(Gm[l]=!0,console.warn(r(l," has been deprecated since v"+t+" and will be removed in the near future"))),e?e(a,l,u):!0}};Yo.spelling=function(e){return(t,n)=>(console.warn(`${n} is likely a misspelling of ${e}`),!0)};function MT(i,e,t){if(typeof i!="object")throw new _e("options must be an object",_e.ERR_BAD_OPTION_VALUE);const n=Object.keys(i);let r=n.length;for(;r-- >0;){const a=n[r],l=e[a];if(l){const u=i[a],f=u===void 0||l(u,a,i);if(f!==!0)throw new _e("option "+a+" must be "+f,_e.ERR_BAD_OPTION_VALUE);continue}if(t!==!0)throw new _e("Unknown option "+a,_e.ERR_BAD_OPTION)}}const yo={assertOptions:MT,validators:Yo},Tn=yo.validators;let Gr=class{constructor(e){this.defaults=e||{},this.interceptors={request:new Dm,response:new Dm}}async request(e,t){try{return await this._request(e,t)}catch(n){if(n instanceof Error){let r={};Error.captureStackTrace?Error.captureStackTrace(r):r=new Error;const a=r.stack?r.stack.replace(/^.+\n/,""):"";try{n.stack?a&&!String(n.stack).endsWith(a.replace(/^.+\n.+\n/,""))&&(n.stack+=`
`+a):n.stack=a}catch{}}throw n}}_request(e,t){typeof e=="string"?(t=t||{},t.url=e):t=e||{},t=Vr(this.defaults,t);const{transitional:n,paramsSerializer:r,headers:a}=t;n!==void 0&&yo.assertOptions(n,{silentJSONParsing:Tn.transitional(Tn.boolean),forcedJSONParsing:Tn.transitional(Tn.boolean),clarifyTimeoutError:Tn.transitional(Tn.boolean)},!1),r!=null&&(Y.isFunction(r)?t.paramsSerializer={serialize:r}:yo.assertOptions(r,{encode:Tn.function,serialize:Tn.function},!0)),t.allowAbsoluteUrls!==void 0||(this.defaults.allowAbsoluteUrls!==void 0?t.allowAbsoluteUrls=this.defaults.allowAbsoluteUrls:t.allowAbsoluteUrls=!0),yo.assertOptions(t,{baseUrl:Tn.spelling("baseURL"),withXsrfToken:Tn.spelling("withXSRFToken")},!0),t.method=(t.method||this.defaults.method||"get").toLowerCase();let l=a&&Y.merge(a.common,a[t.method]);a&&Y.forEach(["delete","get","head","post","put","patch","common"],y=>{delete a[y]}),t.headers=Nt.concat(l,a);const u=[];let f=!0;this.interceptors.request.forEach(function(T){typeof T.runWhen=="function"&&T.runWhen(t)===!1||(f=f&&T.synchronous,u.unshift(T.fulfilled,T.rejected))});const c=[];this.interceptors.response.forEach(function(T){c.push(T.fulfilled,T.rejected)});let h,m=0,g;if(!f){const y=[$m.bind(this),void 0];for(y.unshift.apply(y,u),y.push.apply(y,c),g=y.length,h=Promise.resolve(t);m<g;)h=h.then(y[m++],y[m++]);return h}g=u.length;let E=t;for(m=0;m<g;){const y=u[m++],T=u[m++];try{E=y(E)}catch(S){T.call(this,S);break}}try{h=$m.call(this,E)}catch(y){return Promise.reject(y)}for(m=0,g=c.length;m<g;)h=h.then(c[m++],c[m++]);return h}getUri(e){e=Vr(this.defaults,e);const t=Gg(e.baseURL,e.url,e.allowAbsoluteUrls);return Fg(t,e.params,e.paramsSerializer)}};Y.forEach(["delete","get","head","options"],function(e){Gr.prototype[e]=function(t,n){return this.request(Vr(n||{},{method:e,url:t,data:(n||{}).data}))}});Y.forEach(["post","put","patch"],function(e){function t(n){return function(a,l,u){return this.request(Vr(u||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:a,data:l}))}}Gr.prototype[e]=t(),Gr.prototype[e+"Form"]=t(!0)});let UT=class Wg{constructor(e){if(typeof e!="function")throw new TypeError("executor must be a function.");let t;this.promise=new Promise(function(a){t=a});const n=this;this.promise.then(r=>{if(!n._listeners)return;let a=n._listeners.length;for(;a-- >0;)n._listeners[a](r);n._listeners=null}),this.promise.then=r=>{let a;const l=new Promise(u=>{n.subscribe(u),a=u}).then(r);return l.cancel=function(){n.unsubscribe(a)},l},e(function(a,l,u){n.reason||(n.reason=new Ps(a,l,u),t(n.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(e){if(this.reason){e(this.reason);return}this._listeners?this._listeners.push(e):this._listeners=[e]}unsubscribe(e){if(!this._listeners)return;const t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}toAbortSignal(){const e=new AbortController,t=n=>{e.abort(n)};return this.subscribe(t),e.signal.unsubscribe=()=>this.unsubscribe(t),e.signal}static source(){let e;return{token:new Wg(function(r){e=r}),cancel:e}}};function BT(i){return function(t){return i.apply(null,t)}}function $T(i){return Y.isObject(i)&&i.isAxiosError===!0}const wc={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wc).forEach(([i,e])=>{wc[e]=i});function Yg(i){const e=new Gr(i),t=Ag(Gr.prototype.request,e);return Y.extend(t,Gr.prototype,e,{allOwnKeys:!0}),Y.extend(t,e,null,{allOwnKeys:!0}),t.create=function(r){return Yg(Vr(i,r))},t}const tt=Yg(ji);tt.Axios=Gr;tt.CanceledError=Ps;tt.CancelToken=UT;tt.isCancel=Bg;tt.VERSION=zg;tt.toFormData=zo;tt.AxiosError=_e;tt.Cancel=tt.CanceledError;tt.all=function(e){return Promise.all(e)};tt.spread=BT;tt.isAxiosError=$T;tt.mergeConfig=Vr;tt.AxiosHeaders=Nt;tt.formToJSON=i=>Ug(Y.isHTMLForm(i)?new FormData(i):i);tt.getAdapter=Kg.getAdapter;tt.HttpStatusCode=wc;tt.default=tt;const{Axios:KI,AxiosError:zI,CanceledError:WI,isCancel:YI,CancelToken:qI,VERSION:XI,all:QI,Cancel:JI,isAxiosError:ZI,spread:ew,toFormData:tw,AxiosHeaders:nw,HttpStatusCode:rw,formToJSON:sw,getAdapter:iw,mergeConfig:aw}=tt,GT="http://localhost:5000/api",zn=tt.create({baseURL:GT,headers:{"Content-Type":"application/json"},timeout:3e4});zn.interceptors.response.use(i=>i,i=>i.code==="ECONNREFUSED"||i.code==="ERR_NETWORK"?(console.warn("Backend server not available, using demo mode"),Promise.reject({...i,isDemoMode:!0,message:"Backend server not available"})):Promise.reject(i));const rd=async()=>{try{return(await zn.get("/overlays")).data}catch(i){if(i.isDemoMode)return[{id:"demo-1",name:"Demo Text Overlay",type:"text",content:"LIVE DEMO",position:{x:10,y:10},size:{width:150,height:40},color:"#ff0000",fontSize:24,opacity:1,rotation:0,visible:!0,createdAt:new Date().toISOString()}];throw i}},qg=async i=>{try{return(await zn.post("/overlays",i)).data}catch(e){if(e.isDemoMode)return{id:Date.now().toString(),...i,createdAt:new Date().toISOString()};throw e}},_c=async(i,e)=>{try{return(await zn.put(`/overlays/${i}`,e)).data}catch(t){if(t.isDemoMode)return{id:i,...e};throw t}},Xg=async i=>{try{return(await zn.delete(`/overlays/${i}`)).data}catch(e){if(e.isDemoMode)return{message:"Overlay deleted successfully (demo mode)"};throw e}},qo=async()=>{try{return(await zn.get("/settings")).data}catch(i){if(i.isDemoMode)return{rtspUrl:"rtsp://localhost:8554/mystream",volume:.5,autoplay:!1,quality:"auto",bufferSize:5,reconnectAttempts:3};throw i}},Qg=async i=>{try{return(await zn.put("/settings",i)).data}catch(e){if(e.isDemoMode)return i;throw e}},jT=async i=>{try{return(await zn.post("/stream/start",{rtspUrl:i})).data}catch(e){if(e.isDemoMode)return{message:"Demo mode - no backend server available",mode:"demo",note:"Backend server not available. Running in demo mode."};throw e}},VT=async()=>{try{return(await zn.get("/stream/status")).data}catch(i){if(i.isDemoMode)return{isRunning:!1,hlsAvailable:!1,hlsUrl:null,rtspUrl:null,startTime:null,mode:"demo",hasFFmpeg:!1};throw i}},jm=Object.freeze(Object.defineProperty({__proto__:null,createOverlay:qg,deleteOverlay:Xg,getOverlays:rd,getSettings:qo,getStreamStatus:VT,startStream:jT,updateOverlay:_c,updateSettings:Qg},Symbol.toStringTag,{value:"Module"})),HT="modulepreload",KT=function(i){return"/"+i},Vm={},Hm=function(e,t,n){let r=Promise.resolve();if(t&&t.length>0){let l=function(c){return Promise.all(c.map(h=>Promise.resolve(h).then(m=>({status:"fulfilled",value:m}),m=>({status:"rejected",reason:m}))))};document.getElementsByTagName("link");const u=document.querySelector("meta[property=csp-nonce]"),f=(u==null?void 0:u.nonce)||(u==null?void 0:u.getAttribute("nonce"));r=l(t.map(c=>{if(c=KT(c),c in Vm)return;Vm[c]=!0;const h=c.endsWith(".css"),m=h?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${c}"]${m}`))return;const g=document.createElement("link");if(g.rel=h?"stylesheet":HT,h||(g.as="script"),g.crossOrigin="",g.href=c,f&&g.setAttribute("nonce",f),document.head.appendChild(g),h)return new Promise((E,y)=>{g.addEventListener("load",E),g.addEventListener("error",()=>y(new Error(`Unable to preload CSS for ${c}`)))})}))}function a(l){const u=new Event("vite:preloadError",{cancelable:!0});if(u.payload=l,window.dispatchEvent(u),!u.defaultPrevented)throw l}return r.then(l=>{for(const u of l||[])u.status==="rejected"&&a(u.reason);return e().catch(a)})},ce=Number.isFinite||function(i){return typeof i=="number"&&isFinite(i)},zT=Number.isSafeInteger||function(i){return typeof i=="number"&&Math.abs(i)<=WT},WT=Number.MAX_SAFE_INTEGER||9007199254740991;let xe=function(i){return i.NETWORK_ERROR="networkError",i.MEDIA_ERROR="mediaError",i.KEY_SYSTEM_ERROR="keySystemError",i.MUX_ERROR="muxError",i.OTHER_ERROR="otherError",i}({}),H=function(i){return i.KEY_SYSTEM_NO_KEYS="keySystemNoKeys",i.KEY_SYSTEM_NO_ACCESS="keySystemNoAccess",i.KEY_SYSTEM_NO_SESSION="keySystemNoSession",i.KEY_SYSTEM_NO_CONFIGURED_LICENSE="keySystemNoConfiguredLicense",i.KEY_SYSTEM_LICENSE_REQUEST_FAILED="keySystemLicenseRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED="keySystemServerCertificateRequestFailed",i.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED="keySystemServerCertificateUpdateFailed",i.KEY_SYSTEM_SESSION_UPDATE_FAILED="keySystemSessionUpdateFailed",i.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED="keySystemStatusOutputRestricted",i.KEY_SYSTEM_STATUS_INTERNAL_ERROR="keySystemStatusInternalError",i.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR="keySystemDestroyMediaKeysError",i.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR="keySystemDestroyCloseSessionError",i.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR="keySystemDestroyRemoveSessionError",i.MANIFEST_LOAD_ERROR="manifestLoadError",i.MANIFEST_LOAD_TIMEOUT="manifestLoadTimeOut",i.MANIFEST_PARSING_ERROR="manifestParsingError",i.MANIFEST_INCOMPATIBLE_CODECS_ERROR="manifestIncompatibleCodecsError",i.LEVEL_EMPTY_ERROR="levelEmptyError",i.LEVEL_LOAD_ERROR="levelLoadError",i.LEVEL_LOAD_TIMEOUT="levelLoadTimeOut",i.LEVEL_PARSING_ERROR="levelParsingError",i.LEVEL_SWITCH_ERROR="levelSwitchError",i.AUDIO_TRACK_LOAD_ERROR="audioTrackLoadError",i.AUDIO_TRACK_LOAD_TIMEOUT="audioTrackLoadTimeOut",i.SUBTITLE_LOAD_ERROR="subtitleTrackLoadError",i.SUBTITLE_TRACK_LOAD_TIMEOUT="subtitleTrackLoadTimeOut",i.FRAG_LOAD_ERROR="fragLoadError",i.FRAG_LOAD_TIMEOUT="fragLoadTimeOut",i.FRAG_DECRYPT_ERROR="fragDecryptError",i.FRAG_PARSING_ERROR="fragParsingError",i.FRAG_GAP="fragGap",i.REMUX_ALLOC_ERROR="remuxAllocError",i.KEY_LOAD_ERROR="keyLoadError",i.KEY_LOAD_TIMEOUT="keyLoadTimeOut",i.BUFFER_ADD_CODEC_ERROR="bufferAddCodecError",i.BUFFER_INCOMPATIBLE_CODECS_ERROR="bufferIncompatibleCodecsError",i.BUFFER_APPEND_ERROR="bufferAppendError",i.BUFFER_APPENDING_ERROR="bufferAppendingError",i.BUFFER_STALLED_ERROR="bufferStalledError",i.BUFFER_FULL_ERROR="bufferFullError",i.BUFFER_SEEK_OVER_HOLE="bufferSeekOverHole",i.BUFFER_NUDGE_ON_STALL="bufferNudgeOnStall",i.ASSET_LIST_LOAD_ERROR="assetListLoadError",i.ASSET_LIST_LOAD_TIMEOUT="assetListLoadTimeout",i.ASSET_LIST_PARSING_ERROR="assetListParsingError",i.INTERSTITIAL_ASSET_ITEM_ERROR="interstitialAssetItemError",i.INTERNAL_EXCEPTION="internalException",i.INTERNAL_ABORTED="aborted",i.ATTACH_MEDIA_ERROR="attachMediaError",i.UNKNOWN="unknown",i}({}),L=function(i){return i.MEDIA_ATTACHING="hlsMediaAttaching",i.MEDIA_ATTACHED="hlsMediaAttached",i.MEDIA_DETACHING="hlsMediaDetaching",i.MEDIA_DETACHED="hlsMediaDetached",i.MEDIA_ENDED="hlsMediaEnded",i.STALL_RESOLVED="hlsStallResolved",i.BUFFER_RESET="hlsBufferReset",i.BUFFER_CODECS="hlsBufferCodecs",i.BUFFER_CREATED="hlsBufferCreated",i.BUFFER_APPENDING="hlsBufferAppending",i.BUFFER_APPENDED="hlsBufferAppended",i.BUFFER_EOS="hlsBufferEos",i.BUFFERED_TO_END="hlsBufferedToEnd",i.BUFFER_FLUSHING="hlsBufferFlushing",i.BUFFER_FLUSHED="hlsBufferFlushed",i.MANIFEST_LOADING="hlsManifestLoading",i.MANIFEST_LOADED="hlsManifestLoaded",i.MANIFEST_PARSED="hlsManifestParsed",i.LEVEL_SWITCHING="hlsLevelSwitching",i.LEVEL_SWITCHED="hlsLevelSwitched",i.LEVEL_LOADING="hlsLevelLoading",i.LEVEL_LOADED="hlsLevelLoaded",i.LEVEL_UPDATED="hlsLevelUpdated",i.LEVEL_PTS_UPDATED="hlsLevelPtsUpdated",i.LEVELS_UPDATED="hlsLevelsUpdated",i.AUDIO_TRACKS_UPDATED="hlsAudioTracksUpdated",i.AUDIO_TRACK_SWITCHING="hlsAudioTrackSwitching",i.AUDIO_TRACK_SWITCHED="hlsAudioTrackSwitched",i.AUDIO_TRACK_LOADING="hlsAudioTrackLoading",i.AUDIO_TRACK_LOADED="hlsAudioTrackLoaded",i.AUDIO_TRACK_UPDATED="hlsAudioTrackUpdated",i.SUBTITLE_TRACKS_UPDATED="hlsSubtitleTracksUpdated",i.SUBTITLE_TRACKS_CLEARED="hlsSubtitleTracksCleared",i.SUBTITLE_TRACK_SWITCH="hlsSubtitleTrackSwitch",i.SUBTITLE_TRACK_LOADING="hlsSubtitleTrackLoading",i.SUBTITLE_TRACK_LOADED="hlsSubtitleTrackLoaded",i.SUBTITLE_TRACK_UPDATED="hlsSubtitleTrackUpdated",i.SUBTITLE_FRAG_PROCESSED="hlsSubtitleFragProcessed",i.CUES_PARSED="hlsCuesParsed",i.NON_NATIVE_TEXT_TRACKS_FOUND="hlsNonNativeTextTracksFound",i.INIT_PTS_FOUND="hlsInitPtsFound",i.FRAG_LOADING="hlsFragLoading",i.FRAG_LOAD_EMERGENCY_ABORTED="hlsFragLoadEmergencyAborted",i.FRAG_LOADED="hlsFragLoaded",i.FRAG_DECRYPTED="hlsFragDecrypted",i.FRAG_PARSING_INIT_SEGMENT="hlsFragParsingInitSegment",i.FRAG_PARSING_USERDATA="hlsFragParsingUserdata",i.FRAG_PARSING_METADATA="hlsFragParsingMetadata",i.FRAG_PARSED="hlsFragParsed",i.FRAG_BUFFERED="hlsFragBuffered",i.FRAG_CHANGED="hlsFragChanged",i.FPS_DROP="hlsFpsDrop",i.FPS_DROP_LEVEL_CAPPING="hlsFpsDropLevelCapping",i.MAX_AUTO_LEVEL_UPDATED="hlsMaxAutoLevelUpdated",i.ERROR="hlsError",i.DESTROYING="hlsDestroying",i.KEY_LOADING="hlsKeyLoading",i.KEY_LOADED="hlsKeyLoaded",i.LIVE_BACK_BUFFER_REACHED="hlsLiveBackBufferReached",i.BACK_BUFFER_REACHED="hlsBackBufferReached",i.STEERING_MANIFEST_LOADED="hlsSteeringManifestLoaded",i.ASSET_LIST_LOADING="hlsAssetListLoading",i.ASSET_LIST_LOADED="hlsAssetListLoaded",i.INTERSTITIALS_UPDATED="hlsInterstitialsUpdated",i.INTERSTITIALS_BUFFERED_TO_BOUNDARY="hlsInterstitialsBufferedToBoundary",i.INTERSTITIAL_ASSET_PLAYER_CREATED="hlsInterstitialAssetPlayerCreated",i.INTERSTITIAL_STARTED="hlsInterstitialStarted",i.INTERSTITIAL_ASSET_STARTED="hlsInterstitialAssetStarted",i.INTERSTITIAL_ASSET_ENDED="hlsInterstitialAssetEnded",i.INTERSTITIAL_ASSET_ERROR="hlsInterstitialAssetError",i.INTERSTITIAL_ENDED="hlsInterstitialEnded",i.INTERSTITIALS_PRIMARY_RESUMED="hlsInterstitialsPrimaryResumed",i.PLAYOUT_LIMIT_REACHED="hlsPlayoutLimitReached",i.EVENT_CUE_ENTER="hlsEventCueEnter",i}({});var De={MANIFEST:"manifest",LEVEL:"level",AUDIO_TRACK:"audioTrack",SUBTITLE_TRACK:"subtitleTrack"},pe={MAIN:"main",AUDIO:"audio",SUBTITLE:"subtitle"};class ys{constructor(e,t=0,n=0){this.halfLife=void 0,this.alpha_=void 0,this.estimate_=void 0,this.totalWeight_=void 0,this.halfLife=e,this.alpha_=e?Math.exp(Math.log(.5)/e):0,this.estimate_=t,this.totalWeight_=n}sample(e,t){const n=Math.pow(this.alpha_,e);this.estimate_=t*(1-n)+n*this.estimate_,this.totalWeight_+=e}getTotalWeight(){return this.totalWeight_}getEstimate(){if(this.alpha_){const e=1-Math.pow(this.alpha_,this.totalWeight_);if(e)return this.estimate_/e}return this.estimate_}}class YT{constructor(e,t,n,r=100){this.defaultEstimate_=void 0,this.minWeight_=void 0,this.minDelayMs_=void 0,this.slow_=void 0,this.fast_=void 0,this.defaultTTFB_=void 0,this.ttfb_=void 0,this.defaultEstimate_=n,this.minWeight_=.001,this.minDelayMs_=50,this.slow_=new ys(e),this.fast_=new ys(t),this.defaultTTFB_=r,this.ttfb_=new ys(e)}update(e,t){const{slow_:n,fast_:r,ttfb_:a}=this;n.halfLife!==e&&(this.slow_=new ys(e,n.getEstimate(),n.getTotalWeight())),r.halfLife!==t&&(this.fast_=new ys(t,r.getEstimate(),r.getTotalWeight())),a.halfLife!==e&&(this.ttfb_=new ys(e,a.getEstimate(),a.getTotalWeight()))}sample(e,t){e=Math.max(e,this.minDelayMs_);const n=8*t,r=e/1e3,a=n/r;this.fast_.sample(r,a),this.slow_.sample(r,a)}sampleTTFB(e){const t=e/1e3,n=Math.sqrt(2)*Math.exp(-Math.pow(t,2)/2);this.ttfb_.sample(n,Math.max(e,5))}canEstimate(){return this.fast_.getTotalWeight()>=this.minWeight_}getEstimate(){return this.canEstimate()?Math.min(this.fast_.getEstimate(),this.slow_.getEstimate()):this.defaultEstimate_}getEstimateTTFB(){return this.ttfb_.getTotalWeight()>=this.minWeight_?this.ttfb_.getEstimate():this.defaultTTFB_}get defaultEstimate(){return this.defaultEstimate_}destroy(){}}function qT(i,e,t){return(e=QT(e))in i?Object.defineProperty(i,e,{value:t,enumerable:!0,configurable:!0,writable:!0}):i[e]=t,i}function Ue(){return Ue=Object.assign?Object.assign.bind():function(i){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)({}).hasOwnProperty.call(t,n)&&(i[n]=t[n])}return i},Ue.apply(null,arguments)}function Km(i,e){var t=Object.keys(i);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(i);e&&(n=n.filter(function(r){return Object.getOwnPropertyDescriptor(i,r).enumerable})),t.push.apply(t,n)}return t}function Be(i){for(var e=1;e<arguments.length;e++){var t=arguments[e]!=null?arguments[e]:{};e%2?Km(Object(t),!0).forEach(function(n){qT(i,n,t[n])}):Object.getOwnPropertyDescriptors?Object.defineProperties(i,Object.getOwnPropertyDescriptors(t)):Km(Object(t)).forEach(function(n){Object.defineProperty(i,n,Object.getOwnPropertyDescriptor(t,n))})}return i}function XT(i,e){if(typeof i!="object"||!i)return i;var t=i[Symbol.toPrimitive];if(t!==void 0){var n=t.call(i,e);if(typeof n!="object")return n;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(i)}function QT(i){var e=XT(i,"string");return typeof e=="symbol"?e:e+""}class gn{constructor(e,t){this.trace=void 0,this.debug=void 0,this.log=void 0,this.warn=void 0,this.info=void 0,this.error=void 0;const n=`[${e}]:`;this.trace=yr,this.debug=t.debug.bind(null,n),this.log=t.log.bind(null,n),this.warn=t.warn.bind(null,n),this.info=t.info.bind(null,n),this.error=t.error.bind(null,n)}}const yr=function(){},JT={trace:yr,debug:yr,log:yr,warn:yr,info:yr,error:yr};function bc(){return Ue({},JT)}function ZT(i,e){const t=self.console[i];return t?t.bind(self.console,`${e?"["+e+"] ":""}[${i}] >`):yr}function zm(i,e,t){return e[i]?e[i].bind(e):ZT(i,t)}const Cc=bc();function eL(i,e,t){const n=bc();if(typeof console=="object"&&i===!0||typeof i=="object"){const r=["debug","log","info","warn","error"];r.forEach(a=>{n[a]=zm(a,i,t)});try{n.log(`Debug logs enabled for "${e}" in hls.js version 1.6.7`)}catch{return bc()}r.forEach(a=>{Cc[a]=zm(a,i)})}else Ue(Cc,n);return n}const Fe=Cc;function Er(i=!0){return typeof self>"u"?void 0:(i||!self.MediaSource)&&self.ManagedMediaSource||self.MediaSource||self.WebKitMediaSource}function tL(i){return typeof self<"u"&&i===self.ManagedMediaSource}function Jg(i,e){const t=Object.keys(i),n=Object.keys(e),r=t.length,a=n.length;return!r||!a||r===a&&!t.some(l=>n.indexOf(l)===-1)}function Vt(i,e=!1){if(typeof TextDecoder<"u"){const c=new TextDecoder("utf-8").decode(i);if(e){const h=c.indexOf("\0");return h!==-1?c.substring(0,h):c}return c.replace(/\0/g,"")}const t=i.length;let n,r,a,l="",u=0;for(;u<t;){if(n=i[u++],n===0&&e)return l;if(n===0||n===3)continue;switch(n>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:l+=String.fromCharCode(n);break;case 12:case 13:r=i[u++],l+=String.fromCharCode((n&31)<<6|r&63);break;case 14:r=i[u++],a=i[u++],l+=String.fromCharCode((n&15)<<12|(r&63)<<6|(a&63)<<0);break}}return l}const Br={hexDump:function(i){let e="";for(let t=0;t<i.length;t++){let n=i[t].toString(16);n.length<2&&(n="0"+n),e+=n}return e}};function Zg(i){return Uint8Array.from(i.replace(/^0x/,"").replace(/([\da-fA-F]{2}) ?/g,"0x$1 ").replace(/ +$/,"").split(" ")).buffer}function nL(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var Ju={exports:{}},Wm;function rL(){return Wm||(Wm=1,function(i,e){(function(t){var n=/^(?=((?:[a-zA-Z0-9+\-.]+:)?))\1(?=((?:\/\/[^\/?#]*)?))\2(?=((?:(?:[^?#\/]*\/)*[^;?#\/]*)?))\3((?:;[^?#]*)?)(\?[^#]*)?(#[^]*)?$/,r=/^(?=([^\/?#]*))\1([^]*)$/,a=/(?:\/|^)\.(?=\/)/g,l=/(?:\/|^)\.\.\/(?!\.\.\/)[^\/]*(?=\/)/g,u={buildAbsoluteURL:function(f,c,h){if(h=h||{},f=f.trim(),c=c.trim(),!c){if(!h.alwaysNormalize)return f;var m=u.parseURL(f);if(!m)throw new Error("Error trying to parse base URL.");return m.path=u.normalizePath(m.path),u.buildURLFromParts(m)}var g=u.parseURL(c);if(!g)throw new Error("Error trying to parse relative URL.");if(g.scheme)return h.alwaysNormalize?(g.path=u.normalizePath(g.path),u.buildURLFromParts(g)):c;var E=u.parseURL(f);if(!E)throw new Error("Error trying to parse base URL.");if(!E.netLoc&&E.path&&E.path[0]!=="/"){var y=r.exec(E.path);E.netLoc=y[1],E.path=y[2]}E.netLoc&&!E.path&&(E.path="/");var T={scheme:E.scheme,netLoc:g.netLoc,path:null,params:g.params,query:g.query,fragment:g.fragment};if(!g.netLoc&&(T.netLoc=E.netLoc,g.path[0]!=="/"))if(!g.path)T.path=E.path,g.params||(T.params=E.params,g.query||(T.query=E.query));else{var S=E.path,A=S.substring(0,S.lastIndexOf("/")+1)+g.path;T.path=u.normalizePath(A)}return T.path===null&&(T.path=h.alwaysNormalize?u.normalizePath(g.path):g.path),u.buildURLFromParts(T)},parseURL:function(f){var c=n.exec(f);return c?{scheme:c[1]||"",netLoc:c[2]||"",path:c[3]||"",params:c[4]||"",query:c[5]||"",fragment:c[6]||""}:null},normalizePath:function(f){for(f=f.split("").reverse().join("").replace(a,"");f.length!==(f=f.replace(l,"")).length;);return f.split("").reverse().join("")},buildURLFromParts:function(f){return f.scheme+f.netLoc+f.path+f.params+f.query+f.fragment}};i.exports=u})()}(Ju)),Ju.exports}var sd=rL();class id{constructor(){this.aborted=!1,this.loaded=0,this.retry=0,this.total=0,this.chunkCount=0,this.bwEstimate=0,this.loading={start:0,first:0,end:0},this.parsing={start:0,end:0},this.buffering={start:0,first:0,end:0}}}var Ge={AUDIO:"audio",VIDEO:"video",AUDIOVIDEO:"audiovideo"};class e0{constructor(e){this._byteRange=null,this._url=null,this._stats=null,this._streams=null,this.base=void 0,this.relurl=void 0,typeof e=="string"&&(e={url:e}),this.base=e,iL(this,"stats")}setByteRange(e,t){const n=e.split("@",2);let r;n.length===1?r=(t==null?void 0:t.byteRangeEndOffset)||0:r=parseInt(n[1]),this._byteRange=[r,parseInt(n[0])+r]}get baseurl(){return this.base.url}get byteRange(){return this._byteRange===null?[]:this._byteRange}get byteRangeStartOffset(){return this.byteRange[0]}get byteRangeEndOffset(){return this.byteRange[1]}get elementaryStreams(){return this._streams===null&&(this._streams={[Ge.AUDIO]:null,[Ge.VIDEO]:null,[Ge.AUDIOVIDEO]:null}),this._streams}set elementaryStreams(e){this._streams=e}get hasStats(){return this._stats!==null}get hasStreams(){return this._streams!==null}get stats(){return this._stats===null&&(this._stats=new id),this._stats}set stats(e){this._stats=e}get url(){return!this._url&&this.baseurl&&this.relurl&&(this._url=sd.buildAbsoluteURL(this.baseurl,this.relurl,{alwaysNormalize:!0})),this._url||""}set url(e){this._url=e}clearElementaryStreamInfo(){const{elementaryStreams:e}=this;e[Ge.AUDIO]=null,e[Ge.VIDEO]=null,e[Ge.AUDIOVIDEO]=null}}function st(i){return i.sn!=="initSegment"}class Zu extends e0{constructor(e,t){super(t),this._decryptdata=null,this._programDateTime=null,this._ref=null,this._bitrate=void 0,this.rawProgramDateTime=null,this.tagList=[],this.duration=0,this.sn=0,this.levelkeys=void 0,this.type=void 0,this.loader=null,this.keyLoader=null,this.level=-1,this.cc=0,this.startPTS=void 0,this.endPTS=void 0,this.startDTS=void 0,this.endDTS=void 0,this.start=0,this.playlistOffset=0,this.deltaPTS=void 0,this.maxStartPTS=void 0,this.minEndPTS=void 0,this.data=void 0,this.bitrateTest=!1,this.title=null,this.initSegment=null,this.endList=void 0,this.gap=void 0,this.urlId=0,this.type=e}get byteLength(){if(this.hasStats){const e=this.stats.total;if(e)return e}if(this.byteRange){const e=this.byteRange[0],t=this.byteRange[1];if(ce(e)&&ce(t))return t-e}return null}get bitrate(){return this.byteLength?this.byteLength*8/this.duration:this._bitrate?this._bitrate:null}set bitrate(e){this._bitrate=e}get decryptdata(){const{levelkeys:e}=this;if(!e&&!this._decryptdata)return null;if(!this._decryptdata&&this.levelkeys&&!this.levelkeys.NONE){const t=this.levelkeys.identity;if(t)this._decryptdata=t.getDecryptData(this.sn);else{const n=Object.keys(this.levelkeys);if(n.length===1)return this._decryptdata=this.levelkeys[n[0]].getDecryptData(this.sn)}}return this._decryptdata}get end(){return this.start+this.duration}get endProgramDateTime(){if(this.programDateTime===null)return null;const e=ce(this.duration)?this.duration:0;return this.programDateTime+e*1e3}get encrypted(){var e;if((e=this._decryptdata)!=null&&e.encrypted)return!0;if(this.levelkeys){const t=Object.keys(this.levelkeys),n=t.length;if(n>1||n===1&&this.levelkeys[t[0]].encrypted)return!0}return!1}get programDateTime(){return this._programDateTime===null&&this.rawProgramDateTime&&(this.programDateTime=Date.parse(this.rawProgramDateTime)),this._programDateTime}set programDateTime(e){if(!ce(e)){this._programDateTime=this.rawProgramDateTime=null;return}this._programDateTime=e}get ref(){return st(this)?(this._ref||(this._ref={base:this.base,start:this.start,duration:this.duration,sn:this.sn,programDateTime:this.programDateTime}),this._ref):null}addStart(e){this.setStart(this.start+e)}setStart(e){this.start=e,this._ref&&(this._ref.start=e)}setDuration(e){this.duration=e,this._ref&&(this._ref.duration=e)}setKeyFormat(e){if(this.levelkeys){const t=this.levelkeys[e];t&&!this._decryptdata&&(this._decryptdata=t.getDecryptData(this.sn))}}abortRequests(){var e,t;(e=this.loader)==null||e.abort(),(t=this.keyLoader)==null||t.abort()}setElementaryStreamInfo(e,t,n,r,a,l=!1){const{elementaryStreams:u}=this,f=u[e];if(!f){u[e]={startPTS:t,endPTS:n,startDTS:r,endDTS:a,partial:l};return}f.startPTS=Math.min(f.startPTS,t),f.endPTS=Math.max(f.endPTS,n),f.startDTS=Math.min(f.startDTS,r),f.endDTS=Math.max(f.endDTS,a)}}class sL extends e0{constructor(e,t,n,r,a){super(n),this.fragOffset=0,this.duration=0,this.gap=!1,this.independent=!1,this.relurl=void 0,this.fragment=void 0,this.index=void 0,this.duration=e.decimalFloatingPoint("DURATION"),this.gap=e.bool("GAP"),this.independent=e.bool("INDEPENDENT"),this.relurl=e.enumeratedString("URI"),this.fragment=t,this.index=r;const l=e.enumeratedString("BYTERANGE");l&&this.setByteRange(l,a),a&&(this.fragOffset=a.fragOffset+a.duration)}get start(){return this.fragment.start+this.fragOffset}get end(){return this.start+this.duration}get loaded(){const{elementaryStreams:e}=this;return!!(e.audio||e.video||e.audiovideo)}}function t0(i,e){const t=Object.getPrototypeOf(i);if(t){const n=Object.getOwnPropertyDescriptor(t,e);return n||t0(t,e)}}function iL(i,e){const t=t0(i,e);t&&(t.enumerable=!0,Object.defineProperty(i,e,t))}const Ym=Math.pow(2,32)-1,aL=[].push,n0={video:1,audio:2,id3:3,text:4};function ht(i){return String.fromCharCode.apply(null,i)}function r0(i,e){const t=i[e]<<8|i[e+1];return t<0?65536+t:t}function Re(i,e){const t=s0(i,e);return t<0?4294967296+t:t}function qm(i,e){let t=Re(i,e);return t*=Math.pow(2,32),t+=Re(i,e+4),t}function s0(i,e){return i[e]<<24|i[e+1]<<16|i[e+2]<<8|i[e+3]}function oL(i){const e=i.byteLength;for(let t=0;t<e;){const n=Re(i,t);if(n>8&&i[t+4]===109&&i[t+5]===111&&i[t+6]===111&&i[t+7]===102)return!0;t=n>1?t+n:e}return!1}function Ce(i,e){const t=[];if(!e.length)return t;const n=i.byteLength;for(let r=0;r<n;){const a=Re(i,r),l=ht(i.subarray(r+4,r+8)),u=a>1?r+a:n;if(l===e[0])if(e.length===1)t.push(i.subarray(r+8,u));else{const f=Ce(i.subarray(r+8,u),e.slice(1));f.length&&aL.apply(t,f)}r=u}return t}function lL(i){const e=[],t=i[0];let n=8;const r=Re(i,n);n+=4;let a=0,l=0;t===0?(a=Re(i,n),l=Re(i,n+4),n+=8):(a=qm(i,n),l=qm(i,n+8),n+=16),n+=2;let u=i.length+l;const f=r0(i,n);n+=2;for(let c=0;c<f;c++){let h=n;const m=Re(i,h);h+=4;const g=m&2147483647;if((m&2147483648)>>>31===1)return Fe.warn("SIDX has hierarchical references (not supported)"),null;const y=Re(i,h);h+=4,e.push({referenceSize:g,subsegmentDuration:y,info:{duration:y/r,start:u,end:u+g-1}}),u+=g,h+=4,n=h}return{earliestPresentationTime:a,timescale:r,version:t,referencesCount:f,references:e}}function i0(i){const e=[],t=Ce(i,["moov","trak"]);for(let r=0;r<t.length;r++){const a=t[r],l=Ce(a,["tkhd"])[0];if(l){let u=l[0];const f=Re(l,u===0?12:20),c=Ce(a,["mdia","mdhd"])[0];if(c){u=c[0];const h=Re(c,u===0?12:20),m=Ce(a,["mdia","hdlr"])[0];if(m){const g=ht(m.subarray(8,12)),E={soun:Ge.AUDIO,vide:Ge.VIDEO}[g],y=Ce(a,["mdia","minf","stbl","stsd"])[0],T=uL(y);E?(e[f]={timescale:h,type:E,stsd:T},e[E]=Be({timescale:h,id:f},T)):e[f]={timescale:h,type:g,stsd:T}}}}}return Ce(i,["moov","mvex","trex"]).forEach(r=>{const a=Re(r,4),l=e[a];l&&(l.default={duration:Re(r,12),flags:Re(r,20)})}),e}function uL(i){const e=i.subarray(8),t=e.subarray(86),n=ht(e.subarray(4,8));let r=n,a;const l=n==="enca"||n==="encv";if(l){const c=Ce(e,[n])[0].subarray(n==="enca"?28:78);Ce(c,["sinf"]).forEach(m=>{const g=Ce(m,["schm"])[0];if(g){const E=ht(g.subarray(4,8));if(E==="cbcs"||E==="cenc"){const y=Ce(m,["frma"])[0];y&&(r=ht(y))}}})}const u=r;switch(r){case"avc1":case"avc2":case"avc3":case"avc4":{const f=Ce(t,["avcC"])[0];f&&f.length>3&&(r+="."+eo(f[1])+eo(f[2])+eo(f[3]),a=Za(u==="avc1"?"dva1":"dvav",t));break}case"mp4a":{const f=Ce(e,[n])[0],c=Ce(f.subarray(28),["esds"])[0];if(c&&c.length>7){let h=4;if(c[h++]!==3)break;h=ec(c,h),h+=2;const m=c[h++];if(m&128&&(h+=2),m&64&&(h+=c[h++]),c[h++]!==4)break;h=ec(c,h);const g=c[h++];if(g===64)r+="."+eo(g);else break;if(h+=12,c[h++]!==5)break;h=ec(c,h);const E=c[h++];let y=(E&248)>>3;y===31&&(y+=1+((E&7)<<3)+((c[h]&224)>>5)),r+="."+y}break}case"hvc1":case"hev1":{const f=Ce(t,["hvcC"])[0];if(f&&f.length>12){const c=f[1],h=["","A","B","C"][c>>6],m=c&31,g=Re(f,2),E=(c&32)>>5?"H":"L",y=f[12],T=f.subarray(6,12);r+="."+h+m,r+="."+cL(g).toString(16).toUpperCase(),r+="."+E+y;let S="";for(let A=T.length;A--;){const w=T[A];(w||S)&&(S="."+w.toString(16).toUpperCase()+S)}r+=S}a=Za(u=="hev1"?"dvhe":"dvh1",t);break}case"dvh1":case"dvhe":case"dvav":case"dva1":case"dav1":{r=Za(r,t)||r;break}case"vp09":{const f=Ce(t,["vpcC"])[0];if(f&&f.length>6){const c=f[4],h=f[5],m=f[6]>>4&15;r+="."+An(c)+"."+An(h)+"."+An(m)}break}case"av01":{const f=Ce(t,["av1C"])[0];if(f&&f.length>2){const c=f[1]>>>5,h=f[1]&31,m=f[2]>>>7?"H":"M",g=(f[2]&64)>>6,E=(f[2]&32)>>5,y=c===2&&g?E?12:10:g?10:8,T=(f[2]&16)>>4,S=(f[2]&8)>>3,A=(f[2]&4)>>2,w=f[2]&3;r+="."+c+"."+An(h)+m+"."+An(y)+"."+T+"."+S+A+w+"."+An(1)+"."+An(1)+"."+An(1)+"."+0,a=Za("dav1",t)}break}}return{codec:r,encrypted:l,supplemental:a}}function Za(i,e){const t=Ce(e,["dvvC"]),n=t.length?t[0]:Ce(e,["dvcC"])[0];if(n){const r=n[2]>>1&127,a=n[2]<<5&32|n[3]>>3&31;return i+"."+An(r)+"."+An(a)}}function cL(i){let e=0;for(let t=0;t<32;t++)e|=(i>>t&1)<<31-t;return e>>>0}function ec(i,e){const t=e+5;for(;i[e++]&128&&e<t;);return e}function eo(i){return("0"+i.toString(16).toUpperCase()).slice(-2)}function An(i){return(i<10?"0":"")+i}function dL(i,e){if(!i||!e)return i;const t=e.keyId;return t&&e.isCommonEncryption&&Ce(i,["moov","trak"]).forEach(r=>{const l=Ce(r,["mdia","minf","stbl","stsd"])[0].subarray(8);let u=Ce(l,["enca"]);const f=u.length>0;f||(u=Ce(l,["encv"])),u.forEach(c=>{const h=f?c.subarray(28):c.subarray(78);Ce(h,["sinf"]).forEach(g=>{const E=fL(g);if(E){const y=E.subarray(8,24);y.some(T=>T!==0)||(Fe.log(`[eme] Patching keyId in 'enc${f?"a":"v"}>sinf>>tenc' box: ${Br.hexDump(y)} -> ${Br.hexDump(t)}`),E.set(t,8))}})})}),i}function fL(i){const e=Ce(i,["schm"])[0];if(e){const t=ht(e.subarray(4,8));if(t==="cbcs"||t==="cenc")return Ce(i,["schi","tenc"])[0]}return null}function hL(i,e,t){const n={},r=Ce(i,["moof","traf"]);for(let a=0;a<r.length;a++){const l=r[a],u=Ce(l,["tfhd"])[0],f=Re(u,4),c=e[f];if(!c)continue;const h=n[f]||(n[f]={start:NaN,duration:0,sampleCount:0,timescale:c.timescale,type:c.type}),m=Ce(l,["tfdt"])[0];if(m){const I=m[0];let b=Re(m,4);I===1&&(b===Ym?t.warn("[mp4-demuxer]: Ignoring assumed invalid signed 64-bit track fragment decode time"):(b*=Ym+1,b+=Re(m,8))),ce(b)&&(!ce(h.start)||b<h.start)&&(h.start=b)}const g=c.default,E=Re(u,0)|(g==null?void 0:g.flags);let y=(g==null?void 0:g.duration)||0;E&8&&(E&2?y=Re(u,12):y=Re(u,8));const T=Ce(l,["trun"]);let S=h.start||0,A=0,w=y;for(let I=0;I<T.length;I++){const b=T[I],P=Re(b,4),G=h.sampleCount;h.sampleCount+=P;const D=b[3]&1,M=b[3]&4,B=b[2]&1,O=b[2]&2,X=b[2]&4,re=b[2]&8;let de=8,ae=P;for(D&&(de+=4),M&&P&&(!(b[de+1]&1)&&h.keyFrameIndex===void 0&&(h.keyFrameIndex=G),de+=4,B?(w=Re(b,de),de+=4):w=y,O&&(de+=4),re&&(de+=4),S+=w,A+=w,ae--);ae--;)B?(w=Re(b,de),de+=4):w=y,O&&(de+=4),X&&(b[de+1]&1||h.keyFrameIndex===void 0&&(h.keyFrameIndex=h.sampleCount-(ae+1),h.keyFrameStart=S),de+=4),re&&(de+=4),S+=w,A+=w;!A&&y&&(A+=y*P)}h.duration+=A}if(!Object.keys(n).some(a=>n[a].duration)){let a=1/0,l=0;const u=Ce(i,["sidx"]);for(let f=0;f<u.length;f++){const c=lL(u[f]);if(c!=null&&c.references){a=Math.min(a,c.earliestPresentationTime/c.timescale);const h=c.references.reduce((m,g)=>m+g.info.duration||0,0);l=Math.max(l,h+c.earliestPresentationTime/c.timescale)}}l&&ce(l)&&Object.keys(n).forEach(f=>{n[f].duration||(n[f].duration=l*n[f].timescale-n[f].start)})}return n}function mL(i){const e={valid:null,remainder:null},t=Ce(i,["moof"]);if(t.length<2)return e.remainder=i,e;const n=t[t.length-1];return e.valid=i.slice(0,n.byteOffset-8),e.remainder=i.slice(n.byteOffset-8),e}function en(i,e){const t=new Uint8Array(i.length+e.length);return t.set(i),t.set(e,i.length),t}function Xm(i,e){const t=[],n=e.samples,r=e.timescale,a=e.id;let l=!1;return Ce(n,["moof"]).map(f=>{const c=f.byteOffset-8;Ce(f,["traf"]).map(m=>{const g=Ce(m,["tfdt"]).map(E=>{const y=E[0];let T=Re(E,4);return y===1&&(T*=Math.pow(2,32),T+=Re(E,8)),T/r})[0];return g!==void 0&&(i=g),Ce(m,["tfhd"]).map(E=>{const y=Re(E,4),T=Re(E,0)&16777215,S=(T&1)!==0,A=(T&2)!==0,w=(T&8)!==0;let I=0;const b=(T&16)!==0;let P=0;const G=(T&32)!==0;let D=8;y===a&&(S&&(D+=8),A&&(D+=4),w&&(I=Re(E,D),D+=4),b&&(P=Re(E,D),D+=4),G&&(D+=4),e.type==="video"&&(l=Xo(e.codec)),Ce(m,["trun"]).map(M=>{const B=M[0],O=Re(M,0)&16777215,X=(O&1)!==0;let re=0;const de=(O&4)!==0,ae=(O&256)!==0;let oe=0;const ie=(O&512)!==0;let ee=0;const $=(O&1024)!==0,J=(O&2048)!==0;let q=0;const C=Re(M,4);let U=8;X&&(re=Re(M,U),U+=4),de&&(U+=4);let le=re+c;for(let ue=0;ue<C;ue++){if(ae?(oe=Re(M,U),U+=4):oe=I,ie?(ee=Re(M,U),U+=4):ee=P,$&&(U+=4),J&&(B===0?q=Re(M,U):q=s0(M,U),U+=4),e.type===Ge.VIDEO){let ge=0;for(;ge<ee;){const he=Re(n,le);if(le+=4,pL(l,n[le])){const Le=n.subarray(le,le+he);ad(Le,l?2:1,i+q/r,t)}le+=he,ge+=he+4}}i+=oe/r}}))})})}),t}function Xo(i){if(!i)return!1;const e=i.substring(0,4);return e==="hvc1"||e==="hev1"||e==="dvh1"||e==="dvhe"}function pL(i,e){if(i){const t=e>>1&63;return t===39||t===40}else return(e&31)===6}function ad(i,e,t,n){const r=a0(i);let a=0;a+=e;let l=0,u=0,f=0;for(;a<r.length;){l=0;do{if(a>=r.length)break;f=r[a++],l+=f}while(f===255);u=0;do{if(a>=r.length)break;f=r[a++],u+=f}while(f===255);const c=r.length-a;let h=a;if(u<c)a+=u;else if(u>c){Fe.error(`Malformed SEI payload. ${u} is too small, only ${c} bytes left to parse.`);break}if(l===4){if(r[h++]===181){const g=r0(r,h);if(h+=2,g===49){const E=Re(r,h);if(h+=4,E===1195456820){const y=r[h++];if(y===3){const T=r[h++],S=31&T,A=64&T,w=A?2+S*3:0,I=new Uint8Array(w);if(A){I[0]=T;for(let b=1;b<w;b++)I[b]=r[h++]}n.push({type:y,payloadType:l,pts:t,bytes:I})}}}}}else if(l===5&&u>16){const m=[];for(let y=0;y<16;y++){const T=r[h++].toString(16);m.push(T.length==1?"0"+T:T),(y===3||y===5||y===7||y===9)&&m.push("-")}const g=u-16,E=new Uint8Array(g);for(let y=0;y<g;y++)E[y]=r[h++];n.push({payloadType:l,pts:t,uuid:m.join(""),userData:Vt(E),userDataBytes:E})}}}function a0(i){const e=i.byteLength,t=[];let n=1;for(;n<e-2;)i[n]===0&&i[n+1]===0&&i[n+2]===3?(t.push(n+2),n+=2):n++;if(t.length===0)return i;const r=e-t.length,a=new Uint8Array(r);let l=0;for(n=0;n<r;l++,n++)l===t[0]&&(l++,t.shift()),a[n]=i[l];return a}function gL(i){const e=i[0];let t="",n="",r=0,a=0,l=0,u=0,f=0,c=0;if(e===0){for(;ht(i.subarray(c,c+1))!=="\0";)t+=ht(i.subarray(c,c+1)),c+=1;for(t+=ht(i.subarray(c,c+1)),c+=1;ht(i.subarray(c,c+1))!=="\0";)n+=ht(i.subarray(c,c+1)),c+=1;n+=ht(i.subarray(c,c+1)),c+=1,r=Re(i,12),a=Re(i,16),u=Re(i,20),f=Re(i,24),c=28}else if(e===1){c+=4,r=Re(i,c),c+=4;const m=Re(i,c);c+=4;const g=Re(i,c);for(c+=4,l=2**32*m+g,zT(l)||(l=Number.MAX_SAFE_INTEGER,Fe.warn("Presentation time exceeds safe integer limit and wrapped to max safe integer in parsing emsg box")),u=Re(i,c),c+=4,f=Re(i,c),c+=4;ht(i.subarray(c,c+1))!=="\0";)t+=ht(i.subarray(c,c+1)),c+=1;for(t+=ht(i.subarray(c,c+1)),c+=1;ht(i.subarray(c,c+1))!=="\0";)n+=ht(i.subarray(c,c+1)),c+=1;n+=ht(i.subarray(c,c+1)),c+=1}const h=i.subarray(c,i.byteLength);return{schemeIdUri:t,value:n,timeScale:r,presentationTime:l,presentationTimeDelta:a,eventDuration:u,id:f,payload:h}}function yL(i,...e){const t=e.length;let n=8,r=t;for(;r--;)n+=e[r].byteLength;const a=new Uint8Array(n);for(a[0]=n>>24&255,a[1]=n>>16&255,a[2]=n>>8&255,a[3]=n&255,a.set(i,4),r=0,n=8;r<t;r++)a.set(e[r],n),n+=e[r].byteLength;return a}function vL(i,e,t){if(i.byteLength!==16)throw new RangeError("Invalid system id");let n,r;n=0,r=new Uint8Array;let a;n>0?(a=new Uint8Array(4),e.length>0&&new DataView(a.buffer).setUint32(0,e.length,!1)):a=new Uint8Array;const l=new Uint8Array(4);return t&&t.byteLength>0&&new DataView(l.buffer).setUint32(0,t.byteLength,!1),yL([112,115,115,104],new Uint8Array([n,0,0,0]),i,a,r,l,t||new Uint8Array)}const o0=()=>/\(Windows.+Firefox\//i.test(navigator.userAgent),ws={audio:{a3ds:1,"ac-3":.95,"ac-4":1,alac:.9,alaw:1,dra1:1,"dts+":1,"dts-":1,dtsc:1,dtse:1,dtsh:1,"ec-3":.9,enca:1,fLaC:.9,flac:.9,FLAC:.9,g719:1,g726:1,m4ae:1,mha1:1,mha2:1,mhm1:1,mhm2:1,mlpa:1,mp4a:1,"raw ":1,Opus:1,opus:1,samr:1,sawb:1,sawp:1,sevc:1,sqcp:1,ssmv:1,twos:1,ulaw:1},video:{avc1:1,avc2:1,avc3:1,avc4:1,avcp:1,av01:.8,dav1:.8,drac:1,dva1:1,dvav:1,dvh1:.7,dvhe:.7,encv:1,hev1:.75,hvc1:.75,mjp2:1,mp4v:1,mvc1:1,mvc2:1,mvc3:1,mvc4:1,resv:1,rv60:1,s263:1,svc1:1,svc2:1,"vc-1":1,vp08:1,vp09:.9},text:{stpp:1,wvtt:1}};function od(i,e){const t=ws[e];return!!t&&!!t[i.slice(0,4)]}function kc(i,e,t=!0){return!i.split(",").some(n=>!ld(n,e,t))}function ld(i,e,t=!0){var n;const r=Er(t);return(n=r==null?void 0:r.isTypeSupported(ki(i,e)))!=null?n:!1}function ki(i,e){return`${e}/mp4;codecs=${i}`}function Qm(i){if(i){const e=i.substring(0,4);return ws.video[e]}return 2}function Co(i){const e=o0();return i.split(",").reduce((t,n)=>{const a=e&&Xo(n)?9:ws.video[n];return a?(a*2+t)/(t?3:2):(ws.audio[n]+t)/(t?2:1)},0)}const tc={};function EL(i,e=!0){if(tc[i])return tc[i];const t={flac:["flac","fLaC","FLAC"],opus:["opus","Opus"],"mp4a.40.34":["mp3"]}[i];for(let r=0;r<t.length;r++){var n;if(ld(t[r],"audio",e))return tc[i]=t[r],t[r];if(t[r]==="mp3"&&(n=Er(e))!=null&&n.isTypeSupported("audio/mpeg"))return""}return i}const xL=/flac|opus|mp4a\.40\.34/i;function ko(i,e=!0){return i.replace(xL,t=>EL(t.toLowerCase(),e))}function SL(i,e){const t=[];if(i){const n=i.split(",");for(let r=0;r<n.length;r++)od(n[r],"video")||t.push(n[r])}return e&&t.push(e),t.join(",")}function vo(i,e){if(i&&(i.length>4||["ac-3","ec-3","alac","fLaC","Opus"].indexOf(i)!==-1)&&(Jm(i,"audio")||Jm(i,"video")))return i;if(e){const t=e.split(",");if(t.length>1){if(i){for(let n=t.length;n--;)if(t[n].substring(0,4)===i.substring(0,4))return t[n]}return t[0]}}return e||i}function Jm(i,e){return od(i,e)&&ld(i,e)}function TL(i){const e=i.split(",");for(let t=0;t<e.length;t++){const n=e[t].split(".");n.length>2&&n[0]==="avc1"&&(e[t]=`avc1.${parseInt(n[1]).toString(16)}${("000"+parseInt(n[2]).toString(16)).slice(-4)}`)}return e.join(",")}function LL(i){if(i.startsWith("av01.")){const e=i.split("."),t=["0","111","01","01","01","0"];for(let n=e.length;n>4&&n<10;n++)e[n]=t[n-4];return e.join(".")}return i}function Zm(i){const e=Er(i)||{isTypeSupported:()=>!1};return{mpeg:e.isTypeSupported("audio/mpeg"),mp3:e.isTypeSupported('audio/mp4; codecs="mp3"'),ac3:e.isTypeSupported('audio/mp4; codecs="ac-3"')}}function Dc(i){return i.replace(/^.+codecs=["']?([^"']+).*$/,"$1")}const l0={supported:!0,configurations:[],decodingInfoResults:[{supported:!0,powerEfficient:!0,smooth:!0}]};function u0(i,e){return{supported:!1,configurations:e,decodingInfoResults:[{supported:!1,smooth:!1,powerEfficient:!1}],error:i}}function AL(i,e,t,n,r,a){const l=i.videoCodec,u=i.audioCodec?i.audioGroups:null,f=a==null?void 0:a.audioCodec,c=a==null?void 0:a.channels,h=c?parseInt(c):f?1/0:2;let m=null;if(u!=null&&u.length)try{u.length===1&&u[0]?m=e.groups[u[0]].channels:m=u.reduce((g,E)=>{if(E){const y=e.groups[E];if(!y)throw new Error(`Audio track group ${E} not found`);Object.keys(y.channels).forEach(T=>{g[T]=(g[T]||0)+y.channels[T]})}return g},{2:0})}catch{return!0}return l!==void 0&&(l.split(",").some(g=>Xo(g))||i.width>1920&&i.height>1088||i.height>1920&&i.width>1088||i.frameRate>Math.max(n,30)||i.videoRange!=="SDR"&&i.videoRange!==t||i.bitrate>Math.max(r,8e6))||!!m&&ce(h)&&Object.keys(m).some(g=>parseInt(g)>h)}function c0(i,e,t,n={}){const r=i.videoCodec;if(!r&&!i.audioCodec||!t)return Promise.resolve(l0);const a=[],l=RL(i),u=l.length,f=IL(i,e,u>0),c=f.length;for(let h=u||1*c||1;h--;){const m={type:"media-source"};if(u&&(m.video=l[h%u]),c){m.audio=f[h%c];const g=m.audio.bitrate;m.video&&g&&(m.video.bitrate-=g)}a.push(m)}if(r){const h=navigator.userAgent;if(r.split(",").some(m=>Xo(m))&&o0())return Promise.resolve(u0(new Error(`Overriding Windows Firefox HEVC MediaCapabilities result based on user-agent string: (${h})`),a))}return Promise.all(a.map(h=>{const m=_L(h);return n[m]||(n[m]=t.decodingInfo(h))})).then(h=>({supported:!h.some(m=>!m.supported),configurations:a,decodingInfoResults:h})).catch(h=>({supported:!1,configurations:a,decodingInfoResults:[],error:h}))}function RL(i){var e;const t=(e=i.videoCodec)==null?void 0:e.split(","),n=d0(i),r=i.width||640,a=i.height||480,l=i.frameRate||30,u=i.videoRange.toLowerCase();return t?t.map(f=>{const c={contentType:ki(LL(f),"video"),width:r,height:a,bitrate:n,framerate:l};return u!=="sdr"&&(c.transferFunction=u),c}):[]}function IL(i,e,t){var n;const r=(n=i.audioCodec)==null?void 0:n.split(","),a=d0(i);return r&&i.audioGroups?i.audioGroups.reduce((l,u)=>{var f;const c=u?(f=e.groups[u])==null?void 0:f.tracks:null;return c?c.reduce((h,m)=>{if(m.groupId===u){const g=parseFloat(m.channels||"");r.forEach(E=>{const y={contentType:ki(E,"audio"),bitrate:t?wL(E,a):a};g&&(y.channels=""+g),h.push(y)})}return h},l):l},[]):[]}function wL(i,e){if(e<=1)return 1;let t=128e3;return i==="ec-3"?t=768e3:i==="ac-3"&&(t=64e4),Math.min(e/2,t)}function d0(i){return Math.ceil(Math.max(i.bitrate*.9,i.averageBitrate)/1e3)*1e3||1}function _L(i){let e="";const{audio:t,video:n}=i;if(n){const r=Dc(n.contentType);e+=`${r}_r${n.height}x${n.width}f${Math.ceil(n.framerate)}${n.transferFunction||"sd"}_${Math.ceil(n.bitrate/1e5)}`}if(t){const r=Dc(t.contentType);e+=`${n?"_":""}${r}_c${t.channels}`}return e}const Pc=["NONE","TYPE-0","TYPE-1",null];function bL(i){return Pc.indexOf(i)>-1}const Do=["SDR","PQ","HLG"];function CL(i){return!!i&&Do.indexOf(i)>-1}var Eo={No:"",Yes:"YES",v2:"v2"};function ep(i){const{canSkipUntil:e,canSkipDateRanges:t,age:n}=i,r=n<e/2;return e&&r?t?Eo.v2:Eo.Yes:Eo.No}class tp{constructor(e,t,n){this.msn=void 0,this.part=void 0,this.skip=void 0,this.msn=e,this.part=t,this.skip=n}addDirectives(e){const t=new self.URL(e);return this.msn!==void 0&&t.searchParams.set("_HLS_msn",this.msn.toString()),this.part!==void 0&&t.searchParams.set("_HLS_part",this.part.toString()),this.skip&&t.searchParams.set("_HLS_skip",this.skip),t.href}}class Di{constructor(e){if(this._attrs=void 0,this.audioCodec=void 0,this.bitrate=void 0,this.codecSet=void 0,this.url=void 0,this.frameRate=void 0,this.height=void 0,this.id=void 0,this.name=void 0,this.supplemental=void 0,this.videoCodec=void 0,this.width=void 0,this.details=void 0,this.fragmentError=0,this.loadError=0,this.loaded=void 0,this.realBitrate=0,this.supportedPromise=void 0,this.supportedResult=void 0,this._avgBitrate=0,this._audioGroups=void 0,this._subtitleGroups=void 0,this._urlId=0,this.url=[e.url],this._attrs=[e.attrs],this.bitrate=e.bitrate,e.details&&(this.details=e.details),this.id=e.id||0,this.name=e.name,this.width=e.width||0,this.height=e.height||0,this.frameRate=e.attrs.optionalFloat("FRAME-RATE",0),this._avgBitrate=e.attrs.decimalInteger("AVERAGE-BANDWIDTH"),this.audioCodec=e.audioCodec,this.videoCodec=e.videoCodec,this.codecSet=[e.videoCodec,e.audioCodec].filter(n=>!!n).map(n=>n.substring(0,4)).join(","),"supplemental"in e){var t;this.supplemental=e.supplemental;const n=(t=e.supplemental)==null?void 0:t.videoCodec;n&&n!==e.videoCodec&&(this.codecSet+=`,${n.substring(0,4)}`)}this.addGroupId("audio",e.attrs.AUDIO),this.addGroupId("text",e.attrs.SUBTITLES)}get maxBitrate(){return Math.max(this.realBitrate,this.bitrate)}get averageBitrate(){return this._avgBitrate||this.realBitrate||this.bitrate}get attrs(){return this._attrs[0]}get codecs(){return this.attrs.CODECS||""}get pathwayId(){return this.attrs["PATHWAY-ID"]||"."}get videoRange(){return this.attrs["VIDEO-RANGE"]||"SDR"}get score(){return this.attrs.optionalFloat("SCORE",0)}get uri(){return this.url[0]||""}hasAudioGroup(e){return np(this._audioGroups,e)}hasSubtitleGroup(e){return np(this._subtitleGroups,e)}get audioGroups(){return this._audioGroups}get subtitleGroups(){return this._subtitleGroups}addGroupId(e,t){if(t){if(e==="audio"){let n=this._audioGroups;n||(n=this._audioGroups=[]),n.indexOf(t)===-1&&n.push(t)}else if(e==="text"){let n=this._subtitleGroups;n||(n=this._subtitleGroups=[]),n.indexOf(t)===-1&&n.push(t)}}}get urlId(){return 0}set urlId(e){}get audioGroupIds(){return this.audioGroups?[this.audioGroupId]:void 0}get textGroupIds(){return this.subtitleGroups?[this.textGroupId]:void 0}get audioGroupId(){var e;return(e=this.audioGroups)==null?void 0:e[0]}get textGroupId(){var e;return(e=this.subtitleGroups)==null?void 0:e[0]}addFallback(){}}function np(i,e){return!e||!i?!1:i.indexOf(e)!==-1}function kL(){if(typeof matchMedia=="function"){const i=matchMedia("(dynamic-range: high)"),e=matchMedia("bad query");if(i.media!==e.media)return i.matches===!0}return!1}function DL(i,e){let t=!1,n=[];if(i&&(t=i!=="SDR",n=[i]),e){n=e.allowedVideoRanges||Do.slice(0);const r=n.join("")!=="SDR"&&!e.videoCodec;t=e.preferHDR!==void 0?e.preferHDR:r&&kL(),t||(n=["SDR"])}return{preferHDR:t,allowedVideoRanges:n}}const PL=i=>{const e=new WeakSet;return(t,n)=>{if(i&&(n=i(t,n)),typeof n=="object"&&n!==null){if(e.has(n))return;e.add(n)}return n}},Ke=(i,e)=>JSON.stringify(i,PL(e));function OL(i,e,t,n,r){const a=Object.keys(i),l=n==null?void 0:n.channels,u=n==null?void 0:n.audioCodec,f=r==null?void 0:r.videoCodec,c=l&&parseInt(l)===2;let h=!1,m=!1,g=1/0,E=1/0,y=1/0,T=1/0,S=0,A=[];const{preferHDR:w,allowedVideoRanges:I}=DL(e,r);for(let M=a.length;M--;){const B=i[a[M]];h||(h=B.channels[2]>0),g=Math.min(g,B.minHeight),E=Math.min(E,B.minFramerate),y=Math.min(y,B.minBitrate),I.filter(X=>B.videoRanges[X]>0).length>0&&(m=!0)}g=ce(g)?g:0,E=ce(E)?E:0;const b=Math.max(1080,g),P=Math.max(30,E);y=ce(y)?y:t,t=Math.max(y,t),m||(e=void 0);const G=a.length>1;return{codecSet:a.reduce((M,B)=>{const O=i[B];if(B===M)return M;if(A=m?I.filter(X=>O.videoRanges[X]>0):[],G){if(O.minBitrate>t)return Ln(B,`min bitrate of ${O.minBitrate} > current estimate of ${t}`),M;if(!O.hasDefaultAudio)return Ln(B,"no renditions with default or auto-select sound found"),M;if(u&&B.indexOf(u.substring(0,4))%5!==0)return Ln(B,`audio codec preference "${u}" not found`),M;if(l&&!c){if(!O.channels[l])return Ln(B,`no renditions with ${l} channel sound found (channels options: ${Object.keys(O.channels)})`),M}else if((!u||c)&&h&&O.channels[2]===0)return Ln(B,"no renditions with stereo sound found"),M;if(O.minHeight>b)return Ln(B,`min resolution of ${O.minHeight} > maximum of ${b}`),M;if(O.minFramerate>P)return Ln(B,`min framerate of ${O.minFramerate} > maximum of ${P}`),M;if(!A.some(X=>O.videoRanges[X]>0))return Ln(B,`no variants with VIDEO-RANGE of ${Ke(A)} found`),M;if(f&&B.indexOf(f.substring(0,4))%5!==0)return Ln(B,`video codec preference "${f}" not found`),M;if(O.maxScore<S)return Ln(B,`max score of ${O.maxScore} < selected max of ${S}`),M}return M&&(Co(B)>=Co(M)||O.fragmentError>i[M].fragmentError)?M:(T=O.minIndex,S=O.maxScore,B)},void 0),videoRanges:A,preferHDR:w,minFramerate:E,minBitrate:y,minIndex:T}}function Ln(i,e){Fe.log(`[abr] start candidates with "${i}" ignored because ${e}`)}function f0(i){return i.reduce((e,t)=>{let n=e.groups[t.groupId];n||(n=e.groups[t.groupId]={tracks:[],channels:{2:0},hasDefault:!1,hasAutoSelect:!1}),n.tracks.push(t);const r=t.channels||"2";return n.channels[r]=(n.channels[r]||0)+1,n.hasDefault=n.hasDefault||t.default,n.hasAutoSelect=n.hasAutoSelect||t.autoselect,n.hasDefault&&(e.hasDefaultAudio=!0),n.hasAutoSelect&&(e.hasAutoSelectAudio=!0),e},{hasDefaultAudio:!1,hasAutoSelectAudio:!1,groups:{}})}function NL(i,e,t,n){return i.slice(t,n+1).reduce((r,a,l)=>{if(!a.codecSet)return r;const u=a.audioGroups;let f=r[a.codecSet];f||(r[a.codecSet]=f={minBitrate:1/0,minHeight:1/0,minFramerate:1/0,minIndex:l,maxScore:0,videoRanges:{SDR:0},channels:{2:0},hasDefaultAudio:!u,fragmentError:0}),f.minBitrate=Math.min(f.minBitrate,a.bitrate);const c=Math.min(a.height,a.width);return f.minHeight=Math.min(f.minHeight,c),f.minFramerate=Math.min(f.minFramerate,a.frameRate),f.minIndex=Math.min(f.minIndex,l),f.maxScore=Math.max(f.maxScore,a.score),f.fragmentError+=a.fragmentError,f.videoRanges[a.videoRange]=(f.videoRanges[a.videoRange]||0)+1,u&&u.forEach(h=>{if(!h)return;const m=e.groups[h];m&&(f.hasDefaultAudio=f.hasDefaultAudio||e.hasDefaultAudio?m.hasDefault:m.hasAutoSelect||!e.hasDefaultAudio&&!e.hasAutoSelectAudio,Object.keys(m.channels).forEach(g=>{f.channels[g]=(f.channels[g]||0)+m.channels[g]}))}),r},{})}function rp(i){if(!i)return i;const{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:a}=i;return{lang:e,assocLang:t,characteristics:n,channels:r,audioCodec:a}}function In(i,e,t){if("attrs"in i){const n=e.indexOf(i);if(n!==-1)return n}for(let n=0;n<e.length;n++){const r=e[n];if(jr(i,r,t))return n}return-1}function jr(i,e,t){const{groupId:n,name:r,lang:a,assocLang:l,default:u}=i,f=i.forced;return(n===void 0||e.groupId===n)&&(r===void 0||e.name===r)&&(a===void 0||FL(a,e.lang))&&(a===void 0||e.assocLang===l)&&(u===void 0||e.default===u)&&(f===void 0||e.forced===f)&&(!("characteristics"in i)||ML(i.characteristics||"",e.characteristics))&&(t===void 0||t(i,e))}function FL(i,e="--"){return i.length===e.length?i===e:i.startsWith(e)||e.startsWith(i)}function ML(i,e=""){const t=i.split(","),n=e.split(",");return t.length===n.length&&!t.some(r=>n.indexOf(r)===-1)}function Ur(i,e){const{audioCodec:t,channels:n}=i;return(t===void 0||(e.audioCodec||"").substring(0,4)===t.substring(0,4))&&(n===void 0||n===(e.channels||"2"))}function UL(i,e,t,n,r){const a=e[n],u=e.reduce((g,E,y)=>{const T=E.uri;return(g[T]||(g[T]=[])).push(y),g},{})[a.uri];u.length>1&&(n=Math.max.apply(Math,u));const f=a.videoRange,c=a.frameRate,h=a.codecSet.substring(0,4),m=sp(e,n,g=>{if(g.videoRange!==f||g.frameRate!==c||g.codecSet.substring(0,4)!==h)return!1;const E=g.audioGroups,y=t.filter(T=>!E||E.indexOf(T.groupId)!==-1);return In(i,y,r)>-1});return m>-1?m:sp(e,n,g=>{const E=g.audioGroups,y=t.filter(T=>!E||E.indexOf(T.groupId)!==-1);return In(i,y,r)>-1})}function sp(i,e,t){for(let n=e;n>-1;n--)if(t(i[n]))return n;for(let n=e+1;n<i.length;n++)if(t(i[n]))return n;return-1}function Po(i,e){var t;return!!i&&i!==((t=e.loadLevelObj)==null?void 0:t.uri)}class BL extends gn{constructor(e){super("abr",e.logger),this.hls=void 0,this.lastLevelLoadSec=0,this.lastLoadedFragLevel=-1,this.firstSelection=-1,this._nextAutoLevel=-1,this.nextAutoLevelKey="",this.audioTracksByGroup=null,this.codecTiers=null,this.timer=-1,this.fragCurrent=null,this.partCurrent=null,this.bitrateTestDelay=0,this.rebufferNotice=-1,this.supportedCache={},this.bwEstimator=void 0,this._abandonRulesCheck=t=>{var n;const{fragCurrent:r,partCurrent:a,hls:l}=this,{autoLevelEnabled:u,media:f}=l;if(!r||!f)return;const c=performance.now(),h=a?a.stats:r.stats,m=a?a.duration:r.duration,g=c-h.loading.start,E=l.minAutoLevel,y=r.level,T=this._nextAutoLevel;if(h.aborted||h.loaded&&h.loaded===h.total||y<=E){this.clearTimer(),this._nextAutoLevel=-1;return}if(!u)return;const S=T>-1&&T!==y,A=!!t||S;if(!A&&(f.paused||!f.playbackRate||!f.readyState))return;const w=l.mainForwardBufferInfo;if(!A&&w===null)return;const I=this.bwEstimator.getEstimateTTFB(),b=Math.abs(f.playbackRate);if(g<=Math.max(I,1e3*(m/(b*2))))return;const P=w?w.len/b:0,G=h.loading.first?h.loading.first-h.loading.start:-1,D=h.loaded&&G>-1,M=this.getBwEstimate(),B=l.levels,O=B[y],X=Math.max(h.loaded,Math.round(m*(r.bitrate||O.averageBitrate)/8));let re=D?g-G:g;re<1&&D&&(re=Math.min(g,h.loaded*8/M));const de=D?h.loaded*1e3/re:0,ae=I/1e3,oe=de?(X-h.loaded)/de:X*8/M+ae;if(oe<=P)return;const ie=de?de*8:M,ee=((n=(t==null?void 0:t.details)||this.hls.latestLevelDetails)==null?void 0:n.live)===!0,$=this.hls.config.abrBandWidthUpFactor;let J=Number.POSITIVE_INFINITY,q;for(q=y-1;q>E;q--){const ue=B[q].maxBitrate,ge=!B[q].details||ee;if(J=this.getTimeToLoadFrag(ae,ie,m*ue,ge),J<Math.min(P,m+ae))break}if(J>=oe||J>m*10)return;D?this.bwEstimator.sample(g-Math.min(I,G),h.loaded):this.bwEstimator.sampleTTFB(g);const C=B[q].maxBitrate;this.getBwEstimate()*$>C&&this.resetEstimator(C);const U=this.findBestLevel(C,E,q,0,P,1,1);U>-1&&(q=U),this.warn(`Fragment ${r.sn}${a?" part "+a.index:""} of level ${y} is loading too slowly;
      Fragment duration: ${r.duration.toFixed(3)}
      Time to underbuffer: ${P.toFixed(3)} s
      Estimated load time for current fragment: ${oe.toFixed(3)} s
      Estimated load time for down switch fragment: ${J.toFixed(3)} s
      TTFB estimate: ${G|0} ms
      Current BW estimate: ${ce(M)?M|0:"Unknown"} bps
      New BW estimate: ${this.getBwEstimate()|0} bps
      Switching to level ${q} @ ${C|0} bps`),l.nextLoadLevel=l.nextAutoLevel=q,this.clearTimer();const le=()=>{if(this.clearTimer(),this.fragCurrent===r&&this.hls.loadLevel===q&&q>0){const ue=this.getStarvationDelay();if(this.warn(`Aborting inflight request ${q>0?"and switching down":""}
      Fragment duration: ${r.duration.toFixed(3)} s
      Time to underbuffer: ${ue.toFixed(3)} s`),r.abortRequests(),this.fragCurrent=this.partCurrent=null,q>E){let ge=this.findBestLevel(this.hls.levels[E].bitrate,E,q,0,ue,1,1);ge===-1&&(ge=E),this.hls.nextLoadLevel=this.hls.nextAutoLevel=ge,this.resetEstimator(this.hls.levels[ge].bitrate)}}};S||oe>J*2?le():this.timer=self.setInterval(le,J*1e3),l.trigger(L.FRAG_LOAD_EMERGENCY_ABORTED,{frag:r,part:a,stats:h})},this.hls=e,this.bwEstimator=this.initEstimator(),this.registerListeners()}resetEstimator(e){e&&(this.log(`setting initial bwe to ${e}`),this.hls.config.abrEwmaDefaultEstimate=e),this.firstSelection=-1,this.bwEstimator=this.initEstimator()}initEstimator(){const e=this.hls.config;return new YT(e.abrEwmaSlowVoD,e.abrEwmaFastVoD,e.abrEwmaDefaultEstimate)}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.MAX_AUTO_LEVEL_UPDATED,this.onMaxAutoLevelUpdated,this),e.off(L.ERROR,this.onError,this))}destroy(){this.unregisterListeners(),this.clearTimer(),this.hls=this._abandonRulesCheck=this.supportedCache=null,this.fragCurrent=this.partCurrent=null}onManifestLoading(e,t){this.lastLoadedFragLevel=-1,this.firstSelection=-1,this.lastLevelLoadSec=0,this.supportedCache={},this.fragCurrent=this.partCurrent=null,this.onLevelsUpdated(),this.clearTimer()}onLevelsUpdated(){this.lastLoadedFragLevel>-1&&this.fragCurrent&&(this.lastLoadedFragLevel=this.fragCurrent.level),this._nextAutoLevel=-1,this.onMaxAutoLevelUpdated(),this.codecTiers=null,this.audioTracksByGroup=null}onMaxAutoLevelUpdated(){this.firstSelection=-1,this.nextAutoLevelKey=""}onFragLoading(e,t){const n=t.frag;if(!this.ignoreFragment(n)){if(!n.bitrateTest){var r;this.fragCurrent=n,this.partCurrent=(r=t.part)!=null?r:null}this.clearTimer(),this.timer=self.setInterval(this._abandonRulesCheck,100)}}onLevelSwitching(e,t){this.clearTimer()}onError(e,t){if(!t.fatal)switch(t.details){case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:this.lastLoadedFragLevel=-1,this.firstSelection=-1;break;case H.FRAG_LOAD_TIMEOUT:{const n=t.frag,{fragCurrent:r,partCurrent:a}=this;if(n&&r&&n.sn===r.sn&&n.level===r.level){const l=performance.now(),u=a?a.stats:n.stats,f=l-u.loading.start,c=u.loading.first?u.loading.first-u.loading.start:-1;if(u.loaded&&c>-1){const m=this.bwEstimator.getEstimateTTFB();this.bwEstimator.sample(f-Math.min(m,c),u.loaded)}else this.bwEstimator.sampleTTFB(f)}break}}}getTimeToLoadFrag(e,t,n,r){const a=e+n/t,l=r?e+this.lastLevelLoadSec:0;return a+l}onLevelLoaded(e,t){const n=this.hls.config,{loading:r}=t.stats,a=r.end-r.first;ce(a)&&(this.lastLevelLoadSec=a/1e3),t.details.live?this.bwEstimator.update(n.abrEwmaSlowLive,n.abrEwmaFastLive):this.bwEstimator.update(n.abrEwmaSlowVoD,n.abrEwmaFastVoD),this.timer>-1&&this._abandonRulesCheck(t.levelInfo)}onFragLoaded(e,{frag:t,part:n}){const r=n?n.stats:t.stats;if(t.type===pe.MAIN&&this.bwEstimator.sampleTTFB(r.loading.first-r.loading.start),!this.ignoreFragment(t)){if(this.clearTimer(),t.level===this._nextAutoLevel&&(this._nextAutoLevel=-1),this.firstSelection=-1,this.hls.config.abrMaxWithRealBitrate){const a=n?n.duration:t.duration,l=this.hls.levels[t.level],u=(l.loaded?l.loaded.bytes:0)+r.loaded,f=(l.loaded?l.loaded.duration:0)+a;l.loaded={bytes:u,duration:f},l.realBitrate=Math.round(8*u/f)}if(t.bitrateTest){const a={stats:r,frag:t,part:n,id:t.type};this.onFragBuffered(L.FRAG_BUFFERED,a),t.bitrateTest=!1}else this.lastLoadedFragLevel=t.level}}onFragBuffered(e,t){const{frag:n,part:r}=t,a=r!=null&&r.stats.loaded?r.stats:n.stats;if(a.aborted||this.ignoreFragment(n))return;const l=a.parsing.end-a.loading.start-Math.min(a.loading.first-a.loading.start,this.bwEstimator.getEstimateTTFB());this.bwEstimator.sample(l,a.loaded),a.bwEstimate=this.getBwEstimate(),n.bitrateTest?this.bitrateTestDelay=l/1e3:this.bitrateTestDelay=0}ignoreFragment(e){return e.type!==pe.MAIN||e.sn==="initSegment"}clearTimer(){this.timer>-1&&(self.clearInterval(this.timer),this.timer=-1)}get firstAutoLevel(){const{maxAutoLevel:e,minAutoLevel:t}=this.hls,n=this.getBwEstimate(),r=this.hls.config.maxStarvationDelay,a=this.findBestLevel(n,t,e,0,r,1,1);if(a>-1)return a;const l=this.hls.firstLevel,u=Math.min(Math.max(l,t),e);return this.warn(`Could not find best starting auto level. Defaulting to first in playlist ${l} clamped to ${u}`),u}get forcedAutoLevel(){return this.nextAutoLevelKey?-1:this._nextAutoLevel}get nextAutoLevel(){const e=this.forcedAutoLevel,n=this.bwEstimator.canEstimate(),r=this.lastLoadedFragLevel>-1;if(e!==-1&&(!n||!r||this.nextAutoLevelKey===this.getAutoLevelKey()))return e;const a=n&&r?this.getNextABRAutoLevel():this.firstAutoLevel;if(e!==-1){const l=this.hls.levels;if(l.length>Math.max(e,a)&&l[e].loadError<=l[a].loadError)return e}return this._nextAutoLevel=a,this.nextAutoLevelKey=this.getAutoLevelKey(),a}getAutoLevelKey(){return`${this.getBwEstimate()}_${this.getStarvationDelay().toFixed(2)}`}getNextABRAutoLevel(){const{fragCurrent:e,partCurrent:t,hls:n}=this;if(n.levels.length<=1)return n.loadLevel;const{maxAutoLevel:r,config:a,minAutoLevel:l}=n,u=t?t.duration:e?e.duration:0,f=this.getBwEstimate(),c=this.getStarvationDelay();let h=a.abrBandWidthFactor,m=a.abrBandWidthUpFactor;if(c){const S=this.findBestLevel(f,l,r,c,0,h,m);if(S>=0)return this.rebufferNotice=-1,S}let g=u?Math.min(u,a.maxStarvationDelay):a.maxStarvationDelay;if(!c){const S=this.bitrateTestDelay;S&&(g=(u?Math.min(u,a.maxLoadingDelay):a.maxLoadingDelay)-S,this.info(`bitrate test took ${Math.round(1e3*S)}ms, set first fragment max fetchDuration to ${Math.round(1e3*g)} ms`),h=m=1)}const E=this.findBestLevel(f,l,r,c,g,h,m);if(this.rebufferNotice!==E&&(this.rebufferNotice=E,this.info(`${c?"rebuffering expected":"buffer is empty"}, optimal quality level ${E}`)),E>-1)return E;const y=n.levels[l],T=n.loadLevelObj;return T&&(y==null?void 0:y.bitrate)<T.bitrate?l:n.loadLevel}getStarvationDelay(){const e=this.hls,t=e.media;if(!t)return 1/0;const n=t&&t.playbackRate!==0?Math.abs(t.playbackRate):1,r=e.mainForwardBufferInfo;return(r?r.len:0)/n}getBwEstimate(){return this.bwEstimator.canEstimate()?this.bwEstimator.getEstimate():this.hls.config.abrEwmaDefaultEstimate}findBestLevel(e,t,n,r,a,l,u){var f;const c=r+a,h=this.lastLoadedFragLevel,m=h===-1?this.hls.firstLevel:h,{fragCurrent:g,partCurrent:E}=this,{levels:y,allAudioTracks:T,loadLevel:S,config:A}=this.hls;if(y.length===1)return 0;const w=y[m],I=!!((f=this.hls.latestLevelDetails)!=null&&f.live),b=S===-1||h===-1;let P,G="SDR",D=(w==null?void 0:w.frameRate)||0;const{audioPreference:M,videoPreference:B}=A,O=this.audioTracksByGroup||(this.audioTracksByGroup=f0(T));let X=-1;if(b){if(this.firstSelection!==-1)return this.firstSelection;const ee=this.codecTiers||(this.codecTiers=NL(y,O,t,n)),$=OL(ee,G,e,M,B),{codecSet:J,videoRanges:q,minFramerate:C,minBitrate:U,minIndex:le,preferHDR:ue}=$;X=le,P=J,G=ue?q[q.length-1]:q[0],D=C,e=Math.max(e,U),this.log(`picked start tier ${Ke($)}`)}else P=w==null?void 0:w.codecSet,G=w==null?void 0:w.videoRange;const re=E?E.duration:g?g.duration:0,de=this.bwEstimator.getEstimateTTFB()/1e3,ae=[];for(let ee=n;ee>=t;ee--){var oe,ie;const $=y[ee],J=ee>m;if(!$)continue;if(A.useMediaCapabilities&&!$.supportedResult&&!$.supportedPromise){const he=navigator.mediaCapabilities;typeof(he==null?void 0:he.decodingInfo)=="function"&&AL($,O,G,D,e,M)?($.supportedPromise=c0($,O,he,this.supportedCache),$.supportedPromise.then(Le=>{if(!this.hls)return;$.supportedResult=Le;const we=this.hls.levels,be=we.indexOf($);Le.error?this.warn(`MediaCapabilities decodingInfo error: "${Le.error}" for level ${be} ${Ke(Le)}`):Le.supported?Le.decodingInfoResults.some($e=>$e.smooth===!1||$e.powerEfficient===!1)&&this.log(`MediaCapabilities decodingInfo for level ${be} not smooth or powerEfficient: ${Ke(Le)}`):(this.warn(`Unsupported MediaCapabilities decodingInfo result for level ${be} ${Ke(Le)}`),be>-1&&we.length>1&&(this.log(`Removing unsupported level ${be}`),this.hls.removeLevel(be),this.hls.loadLevel===-1&&(this.hls.nextLoadLevel=0)))})):$.supportedResult=l0}if((P&&$.codecSet!==P||G&&$.videoRange!==G||J&&D>$.frameRate||!J&&D>0&&D<$.frameRate||(oe=$.supportedResult)!=null&&(ie=oe.decodingInfoResults)!=null&&ie.some(he=>he.smooth===!1))&&(!b||ee!==X)){ae.push(ee);continue}const q=$.details,C=(E?q==null?void 0:q.partTarget:q==null?void 0:q.averagetargetduration)||re;let U;J?U=u*e:U=l*e;const le=re&&r>=re*2&&a===0?$.averageBitrate:$.maxBitrate,ue=this.getTimeToLoadFrag(de,U,le*C,q===void 0);if(U>=le&&(ee===h||$.loadError===0&&$.fragmentError===0)&&(ue<=de||!ce(ue)||I&&!this.bitrateTestDelay||ue<c)){const he=this.forcedAutoLevel;return ee!==S&&(he===-1||he!==S)&&(ae.length&&this.trace(`Skipped level(s) ${ae.join(",")} of ${n} max with CODECS and VIDEO-RANGE:"${y[ae[0]].codecs}" ${y[ae[0]].videoRange}; not compatible with "${P}" ${G}`),this.info(`switch candidate:${m}->${ee} adjustedbw(${Math.round(U)})-bitrate=${Math.round(U-le)} ttfb:${de.toFixed(1)} avgDuration:${C.toFixed(1)} maxFetchDuration:${c.toFixed(1)} fetchDuration:${ue.toFixed(1)} firstSelection:${b} codecSet:${$.codecSet} videoRange:${$.videoRange} hls.loadLevel:${S}`)),b&&(this.firstSelection=ee),ee}}return-1}set nextAutoLevel(e){const t=this.deriveNextAutoLevel(e);this._nextAutoLevel!==t&&(this.nextAutoLevelKey="",this._nextAutoLevel=t)}deriveNextAutoLevel(e){const{maxAutoLevel:t,minAutoLevel:n}=this.hls;return Math.min(Math.max(e,n),t)}}const h0={search:function(i,e){let t=0,n=i.length-1,r=null,a=null;for(;t<=n;){r=(t+n)/2|0,a=i[r];const l=e(a);if(l>0)t=r+1;else if(l<0)n=r-1;else return a}return null}};function $L(i,e,t){if(e===null||!Array.isArray(i)||!i.length||!ce(e))return null;const n=i[0].programDateTime;if(e<(n||0))return null;const r=i[i.length-1].endProgramDateTime;if(e>=(r||0))return null;for(let a=0;a<i.length;++a){const l=i[a];if(jL(e,t,l))return l}return null}function Hr(i,e,t=0,n=0,r=.005){let a=null;if(i){a=e[1+i.sn-e[0].sn]||null;const u=i.endDTS-t;u>0&&u<15e-7&&(t+=15e-7),a&&i.level!==a.level&&a.end<=i.end&&(a=e[2+i.sn-e[0].sn]||null)}else t===0&&e[0].start===0&&(a=e[0]);if(a&&((!i||i.level===a.level)&&ip(t,n,a)===0||GL(a,i,Math.min(r,n))))return a;const l=h0.search(e,ip.bind(null,t,n));return l&&(l!==i||!a)?l:a}function GL(i,e,t){if(e&&e.start===0&&e.level<i.level&&(e.endPTS||0)>0){const n=e.tagList.reduce((r,a)=>(a[0]==="INF"&&(r+=parseFloat(a[1])),r),t);return i.start<=n}return!1}function ip(i=0,e=0,t){if(t.start<=i&&t.start+t.duration>i)return 0;const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0));return t.start+t.duration-n<=i?1:t.start-n>i&&t.start?-1:0}function jL(i,e,t){const n=Math.min(e,t.duration+(t.deltaPTS?t.deltaPTS:0))*1e3;return(t.endProgramDateTime||0)-n>i}function m0(i,e,t){if(i&&i.startCC<=e&&i.endCC>=e){let n=i.fragments;const{fragmentHint:r}=i;r&&(n=n.concat(r));let a;return h0.search(n,l=>l.cc<e?1:l.cc>e?-1:(a=l,l.end<=t?1:l.start>t?-1:0)),a||null}return null}function Oo(i){switch(i.details){case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_TIMEOUT:case H.LEVEL_LOAD_TIMEOUT:case H.MANIFEST_LOAD_TIMEOUT:return!0}return!1}function ap(i,e){const t=Oo(e);return i.default[`${t?"timeout":"error"}Retry`]}function ud(i,e){const t=i.backoff==="linear"?1:Math.pow(2,e);return Math.min(t*i.retryDelayMs,i.maxRetryDelayMs)}function op(i){return Be(Be({},i),{errorRetry:null,timeoutRetry:null})}function No(i,e,t,n){if(!i)return!1;const r=n==null?void 0:n.code,a=e<i.maxNumRetry&&(VL(r)||!!t);return i.shouldRetry?i.shouldRetry(i,e,t,n,a):a}function VL(i){return i===0&&navigator.onLine===!1||!!i&&(i<400||i>499)}var St={DoNothing:0,SendAlternateToPenaltyBox:2,RemoveAlternatePermanently:3,RetryRequest:5},hn={None:0,MoveAllAlternatesMatchingHost:1,MoveAllAlternatesMatchingHDCP:2};class HL extends gn{constructor(e){super("error-controller",e.logger),this.hls=void 0,this.playlistError=0,this.penalizedRenditions={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.ERROR,this.onError,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.ERROR,this.onError,this),e.off(L.ERROR,this.onErrorOut,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this))}destroy(){this.unregisterListeners(),this.hls=null,this.penalizedRenditions={}}startLoad(e){}stopLoad(){this.playlistError=0}getVariantLevelIndex(e){return(e==null?void 0:e.type)===pe.MAIN?e.level:this.hls.loadLevel}onManifestLoading(){this.playlistError=0,this.penalizedRenditions={}}onLevelUpdated(){this.playlistError=0}onError(e,t){var n;if(t.fatal)return;const r=this.hls,a=t.context;switch(t.details){case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:t.errorAction=this.getFragRetryOrSwitchAction(t);return;case H.FRAG_PARSING_ERROR:if((n=t.frag)!=null&&n.gap){t.errorAction=Pi();return}case H.FRAG_GAP:case H.FRAG_DECRYPT_ERROR:{t.errorAction=this.getFragRetryOrSwitchAction(t),t.errorAction.action=St.SendAlternateToPenaltyBox;return}case H.LEVEL_EMPTY_ERROR:case H.LEVEL_PARSING_ERROR:{var l,u;const c=t.parent===pe.MAIN?t.level:r.loadLevel;t.details===H.LEVEL_EMPTY_ERROR&&((l=t.context)!=null&&(u=l.levelDetails)!=null&&u.live)?t.errorAction=this.getPlaylistRetryOrSwitchAction(t,c):(t.levelRetry=!1,t.errorAction=this.getLevelSwitchAction(t,c))}return;case H.LEVEL_LOAD_ERROR:case H.LEVEL_LOAD_TIMEOUT:typeof(a==null?void 0:a.level)=="number"&&(t.errorAction=this.getPlaylistRetryOrSwitchAction(t,a.level));return;case H.AUDIO_TRACK_LOAD_ERROR:case H.AUDIO_TRACK_LOAD_TIMEOUT:case H.SUBTITLE_LOAD_ERROR:case H.SUBTITLE_TRACK_LOAD_TIMEOUT:if(a){const c=r.loadLevelObj;if(c&&(a.type===De.AUDIO_TRACK&&c.hasAudioGroup(a.groupId)||a.type===De.SUBTITLE_TRACK&&c.hasSubtitleGroup(a.groupId))){t.errorAction=this.getPlaylistRetryOrSwitchAction(t,r.loadLevel),t.errorAction.action=St.SendAlternateToPenaltyBox,t.errorAction.flags=hn.MoveAllAlternatesMatchingHost;return}}return;case H.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED:{const c=r.loadLevelObj,h=c==null?void 0:c.attrs["HDCP-LEVEL"];h?t.errorAction={action:St.SendAlternateToPenaltyBox,flags:hn.MoveAllAlternatesMatchingHDCP,hdcpLevel:h}:this.keySystemError(t)}return;case H.BUFFER_ADD_CODEC_ERROR:case H.REMUX_ALLOC_ERROR:case H.BUFFER_APPEND_ERROR:if(!t.errorAction){var f;t.errorAction=this.getLevelSwitchAction(t,(f=t.level)!=null?f:r.loadLevel)}return;case H.INTERNAL_EXCEPTION:case H.BUFFER_APPENDING_ERROR:case H.BUFFER_FULL_ERROR:case H.LEVEL_SWITCH_ERROR:case H.BUFFER_STALLED_ERROR:case H.BUFFER_SEEK_OVER_HOLE:case H.BUFFER_NUDGE_ON_STALL:t.errorAction=Pi();return}t.type===xe.KEY_SYSTEM_ERROR&&this.keySystemError(t)}keySystemError(e){const t=this.getVariantLevelIndex(e.frag);e.levelRetry=!1,e.errorAction=this.getLevelSwitchAction(e,t)}getPlaylistRetryOrSwitchAction(e,t){const n=this.hls,r=ap(n.config.playlistLoadPolicy,e),a=this.playlistError++;if(No(r,a,Oo(e),e.response))return{action:St.RetryRequest,flags:hn.None,retryConfig:r,retryCount:a};const u=this.getLevelSwitchAction(e,t);return r&&(u.retryConfig=r,u.retryCount=a),u}getFragRetryOrSwitchAction(e){const t=this.hls,n=this.getVariantLevelIndex(e.frag),r=t.levels[n],{fragLoadPolicy:a,keyLoadPolicy:l}=t.config,u=ap(e.details.startsWith("key")?l:a,e),f=t.levels.reduce((h,m)=>h+m.fragmentError,0);if(r&&(e.details!==H.FRAG_GAP&&r.fragmentError++,No(u,f,Oo(e),e.response)))return{action:St.RetryRequest,flags:hn.None,retryConfig:u,retryCount:f};const c=this.getLevelSwitchAction(e,n);return u&&(c.retryConfig=u,c.retryCount=f),c}getLevelSwitchAction(e,t){const n=this.hls;t==null&&(t=n.loadLevel);const r=this.hls.levels[t];if(r){var a,l;const c=e.details;r.loadError++,c===H.BUFFER_APPEND_ERROR&&r.fragmentError++;let h=-1;const{levels:m,loadLevel:g,minAutoLevel:E,maxAutoLevel:y}=n;!n.autoLevelEnabled&&!n.config.preserveManualLevelOnError&&(n.loadLevel=-1);const T=(a=e.frag)==null?void 0:a.type,A=(T===pe.AUDIO&&c===H.FRAG_PARSING_ERROR||e.sourceBufferName==="audio"&&(c===H.BUFFER_ADD_CODEC_ERROR||c===H.BUFFER_APPEND_ERROR))&&m.some(({audioCodec:G})=>r.audioCodec!==G),I=e.sourceBufferName==="video"&&(c===H.BUFFER_ADD_CODEC_ERROR||c===H.BUFFER_APPEND_ERROR)&&m.some(({codecSet:G,audioCodec:D})=>r.codecSet!==G&&r.audioCodec===D),{type:b,groupId:P}=(l=e.context)!=null?l:{};for(let G=m.length;G--;){const D=(G+g)%m.length;if(D!==g&&D>=E&&D<=y&&m[D].loadError===0){var u,f;const M=m[D];if(c===H.FRAG_GAP&&T===pe.MAIN&&e.frag){const B=m[D].details;if(B){const O=Hr(e.frag,B.fragments,e.frag.start);if(O!=null&&O.gap)continue}}else{if(b===De.AUDIO_TRACK&&M.hasAudioGroup(P)||b===De.SUBTITLE_TRACK&&M.hasSubtitleGroup(P))continue;if(T===pe.AUDIO&&(u=r.audioGroups)!=null&&u.some(B=>M.hasAudioGroup(B))||T===pe.SUBTITLE&&(f=r.subtitleGroups)!=null&&f.some(B=>M.hasSubtitleGroup(B))||A&&r.audioCodec===M.audioCodec||!A&&r.audioCodec!==M.audioCodec||I&&r.codecSet===M.codecSet)continue}h=D;break}}if(h>-1&&n.loadLevel!==h)return e.levelRetry=!0,this.playlistError=0,{action:St.SendAlternateToPenaltyBox,flags:hn.None,nextAutoLevel:h}}return{action:St.SendAlternateToPenaltyBox,flags:hn.MoveAllAlternatesMatchingHost}}onErrorOut(e,t){var n;switch((n=t.errorAction)==null?void 0:n.action){case St.DoNothing:break;case St.SendAlternateToPenaltyBox:this.sendAlternateToPenaltyBox(t),!t.errorAction.resolved&&t.details!==H.FRAG_GAP?t.fatal=!0:/MediaSource readyState: ended/.test(t.error.message)&&(this.warn(`MediaSource ended after "${t.sourceBufferName}" sourceBuffer append error. Attempting to recover from media error.`),this.hls.recoverMediaError());break}if(t.fatal){this.hls.stopLoad();return}}sendAlternateToPenaltyBox(e){const t=this.hls,n=e.errorAction;if(!n)return;const{flags:r,hdcpLevel:a,nextAutoLevel:l}=n;switch(r){case hn.None:this.switchLevel(e,l);break;case hn.MoveAllAlternatesMatchingHDCP:a&&(t.maxHdcpLevel=Pc[Pc.indexOf(a)-1],n.resolved=!0),this.warn(`Restricting playback to HDCP-LEVEL of "${t.maxHdcpLevel}" or lower`);break}n.resolved||this.switchLevel(e,l)}switchLevel(e,t){if(t!==void 0&&e.errorAction&&(this.warn(`switching to level ${t} after ${e.details}`),this.hls.nextAutoLevel=t,e.errorAction.resolved=!0,this.hls.nextLoadLevel=this.hls.nextAutoLevel,e.details===H.BUFFER_ADD_CODEC_ERROR&&e.mimeType&&e.sourceBufferName!=="audiovideo")){const n=Dc(e.mimeType),r=this.hls.levels;for(let a=r.length;a--;)r[a][`${e.sourceBufferName}Codec`]===n&&this.hls.removeLevel(a)}}}function Pi(i){const e={action:St.DoNothing,flags:hn.None};return i&&(e.resolved=!0),e}var ot={NOT_LOADED:"NOT_LOADED",APPENDING:"APPENDING",PARTIAL:"PARTIAL",OK:"OK"};class KL{constructor(e){this.activePartLists=Object.create(null),this.endListFragments=Object.create(null),this.fragments=Object.create(null),this.timeRanges=Object.create(null),this.bufferPadding=.2,this.hls=void 0,this.hasGaps=!1,this.hls=e,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this)}destroy(){this._unregisterListeners(),this.fragments=this.activePartLists=this.endListFragments=this.timeRanges=null}getAppendedFrag(e,t){const n=this.activePartLists[t];if(n)for(let r=n.length;r--;){const a=n[r];if(!a)break;const l=a.end;if(a.start<=e&&l!==null&&e<=l)return a}return this.getBufferedFrag(e,t)}getBufferedFrag(e,t){return this.getFragAtPos(e,t,!0)}getFragAtPos(e,t,n){const{fragments:r}=this,a=Object.keys(r);for(let l=a.length;l--;){const u=r[a[l]];if((u==null?void 0:u.body.type)===t&&(!n||u.buffered)){const f=u.body;if(f.start<=e&&e<=f.end)return f}}return null}detectEvictedFragments(e,t,n,r,a){this.timeRanges&&(this.timeRanges[e]=t);const l=(r==null?void 0:r.fragment.sn)||-1;Object.keys(this.fragments).forEach(u=>{const f=this.fragments[u];if(!f||l>=f.body.sn)return;if(!f.buffered&&(!f.loaded||a)){f.body.type===n&&this.removeFragment(f.body);return}const c=f.range[e];if(c){if(c.time.length===0){this.removeFragment(f.body);return}c.time.some(h=>{const m=!this.isTimeBuffered(h.startPTS,h.endPTS,t);return m&&this.removeFragment(f.body),m})}})}detectPartialFragments(e){const t=this.timeRanges;if(!t||e.frag.sn==="initSegment")return;const n=e.frag,r=vs(n),a=this.fragments[r];if(!a||a.buffered&&n.gap)return;const l=!n.relurl;Object.keys(t).forEach(u=>{const f=n.elementaryStreams[u];if(!f)return;const c=t[u],h=l||f.partial===!0;a.range[u]=this.getBufferedTimes(n,e.part,h,c)}),a.loaded=null,Object.keys(a.range).length?(a.buffered=!0,(a.body.endList=n.endList||a.body.endList)&&(this.endListFragments[a.body.type]=a),to(a)||this.removeParts(n.sn-1,n.type)):this.removeFragment(a.body)}removeParts(e,t){const n=this.activePartLists[t];n&&(this.activePartLists[t]=lp(n,r=>r.fragment.sn>=e))}fragBuffered(e,t){const n=vs(e);let r=this.fragments[n];!r&&t&&(r=this.fragments[n]={body:e,appendedPTS:null,loaded:null,buffered:!1,range:Object.create(null)},e.gap&&(this.hasGaps=!0)),r&&(r.loaded=null,r.buffered=!0)}getBufferedTimes(e,t,n,r){const a={time:[],partial:n},l=e.start,u=e.end,f=e.minEndPTS||u,c=e.maxStartPTS||l;for(let h=0;h<r.length;h++){const m=r.start(h)-this.bufferPadding,g=r.end(h)+this.bufferPadding;if(c>=m&&f<=g){a.time.push({startPTS:Math.max(l,r.start(h)),endPTS:Math.min(u,r.end(h))});break}else if(l<g&&u>m){const E=Math.max(l,r.start(h)),y=Math.min(u,r.end(h));y>E&&(a.partial=!0,a.time.push({startPTS:E,endPTS:y}))}else if(u<=m)break}return a}getPartialFragment(e){let t=null,n,r,a,l=0;const{bufferPadding:u,fragments:f}=this;return Object.keys(f).forEach(c=>{const h=f[c];h&&to(h)&&(r=h.body.start-u,a=h.body.end+u,e>=r&&e<=a&&(n=Math.min(e-r,a-e),l<=n&&(t=h.body,l=n)))}),t}isEndListAppended(e){const t=this.endListFragments[e];return t!==void 0&&(t.buffered||to(t))}getState(e){const t=vs(e),n=this.fragments[t];return n?n.buffered?to(n)?ot.PARTIAL:ot.OK:ot.APPENDING:ot.NOT_LOADED}isTimeBuffered(e,t,n){let r,a;for(let l=0;l<n.length;l++){if(r=n.start(l)-this.bufferPadding,a=n.end(l)+this.bufferPadding,e>=r&&t<=a)return!0;if(t<=r)return!1}return!1}onManifestLoading(){this.removeAllFragments()}onFragLoaded(e,t){if(t.frag.sn==="initSegment"||t.frag.bitrateTest)return;const n=t.frag,r=t.part?null:t,a=vs(n);this.fragments[a]={body:n,appendedPTS:null,loaded:r,buffered:!1,range:Object.create(null)}}onBufferAppended(e,t){const{frag:n,part:r,timeRanges:a,type:l}=t;if(n.sn==="initSegment")return;const u=n.type;if(r){let c=this.activePartLists[u];c||(this.activePartLists[u]=c=[]),c.push(r)}this.timeRanges=a;const f=a[l];this.detectEvictedFragments(l,f,u,r)}onFragBuffered(e,t){this.detectPartialFragments(t)}hasFragment(e){const t=vs(e);return!!this.fragments[t]}hasFragments(e){const{fragments:t}=this,n=Object.keys(t);if(!e)return n.length>0;for(let r=n.length;r--;){const a=t[n[r]];if((a==null?void 0:a.body.type)===e)return!0}return!1}hasParts(e){var t;return!!((t=this.activePartLists[e])!=null&&t.length)}removeFragmentsInRange(e,t,n,r,a){r&&!this.hasGaps||Object.keys(this.fragments).forEach(l=>{const u=this.fragments[l];if(!u)return;const f=u.body;f.type!==n||r&&!f.gap||f.start<t&&f.end>e&&(u.buffered||a)&&this.removeFragment(f)})}removeFragment(e){const t=vs(e);e.clearElementaryStreamInfo();const n=this.activePartLists[e.type];if(n){const r=e.sn;this.activePartLists[e.type]=lp(n,a=>a.fragment.sn!==r)}delete this.fragments[t],e.endList&&delete this.endListFragments[e.type]}removeAllFragments(){var e,t;this.fragments=Object.create(null),this.endListFragments=Object.create(null),this.activePartLists=Object.create(null),this.hasGaps=!1;const n=(e=this.hls)==null||(t=e.latestLevelDetails)==null?void 0:t.partList;n&&n.forEach(r=>r.clearElementaryStreamInfo())}}function to(i){var e,t,n;return i.buffered&&(i.body.gap||((e=i.range.video)==null?void 0:e.partial)||((t=i.range.audio)==null?void 0:t.partial)||((n=i.range.audiovideo)==null?void 0:n.partial))}function vs(i){return`${i.type}_${i.level}_${i.sn}`}function lp(i,e){return i.filter(t=>{const n=e(t);return n||t.clearElementaryStreamInfo(),n})}var xr={cbc:0,ctr:1};class zL{constructor(e,t,n){this.subtle=void 0,this.aesIV=void 0,this.aesMode=void 0,this.subtle=e,this.aesIV=t,this.aesMode=n}decrypt(e,t){switch(this.aesMode){case xr.cbc:return this.subtle.decrypt({name:"AES-CBC",iv:this.aesIV},t,e);case xr.ctr:return this.subtle.decrypt({name:"AES-CTR",counter:this.aesIV,length:64},t,e);default:throw new Error(`[AESCrypto] invalid aes mode ${this.aesMode}`)}}}function WL(i){const e=i.byteLength,t=e&&new DataView(i.buffer).getUint8(e-1);return t?i.slice(0,e-t):i}class YL{constructor(){this.rcon=[0,1,2,4,8,16,32,64,128,27,54],this.subMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.invSubMix=[new Uint32Array(256),new Uint32Array(256),new Uint32Array(256),new Uint32Array(256)],this.sBox=new Uint32Array(256),this.invSBox=new Uint32Array(256),this.key=new Uint32Array(0),this.ksRows=0,this.keySize=0,this.keySchedule=void 0,this.invKeySchedule=void 0,this.initTable()}uint8ArrayToUint32Array_(e){const t=new DataView(e),n=new Uint32Array(4);for(let r=0;r<4;r++)n[r]=t.getUint32(r*4);return n}initTable(){const e=this.sBox,t=this.invSBox,n=this.subMix,r=n[0],a=n[1],l=n[2],u=n[3],f=this.invSubMix,c=f[0],h=f[1],m=f[2],g=f[3],E=new Uint32Array(256);let y=0,T=0,S=0;for(S=0;S<256;S++)S<128?E[S]=S<<1:E[S]=S<<1^283;for(S=0;S<256;S++){let A=T^T<<1^T<<2^T<<3^T<<4;A=A>>>8^A&255^99,e[y]=A,t[A]=y;const w=E[y],I=E[w],b=E[I];let P=E[A]*257^A*16843008;r[y]=P<<24|P>>>8,a[y]=P<<16|P>>>16,l[y]=P<<8|P>>>24,u[y]=P,P=b*16843009^I*65537^w*257^y*16843008,c[A]=P<<24|P>>>8,h[A]=P<<16|P>>>16,m[A]=P<<8|P>>>24,g[A]=P,y?(y=w^E[E[E[b^w]]],T^=E[E[T]]):y=T=1}}expandKey(e){const t=this.uint8ArrayToUint32Array_(e);let n=!0,r=0;for(;r<t.length&&n;)n=t[r]===this.key[r],r++;if(n)return;this.key=t;const a=this.keySize=t.length;if(a!==4&&a!==6&&a!==8)throw new Error("Invalid aes key size="+a);const l=this.ksRows=(a+6+1)*4;let u,f;const c=this.keySchedule=new Uint32Array(l),h=this.invKeySchedule=new Uint32Array(l),m=this.sBox,g=this.rcon,E=this.invSubMix,y=E[0],T=E[1],S=E[2],A=E[3];let w,I;for(u=0;u<l;u++){if(u<a){w=c[u]=t[u];continue}I=w,u%a===0?(I=I<<8|I>>>24,I=m[I>>>24]<<24|m[I>>>16&255]<<16|m[I>>>8&255]<<8|m[I&255],I^=g[u/a|0]<<24):a>6&&u%a===4&&(I=m[I>>>24]<<24|m[I>>>16&255]<<16|m[I>>>8&255]<<8|m[I&255]),c[u]=w=(c[u-a]^I)>>>0}for(f=0;f<l;f++)u=l-f,f&3?I=c[u]:I=c[u-4],f<4||u<=4?h[f]=I:h[f]=y[m[I>>>24]]^T[m[I>>>16&255]]^S[m[I>>>8&255]]^A[m[I&255]],h[f]=h[f]>>>0}networkToHostOrderSwap(e){return e<<24|(e&65280)<<8|(e&16711680)>>8|e>>>24}decrypt(e,t,n){const r=this.keySize+6,a=this.invKeySchedule,l=this.invSBox,u=this.invSubMix,f=u[0],c=u[1],h=u[2],m=u[3],g=this.uint8ArrayToUint32Array_(n);let E=g[0],y=g[1],T=g[2],S=g[3];const A=new Int32Array(e),w=new Int32Array(A.length);let I,b,P,G,D,M,B,O,X,re,de,ae,oe,ie;const ee=this.networkToHostOrderSwap;for(;t<A.length;){for(X=ee(A[t]),re=ee(A[t+1]),de=ee(A[t+2]),ae=ee(A[t+3]),D=X^a[0],M=ae^a[1],B=de^a[2],O=re^a[3],oe=4,ie=1;ie<r;ie++)I=f[D>>>24]^c[M>>16&255]^h[B>>8&255]^m[O&255]^a[oe],b=f[M>>>24]^c[B>>16&255]^h[O>>8&255]^m[D&255]^a[oe+1],P=f[B>>>24]^c[O>>16&255]^h[D>>8&255]^m[M&255]^a[oe+2],G=f[O>>>24]^c[D>>16&255]^h[M>>8&255]^m[B&255]^a[oe+3],D=I,M=b,B=P,O=G,oe=oe+4;I=l[D>>>24]<<24^l[M>>16&255]<<16^l[B>>8&255]<<8^l[O&255]^a[oe],b=l[M>>>24]<<24^l[B>>16&255]<<16^l[O>>8&255]<<8^l[D&255]^a[oe+1],P=l[B>>>24]<<24^l[O>>16&255]<<16^l[D>>8&255]<<8^l[M&255]^a[oe+2],G=l[O>>>24]<<24^l[D>>16&255]<<16^l[M>>8&255]<<8^l[B&255]^a[oe+3],w[t]=ee(I^E),w[t+1]=ee(G^y),w[t+2]=ee(P^T),w[t+3]=ee(b^S),E=X,y=re,T=de,S=ae,t=t+4}return w.buffer}}class qL{constructor(e,t,n){this.subtle=void 0,this.key=void 0,this.aesMode=void 0,this.subtle=e,this.key=t,this.aesMode=n}expandKey(){const e=XL(this.aesMode);return this.subtle.importKey("raw",this.key,{name:e},!1,["encrypt","decrypt"])}}function XL(i){switch(i){case xr.cbc:return"AES-CBC";case xr.ctr:return"AES-CTR";default:throw new Error(`[FastAESKey] invalid aes mode ${i}`)}}const QL=16;class cd{constructor(e,{removePKCS7Padding:t=!0}={}){if(this.logEnabled=!0,this.removePKCS7Padding=void 0,this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null,this.useSoftware=void 0,this.enableSoftwareAES=void 0,this.enableSoftwareAES=e.enableSoftwareAES,this.removePKCS7Padding=t,t)try{const n=self.crypto;n&&(this.subtle=n.subtle||n.webkitSubtle)}catch{}this.useSoftware=!this.subtle}destroy(){this.subtle=null,this.softwareDecrypter=null,this.key=null,this.fastAesKey=null,this.remainderData=null,this.currentIV=null,this.currentResult=null}isSync(){return this.useSoftware}flush(){const{currentResult:e,remainderData:t}=this;if(!e||t)return this.reset(),null;const n=new Uint8Array(e);return this.reset(),this.removePKCS7Padding?WL(n):n}reset(){this.currentResult=null,this.currentIV=null,this.remainderData=null,this.softwareDecrypter&&(this.softwareDecrypter=null)}decrypt(e,t,n,r){return this.useSoftware?new Promise((a,l)=>{const u=ArrayBuffer.isView(e)?e:new Uint8Array(e);this.softwareDecrypt(u,t,n,r);const f=this.flush();f?a(f.buffer):l(new Error("[softwareDecrypt] Failed to decrypt data"))}):this.webCryptoDecrypt(new Uint8Array(e),t,n,r)}softwareDecrypt(e,t,n,r){const{currentIV:a,currentResult:l,remainderData:u}=this;if(r!==xr.cbc||t.byteLength!==16)return Fe.warn("SoftwareDecrypt: can only handle AES-128-CBC"),null;this.logOnce("JS AES decrypt"),u&&(e=en(u,e),this.remainderData=null);const f=this.getValidChunk(e);if(!f.length)return null;a&&(n=a);let c=this.softwareDecrypter;c||(c=this.softwareDecrypter=new YL),c.expandKey(t);const h=l;return this.currentResult=c.decrypt(f.buffer,0,n),this.currentIV=f.slice(-16).buffer,h||null}webCryptoDecrypt(e,t,n,r){if(this.key!==t||!this.fastAesKey){if(!this.subtle)return Promise.resolve(this.onWebCryptoError(e,t,n,r));this.key=t,this.fastAesKey=new qL(this.subtle,t,r)}return this.fastAesKey.expandKey().then(a=>this.subtle?(this.logOnce("WebCrypto AES decrypt"),new zL(this.subtle,new Uint8Array(n),r).decrypt(e.buffer,a)):Promise.reject(new Error("web crypto not initialized"))).catch(a=>(Fe.warn(`[decrypter]: WebCrypto Error, disable WebCrypto API, ${a.name}: ${a.message}`),this.onWebCryptoError(e,t,n,r)))}onWebCryptoError(e,t,n,r){const a=this.enableSoftwareAES;if(a){this.useSoftware=!0,this.logEnabled=!0,this.softwareDecrypt(e,t,n,r);const l=this.flush();if(l)return l.buffer}throw new Error("WebCrypto"+(a?" and softwareDecrypt":"")+": failed to decrypt data")}getValidChunk(e){let t=e;const n=e.length-e.length%QL;return n!==e.length&&(t=e.slice(0,n),this.remainderData=e.slice(n)),t}logOnce(e){this.logEnabled&&(Fe.log(`[decrypter]: ${e}`),this.logEnabled=!1)}}const up=Math.pow(2,17);class JL{constructor(e){this.config=void 0,this.loader=null,this.partLoadTimeout=-1,this.config=e}destroy(){this.loader&&(this.loader.destroy(),this.loader=null)}abort(){this.loader&&this.loader.abort()}load(e,t){const n=e.url;if(!n)return Promise.reject(new Gn({type:xe.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,error:new Error(`Fragment does not have a ${n?"part list":"url"}`),networkDetails:null}));this.abort();const r=this.config,a=r.fLoader,l=r.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap)if(e.tagList.some(y=>y[0]==="GAP")){f(dp(e));return}else e.gap=!1;const c=this.loader=a?new a(r):new l(r),h=cp(e);e.loader=c;const m=op(r.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:e.sn==="initSegment"?1/0:up};e.stats=c.stats;const E={onSuccess:(y,T,S,A)=>{this.resetLoader(e,c);let w=y.data;S.resetIV&&e.decryptdata&&(e.decryptdata.iv=new Uint8Array(w.slice(0,16)),w=w.slice(16)),u({frag:e,part:null,payload:w,networkDetails:A})},onError:(y,T,S,A)=>{this.resetLoader(e,c),f(new Gn({type:xe.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,response:Be({url:n,data:void 0},y),error:new Error(`HTTP Error ${y.code} ${y.text}`),networkDetails:S,stats:A}))},onAbort:(y,T,S)=>{this.resetLoader(e,c),f(new Gn({type:xe.NETWORK_ERROR,details:H.INTERNAL_ABORTED,fatal:!1,frag:e,error:new Error("Aborted"),networkDetails:S,stats:y}))},onTimeout:(y,T,S)=>{this.resetLoader(e,c),f(new Gn({type:xe.NETWORK_ERROR,details:H.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:S,stats:y}))}};t&&(E.onProgress=(y,T,S,A)=>t({frag:e,part:null,payload:S,networkDetails:A})),c.load(h,g,E)})}loadPart(e,t,n){this.abort();const r=this.config,a=r.fLoader,l=r.loader;return new Promise((u,f)=>{if(this.loader&&this.loader.destroy(),e.gap||t.gap){f(dp(e,t));return}const c=this.loader=a?new a(r):new l(r),h=cp(e,t);e.loader=c;const m=op(r.fragLoadPolicy.default),g={loadPolicy:m,timeout:m.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0,highWaterMark:up};t.stats=c.stats,c.load(h,g,{onSuccess:(E,y,T,S)=>{this.resetLoader(e,c),this.updateStatsFromPart(e,t);const A={frag:e,part:t,payload:E.data,networkDetails:S};n(A),u(A)},onError:(E,y,T,S)=>{this.resetLoader(e,c),f(new Gn({type:xe.NETWORK_ERROR,details:H.FRAG_LOAD_ERROR,fatal:!1,frag:e,part:t,response:Be({url:h.url,data:void 0},E),error:new Error(`HTTP Error ${E.code} ${E.text}`),networkDetails:T,stats:S}))},onAbort:(E,y,T)=>{e.stats.aborted=t.stats.aborted,this.resetLoader(e,c),f(new Gn({type:xe.NETWORK_ERROR,details:H.INTERNAL_ABORTED,fatal:!1,frag:e,part:t,error:new Error("Aborted"),networkDetails:T,stats:E}))},onTimeout:(E,y,T)=>{this.resetLoader(e,c),f(new Gn({type:xe.NETWORK_ERROR,details:H.FRAG_LOAD_TIMEOUT,fatal:!1,frag:e,part:t,error:new Error(`Timeout after ${g.timeout}ms`),networkDetails:T,stats:E}))}})})}updateStatsFromPart(e,t){const n=e.stats,r=t.stats,a=r.total;if(n.loaded+=r.loaded,a){const f=Math.round(e.duration/t.duration),c=Math.min(Math.round(n.loaded/a),f),m=(f-c)*Math.round(n.loaded/c);n.total=n.loaded+m}else n.total=Math.max(n.loaded,n.total);const l=n.loading,u=r.loading;l.start?l.first+=u.first-u.start:(l.start=u.start,l.first=u.first),l.end=u.end}resetLoader(e,t){e.loader=null,this.loader===t&&(self.clearTimeout(this.partLoadTimeout),this.loader=null),t.destroy()}}function cp(i,e=null){const t=e||i,n={frag:i,part:e,responseType:"arraybuffer",url:t.url,headers:{},rangeStart:0,rangeEnd:0},r=t.byteRangeStartOffset,a=t.byteRangeEndOffset;if(ce(r)&&ce(a)){var l;let u=r,f=a;if(i.sn==="initSegment"&&ZL((l=i.decryptdata)==null?void 0:l.method)){const c=a-r;c%16&&(f=a+(16-c%16)),r!==0&&(n.resetIV=!0,u=r-16)}n.rangeStart=u,n.rangeEnd=f}return n}function dp(i,e){const t=new Error(`GAP ${i.gap?"tag":"attribute"} found`),n={type:xe.MEDIA_ERROR,details:H.FRAG_GAP,fatal:!1,frag:i,error:t,networkDetails:null};return e&&(n.part=e),(e||i).stats.aborted=!0,new Gn(n)}function ZL(i){return i==="AES-128"||i==="AES-256"}class Gn extends Error{constructor(e){super(e.error.message),this.data=void 0,this.data=e}}class p0 extends gn{constructor(e,t){super(e,t),this._boundTick=void 0,this._tickTimer=null,this._tickInterval=null,this._tickCallCount=0,this._boundTick=this.tick.bind(this)}destroy(){this.onHandlerDestroying(),this.onHandlerDestroyed()}onHandlerDestroying(){this.clearNextTick(),this.clearInterval()}onHandlerDestroyed(){}hasInterval(){return!!this._tickInterval}hasNextTick(){return!!this._tickTimer}setInterval(e){return this._tickInterval?!1:(this._tickCallCount=0,this._tickInterval=self.setInterval(this._boundTick,e),!0)}clearInterval(){return this._tickInterval?(self.clearInterval(this._tickInterval),this._tickInterval=null,!0):!1}clearNextTick(){return this._tickTimer?(self.clearTimeout(this._tickTimer),this._tickTimer=null,!0):!1}tick(){this._tickCallCount++,this._tickCallCount===1&&(this.doTick(),this._tickCallCount>1&&this.tickImmediate(),this._tickCallCount=0)}tickImmediate(){this.clearNextTick(),this._tickTimer=self.setTimeout(this._boundTick,0)}doTick(){}}class dd{constructor(e,t,n,r=0,a=-1,l=!1){this.level=void 0,this.sn=void 0,this.part=void 0,this.id=void 0,this.size=void 0,this.partial=void 0,this.transmuxing=no(),this.buffering={audio:no(),video:no(),audiovideo:no()},this.level=e,this.sn=t,this.id=n,this.size=r,this.part=a,this.partial=l}}function no(){return{start:0,executeStart:0,executeEnd:0,end:0}}const fp={length:0,start:()=>0,end:()=>0};class Ie{static isBuffered(e,t){if(e){const n=Ie.getBuffered(e);for(let r=n.length;r--;)if(t>=n.start(r)&&t<=n.end(r))return!0}return!1}static bufferedRanges(e){if(e){const t=Ie.getBuffered(e);return Ie.timeRangesToArray(t)}return[]}static timeRangesToArray(e){const t=[];for(let n=0;n<e.length;n++)t.push({start:e.start(n),end:e.end(n)});return t}static bufferInfo(e,t,n){if(e){const r=Ie.bufferedRanges(e);if(r.length)return Ie.bufferedInfo(r,t,n)}return{len:0,start:t,end:t,bufferedIndex:-1}}static bufferedInfo(e,t,n){t=Math.max(0,t),e.length>1&&e.sort((h,m)=>h.start-m.start||m.end-h.end);let r=-1,a=[];if(n)for(let h=0;h<e.length;h++){t>=e[h].start&&t<=e[h].end&&(r=h);const m=a.length;if(m){const g=a[m-1].end;e[h].start-g<n?e[h].end>g&&(a[m-1].end=e[h].end):a.push(e[h])}else a.push(e[h])}else a=e;let l=0,u,f=t,c=t;for(let h=0;h<a.length;h++){const m=a[h].start,g=a[h].end;if(r===-1&&t>=m&&t<=g&&(r=h),t+n>=m&&t<g)f=m,c=g,l=c-t;else if(t+n<m){u=m;break}}return{len:l,start:f||0,end:c||0,nextStart:u,buffered:e,bufferedIndex:r}}static getBuffered(e){try{return e.buffered||fp}catch(t){return Fe.log("failed to get media.buffered",t),fp}}}const g0=/\{\$([a-zA-Z0-9-_]+)\}/g;function hp(i){return g0.test(i)}function Oc(i,e){if(i.variableList!==null||i.hasVariableRefs){const t=i.variableList;return e.replace(g0,n=>{const r=n.substring(2,n.length-1),a=t==null?void 0:t[r];return a===void 0?(i.playlistParsingError||(i.playlistParsingError=new Error(`Missing preceding EXT-X-DEFINE tag for Variable Reference: "${r}"`)),n):a})}return e}function mp(i,e,t){let n=i.variableList;n||(i.variableList=n={});let r,a;if("QUERYPARAM"in e){r=e.QUERYPARAM;try{const l=new self.URL(t).searchParams;if(l.has(r))a=l.get(r);else throw new Error(`"${r}" does not match any query parameter in URI: "${t}"`)}catch(l){i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE QUERYPARAM: ${l.message}`))}}else r=e.NAME,a=e.VALUE;r in n?i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE duplicate Variable Name declarations: "${r}"`)):n[r]=a||""}function eA(i,e,t){const n=e.IMPORT;if(t&&n in t){let r=i.variableList;r||(i.variableList=r={}),r[n]=t[n]}else i.playlistParsingError||(i.playlistParsingError=new Error(`EXT-X-DEFINE IMPORT attribute not found in Multivariant Playlist: "${n}"`))}const tA=/^(\d+)x(\d+)$/,pp=/(.+?)=(".*?"|.*?)(?:,|$)/g;class qe{constructor(e,t){typeof e=="string"&&(e=qe.parseAttrList(e,t)),Ue(this,e)}get clientAttrs(){return Object.keys(this).filter(e=>e.substring(0,2)==="X-")}decimalInteger(e){const t=parseInt(this[e],10);return t>Number.MAX_SAFE_INTEGER?1/0:t}hexadecimalInteger(e){if(this[e]){let t=(this[e]||"0x").slice(2);t=(t.length&1?"0":"")+t;const n=new Uint8Array(t.length/2);for(let r=0;r<t.length/2;r++)n[r]=parseInt(t.slice(r*2,r*2+2),16);return n}return null}hexadecimalIntegerAsNumber(e){const t=parseInt(this[e],16);return t>Number.MAX_SAFE_INTEGER?1/0:t}decimalFloatingPoint(e){return parseFloat(this[e])}optionalFloat(e,t){const n=this[e];return n?parseFloat(n):t}enumeratedString(e){return this[e]}enumeratedStringList(e,t){const n=this[e];return(n?n.split(/[ ,]+/):[]).reduce((r,a)=>(r[a.toLowerCase()]=!0,r),t)}bool(e){return this[e]==="YES"}decimalResolution(e){const t=tA.exec(this[e]);if(t!==null)return{width:parseInt(t[1],10),height:parseInt(t[2],10)}}static parseAttrList(e,t){let n;const r={},a='"';for(pp.lastIndex=0;(n=pp.exec(e))!==null;){const l=n[1].trim();let u=n[2];const f=u.indexOf(a)===0&&u.lastIndexOf(a)===u.length-1;let c=!1;if(f)u=u.slice(1,-1);else switch(l){case"IV":case"SCTE35-CMD":case"SCTE35-IN":case"SCTE35-OUT":c=!0}if(t&&(f||c))u=Oc(t,u);else if(!c&&!f)switch(l){case"CLOSED-CAPTIONS":if(u==="NONE")break;case"ALLOWED-CPC":case"CLASS":case"ASSOC-LANGUAGE":case"AUDIO":case"BYTERANGE":case"CHANNELS":case"CHARACTERISTICS":case"CODECS":case"DATA-ID":case"END-DATE":case"GROUP-ID":case"ID":case"IMPORT":case"INSTREAM-ID":case"KEYFORMAT":case"KEYFORMATVERSIONS":case"LANGUAGE":case"NAME":case"PATHWAY-ID":case"QUERYPARAM":case"RECENTLY-REMOVED-DATERANGES":case"SERVER-URI":case"STABLE-RENDITION-ID":case"STABLE-VARIANT-ID":case"START-DATE":case"SUBTITLES":case"SUPPLEMENTAL-CODECS":case"URI":case"VALUE":case"VIDEO":case"X-ASSET-LIST":case"X-ASSET-URI":Fe.warn(`${e}: attribute ${l} is missing quotes`)}r[l]=u}return r}}const nA="com.apple.hls.interstitial";function rA(i){return i!=="ID"&&i!=="CLASS"&&i!=="CUE"&&i!=="START-DATE"&&i!=="DURATION"&&i!=="END-DATE"&&i!=="END-ON-NEXT"}function sA(i){return i==="SCTE35-OUT"||i==="SCTE35-IN"||i==="SCTE35-CMD"}class y0{constructor(e,t,n=0){var r;if(this.attr=void 0,this.tagAnchor=void 0,this.tagOrder=void 0,this._startDate=void 0,this._endDate=void 0,this._dateAtEnd=void 0,this._cue=void 0,this._badValueForSameId=void 0,this.tagAnchor=(t==null?void 0:t.tagAnchor)||null,this.tagOrder=(r=t==null?void 0:t.tagOrder)!=null?r:n,t){const a=t.attr;for(const l in a)if(Object.prototype.hasOwnProperty.call(e,l)&&e[l]!==a[l]){Fe.warn(`DATERANGE tag attribute: "${l}" does not match for tags with ID: "${e.ID}"`),this._badValueForSameId=l;break}e=Ue(new qe({}),a,e)}if(this.attr=e,t?(this._startDate=t._startDate,this._cue=t._cue,this._endDate=t._endDate,this._dateAtEnd=t._dateAtEnd):this._startDate=new Date(e["START-DATE"]),"END-DATE"in this.attr){const a=(t==null?void 0:t.endDate)||new Date(this.attr["END-DATE"]);ce(a.getTime())&&(this._endDate=a)}}get id(){return this.attr.ID}get class(){return this.attr.CLASS}get cue(){const e=this._cue;return e===void 0?this._cue=this.attr.enumeratedStringList(this.attr.CUE?"CUE":"X-CUE",{pre:!1,post:!1,once:!1}):e}get startTime(){const{tagAnchor:e}=this;return e===null||e.programDateTime===null?(Fe.warn(`Expected tagAnchor Fragment with PDT set for DateRange "${this.id}": ${e}`),NaN):e.start+(this.startDate.getTime()-e.programDateTime)/1e3}get startDate(){return this._startDate}get endDate(){const e=this._endDate||this._dateAtEnd;if(e)return e;const t=this.duration;return t!==null?this._dateAtEnd=new Date(this._startDate.getTime()+t*1e3):null}get duration(){if("DURATION"in this.attr){const e=this.attr.decimalFloatingPoint("DURATION");if(ce(e))return e}else if(this._endDate)return(this._endDate.getTime()-this._startDate.getTime())/1e3;return null}get plannedDuration(){return"PLANNED-DURATION"in this.attr?this.attr.decimalFloatingPoint("PLANNED-DURATION"):null}get endOnNext(){return this.attr.bool("END-ON-NEXT")}get isInterstitial(){return this.class===nA}get isValid(){return!!this.id&&!this._badValueForSameId&&ce(this.startDate.getTime())&&(this.duration===null||this.duration>=0)&&(!this.endOnNext||!!this.class)&&(!this.attr.CUE||!this.cue.pre&&!this.cue.post||this.cue.pre!==this.cue.post)&&(!this.isInterstitial||"X-ASSET-URI"in this.attr||"X-ASSET-LIST"in this.attr)}}const iA=10;class aA{constructor(e){this.PTSKnown=!1,this.alignedSliding=!1,this.averagetargetduration=void 0,this.endCC=0,this.endSN=0,this.fragments=void 0,this.fragmentHint=void 0,this.partList=null,this.dateRanges=void 0,this.dateRangeTagCount=0,this.live=!0,this.requestScheduled=-1,this.ageHeader=0,this.advancedDateTime=void 0,this.updated=!0,this.advanced=!0,this.misses=0,this.startCC=0,this.startSN=0,this.startTimeOffset=null,this.targetduration=0,this.totalduration=0,this.type=null,this.url=void 0,this.m3u8="",this.version=null,this.canBlockReload=!1,this.canSkipUntil=0,this.canSkipDateRanges=!1,this.skippedSegments=0,this.recentlyRemovedDateranges=void 0,this.partHoldBack=0,this.holdBack=0,this.partTarget=0,this.preloadHint=void 0,this.renditionReports=void 0,this.tuneInGoal=0,this.deltaUpdateFailed=void 0,this.driftStartTime=0,this.driftEndTime=0,this.driftStart=0,this.driftEnd=0,this.encryptedFragments=void 0,this.playlistParsingError=null,this.variableList=null,this.hasVariableRefs=!1,this.appliedTimelineOffset=void 0,this.fragments=[],this.encryptedFragments=[],this.dateRanges={},this.url=e}reloaded(e){if(!e){this.advanced=!0,this.updated=!0;return}const t=this.lastPartSn-e.lastPartSn,n=this.lastPartIndex-e.lastPartIndex;this.updated=this.endSN!==e.endSN||!!n||!!t||!this.live,this.advanced=this.endSN>e.endSN||t>0||t===0&&n>0,this.updated||this.advanced?this.misses=Math.floor(e.misses*.6):this.misses=e.misses+1}get hasProgramDateTime(){return this.fragments.length?ce(this.fragments[this.fragments.length-1].programDateTime):!1}get levelTargetDuration(){return this.averagetargetduration||this.targetduration||iA}get drift(){const e=this.driftEndTime-this.driftStartTime;return e>0?(this.driftEnd-this.driftStart)*1e3/e:1}get edge(){return this.partEnd||this.fragmentEnd}get partEnd(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].end:this.fragmentEnd}get fragmentEnd(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[this.fragments.length-1].end:0}get fragmentStart(){var e;return(e=this.fragments)!=null&&e.length?this.fragments[0].start:0}get age(){return this.advancedDateTime?Math.max(Date.now()-this.advancedDateTime,0)/1e3:0}get lastPartIndex(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].index:-1}get maxPartIndex(){const e=this.partList;if(e){const t=this.lastPartIndex;if(t!==-1){for(let n=e.length;n--;)if(e[n].index>t)return e[n].index;return t}}return 0}get lastPartSn(){var e;return(e=this.partList)!=null&&e.length?this.partList[this.partList.length-1].fragment.sn:this.endSN}get expired(){if(this.live&&this.age&&this.misses<3){const e=this.partEnd-this.fragmentStart;return this.age>Math.max(e,this.totalduration)+this.levelTargetDuration}return!1}}function As(i){return i==="AES-128"||i==="AES-256"||i==="AES-256-CTR"}function fd(i){switch(i){case"AES-128":case"AES-256":return xr.cbc;case"AES-256-CTR":return xr.ctr;default:throw new Error(`invalid full segment method ${i}`)}}function v0(i){return Uint8Array.from(atob(i),e=>e.charCodeAt(0))}function Nc(i){return Uint8Array.from(unescape(encodeURIComponent(i)),e=>e.charCodeAt(0))}function oA(i){const e=Nc(i).subarray(0,16),t=new Uint8Array(16);return t.set(e,16-e.length),t}function lA(i){const e=function(n,r,a){const l=n[r];n[r]=n[a],n[a]=l};e(i,0,3),e(i,1,2),e(i,4,5),e(i,6,7)}function uA(i){const e=i.split(":");let t=null;if(e[0]==="data"&&e.length===2){const n=e[1].split(";"),r=n[n.length-1].split(",");if(r.length===2){const a=r[0]==="base64",l=r[1];a?(n.splice(-1,1),t=v0(l)):t=oA(l)}}return t}const Fo=typeof self<"u"?self:void 0;var et={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.fps",PLAYREADY:"com.microsoft.playready",WIDEVINE:"com.widevine.alpha"},Pt={CLEARKEY:"org.w3.clearkey",FAIRPLAY:"com.apple.streamingkeydelivery",PLAYREADY:"com.microsoft.playready",WIDEVINE:"urn:uuid:edef8ba9-79d6-4ace-a3c8-27dcd51d21ed"};function Fc(i){switch(i){case Pt.FAIRPLAY:return et.FAIRPLAY;case Pt.PLAYREADY:return et.PLAYREADY;case Pt.WIDEVINE:return et.WIDEVINE;case Pt.CLEARKEY:return et.CLEARKEY}}function gp(i){switch(i){case et.FAIRPLAY:return Pt.FAIRPLAY;case et.PLAYREADY:return Pt.PLAYREADY;case et.WIDEVINE:return Pt.WIDEVINE;case et.CLEARKEY:return Pt.CLEARKEY}}function xo(i){const{drmSystems:e,widevineLicenseUrl:t}=i,n=e?[et.FAIRPLAY,et.WIDEVINE,et.PLAYREADY,et.CLEARKEY].filter(r=>!!e[r]):[];return!n[et.WIDEVINE]&&t&&n.push(et.WIDEVINE),n}const E0=function(i){return Fo!=null&&(i=Fo.navigator)!=null&&i.requestMediaKeySystemAccess?self.navigator.requestMediaKeySystemAccess.bind(self.navigator):null}();function cA(i,e,t,n){let r;switch(i){case et.FAIRPLAY:r=["cenc","sinf"];break;case et.WIDEVINE:case et.PLAYREADY:r=["cenc"];break;case et.CLEARKEY:r=["cenc","keyids"];break;default:throw new Error(`Unknown key-system: ${i}`)}return dA(r,e,t,n)}function dA(i,e,t,n){return[{initDataTypes:i,persistentState:n.persistentState||"optional",distinctiveIdentifier:n.distinctiveIdentifier||"optional",sessionTypes:n.sessionTypes||[n.sessionType||"temporary"],audioCapabilities:e.map(a=>({contentType:`audio/mp4; codecs=${a}`,robustness:n.audioRobustness||"",encryptionScheme:n.audioEncryptionScheme||null})),videoCapabilities:t.map(a=>({contentType:`video/mp4; codecs=${a}`,robustness:n.videoRobustness||"",encryptionScheme:n.videoEncryptionScheme||null}))}]}function fA(i){var e;return i.sessionType==="persistent-license"||!!((e=i.sessionTypes)!=null&&e.some(t=>t==="persistent-license"))}function hA(i){const e=new Uint16Array(i.buffer,i.byteOffset,i.byteLength/2),t=String.fromCharCode.apply(null,Array.from(e)),n=t.substring(t.indexOf("<"),t.length),l=new DOMParser().parseFromString(n,"text/xml").getElementsByTagName("KID")[0];if(l){const u=l.childNodes[0]?l.childNodes[0].nodeValue:l.getAttribute("VALUE");if(u){const f=v0(u).subarray(0,16);return lA(f),f}}return null}let ro={};class Qo{static clearKeyUriToKeyIdMap(){ro={}}constructor(e,t,n,r=[1],a=null,l){this.uri=void 0,this.method=void 0,this.keyFormat=void 0,this.keyFormatVersions=void 0,this.encrypted=void 0,this.isCommonEncryption=void 0,this.iv=null,this.key=null,this.keyId=null,this.pssh=null,this.method=e,this.uri=t,this.keyFormat=n,this.keyFormatVersions=r,this.iv=a,this.encrypted=e?e!=="NONE":!1,this.isCommonEncryption=this.encrypted&&!As(e),l!=null&&l.startsWith("0x")&&(this.keyId=new Uint8Array(Zg(l)))}matches(e){var t,n;return e.uri===this.uri&&e.method===this.method&&e.encrypted===this.encrypted&&e.keyFormat===this.keyFormat&&e.keyFormatVersions.join(",")===this.keyFormatVersions.join(",")&&((t=e.iv)==null?void 0:t.join(","))===((n=this.iv)==null?void 0:n.join(","))}isSupported(){if(this.method){if(As(this.method)||this.method==="NONE")return!0;if(this.keyFormat==="identity")return this.method==="SAMPLE-AES";switch(this.keyFormat){case Pt.FAIRPLAY:case Pt.WIDEVINE:case Pt.PLAYREADY:case Pt.CLEARKEY:return["ISO-23001-7","SAMPLE-AES","SAMPLE-AES-CENC","SAMPLE-AES-CTR"].indexOf(this.method)!==-1}}return!1}getDecryptData(e){if(!this.encrypted||!this.uri)return null;if(As(this.method)&&this.uri&&!this.iv){typeof e!="number"&&(Fe.warn(`missing IV for initialization segment with method="${this.method}" - compliance issue`),e=0);const n=mA(e);return new Qo(this.method,this.uri,"identity",this.keyFormatVersions,n)}if(this.pssh&&this.keyId)return this;const t=uA(this.uri);if(t)switch(this.keyFormat){case Pt.WIDEVINE:if(this.pssh=t,!this.keyId&&t.length>=22){const n=t.length-22;this.keyId=t.subarray(n,n+16)}break;case Pt.PLAYREADY:{const n=new Uint8Array([154,4,240,121,152,64,66,134,171,146,230,91,224,136,95,149]);this.pssh=vL(n,null,t),this.keyId=hA(t);break}default:{let n=t.subarray(0,16);if(n.length!==16){const r=new Uint8Array(16);r.set(n,16-n.length),n=r}this.keyId=n;break}}if(!this.keyId||this.keyId.byteLength!==16){let n=ro[this.uri];if(!n){const r=Object.keys(ro).length%Number.MAX_SAFE_INTEGER;n=new Uint8Array(16),new DataView(n.buffer,12,4).setUint32(0,r),ro[this.uri]=n}this.keyId=n}return this}}function mA(i){const e=new Uint8Array(16);for(let t=12;t<16;t++)e[t]=i>>8*(15-t)&255;return e}const yp=/#EXT-X-STREAM-INF:([^\r\n]*)(?:[\r\n](?:#[^\r\n]*)?)*([^\r\n]+)|#EXT-X-(SESSION-DATA|SESSION-KEY|DEFINE|CONTENT-STEERING|START):([^\r\n]*)[\r\n]+/g,vp=/#EXT-X-MEDIA:(.*)/g,pA=/^#EXT(?:INF|-X-TARGETDURATION):/m,nc=new RegExp([/#EXTINF:\s*(\d*(?:\.\d+)?)(?:,(.*)\s+)?/.source,/(?!#) *(\S[^\r\n]*)/.source,/#.*/.source].join("|"),"g"),gA=new RegExp([/#EXT-X-(PROGRAM-DATE-TIME|BYTERANGE|DATERANGE|DEFINE|KEY|MAP|PART|PART-INF|PLAYLIST-TYPE|PRELOAD-HINT|RENDITION-REPORT|SERVER-CONTROL|SKIP|START):(.+)/.source,/#EXT-X-(BITRATE|DISCONTINUITY-SEQUENCE|MEDIA-SEQUENCE|TARGETDURATION|VERSION): *(\d+)/.source,/#EXT-X-(DISCONTINUITY|ENDLIST|GAP|INDEPENDENT-SEGMENTS)/.source,/(#)([^:]*):(.*)/.source,/(#)(.*)(?:.*)\r?\n?/.source].join("|"));class wn{static findGroup(e,t){for(let n=0;n<e.length;n++){const r=e[n];if(r.id===t)return r}}static resolve(e,t){return sd.buildAbsoluteURL(t,e,{alwaysNormalize:!0})}static isMediaPlaylist(e){return pA.test(e)}static parseMasterPlaylist(e,t){const n=hp(e),r={contentSteering:null,levels:[],playlistParsingError:null,sessionData:null,sessionKeys:null,startTimeOffset:null,variableList:null,hasVariableRefs:n},a=[];yp.lastIndex=0;let l;for(;(l=yp.exec(e))!=null;)if(l[1]){var u;const c=new qe(l[1],r),h=Oc(r,l[2]),m={attrs:c,bitrate:c.decimalInteger("BANDWIDTH")||c.decimalInteger("AVERAGE-BANDWIDTH"),name:c.NAME,url:wn.resolve(h,t)},g=c.decimalResolution("RESOLUTION");g&&(m.width=g.width,m.height=g.height),Sp(c.CODECS,m);const E=c["SUPPLEMENTAL-CODECS"];E&&(m.supplemental={},Sp(E,m.supplemental)),(u=m.unknownCodecs)!=null&&u.length||a.push(m),r.levels.push(m)}else if(l[3]){const c=l[3],h=l[4];switch(c){case"SESSION-DATA":{const m=new qe(h,r),g=m["DATA-ID"];g&&(r.sessionData===null&&(r.sessionData={}),r.sessionData[g]=m);break}case"SESSION-KEY":{const m=Ep(h,t,r);m.encrypted&&m.isSupported()?(r.sessionKeys===null&&(r.sessionKeys=[]),r.sessionKeys.push(m)):Fe.warn(`[Keys] Ignoring invalid EXT-X-SESSION-KEY tag: "${h}"`);break}case"DEFINE":{{const m=new qe(h,r);mp(r,m,t)}break}case"CONTENT-STEERING":{const m=new qe(h,r);r.contentSteering={uri:wn.resolve(m["SERVER-URI"],t),pathwayId:m["PATHWAY-ID"]||"."};break}case"START":{r.startTimeOffset=xp(h);break}}}const f=a.length>0&&a.length<r.levels.length;return r.levels=f?a:r.levels,r.levels.length===0&&(r.playlistParsingError=new Error("no levels found in manifest")),r}static parseMasterPlaylistMedia(e,t,n){let r;const a={},l=n.levels,u={AUDIO:l.map(c=>({id:c.attrs.AUDIO,audioCodec:c.audioCodec})),SUBTITLES:l.map(c=>({id:c.attrs.SUBTITLES,textCodec:c.textCodec})),"CLOSED-CAPTIONS":[]};let f=0;for(vp.lastIndex=0;(r=vp.exec(e))!==null;){const c=new qe(r[1],n),h=c.TYPE;if(h){const m=u[h],g=a[h]||[];a[h]=g;const E=c.LANGUAGE,y=c["ASSOC-LANGUAGE"],T=c.CHANNELS,S=c.CHARACTERISTICS,A=c["INSTREAM-ID"],w={attrs:c,bitrate:0,id:f++,groupId:c["GROUP-ID"]||"",name:c.NAME||E||"",type:h,default:c.bool("DEFAULT"),autoselect:c.bool("AUTOSELECT"),forced:c.bool("FORCED"),lang:E,url:c.URI?wn.resolve(c.URI,t):""};if(y&&(w.assocLang=y),T&&(w.channels=T),S&&(w.characteristics=S),A&&(w.instreamId=A),m!=null&&m.length){const I=wn.findGroup(m,w.groupId)||m[0];Tp(w,I,"audioCodec"),Tp(w,I,"textCodec")}g.push(w)}}return a}static parseLevelPlaylist(e,t,n,r,a,l){var u;const f={url:t},c=new aA(t),h=c.fragments,m=[];let g=null,E=0,y=0,T=0,S=0,A=0,w=null,I=new Zu(r,f),b,P,G,D=-1,M=!1,B=null,O;if(nc.lastIndex=0,c.m3u8=e,c.hasVariableRefs=hp(e),((u=nc.exec(e))==null?void 0:u[0])!=="#EXTM3U")return c.playlistParsingError=new Error("Missing format identifier #EXTM3U"),c;for(;(b=nc.exec(e))!==null;){M&&(M=!1,I=new Zu(r,f),I.playlistOffset=T,I.start=T,I.sn=E,I.cc=S,A&&(I.bitrate=A),I.level=n,g&&(I.initSegment=g,g.rawProgramDateTime&&(I.rawProgramDateTime=g.rawProgramDateTime,g.rawProgramDateTime=null),B&&(I.setByteRange(B),B=null)));const ae=b[1];if(ae){I.duration=parseFloat(ae);const oe=(" "+b[2]).slice(1);I.title=oe||null,I.tagList.push(oe?["INF",ae,oe]:["INF",ae])}else if(b[3]){if(ce(I.duration)){I.playlistOffset=T,I.start=T,G&&Ap(I,G,c),I.sn=E,I.level=n,I.cc=S,h.push(I);const oe=(" "+b[3]).slice(1);I.relurl=Oc(c,oe),Mc(I,w,m),w=I,T+=I.duration,E++,y=0,M=!0}}else{if(b=b[0].match(gA),!b){Fe.warn("No matches on slow regex match for level playlist!");continue}for(P=1;P<b.length&&b[P]===void 0;P++);const oe=(" "+b[P]).slice(1),ie=(" "+b[P+1]).slice(1),ee=b[P+2]?(" "+b[P+2]).slice(1):null;switch(oe){case"BYTERANGE":w?I.setByteRange(ie,w):I.setByteRange(ie);break;case"PROGRAM-DATE-TIME":I.rawProgramDateTime=ie,I.tagList.push(["PROGRAM-DATE-TIME",ie]),D===-1&&(D=h.length);break;case"PLAYLIST-TYPE":c.type&&Bn(c,oe,b),c.type=ie.toUpperCase();break;case"MEDIA-SEQUENCE":c.startSN!==0?Bn(c,oe,b):h.length>0&&Rp(c,oe,b),E=c.startSN=parseInt(ie);break;case"SKIP":{c.skippedSegments&&Bn(c,oe,b);const $=new qe(ie,c),J=$.decimalInteger("SKIPPED-SEGMENTS");if(ce(J)){c.skippedSegments+=J;for(let C=J;C--;)h.push(null);E+=J}const q=$.enumeratedString("RECENTLY-REMOVED-DATERANGES");q&&(c.recentlyRemovedDateranges=(c.recentlyRemovedDateranges||[]).concat(q.split("	")));break}case"TARGETDURATION":c.targetduration!==0&&Bn(c,oe,b),c.targetduration=Math.max(parseInt(ie),1);break;case"VERSION":c.version!==null&&Bn(c,oe,b),c.version=parseInt(ie);break;case"INDEPENDENT-SEGMENTS":break;case"ENDLIST":c.live||Bn(c,oe,b),c.live=!1;break;case"#":(ie||ee)&&I.tagList.push(ee?[ie,ee]:[ie]);break;case"DISCONTINUITY":S++,I.tagList.push(["DIS"]);break;case"GAP":I.gap=!0,I.tagList.push([oe]);break;case"BITRATE":I.tagList.push([oe,ie]),A=parseInt(ie)*1e3,ce(A)?I.bitrate=A:A=0;break;case"DATERANGE":{const $=new qe(ie,c),J=new y0($,c.dateRanges[$.ID],c.dateRangeTagCount);c.dateRangeTagCount++,J.isValid||c.skippedSegments?c.dateRanges[J.id]=J:Fe.warn(`Ignoring invalid DATERANGE tag: "${ie}"`),I.tagList.push(["EXT-X-DATERANGE",ie]);break}case"DEFINE":{{const $=new qe(ie,c);"IMPORT"in $?eA(c,$,l):mp(c,$,t)}break}case"DISCONTINUITY-SEQUENCE":c.startCC!==0?Bn(c,oe,b):h.length>0&&Rp(c,oe,b),c.startCC=S=parseInt(ie);break;case"KEY":{const $=Ep(ie,t,c);if($.isSupported()){if($.method==="NONE"){G=void 0;break}G||(G={});const J=G[$.keyFormat];J!=null&&J.matches($)||(J&&(G=Ue({},G)),G[$.keyFormat]=$)}else Fe.warn(`[Keys] Ignoring invalid EXT-X-KEY tag: "${ie}"`);break}case"START":c.startTimeOffset=xp(ie);break;case"MAP":{const $=new qe(ie,c);if(I.duration){const J=new Zu(r,f);Lp(J,$,n,G),g=J,I.initSegment=g,g.rawProgramDateTime&&!I.rawProgramDateTime&&(I.rawProgramDateTime=g.rawProgramDateTime)}else{const J=I.byteRangeEndOffset;if(J){const q=I.byteRangeStartOffset;B=`${J-q}@${q}`}else B=null;Lp(I,$,n,G),g=I,M=!0}g.cc=S;break}case"SERVER-CONTROL":{O&&Bn(c,oe,b),O=new qe(ie),c.canBlockReload=O.bool("CAN-BLOCK-RELOAD"),c.canSkipUntil=O.optionalFloat("CAN-SKIP-UNTIL",0),c.canSkipDateRanges=c.canSkipUntil>0&&O.bool("CAN-SKIP-DATERANGES"),c.partHoldBack=O.optionalFloat("PART-HOLD-BACK",0),c.holdBack=O.optionalFloat("HOLD-BACK",0);break}case"PART-INF":{c.partTarget&&Bn(c,oe,b);const $=new qe(ie);c.partTarget=$.decimalFloatingPoint("PART-TARGET");break}case"PART":{let $=c.partList;$||($=c.partList=[]);const J=y>0?$[$.length-1]:void 0,q=y++,C=new qe(ie,c),U=new sL(C,I,f,q,J);$.push(U),I.duration+=U.duration;break}case"PRELOAD-HINT":{const $=new qe(ie,c);c.preloadHint=$;break}case"RENDITION-REPORT":{const $=new qe(ie,c);c.renditionReports=c.renditionReports||[],c.renditionReports.push($);break}default:Fe.warn(`line parsed but not handled: ${b}`);break}}}w&&!w.relurl?(h.pop(),T-=w.duration,c.partList&&(c.fragmentHint=w)):c.partList&&(Mc(I,w,m),I.cc=S,c.fragmentHint=I,G&&Ap(I,G,c)),c.targetduration||(c.playlistParsingError=new Error("#EXT-X-TARGETDURATION is required"));const X=h.length,re=h[0],de=h[X-1];if(T+=c.skippedSegments*c.targetduration,T>0&&X&&de){c.averagetargetduration=T/X;const ae=de.sn;c.endSN=ae!=="initSegment"?ae:0,c.live||(de.endList=!0),re&&c.startCC===void 0&&(c.startCC=re.cc),D>0&&(vA(h,D),re&&m.unshift(re))}else c.endSN=0,c.startCC=0;return c.fragmentHint&&(T+=c.fragmentHint.duration),c.totalduration=T,m.length&&c.dateRangeTagCount&&re&&x0(m,c),c.endCC=S,c}}function x0(i,e){const t=i.length;if(!t)return;const n=i[t-1],r=e.live?1/0:e.totalduration,a=Object.keys(e.dateRanges);for(let l=a.length;l--;){const u=e.dateRanges[a[l]],f=u.startDate.getTime();u.tagAnchor=n.ref;for(let c=t;c--;){const h=yA(e,f,i,c,r);if(h!==-1){u.tagAnchor=e.fragments[h].ref;break}}}}function yA(i,e,t,n,r){const a=t[n];if(a){const u=a.programDateTime;if(e>=u||n===0){var l;const f=(((l=t[n+1])==null?void 0:l.start)||r)-a.start;if(e<=u+f*1e3){const c=t[n].sn-i.startSN,h=i.fragments;if(h.length>t.length){const g=(t[n+1]||h[h.length-1]).sn-i.startSN;for(let E=g;E>c;E--){const y=h[E].programDateTime;if(e>=y&&e<y+h[E].duration*1e3)return E}}return c}}}return-1}function Ep(i,e,t){var n,r;const a=new qe(i,t),l=(n=a.METHOD)!=null?n:"",u=a.URI,f=a.hexadecimalInteger("IV"),c=a.KEYFORMATVERSIONS,h=(r=a.KEYFORMAT)!=null?r:"identity";u&&a.IV&&!f&&Fe.error(`Invalid IV: ${a.IV}`);const m=u?wn.resolve(u,e):"",g=(c||"1").split("/").map(Number).filter(Number.isFinite);return new Qo(l,m,h,g,f,a.KEYID)}function xp(i){const t=new qe(i).decimalFloatingPoint("TIME-OFFSET");return ce(t)?t:null}function Sp(i,e){let t=(i||"").split(/[ ,]+/).filter(n=>n);["video","audio","text"].forEach(n=>{const r=t.filter(a=>od(a,n));r.length&&(e[`${n}Codec`]=r.map(a=>a.split("/")[0]).join(","),t=t.filter(a=>r.indexOf(a)===-1))}),e.unknownCodecs=t}function Tp(i,e,t){const n=e[t];n&&(i[t]=n)}function vA(i,e){let t=i[e];for(let n=e;n--;){const r=i[n];if(!r)return;r.programDateTime=t.programDateTime-r.duration*1e3,t=r}}function Mc(i,e,t){i.rawProgramDateTime?t.push(i):e!=null&&e.programDateTime&&(i.programDateTime=e.endProgramDateTime)}function Lp(i,e,t,n){i.relurl=e.URI,e.BYTERANGE&&i.setByteRange(e.BYTERANGE),i.level=t,i.sn="initSegment",n&&(i.levelkeys=n),i.initSegment=null}function Ap(i,e,t){i.levelkeys=e;const{encryptedFragments:n}=t;(!n.length||n[n.length-1].levelkeys!==e)&&Object.keys(e).some(r=>e[r].isCommonEncryption)&&n.push(i)}function Bn(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must not appear more than once (${t[0]})`)}function Rp(i,e,t){i.playlistParsingError=new Error(`#EXT-X-${e} must appear before the first Media Segment (${t[0]})`)}function rc(i,e){const t=e.startPTS;if(ce(t)){let n=0,r;e.sn>i.sn?(n=t-i.start,r=i):(n=i.start-t,r=e),r.duration!==n&&r.setDuration(n)}else e.sn>i.sn?i.cc===e.cc&&i.minEndPTS?e.setStart(i.start+(i.minEndPTS-i.start)):e.setStart(i.start+i.duration):e.setStart(Math.max(i.start-e.duration,0))}function S0(i,e,t,n,r,a){n-t<=0&&(Fe.warn("Fragment should have a positive duration",e),n=t+e.duration,a=r+e.duration);let u=t,f=n;const c=e.startPTS,h=e.endPTS;if(ce(c)){const S=Math.abs(c-t);ce(e.deltaPTS)?e.deltaPTS=Math.max(S,e.deltaPTS):e.deltaPTS=S,u=Math.max(t,c),t=Math.min(t,c),r=Math.min(r,e.startDTS),f=Math.min(n,h),n=Math.max(n,h),a=Math.max(a,e.endDTS)}const m=t-e.start;e.start!==0&&e.setStart(t),e.setDuration(n-e.start),e.startPTS=t,e.maxStartPTS=u,e.startDTS=r,e.endPTS=n,e.minEndPTS=f,e.endDTS=a;const g=e.sn;if(!i||g<i.startSN||g>i.endSN)return 0;let E;const y=g-i.startSN,T=i.fragments;for(T[y]=e,E=y;E>0;E--)rc(T[E],T[E-1]);for(E=y;E<T.length-1;E++)rc(T[E],T[E+1]);return i.fragmentHint&&rc(T[T.length-1],i.fragmentHint),i.PTSKnown=i.alignedSliding=!0,m}function EA(i,e){if(i===e)return;let t=null;const n=i.fragments;for(let c=n.length-1;c>=0;c--){const h=n[c].initSegment;if(h){t=h;break}}i.fragmentHint&&delete i.fragmentHint.endPTS;let r;TA(i,e,(c,h,m,g)=>{if((!e.startCC||e.skippedSegments)&&h.cc!==c.cc){const E=c.cc-h.cc;for(let y=m;y<g.length;y++)g[y].cc+=E;e.endCC=g[g.length-1].cc}ce(c.startPTS)&&ce(c.endPTS)&&(h.setStart(h.startPTS=c.startPTS),h.startDTS=c.startDTS,h.maxStartPTS=c.maxStartPTS,h.endPTS=c.endPTS,h.endDTS=c.endDTS,h.minEndPTS=c.minEndPTS,h.setDuration(c.endPTS-c.startPTS),h.duration&&(r=h),e.PTSKnown=e.alignedSliding=!0),c.hasStreams&&(h.elementaryStreams=c.elementaryStreams),h.loader=c.loader,c.hasStats&&(h.stats=c.stats),c.initSegment&&(h.initSegment=c.initSegment,t=c.initSegment)});const a=e.fragments,l=e.fragmentHint?a.concat(e.fragmentHint):a;if(t&&l.forEach(c=>{var h;c&&(!c.initSegment||c.initSegment.relurl===((h=t)==null?void 0:h.relurl))&&(c.initSegment=t)}),e.skippedSegments){if(e.deltaUpdateFailed=a.some(c=>!c),e.deltaUpdateFailed){Fe.warn("[level-helper] Previous playlist missing segments skipped in delta playlist");for(let c=e.skippedSegments;c--;)a.shift();e.startSN=a[0].sn}else{e.canSkipDateRanges&&(e.dateRanges=xA(i.dateRanges,e));const c=i.fragments.filter(h=>h.rawProgramDateTime);if(i.hasProgramDateTime&&!e.hasProgramDateTime)for(let h=1;h<l.length;h++)l[h].programDateTime===null&&Mc(l[h],l[h-1],c);x0(c,e)}e.endCC=a[a.length-1].cc}if(!e.startCC){var u;const c=A0(i,e.startSN-1);e.startCC=(u=c==null?void 0:c.cc)!=null?u:a[0].cc}SA(i.partList,e.partList,(c,h)=>{h.elementaryStreams=c.elementaryStreams,h.stats=c.stats}),r?S0(e,r,r.startPTS,r.endPTS,r.startDTS,r.endDTS):T0(i,e),a.length&&(e.totalduration=e.edge-a[0].start),e.driftStartTime=i.driftStartTime,e.driftStart=i.driftStart;const f=e.advancedDateTime;if(e.advanced&&f){const c=e.edge;e.driftStart||(e.driftStartTime=f,e.driftStart=c),e.driftEndTime=f,e.driftEnd=c}else e.driftEndTime=i.driftEndTime,e.driftEnd=i.driftEnd,e.advancedDateTime=i.advancedDateTime;e.requestScheduled===-1&&(e.requestScheduled=i.requestScheduled)}function xA(i,e){const{dateRanges:t,recentlyRemovedDateranges:n}=e,r=Ue({},i);n&&n.forEach(u=>{delete r[u]});const l=Object.keys(r).length;return l&&Object.keys(t).forEach(u=>{const f=r[u],c=new y0(t[u].attr,f);c.isValid?(r[u]=c,f||(c.tagOrder+=l)):Fe.warn(`Ignoring invalid Playlist Delta Update DATERANGE tag: "${Ke(t[u].attr)}"`)}),r}function SA(i,e,t){if(i&&e){let n=0;for(let r=0,a=i.length;r<=a;r++){const l=i[r],u=e[r+n];l&&u&&l.index===u.index&&l.fragment.sn===u.fragment.sn?t(l,u):n--}}}function TA(i,e,t){const n=e.skippedSegments,r=Math.max(i.startSN,e.startSN)-e.startSN,a=(i.fragmentHint?1:0)+(n?e.endSN:Math.min(i.endSN,e.endSN))-e.startSN,l=e.startSN-i.startSN,u=e.fragmentHint?e.fragments.concat(e.fragmentHint):e.fragments,f=i.fragmentHint?i.fragments.concat(i.fragmentHint):i.fragments;for(let c=r;c<=a;c++){const h=f[l+c];let m=u[c];if(n&&!m&&h&&(m=e.fragments[c]=h),h&&m){if(t(h,m,c,u),h.url&&h.url!==m.url){e.playlistParsingError=Ip(`media sequence mismatch ${m.sn}:`,i,e,h,m);return}else if(h.cc!==m.cc){e.playlistParsingError=Ip(`discontinuity sequence mismatch (${h.cc}!=${m.cc})`,i,e,h,m);return}}}}function Ip(i,e,t,n,r){return new Error(`${i} ${r.url}
Playlist starting @${e.startSN}
${e.m3u8}

Playlist starting @${t.startSN}
${t.m3u8}`)}function T0(i,e,t=!0){const n=e.startSN+e.skippedSegments-i.startSN,r=i.fragments,a=n>=0;let l=0;if(a&&n<r.length)l=r[n].start;else if(a&&e.startSN===i.endSN+1)l=i.fragmentEnd;else if(a&&t)l=i.fragmentStart+n*e.levelTargetDuration;else if(!e.skippedSegments&&e.fragmentStart===0)l=i.fragmentStart;else return;Uc(e,l)}function Uc(i,e){if(e){const t=i.fragments;for(let n=i.skippedSegments;n<t.length;n++)t[n].addStart(e);i.fragmentHint&&i.fragmentHint.addStart(e)}}function L0(i,e=1/0){let t=1e3*i.targetduration;if(i.updated){const n=i.fragments;if(n.length&&t*4>e){const a=n[n.length-1].duration*1e3;a<t&&(t=a)}}else t/=2;return Math.round(t)}function A0(i,e,t){if(!i)return null;let n=i.fragments[e-i.startSN];return n||(n=i.fragmentHint,n&&n.sn===e)?n:e<i.startSN&&t&&t.sn===e?t:null}function wp(i,e,t){return i?R0(i.partList,e,t):null}function R0(i,e,t){if(i)for(let n=i.length;n--;){const r=i[n];if(r.index===t&&r.fragment.sn===e)return r}return null}function I0(i){i.forEach((e,t)=>{var n;(n=e.details)==null||n.fragments.forEach(r=>{r.level=t,r.initSegment&&(r.initSegment.level=t)})})}function Ii(i,e){for(let n=0,r=i.length;n<r;n++){var t;if(((t=i[n])==null?void 0:t.cc)===e)return i[n]}return null}function LA(i,e){return!!(i&&e.startCC<i.endCC&&e.endCC>i.startCC)}function _p(i,e){if(i){const t=i.start+e;i.start=i.startPTS=t,i.endPTS=t+i.duration}}function w0(i,e){const t=e.fragments;for(let n=0,r=t.length;n<r;n++)_p(t[n],i);e.fragmentHint&&_p(e.fragmentHint,i),e.alignedSliding=!0}function AA(i,e){i&&(_0(e,i),!e.alignedSliding&&i&&Mo(e,i),!e.alignedSliding&&i&&!e.skippedSegments&&T0(i,e,!1))}function _0(i,e){if(!LA(e,i))return;const t=Math.min(e.endCC,i.endCC),n=Ii(e.fragments,t),r=Ii(i.fragments,t);if(!n||!r)return;Fe.log(`Aligning playlist at start of dicontinuity sequence ${t}`);const a=n.start-r.start;w0(a,i)}function Mo(i,e){if(!i.hasProgramDateTime||!e.hasProgramDateTime)return;const t=i.fragments,n=e.fragments;if(!t.length||!n.length)return;let r,a;const l=Math.min(e.endCC,i.endCC);e.startCC<l&&i.startCC<l&&(r=Ii(n,l),a=Ii(t,l)),(!r||!a)&&(r=n[Math.floor(n.length/2)],a=Ii(t,r.cc)||t[Math.floor(t.length/2)]);const u=r.programDateTime,f=a.programDateTime;if(!u||!f)return;const c=(f-u)/1e3-(a.start-r.start);w0(c,i)}const RA={toString:function(i){let e="";const t=i.length;for(let n=0;n<t;n++)e+=`[${i.start(n).toFixed(3)}-${i.end(n).toFixed(3)}]`;return e}},Q={STOPPED:"STOPPED",IDLE:"IDLE",KEY_LOADING:"KEY_LOADING",FRAG_LOADING:"FRAG_LOADING",FRAG_LOADING_WAITING_RETRY:"FRAG_LOADING_WAITING_RETRY",WAITING_TRACK:"WAITING_TRACK",PARSING:"PARSING",PARSED:"PARSED",ENDED:"ENDED",ERROR:"ERROR",WAITING_INIT_PTS:"WAITING_INIT_PTS",WAITING_LEVEL:"WAITING_LEVEL"};class hd extends p0{constructor(e,t,n,r,a){super(r,e.logger),this.hls=void 0,this.fragPrevious=null,this.fragCurrent=null,this.fragmentTracker=void 0,this.transmuxer=null,this._state=Q.STOPPED,this.playlistType=void 0,this.media=null,this.mediaBuffer=null,this.config=void 0,this.bitrateTest=!1,this.lastCurrentTime=0,this.nextLoadPosition=0,this.startPosition=0,this.startTimeOffset=null,this.retryDate=0,this.levels=null,this.fragmentLoader=void 0,this.keyLoader=void 0,this.levelLastLoaded=null,this.startFragRequested=!1,this.decrypter=void 0,this.initPTS=[],this.buffering=!0,this.loadingParts=!1,this.loopSn=void 0,this.onMediaSeeking=()=>{const{config:l,fragCurrent:u,media:f,mediaBuffer:c,state:h}=this,m=f?f.currentTime:0,g=Ie.bufferInfo(c||f,m,l.maxBufferHole),E=!g.len;if(this.log(`Media seeking to ${ce(m)?m.toFixed(3):m}, state: ${h}, ${E?"out of":"in"} buffer`),this.state===Q.ENDED)this.resetLoadingState();else if(u){const y=l.maxFragLookUpTolerance,T=u.start-y,S=u.start+u.duration+y;if(E||S<g.start||T>g.end){const A=m>S;(m<T||A)&&(A&&u.loader&&(this.log(`Cancelling fragment load for seek (sn: ${u.sn})`),u.abortRequests(),this.resetLoadingState()),this.fragPrevious=null)}}if(f){this.fragmentTracker.removeFragmentsInRange(m,1/0,this.playlistType,!0);const y=this.lastCurrentTime;if(m>y&&(this.lastCurrentTime=m),!this.loadingParts){const T=Math.max(g.end,m),S=this.shouldLoadParts(this.getLevelDetails(),T);S&&(this.log(`LL-Part loading ON after seeking to ${m.toFixed(2)} with buffer @${T.toFixed(2)}`),this.loadingParts=S)}}this.hls.hasEnoughToStart||(this.log(`Setting ${E?"startPosition":"nextLoadPosition"} to ${m} for seek without enough to start`),this.nextLoadPosition=m,E&&(this.startPosition=m)),this.tickImmediate()},this.onMediaEnded=()=>{this.log("setting startPosition to 0 because media ended"),this.startPosition=this.lastCurrentTime=0},this.playlistType=a,this.hls=e,this.fragmentLoader=new JL(e.config),this.keyLoader=n,this.fragmentTracker=t,this.config=e.config,this.decrypter=new cd(e.config)}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.ERROR,this.onError,this)}doTick(){this.onTickEnd()}onTickEnd(){}startLoad(e){}stopLoad(){if(this.state===Q.STOPPED)return;this.fragmentLoader.abort(),this.keyLoader.abort(this.playlistType);const e=this.fragCurrent;e!=null&&e.loader&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.resetTransmuxer(),this.fragCurrent=null,this.fragPrevious=null,this.clearInterval(),this.clearNextTick(),this.state=Q.STOPPED}get startPositionValue(){const{nextLoadPosition:e,startPosition:t}=this;return t===-1&&e?e:t}get bufferingEnabled(){return this.buffering}pauseBuffering(){this.buffering=!1}resumeBuffering(){this.buffering=!0}get inFlightFrag(){return{frag:this.fragCurrent,state:this.state}}_streamEnded(e,t){if(t.live||!this.media)return!1;const n=e.end||0,r=this.config.timelineOffset||0;if(n<=r)return!1;const a=e.buffered;this.config.maxBufferHole&&a&&a.length>1&&(e=Ie.bufferedInfo(a,e.start,0));const l=e.nextStart;if(l&&l>r&&l<t.edge||this.media.currentTime<e.start)return!1;const f=t.partList;if(f!=null&&f.length){const h=f[f.length-1];return Ie.isBuffered(this.media,h.start+h.duration/2)}const c=t.fragments[t.fragments.length-1].type;return this.fragmentTracker.isEndListAppended(c)}getLevelDetails(){if(this.levels&&this.levelLastLoaded!==null){var e;return(e=this.levelLastLoaded)==null?void 0:e.details}}get timelineOffset(){const e=this.config.timelineOffset;if(e){var t;return((t=this.getLevelDetails())==null?void 0:t.appliedTimelineOffset)||e}return 0}onMediaAttached(e,t){const n=this.media=this.mediaBuffer=t.media;n.removeEventListener("seeking",this.onMediaSeeking),n.removeEventListener("ended",this.onMediaEnded),n.addEventListener("seeking",this.onMediaSeeking),n.addEventListener("ended",this.onMediaEnded);const r=this.config;this.levels&&r.autoStartLoad&&this.state===Q.STOPPED&&this.startLoad(r.startPosition)}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(r!==null){if(r.ended&&(this.log("MSE detaching and video ended, reset startPosition"),this.startPosition=this.lastCurrentTime=0),r.removeEventListener("seeking",this.onMediaSeeking),r.removeEventListener("ended",this.onMediaEnded),this.keyLoader&&!n&&this.keyLoader.detach(),this.media=this.mediaBuffer=null,this.loopSn=void 0,n){this.resetLoadingState(),this.resetTransmuxer();return}this.loadingParts=!1,this.fragmentTracker.removeAllFragments(),this.stopLoad()}}onManifestLoading(){this.initPTS=[],this.levels=this.levelLastLoaded=this.fragCurrent=null,this.lastCurrentTime=this.startPosition=0,this.startFragRequested=!1}onError(e,t){}onManifestLoaded(e,t){this.startTimeOffset=t.startTimeOffset}onHandlerDestroying(){this.stopLoad(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),super.onHandlerDestroying(),this.hls=this.onMediaSeeking=this.onMediaEnded=null}onHandlerDestroyed(){this.state=Q.STOPPED,this.fragmentLoader&&this.fragmentLoader.destroy(),this.keyLoader&&this.keyLoader.destroy(),this.decrypter&&this.decrypter.destroy(),this.hls=this.log=this.warn=this.decrypter=this.keyLoader=this.fragmentLoader=this.fragmentTracker=null,super.onHandlerDestroyed()}loadFragment(e,t,n){this.startFragRequested=!0,this._loadFragForPlayback(e,t,n)}_loadFragForPlayback(e,t,n){const r=a=>{const l=a.frag;if(this.fragContextChanged(l)){this.warn(`${l.type} sn: ${l.sn}${a.part?" part: "+a.part.index:""} of ${this.fragInfo(l,!1,a.part)}) was dropped during download.`),this.fragmentTracker.removeFragment(l);return}l.stats.chunkCount++,this._handleFragmentLoadProgress(a)};this._doFragLoad(e,t,n,r).then(a=>{if(!a)return;const l=this.state,u=a.frag;if(this.fragContextChanged(u)){(l===Q.FRAG_LOADING||!this.fragCurrent&&l===Q.PARSING)&&(this.fragmentTracker.removeFragment(u),this.state=Q.IDLE);return}"payload"in a&&(this.log(`Loaded ${u.type} sn: ${u.sn} of ${this.playlistLabel()} ${u.level}`),this.hls.trigger(L.FRAG_LOADED,a)),this._handleFragmentLoadComplete(a)}).catch(a=>{this.state===Q.STOPPED||this.state===Q.ERROR||(this.warn(`Frag error: ${(a==null?void 0:a.message)||a}`),this.resetFragmentLoading(e))})}clearTrackerIfNeeded(e){var t;const{fragmentTracker:n}=this;if(n.getState(e)===ot.APPENDING){const a=e.type,l=this.getFwdBufferInfo(this.mediaBuffer,a),u=Math.max(e.duration,l?l.len:this.config.maxBufferLength),f=this.backtrackFragment;((f?e.sn-f.sn:0)===1||this.reduceMaxBufferLength(u,e.duration))&&n.removeFragment(e)}else((t=this.mediaBuffer)==null?void 0:t.buffered.length)===0?n.removeAllFragments():n.hasParts(e.type)&&(n.detectPartialFragments({frag:e,part:null,stats:e.stats,id:e.type}),n.getState(e)===ot.PARTIAL&&n.removeFragment(e))}checkLiveUpdate(e){if(e.updated&&!e.live){const t=e.fragments[e.fragments.length-1];this.fragmentTracker.detectPartialFragments({frag:t,part:null,stats:t.stats,id:t.type})}e.fragments[0]||(e.deltaUpdateFailed=!0)}waitForLive(e){const t=e.details;return(t==null?void 0:t.live)&&t.type!=="EVENT"&&(this.levelLastLoaded!==e||t.expired)}flushMainBuffer(e,t,n=null){if(!(e-t))return;const r={startOffset:e,endOffset:t,type:n};this.hls.trigger(L.BUFFER_FLUSHING,r)}_loadInitSegment(e,t){this._doFragLoad(e,t).then(n=>{const r=n==null?void 0:n.frag;if(!r||this.fragContextChanged(r)||!this.levels)throw new Error("init load aborted");return n}).then(n=>{const{hls:r}=this,{frag:a,payload:l}=n,u=a.decryptdata;if(l&&l.byteLength>0&&u!=null&&u.key&&u.iv&&As(u.method)){const f=self.performance.now();return this.decrypter.decrypt(new Uint8Array(l),u.key.buffer,u.iv.buffer,fd(u.method)).catch(c=>{throw r.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.FRAG_DECRYPT_ERROR,fatal:!1,error:c,reason:c.message,frag:a}),c}).then(c=>{const h=self.performance.now();return r.trigger(L.FRAG_DECRYPTED,{frag:a,payload:c,stats:{tstart:f,tdecrypt:h}}),n.payload=c,this.completeInitSegmentLoad(n)})}return this.completeInitSegmentLoad(n)}).catch(n=>{this.state===Q.STOPPED||this.state===Q.ERROR||(this.warn(n),this.resetFragmentLoading(e))})}completeInitSegmentLoad(e){const{levels:t}=this;if(!t)throw new Error("init load aborted, missing levels");const n=e.frag.stats;this.state!==Q.STOPPED&&(this.state=Q.IDLE),e.frag.data=new Uint8Array(e.payload),n.parsing.start=n.buffering.start=self.performance.now(),n.parsing.end=n.buffering.end=self.performance.now(),this.tick()}fragContextChanged(e){const{fragCurrent:t}=this;return!e||!t||e.sn!==t.sn||e.level!==t.level}fragBufferedComplete(e,t){const n=this.mediaBuffer?this.mediaBuffer:this.media;if(this.log(`Buffered ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)} > buffer:${n?RA.toString(Ie.getBuffered(n)):"(detached)"})`),st(e)){var r;if(e.type!==pe.SUBTITLE){const l=e.elementaryStreams;if(!Object.keys(l).some(u=>!!l[u])){this.state=Q.IDLE;return}}const a=(r=this.levels)==null?void 0:r[e.level];a!=null&&a.fragmentError&&(this.log(`Resetting level fragment error count of ${a.fragmentError} on frag buffered`),a.fragmentError=0)}this.state=Q.IDLE}_handleFragmentLoadComplete(e){const{transmuxer:t}=this;if(!t)return;const{frag:n,part:r,partsLoaded:a}=e,l=!a||a.length===0||a.some(f=>!f),u=new dd(n.level,n.sn,n.stats.chunkCount+1,0,r?r.index:-1,!l);t.flush(u)}_handleFragmentLoadProgress(e){}_doFragLoad(e,t,n=null,r){var a;this.fragCurrent=e;const l=t==null?void 0:t.details;if(!this.levels||!l)throw new Error(`frag load aborted, missing level${l?"":" detail"}s`);let u=null;e.encrypted&&!((a=e.decryptdata)!=null&&a.key)?(this.log(`Loading key for ${e.sn} of [${l.startSN}-${l.endSN}], ${this.playlistLabel()} ${e.level}`),this.state=Q.KEY_LOADING,this.fragCurrent=e,u=this.keyLoader.load(e).then(m=>{if(!this.fragContextChanged(m.frag))return this.hls.trigger(L.KEY_LOADED,m),this.state===Q.KEY_LOADING&&(this.state=Q.IDLE),m}),this.hls.trigger(L.KEY_LOADING,{frag:e}),this.fragCurrent===null&&(u=Promise.reject(new Error("frag load aborted, context changed in KEY_LOADING")))):e.encrypted||(u=this.keyLoader.loadClear(e,l.encryptedFragments,this.startFragRequested),u&&this.log("[eme] blocking frag load until media-keys acquired"));const f=this.fragPrevious;if(st(e)&&(!f||e.sn!==f.sn)){const m=this.shouldLoadParts(t.details,e.end);m!==this.loadingParts&&(this.log(`LL-Part loading ${m?"ON":"OFF"} loading sn ${f==null?void 0:f.sn}->${e.sn}`),this.loadingParts=m)}if(n=Math.max(e.start,n||0),this.loadingParts&&st(e)){const m=l.partList;if(m&&r){n>e.end&&l.fragmentHint&&(e=l.fragmentHint);const g=this.getNextPart(m,e,n);if(g>-1){const E=m[g];e=this.fragCurrent=E.fragment,this.log(`Loading ${e.type} sn: ${e.sn} part: ${E.index} (${g}/${m.length-1}) of ${this.fragInfo(e,!1,E)}) cc: ${e.cc} [${l.startSN}-${l.endSN}], target: ${parseFloat(n.toFixed(3))}`),this.nextLoadPosition=E.start+E.duration,this.state=Q.FRAG_LOADING;let y;return u?y=u.then(T=>!T||this.fragContextChanged(T.frag)?null:this.doFragPartsLoad(e,E,t,r)).catch(T=>this.handleFragLoadError(T)):y=this.doFragPartsLoad(e,E,t,r).catch(T=>this.handleFragLoadError(T)),this.hls.trigger(L.FRAG_LOADING,{frag:e,part:E,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING parts")):y}else if(!e.url||this.loadedEndOfParts(m,n))return Promise.resolve(null)}}if(st(e)&&this.loadingParts)this.log(`LL-Part loading OFF after next part miss @${n.toFixed(2)}`),this.loadingParts=!1;else if(!e.url)return Promise.resolve(null);this.log(`Loading ${e.type} sn: ${e.sn} of ${this.fragInfo(e,!1)}) cc: ${e.cc} ${l?"["+l.startSN+"-"+l.endSN+"]":""}, target: ${parseFloat(n.toFixed(3))}`),ce(e.sn)&&!this.bitrateTest&&(this.nextLoadPosition=e.start+e.duration),this.state=Q.FRAG_LOADING;const c=this.config.progressive;let h;return c&&u?h=u.then(m=>!m||this.fragContextChanged(m==null?void 0:m.frag)?null:this.fragmentLoader.load(e,r)).catch(m=>this.handleFragLoadError(m)):h=Promise.all([this.fragmentLoader.load(e,c?r:void 0),u]).then(([m])=>(!c&&m&&r&&r(m),m)).catch(m=>this.handleFragLoadError(m)),this.hls.trigger(L.FRAG_LOADING,{frag:e,targetBufferTime:n}),this.fragCurrent===null?Promise.reject(new Error("frag load aborted, context changed in FRAG_LOADING")):h}doFragPartsLoad(e,t,n,r){return new Promise((a,l)=>{var u;const f=[],c=(u=n.details)==null?void 0:u.partList,h=m=>{this.fragmentLoader.loadPart(e,m,r).then(g=>{f[m.index]=g;const E=g.part;this.hls.trigger(L.FRAG_LOADED,g);const y=wp(n.details,e.sn,m.index+1)||R0(c,e.sn,m.index+1);if(y)h(y);else return a({frag:e,part:E,partsLoaded:f})}).catch(l)};h(t)})}handleFragLoadError(e){if("data"in e){const t=e.data;e.data&&t.details===H.INTERNAL_ABORTED?this.handleFragLoadAborted(t.frag,t.part):this.hls.trigger(L.ERROR,t)}else this.hls.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,err:e,error:e,fatal:!0});return null}_handleTransmuxerFlush(e){const t=this.getCurrentContext(e);if(!t||this.state!==Q.PARSING){!this.fragCurrent&&this.state!==Q.STOPPED&&this.state!==Q.ERROR&&(this.state=Q.IDLE);return}const{frag:n,part:r,level:a}=t,l=self.performance.now();n.stats.parsing.end=l,r&&(r.stats.parsing.end=l);const u=this.getLevelDetails(),c=u&&n.sn>u.endSN||this.shouldLoadParts(u,n.end);c!==this.loadingParts&&(this.log(`LL-Part loading ${c?"ON":"OFF"} after parsing segment ending @${n.end.toFixed(2)}`),this.loadingParts=c),this.updateLevelTiming(n,r,a,e.partial)}shouldLoadParts(e,t){if(this.config.lowLatencyMode){if(!e)return this.loadingParts;if(e!=null&&e.partList){var n;const a=e.partList[0],l=a.end+(((n=e.fragmentHint)==null?void 0:n.duration)||0);if(t>=l){var r;if((this.hls.hasEnoughToStart?((r=this.media)==null?void 0:r.currentTime)||this.lastCurrentTime:this.getLoadPosition())>a.start-a.fragment.duration)return!0}}}return!1}getCurrentContext(e){const{levels:t,fragCurrent:n}=this,{level:r,sn:a,part:l}=e;if(!(t!=null&&t[r]))return this.warn(`Levels object was unset while buffering fragment ${a} of ${this.playlistLabel()} ${r}. The current chunk will not be buffered.`),null;const u=t[r],f=u.details,c=l>-1?wp(f,a,l):null,h=c?c.fragment:A0(f,a,n);return h?(n&&n!==h&&(h.stats=n.stats),{frag:h,part:c,level:u}):null}bufferFragmentData(e,t,n,r,a){var l;if(!e||this.state!==Q.PARSING)return;const{data1:u,data2:f}=e;let c=u;if(u&&f&&(c=en(u,f)),!((l=c)!=null&&l.length))return;const h=this.initPTS[t.cc],m=h?-h.baseTime/h.timescale:void 0,g={type:e.type,frag:t,part:n,chunkMeta:r,offset:m,parent:t.type,data:c};if(this.hls.trigger(L.BUFFER_APPENDING,g),e.dropped&&e.independent&&!n){if(a)return;this.flushBufferGap(t)}}flushBufferGap(e){const t=this.media;if(!t)return;if(!Ie.isBuffered(t,t.currentTime)){this.flushMainBuffer(0,e.start);return}const n=t.currentTime,r=Ie.bufferInfo(t,n,0),a=e.duration,l=Math.min(this.config.maxFragLookUpTolerance*2,a*.25),u=Math.max(Math.min(e.start-l,r.end-l),n+l);e.start-u>l&&this.flushMainBuffer(u,e.start)}getFwdBufferInfo(e,t){var n;const r=this.getLoadPosition();if(!ce(r))return null;const l=this.lastCurrentTime>r||(n=this.media)!=null&&n.paused?0:this.config.maxBufferHole;return this.getFwdBufferInfoAtPos(e,r,t,l)}getFwdBufferInfoAtPos(e,t,n,r){const a=Ie.bufferInfo(e,t,r);if(a.len===0&&a.nextStart!==void 0){const l=this.fragmentTracker.getBufferedFrag(t,n);if(l&&(a.nextStart<=l.end||l.gap)){const u=Math.max(Math.min(a.nextStart,l.end)-t,r);return Ie.bufferInfo(e,t,u)}}return a}getMaxBufferLength(e){const{config:t}=this;let n;return e?n=Math.max(8*t.maxBufferSize/e,t.maxBufferLength):n=t.maxBufferLength,Math.min(n,t.maxMaxBufferLength)}reduceMaxBufferLength(e,t){const n=this.config,r=Math.max(Math.min(e-t,n.maxBufferLength),t),a=Math.max(e-t*3,n.maxMaxBufferLength/2,r);return a>=r?(n.maxMaxBufferLength=a,this.warn(`Reduce max buffer length to ${a}s`),!0):!1}getAppendedFrag(e,t=pe.MAIN){var n;const r=(n=this.fragmentTracker)==null?void 0:n.getAppendedFrag(e,t);return r&&"fragment"in r?r.fragment:r}getNextFragment(e,t){const n=t.fragments,r=n.length;if(!r)return null;const{config:a}=this,l=n[0].start,u=a.lowLatencyMode&&!!t.partList;let f=null;if(t.live){const m=a.initialLiveManifestSize;if(r<m)return this.warn(`Not enough fragments to start playback (have: ${r}, need: ${m})`),null;if(!t.PTSKnown&&!this.startFragRequested&&this.startPosition===-1||e<l){var c;u&&!this.loadingParts&&(this.log("LL-Part loading ON for initial live fragment"),this.loadingParts=!0),f=this.getInitialLiveFragment(t);const g=this.hls.startPosition,E=this.hls.liveSyncPosition,y=f?(g!==-1&&g>=l?g:E)||f.start:e;this.log(`Setting startPosition to ${y} to match start frag at live edge. mainStart: ${g} liveSyncPosition: ${E} frag.start: ${(c=f)==null?void 0:c.start}`),this.startPosition=this.nextLoadPosition=y}}else e<=l&&(f=n[0]);if(!f){const m=this.loadingParts?t.partEnd:t.fragmentEnd;f=this.getFragmentAtPosition(e,m,t)}let h=this.filterReplacedPrimary(f,t);if(!h&&f){const m=f.sn-t.startSN;h=this.filterReplacedPrimary(n[m+1]||null,t)}return this.mapToInitFragWhenRequired(h)}isLoopLoading(e,t){const n=this.fragmentTracker.getState(e);return(n===ot.OK||n===ot.PARTIAL&&!!e.gap)&&this.nextLoadPosition>t}getNextFragmentLoopLoading(e,t,n,r,a){let l=null;if(e.gap&&(l=this.getNextFragment(this.nextLoadPosition,t),l&&!l.gap&&n.nextStart)){const u=this.getFwdBufferInfoAtPos(this.mediaBuffer?this.mediaBuffer:this.media,n.nextStart,r,0);if(u!==null&&n.len+u.len>=a){const f=l.sn;return this.loopSn!==f&&(this.log(`buffer full after gaps in "${r}" playlist starting at sn: ${f}`),this.loopSn=f),null}}return this.loopSn=void 0,l}get primaryPrefetch(){if(bp(this.hls.config)){var e,t;if((e=this.hls.interstitialsManager)==null||(t=e.playingItem)==null?void 0:t.event)return!0}return!1}filterReplacedPrimary(e,t){if(!e)return e;if(bp(this.hls.config)&&e.type!==pe.SUBTITLE){const n=this.hls.interstitialsManager,r=n==null?void 0:n.bufferingItem;if(r){const l=r.event;if(l){if(l.appendInPlace||Math.abs(e.start-r.start)>1||r.start===0)return null}else if(e.end<=r.start&&(t==null?void 0:t.live)===!1||e.start>r.end&&r.nextEvent&&(r.nextEvent.appendInPlace||e.start-r.end>1))return null}const a=n==null?void 0:n.playerQueue;if(a)for(let l=a.length;l--;){const u=a[l].interstitial;if(u.appendInPlace&&e.start>=u.startTime&&e.end<=u.resumeTime)return null}}return e}mapToInitFragWhenRequired(e){return e!=null&&e.initSegment&&!(e!=null&&e.initSegment.data)&&!this.bitrateTest?e.initSegment:e}getNextPart(e,t,n){let r=-1,a=!1,l=!0;for(let u=0,f=e.length;u<f;u++){const c=e[u];if(l=l&&!c.independent,r>-1&&n<c.start)break;const h=c.loaded;h?r=-1:(a||c.independent||l)&&c.fragment===t&&(r=u),a=h}return r}loadedEndOfParts(e,t){const n=e[e.length-1];return n&&t>n.start&&n.loaded}getInitialLiveFragment(e){const t=e.fragments,n=this.fragPrevious;let r=null;if(n){if(e.hasProgramDateTime&&(this.log(`Live playlist, switching playlist, load frag with same PDT: ${n.programDateTime}`),r=$L(t,n.endProgramDateTime,this.config.maxFragLookUpTolerance)),!r){const a=n.sn+1;if(a>=e.startSN&&a<=e.endSN){const l=t[a-e.startSN];n.cc===l.cc&&(r=l,this.log(`Live playlist, switching playlist, load frag with next SN: ${r.sn}`))}r||(r=m0(e,n.cc,n.end),r&&this.log(`Live playlist, switching playlist, load frag with same CC: ${r.sn}`))}}else{const a=this.hls.liveSyncPosition;a!==null&&(r=this.getFragmentAtPosition(a,this.bitrateTest?e.fragmentEnd:e.edge,e))}return r}getFragmentAtPosition(e,t,n){const{config:r}=this;let{fragPrevious:a}=this,{fragments:l,endSN:u}=n;const{fragmentHint:f}=n,{maxFragLookUpTolerance:c}=r,h=n.partList,m=!!(this.loadingParts&&h!=null&&h.length&&f);m&&f&&!this.bitrateTest&&h[h.length-1].fragment.sn===f.sn&&(l=l.concat(f),u=f.sn);let g;if(e<t){var E;const T=e<this.lastCurrentTime||e>t-c||(E=this.media)!=null&&E.paused||!this.startFragRequested?0:c;g=Hr(a,l,e,T)}else g=l[l.length-1];if(g){const y=g.sn-n.startSN,T=this.fragmentTracker.getState(g);if((T===ot.OK||T===ot.PARTIAL&&g.gap)&&(a=g),a&&g.sn===a.sn&&(!m||h[0].fragment.sn>g.sn||!n.live&&!m)&&a&&g.level===a.level){const A=l[y+1];g.sn<u&&this.fragmentTracker.getState(A)!==ot.OK?g=A:g=null}}return g}alignPlaylists(e,t,n){const r=e.fragments.length;if(!r)return this.warn("No fragments in live playlist"),0;const a=e.fragmentStart,l=!t,u=e.alignedSliding&&ce(a);if(l||!u&&!a){AA(n,e);const f=e.fragmentStart;return this.log(`Live playlist sliding: ${f.toFixed(2)} start-sn: ${t?t.startSN:"na"}->${e.startSN} fragments: ${r}`),f}return a}waitForCdnTuneIn(e){return e.live&&e.canBlockReload&&e.partTarget&&e.tuneInGoal>Math.max(e.partHoldBack,e.partTarget*3)}setStartPosition(e,t){let n=this.startPosition;n<t&&(n=-1);const r=this.timelineOffset;if(n===-1){const a=this.startTimeOffset!==null,l=a?this.startTimeOffset:e.startTimeOffset;l!==null&&ce(l)?(n=t+l,l<0&&(n+=e.edge),n=Math.min(Math.max(t,n),t+e.totalduration),this.log(`Setting startPosition to ${n} for start time offset ${l} found in ${a?"multivariant":"media"} playlist`),this.startPosition=n):e.live?(n=this.hls.liveSyncPosition||t,this.log(`Setting startPosition to -1 to start at live edge ${n}`),this.startPosition=-1):(this.log("setting startPosition to 0 by default"),this.startPosition=n=0),this.lastCurrentTime=n+r}this.nextLoadPosition=n+r}getLoadPosition(){var e;const{media:t}=this;let n=0;return(e=this.hls)!=null&&e.hasEnoughToStart&&t?n=t.currentTime:this.nextLoadPosition>=0&&(n=this.nextLoadPosition),n}handleFragLoadAborted(e,t){this.transmuxer&&e.type===this.playlistType&&st(e)&&e.stats.aborted&&(this.log(`Fragment ${e.sn}${t?" part "+t.index:""} of ${this.playlistLabel()} ${e.level} was aborted`),this.resetFragmentLoading(e))}resetFragmentLoading(e){(!this.fragCurrent||!this.fragContextChanged(e)&&this.state!==Q.FRAG_LOADING_WAITING_RETRY)&&(this.state=Q.IDLE)}onFragmentOrKeyLoadError(e,t){if(t.chunkMeta&&!t.frag){const y=this.getCurrentContext(t.chunkMeta);y&&(t.frag=y.frag)}const n=t.frag;if(!n||n.type!==e||!this.levels)return;if(this.fragContextChanged(n)){var r;this.warn(`Frag load error must match current frag to retry ${n.url} > ${(r=this.fragCurrent)==null?void 0:r.url}`);return}const a=t.details===H.FRAG_GAP;a&&this.fragmentTracker.fragBuffered(n,!0);const l=t.errorAction,{action:u,flags:f,retryCount:c=0,retryConfig:h}=l||{},m=!!l&&!!h,g=m&&u===St.RetryRequest,E=m&&!l.resolved&&f===hn.MoveAllAlternatesMatchingHost;if(!g&&E&&st(n)&&!n.endList)this.resetFragmentErrors(e),this.treatAsGap(n),l.resolved=!0;else if((g||E)&&c<h.maxNumRetry){this.resetStartWhenNotLoaded(this.levelLastLoaded);const y=ud(h,c);this.warn(`Fragment ${n.sn} of ${e} ${n.level} errored with ${t.details}, retrying loading ${c+1}/${h.maxNumRetry} in ${y}ms`),l.resolved=!0,this.retryDate=self.performance.now()+y,this.state=Q.FRAG_LOADING_WAITING_RETRY}else if(h&&l)if(this.resetFragmentErrors(e),c<h.maxNumRetry)!a&&u!==St.RemoveAlternatePermanently&&(l.resolved=!0);else{this.warn(`${t.details} reached or exceeded max retry (${c})`);return}else u===St.SendAlternateToPenaltyBox?this.state=Q.WAITING_LEVEL:this.state=Q.ERROR;this.tickImmediate()}reduceLengthAndFlushBuffer(e){if(this.state===Q.PARSING||this.state===Q.PARSED){const t=e.frag,n=e.parent,r=this.getFwdBufferInfo(this.mediaBuffer,n),a=r&&r.len>.5;a&&this.reduceMaxBufferLength(r.len,(t==null?void 0:t.duration)||10);const l=!a;return l&&this.warn(`Buffer full error while media.currentTime is not buffered, flush ${n} buffer`),t&&(this.fragmentTracker.removeFragment(t),this.nextLoadPosition=t.start),this.resetLoadingState(),l}return!1}resetFragmentErrors(e){e===pe.AUDIO&&(this.fragCurrent=null),this.hls.hasEnoughToStart||(this.startFragRequested=!1),this.state!==Q.STOPPED&&(this.state=Q.IDLE)}afterBufferFlushed(e,t,n){if(!e)return;const r=Ie.getBuffered(e);this.fragmentTracker.detectEvictedFragments(t,r,n),this.state===Q.ENDED&&this.resetLoadingState()}resetLoadingState(){this.log("Reset loading state"),this.fragCurrent=null,this.fragPrevious=null,this.state!==Q.STOPPED&&(this.state=Q.IDLE)}resetStartWhenNotLoaded(e){if(!this.hls.hasEnoughToStart){this.startFragRequested=!1;const t=e?e.details:null;t!=null&&t.live?(this.log("resetting startPosition for live start"),this.startPosition=-1,this.setStartPosition(t,t.fragmentStart),this.resetLoadingState()):this.nextLoadPosition=this.startPosition}}resetWhenMissingContext(e){this.warn(`The loading context changed while buffering fragment ${e.sn} of ${this.playlistLabel()} ${e.level}. This chunk will not be buffered.`),this.removeUnbufferedFrags(),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState()}removeUnbufferedFrags(e=0){this.fragmentTracker.removeFragmentsInRange(e,1/0,this.playlistType,!1,!0)}updateLevelTiming(e,t,n,r){const a=n.details;if(!a){this.warn("level.details undefined");return}if(!Object.keys(e.elementaryStreams).reduce((f,c)=>{const h=e.elementaryStreams[c];if(h){const m=h.endPTS-h.startPTS;if(m<=0)return this.warn(`Could not parse fragment ${e.sn} ${c} duration reliably (${m})`),f||!1;const g=r?0:S0(a,e,h.startPTS,h.endPTS,h.startDTS,h.endDTS);return this.hls.trigger(L.LEVEL_PTS_UPDATED,{details:a,level:n,drift:g,type:c,frag:e,start:h.startPTS,end:h.endPTS}),!0}return f},!1)){var u;if(n.fragmentError===0&&this.treatAsGap(e,n),((u=this.transmuxer)==null?void 0:u.error)===null){const f=new Error(`Found no media in fragment ${e.sn} of ${this.playlistLabel()} ${e.level} resetting transmuxer to fallback to playlist timing`);if(this.warn(f.message),this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,error:f,frag:e,reason:`Found no media in msn ${e.sn} of ${this.playlistLabel()} "${n.url}"`}),!this.hls)return;this.resetTransmuxer()}}this.state=Q.PARSED,this.log(`Parsed ${e.type} sn: ${e.sn}${t?" part: "+t.index:""} of ${this.fragInfo(e,!1,t)})`),this.hls.trigger(L.FRAG_PARSED,{frag:e,part:t})}playlistLabel(){return this.playlistType===pe.MAIN?"level":"track"}fragInfo(e,t=!0,n){var r,a;return`${this.playlistLabel()} ${e.level} (${n?"part":"frag"}:[${((r=t&&!n?e.startPTS:(n||e).start)!=null?r:NaN).toFixed(3)}-${((a=t&&!n?e.endPTS:(n||e).end)!=null?a:NaN).toFixed(3)}]${n&&e.type==="main"?"INDEPENDENT="+(n.independent?"YES":"NO"):""}`}treatAsGap(e,t){t&&t.fragmentError++,e.gap=!0,this.fragmentTracker.removeFragment(e),this.fragmentTracker.fragBuffered(e,!0)}resetTransmuxer(){var e;(e=this.transmuxer)==null||e.reset()}recoverWorkerError(e){e.event==="demuxerWorker"&&(this.fragmentTracker.removeAllFragments(),this.transmuxer&&(this.transmuxer.destroy(),this.transmuxer=null),this.resetStartWhenNotLoaded(this.levelLastLoaded),this.resetLoadingState())}set state(e){const t=this._state;t!==e&&(this._state=e,this.log(`${t}->${e}`))}get state(){return this._state}}function bp(i){return!!i.interstitialsController&&i.enableInterstitialPlayback!==!1}class b0{constructor(){this.chunks=[],this.dataLength=0}push(e){this.chunks.push(e),this.dataLength+=e.length}flush(){const{chunks:e,dataLength:t}=this;let n;if(e.length)e.length===1?n=e[0]:n=IA(e,t);else return new Uint8Array(0);return this.reset(),n}reset(){this.chunks.length=0,this.dataLength=0}}function IA(i,e){const t=new Uint8Array(e);let n=0;for(let r=0;r<i.length;r++){const a=i[r];t.set(a,n),n+=a.length}return t}var sc={exports:{}},Cp;function wA(){return Cp||(Cp=1,function(i){var e=Object.prototype.hasOwnProperty,t="~";function n(){}Object.create&&(n.prototype=Object.create(null),new n().__proto__||(t=!1));function r(f,c,h){this.fn=f,this.context=c,this.once=h||!1}function a(f,c,h,m,g){if(typeof h!="function")throw new TypeError("The listener must be a function");var E=new r(h,m||f,g),y=t?t+c:c;return f._events[y]?f._events[y].fn?f._events[y]=[f._events[y],E]:f._events[y].push(E):(f._events[y]=E,f._eventsCount++),f}function l(f,c){--f._eventsCount===0?f._events=new n:delete f._events[c]}function u(){this._events=new n,this._eventsCount=0}u.prototype.eventNames=function(){var c=[],h,m;if(this._eventsCount===0)return c;for(m in h=this._events)e.call(h,m)&&c.push(t?m.slice(1):m);return Object.getOwnPropertySymbols?c.concat(Object.getOwnPropertySymbols(h)):c},u.prototype.listeners=function(c){var h=t?t+c:c,m=this._events[h];if(!m)return[];if(m.fn)return[m.fn];for(var g=0,E=m.length,y=new Array(E);g<E;g++)y[g]=m[g].fn;return y},u.prototype.listenerCount=function(c){var h=t?t+c:c,m=this._events[h];return m?m.fn?1:m.length:0},u.prototype.emit=function(c,h,m,g,E,y){var T=t?t+c:c;if(!this._events[T])return!1;var S=this._events[T],A=arguments.length,w,I;if(S.fn){switch(S.once&&this.removeListener(c,S.fn,void 0,!0),A){case 1:return S.fn.call(S.context),!0;case 2:return S.fn.call(S.context,h),!0;case 3:return S.fn.call(S.context,h,m),!0;case 4:return S.fn.call(S.context,h,m,g),!0;case 5:return S.fn.call(S.context,h,m,g,E),!0;case 6:return S.fn.call(S.context,h,m,g,E,y),!0}for(I=1,w=new Array(A-1);I<A;I++)w[I-1]=arguments[I];S.fn.apply(S.context,w)}else{var b=S.length,P;for(I=0;I<b;I++)switch(S[I].once&&this.removeListener(c,S[I].fn,void 0,!0),A){case 1:S[I].fn.call(S[I].context);break;case 2:S[I].fn.call(S[I].context,h);break;case 3:S[I].fn.call(S[I].context,h,m);break;case 4:S[I].fn.call(S[I].context,h,m,g);break;default:if(!w)for(P=1,w=new Array(A-1);P<A;P++)w[P-1]=arguments[P];S[I].fn.apply(S[I].context,w)}}return!0},u.prototype.on=function(c,h,m){return a(this,c,h,m,!1)},u.prototype.once=function(c,h,m){return a(this,c,h,m,!0)},u.prototype.removeListener=function(c,h,m,g){var E=t?t+c:c;if(!this._events[E])return this;if(!h)return l(this,E),this;var y=this._events[E];if(y.fn)y.fn===h&&(!g||y.once)&&(!m||y.context===m)&&l(this,E);else{for(var T=0,S=[],A=y.length;T<A;T++)(y[T].fn!==h||g&&!y[T].once||m&&y[T].context!==m)&&S.push(y[T]);S.length?this._events[E]=S.length===1?S[0]:S:l(this,E)}return this},u.prototype.removeAllListeners=function(c){var h;return c?(h=t?t+c:c,this._events[h]&&l(this,h)):(this._events=new n,this._eventsCount=0),this},u.prototype.off=u.prototype.removeListener,u.prototype.addListener=u.prototype.on,u.prefixed=t,u.EventEmitter=u,i.exports=u}(sc)),sc.exports}var _A=wA(),md=nL(_A);const Oi="1.6.7",_s={};function bA(){return typeof __HLS_WORKER_BUNDLE__=="function"}function CA(){const i=_s[Oi];if(i)return i.clientCount++,i;const e=new self.Blob([`var exports={};var module={exports:exports};function define(f){f()};define.amd=true;(${__HLS_WORKER_BUNDLE__.toString()})(true);`],{type:"text/javascript"}),t=self.URL.createObjectURL(e),r={worker:new self.Worker(t),objectURL:t,clientCount:1};return _s[Oi]=r,r}function kA(i){const e=_s[i];if(e)return e.clientCount++,e;const t=new self.URL(i,self.location.href).href,r={worker:new self.Worker(t),scriptURL:t,clientCount:1};return _s[i]=r,r}function DA(i){const e=_s[i||Oi];if(e&&e.clientCount--===1){const{worker:n,objectURL:r}=e;delete _s[i||Oi],r&&self.URL.revokeObjectURL(r),n.terminate()}}function C0(i,e){return e+10<=i.length&&i[e]===51&&i[e+1]===68&&i[e+2]===73&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function pd(i,e){return e+10<=i.length&&i[e]===73&&i[e+1]===68&&i[e+2]===51&&i[e+3]<255&&i[e+4]<255&&i[e+6]<128&&i[e+7]<128&&i[e+8]<128&&i[e+9]<128}function Jo(i,e){let t=0;return t=(i[e]&127)<<21,t|=(i[e+1]&127)<<14,t|=(i[e+2]&127)<<7,t|=i[e+3]&127,t}function Ni(i,e){const t=e;let n=0;for(;pd(i,e);){n+=10;const r=Jo(i,e+6);n+=r,C0(i,e+10)&&(n+=10),e+=n}if(n>0)return i.subarray(t,t+n)}function PA(i,e,t,n){const r=[96e3,88200,64e3,48e3,44100,32e3,24e3,22050,16e3,12e3,11025,8e3,7350],a=e[t+2],l=a>>2&15;if(l>12){const E=new Error(`invalid ADTS sampling index:${l}`);i.emit(L.ERROR,L.ERROR,{type:xe.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!0,error:E,reason:E.message});return}const u=(a>>6&3)+1,f=e[t+3]>>6&3|(a&1)<<2,c="mp4a.40."+u,h=r[l];let m=l;(u===5||u===29)&&(m-=3);const g=[u<<3|(m&14)>>1,(m&1)<<7|f<<3];return Fe.log(`manifest codec:${n}, parsed codec:${c}, channels:${f}, rate:${h} (ADTS object type:${u} sampling index:${l})`),{config:g,samplerate:h,channelCount:f,codec:c,parsedCodec:c,manifestCodec:n}}function k0(i,e){return i[e]===255&&(i[e+1]&246)===240}function D0(i,e){return i[e+1]&1?7:9}function gd(i,e){return(i[e+3]&3)<<11|i[e+4]<<3|(i[e+5]&224)>>>5}function OA(i,e){return e+5<i.length}function Uo(i,e){return e+1<i.length&&k0(i,e)}function NA(i,e){return OA(i,e)&&k0(i,e)&&gd(i,e)<=i.length-e}function FA(i,e){if(Uo(i,e)){const t=D0(i,e);if(e+t>=i.length)return!1;const n=gd(i,e);if(n<=t)return!1;const r=e+n;return r===i.length||Uo(i,r)}return!1}function P0(i,e,t,n,r){if(!i.samplerate){const a=PA(e,t,n,r);if(!a)return;Ue(i,a)}}function O0(i){return 1024*9e4/i}function MA(i,e){const t=D0(i,e);if(e+t<=i.length){const n=gd(i,e)-t;if(n>0)return{headerLength:t,frameLength:n}}}function N0(i,e,t,n,r){const a=O0(i.samplerate),l=n+r*a,u=MA(e,t);let f;if(u){const{frameLength:m,headerLength:g}=u,E=g+m,y=Math.max(0,t+E-e.length);y?(f=new Uint8Array(E-g),f.set(e.subarray(t+g,e.length),0)):f=e.subarray(t+g,t+E);const T={unit:f,pts:l};return y||i.samples.push(T),{sample:T,length:E,missing:y}}const c=e.length-t;return f=new Uint8Array(c),f.set(e.subarray(t,e.length),0),{sample:{unit:f,pts:l},length:c,missing:-1}}function UA(i,e){return pd(i,e)&&Jo(i,e+6)+10<=i.length-e}function BA(i){return i instanceof ArrayBuffer?i:i.byteOffset==0&&i.byteLength==i.buffer.byteLength?i.buffer:new Uint8Array(i).buffer}function ic(i,e=0,t=1/0){return $A(i,e,t,Uint8Array)}function $A(i,e,t,n){const r=GA(i);let a=1;"BYTES_PER_ELEMENT"in n&&(a=n.BYTES_PER_ELEMENT);const l=jA(i)?i.byteOffset:0,u=(l+i.byteLength)/a,f=(l+e)/a,c=Math.floor(Math.max(0,Math.min(f,u))),h=Math.floor(Math.min(c+Math.max(t,0),u));return new n(r,c,h-c)}function GA(i){return i instanceof ArrayBuffer?i:i.buffer}function jA(i){return i&&i.buffer instanceof ArrayBuffer&&i.byteLength!==void 0&&i.byteOffset!==void 0}function VA(i){const e={key:i.type,description:"",data:"",mimeType:null,pictureType:null},t=3;if(i.size<2)return;if(i.data[0]!==t){console.log("Ignore frame with unrecognized character encoding");return}const n=i.data.subarray(1).indexOf(0);if(n===-1)return;const r=Vt(ic(i.data,1,n)),a=i.data[2+n],l=i.data.subarray(3+n).indexOf(0);if(l===-1)return;const u=Vt(ic(i.data,3+n,l));let f;return r==="-->"?f=Vt(ic(i.data,4+n+l)):f=BA(i.data.subarray(4+n+l)),e.mimeType=r,e.pictureType=a,e.description=u,e.data=f,e}function HA(i){if(i.size<2)return;const e=Vt(i.data,!0),t=new Uint8Array(i.data.subarray(e.length+1));return{key:i.type,info:e,data:t.buffer}}function KA(i){if(i.size<2)return;if(i.type==="TXXX"){let t=1;const n=Vt(i.data.subarray(t),!0);t+=n.length+1;const r=Vt(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Vt(i.data.subarray(1));return{key:i.type,info:"",data:e}}function zA(i){if(i.type==="WXXX"){if(i.size<2)return;let t=1;const n=Vt(i.data.subarray(t),!0);t+=n.length+1;const r=Vt(i.data.subarray(t));return{key:i.type,info:n,data:r}}const e=Vt(i.data);return{key:i.type,info:"",data:e}}function WA(i){return i.type==="PRIV"?HA(i):i.type[0]==="W"?zA(i):i.type==="APIC"?VA(i):KA(i)}function YA(i){const e=String.fromCharCode(i[0],i[1],i[2],i[3]),t=Jo(i,4),n=10;return{type:e,size:t,data:i.subarray(n,n+t)}}const so=10,qA=10;function F0(i){let e=0;const t=[];for(;pd(i,e);){const n=Jo(i,e+6);i[e+5]>>6&1&&(e+=so),e+=so;const r=e+n;for(;e+qA<r;){const a=YA(i.subarray(e)),l=WA(a);l&&t.push(l),e+=a.size+so}C0(i,e)&&(e+=so)}return t}function M0(i){return i&&i.key==="PRIV"&&i.info==="com.apple.streaming.transportStreamTimestamp"}function XA(i){if(i.data.byteLength===8){const e=new Uint8Array(i.data),t=e[3]&1;let n=(e[4]<<23)+(e[5]<<15)+(e[6]<<7)+e[7];return n/=45,t&&(n+=4772185884e-2),Math.round(n)}}function yd(i){const e=F0(i);for(let t=0;t<e.length;t++){const n=e[t];if(M0(n))return XA(n)}}let Gt=function(i){return i.audioId3="org.id3",i.dateRange="com.apple.quicktime.HLS",i.emsg="https://aomedia.org/emsg/ID3",i.misbklv="urn:misb:KLV:bin:1910.1",i}({});function Rn(i="",e=9e4){return{type:i,id:-1,pid:-1,inputTimeScale:e,sequenceNumber:-1,samples:[],dropped:0}}class vd{constructor(){this._audioTrack=void 0,this._id3Track=void 0,this.frameIndex=0,this.cachedData=null,this.basePTS=null,this.initPTS=null,this.lastPTS=null}resetInitSegment(e,t,n,r){this._id3Track={type:"id3",id:3,pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0}}resetTimeStamp(e){this.initPTS=e,this.resetContiguity()}resetContiguity(){this.basePTS=null,this.lastPTS=null,this.frameIndex=0}canParse(e,t){return!1}appendFrame(e,t,n){}demux(e,t){this.cachedData&&(e=en(this.cachedData,e),this.cachedData=null);let n=Ni(e,0),r=n?n.length:0,a;const l=this._audioTrack,u=this._id3Track,f=n?yd(n):void 0,c=e.length;for((this.basePTS===null||this.frameIndex===0&&ce(f))&&(this.basePTS=QA(f,t,this.initPTS),this.lastPTS=this.basePTS),this.lastPTS===null&&(this.lastPTS=this.basePTS),n&&n.length>0&&u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Gt.audioId3,duration:Number.POSITIVE_INFINITY});r<c;){if(this.canParse(e,r)){const h=this.appendFrame(l,e,r);h?(this.frameIndex++,this.lastPTS=h.sample.pts,r+=h.length,a=r):r=c}else UA(e,r)?(n=Ni(e,r),u.samples.push({pts:this.lastPTS,dts:this.lastPTS,data:n,type:Gt.audioId3,duration:Number.POSITIVE_INFINITY}),r+=n.length,a=r):r++;if(r===c&&a!==c){const h=e.slice(a);this.cachedData?this.cachedData=en(this.cachedData,h):this.cachedData=h}}return{audioTrack:l,videoTrack:Rn(),id3Track:u,textTrack:Rn()}}demuxSampleAes(e,t,n){return Promise.reject(new Error(`[${this}] This demuxer does not support Sample-AES decryption`))}flush(e){const t=this.cachedData;return t&&(this.cachedData=null,this.demux(t,0)),{audioTrack:this._audioTrack,videoTrack:Rn(),id3Track:this._id3Track,textTrack:Rn()}}destroy(){this.cachedData=null,this._audioTrack=this._id3Track=void 0}}const QA=(i,e,t)=>{if(ce(i))return i*90;const n=t?t.baseTime*9e4/t.timescale:0;return e*9e4+n};let io=null;const JA=[32,64,96,128,160,192,224,256,288,320,352,384,416,448,32,48,56,64,80,96,112,128,160,192,224,256,320,384,32,40,48,56,64,80,96,112,128,160,192,224,256,320,32,48,56,64,80,96,112,128,144,160,176,192,224,256,8,16,24,32,40,48,56,64,80,96,112,128,144,160],ZA=[44100,48e3,32e3,22050,24e3,16e3,11025,12e3,8e3],eR=[[0,72,144,12],[0,0,0,0],[0,72,144,12],[0,144,144,12]],tR=[0,1,1,4];function U0(i,e,t,n,r){if(t+24>e.length)return;const a=B0(e,t);if(a&&t+a.frameLength<=e.length){const l=a.samplesPerFrame*9e4/a.sampleRate,u=n+r*l,f={unit:e.subarray(t,t+a.frameLength),pts:u,dts:u};return i.config=[],i.channelCount=a.channelCount,i.samplerate=a.sampleRate,i.samples.push(f),{sample:f,length:a.frameLength,missing:0}}}function B0(i,e){const t=i[e+1]>>3&3,n=i[e+1]>>1&3,r=i[e+2]>>4&15,a=i[e+2]>>2&3;if(t!==1&&r!==0&&r!==15&&a!==3){const l=i[e+2]>>1&1,u=i[e+3]>>6,f=t===3?3-n:n===3?3:4,c=JA[f*14+r-1]*1e3,m=ZA[(t===3?0:t===2?1:2)*3+a],g=u===3?1:2,E=eR[t][n],y=tR[n],T=E*8*y,S=Math.floor(E*c/m+l)*y;if(io===null){const I=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);io=I?parseInt(I[1]):0}return!!io&&io<=87&&n===2&&c>=224e3&&u===0&&(i[e+3]=i[e+3]|128),{sampleRate:m,channelCount:g,frameLength:S,samplesPerFrame:T}}}function Ed(i,e){return i[e]===255&&(i[e+1]&224)===224&&(i[e+1]&6)!==0}function $0(i,e){return e+1<i.length&&Ed(i,e)}function nR(i,e){return Ed(i,e)&&4<=i.length-e}function G0(i,e){if(e+1<i.length&&Ed(i,e)){const n=B0(i,e);let r=4;n!=null&&n.frameLength&&(r=n.frameLength);const a=e+r;return a===i.length||$0(i,a)}return!1}class rR extends vd{constructor(e,t){super(),this.observer=void 0,this.config=void 0,this.observer=e,this.config=t}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/adts",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"aac",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e,t){if(!e)return!1;const n=Ni(e,0);let r=(n==null?void 0:n.length)||0;if(G0(e,r))return!1;for(let a=e.length;r<a;r++)if(FA(e,r))return t.log("ADTS sync word found !"),!0;return!1}canParse(e,t){return NA(e,t)}appendFrame(e,t,n){P0(e,this.observer,t,n,e.manifestCodec);const r=N0(e,t,n,this.basePTS,this.frameIndex);if(r&&r.missing===0)return r}}const j0=(i,e)=>{let t=0,n=5;e+=n;const r=new Uint32Array(1),a=new Uint32Array(1),l=new Uint8Array(1);for(;n>0;){l[0]=i[e];const u=Math.min(n,8),f=8-u;a[0]=4278190080>>>24+f<<f,r[0]=(l[0]&a[0])>>f,t=t?t<<u|r[0]:r[0],e+=1,n-=u}return t};class sR extends vd{constructor(e){super(),this.observer=void 0,this.observer=e}resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/ac-3",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"ac3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}canParse(e,t){return t+64<e.length}appendFrame(e,t,n){const r=V0(e,t,n,this.basePTS,this.frameIndex);if(r!==-1)return{sample:e.samples[e.samples.length-1],length:r,missing:0}}static probe(e){if(!e)return!1;const t=Ni(e,0);if(!t)return!1;const n=t.length;return e[n]===11&&e[n+1]===119&&yd(t)!==void 0&&j0(e,n)<16}}function V0(i,e,t,n,r){if(t+8>e.length||e[t]!==11||e[t+1]!==119)return-1;const a=e[t+4]>>6;if(a>=3)return-1;const u=[48e3,44100,32e3][a],f=e[t+4]&63,h=[64,69,96,64,70,96,80,87,120,80,88,120,96,104,144,96,105,144,112,121,168,112,122,168,128,139,192,128,140,192,160,174,240,160,175,240,192,208,288,192,209,288,224,243,336,224,244,336,256,278,384,256,279,384,320,348,480,320,349,480,384,417,576,384,418,576,448,487,672,448,488,672,512,557,768,512,558,768,640,696,960,640,697,960,768,835,1152,768,836,1152,896,975,1344,896,976,1344,1024,1114,1536,1024,1115,1536,1152,1253,1728,1152,1254,1728,1280,1393,1920,1280,1394,1920][f*3+a]*2;if(t+h>e.length)return-1;const m=e[t+6]>>5;let g=0;m===2?g+=2:(m&1&&m!==1&&(g+=2),m&4&&(g+=2));const E=(e[t+6]<<8|e[t+7])>>12-g&1,T=[2,1,2,3,3,4,4,5][m]+E,S=e[t+5]>>3,A=e[t+5]&7,w=new Uint8Array([a<<6|S<<1|A>>2,(A&3)<<6|m<<3|E<<2|f>>4,f<<4&224]),I=1536/u*9e4,b=n+r*I,P=e.subarray(t,t+h);return i.config=w,i.channelCount=T,i.samplerate=u,i.samples.push({unit:P,pts:b}),h}class iR extends vd{resetInitSegment(e,t,n,r){super.resetInitSegment(e,t,n,r),this._audioTrack={container:"audio/mpeg",type:"audio",id:2,pid:-1,sequenceNumber:0,segmentCodec:"mp3",samples:[],manifestCodec:t,duration:r,inputTimeScale:9e4,dropped:0}}static probe(e){if(!e)return!1;const t=Ni(e,0);let n=(t==null?void 0:t.length)||0;if(t&&e[n]===11&&e[n+1]===119&&yd(t)!==void 0&&j0(e,n)<=16)return!1;for(let r=e.length;n<r;n++)if(G0(e,n))return Fe.log("MPEG Audio sync word found !"),!0;return!1}canParse(e,t){return nR(e,t)}appendFrame(e,t,n){if(this.basePTS!==null)return U0(e,t,n,this.basePTS,this.frameIndex)}}const aR=/\/emsg[-/]ID3/i;class oR{constructor(e,t){this.remainderData=null,this.timeOffset=0,this.config=void 0,this.videoTrack=void 0,this.audioTrack=void 0,this.id3Track=void 0,this.txtTrack=void 0,this.config=t}resetTimeStamp(){}resetInitSegment(e,t,n,r){const a=this.videoTrack=Rn("video",1),l=this.audioTrack=Rn("audio",1),u=this.txtTrack=Rn("text",1);if(this.id3Track=Rn("id3",1),this.timeOffset=0,!(e!=null&&e.byteLength))return;const f=i0(e);if(f.video){const{id:c,timescale:h,codec:m,supplemental:g}=f.video;a.id=c,a.timescale=u.timescale=h,a.codec=m,a.supplemental=g}if(f.audio){const{id:c,timescale:h,codec:m}=f.audio;l.id=c,l.timescale=h,l.codec=m}u.id=n0.text,a.sampleDuration=0,a.duration=l.duration=r}resetContiguity(){this.remainderData=null}static probe(e){return oL(e)}demux(e,t){this.timeOffset=t;let n=e;const r=this.videoTrack,a=this.txtTrack;if(this.config.progressive){this.remainderData&&(n=en(this.remainderData,e));const u=mL(n);this.remainderData=u.remainder,r.samples=u.valid||new Uint8Array}else r.samples=n;const l=this.extractID3Track(r,t);return a.samples=Xm(t,r),{videoTrack:r,audioTrack:this.audioTrack,id3Track:l,textTrack:this.txtTrack}}flush(){const e=this.timeOffset,t=this.videoTrack,n=this.txtTrack;t.samples=this.remainderData||new Uint8Array,this.remainderData=null;const r=this.extractID3Track(t,this.timeOffset);return n.samples=Xm(e,t),{videoTrack:t,audioTrack:Rn(),id3Track:r,textTrack:Rn()}}extractID3Track(e,t){const n=this.id3Track;if(e.samples.length){const r=Ce(e.samples,["emsg"]);r&&r.forEach(a=>{const l=gL(a);if(aR.test(l.schemeIdUri)){const u=kp(l,t);let f=l.eventDuration===4294967295?Number.POSITIVE_INFINITY:l.eventDuration/l.timeScale;f<=.001&&(f=Number.POSITIVE_INFINITY);const c=l.payload;n.samples.push({data:c,len:c.byteLength,dts:u,pts:u,type:Gt.emsg,duration:f})}else if(this.config.enableEmsgKLVMetadata&&l.schemeIdUri.startsWith("urn:misb:KLV:bin:1910.1")){const u=kp(l,t);n.samples.push({data:l.payload,len:l.payload.byteLength,dts:u,pts:u,type:Gt.misbklv,duration:Number.POSITIVE_INFINITY})}})}return n}demuxSampleAes(e,t,n){return Promise.reject(new Error("The MP4 demuxer does not support SAMPLE-AES decryption"))}destroy(){this.config=null,this.remainderData=null,this.videoTrack=this.audioTrack=this.id3Track=this.txtTrack=void 0}}function kp(i,e){return ce(i.presentationTime)?i.presentationTime/i.timeScale:e+i.presentationTimeDelta/i.timeScale}class lR{constructor(e,t,n){this.keyData=void 0,this.decrypter=void 0,this.keyData=n,this.decrypter=new cd(t,{removePKCS7Padding:!1})}decryptBuffer(e){return this.decrypter.decrypt(e,this.keyData.key.buffer,this.keyData.iv.buffer,xr.cbc)}decryptAacSample(e,t,n){const r=e[t].unit;if(r.length<=16)return;const a=r.subarray(16,r.length-r.length%16),l=a.buffer.slice(a.byteOffset,a.byteOffset+a.length);this.decryptBuffer(l).then(u=>{const f=new Uint8Array(u);r.set(f,16),this.decrypter.isSync()||this.decryptAacSamples(e,t+1,n)})}decryptAacSamples(e,t,n){for(;;t++){if(t>=e.length){n();return}if(!(e[t].unit.length<32)&&(this.decryptAacSample(e,t,n),!this.decrypter.isSync()))return}}getAvcEncryptedData(e){const t=Math.floor((e.length-48)/160)*16+16,n=new Int8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)n.set(e.subarray(a,a+16),r);return n}getAvcDecryptedUnit(e,t){const n=new Uint8Array(t);let r=0;for(let a=32;a<e.length-16;a+=160,r+=16)e.set(n.subarray(r,r+16),a);return e}decryptAvcSample(e,t,n,r,a){const l=a0(a.data),u=this.getAvcEncryptedData(l);this.decryptBuffer(u.buffer).then(f=>{a.data=this.getAvcDecryptedUnit(l,f),this.decrypter.isSync()||this.decryptAvcSamples(e,t,n+1,r)})}decryptAvcSamples(e,t,n,r){if(e instanceof Uint8Array)throw new Error("Cannot decrypt samples of type Uint8Array");for(;;t++,n=0){if(t>=e.length){r();return}const a=e[t].units;for(;!(n>=a.length);n++){const l=a[n];if(!(l.data.length<=48||l.type!==1&&l.type!==5)&&(this.decryptAvcSample(e,t,n,r,l),!this.decrypter.isSync()))return}}}}class H0{constructor(){this.VideoSample=null}createVideoSample(e,t,n){return{key:e,frame:!1,pts:t,dts:n,units:[],length:0}}getLastNalUnit(e){var t;let n=this.VideoSample,r;if((!n||n.units.length===0)&&(n=e[e.length-1]),(t=n)!=null&&t.units){const a=n.units;r=a[a.length-1]}return r}pushAccessUnit(e,t){if(e.units.length&&e.frame){if(e.pts===void 0){const n=t.samples,r=n.length;if(r){const a=n[r-1];e.pts=a.pts,e.dts=a.dts}else{t.dropped++;return}}t.samples.push(e)}}parseNALu(e,t,n){const r=t.byteLength;let a=e.naluState||0;const l=a,u=[];let f=0,c,h,m,g=-1,E=0;for(a===-1&&(g=0,E=this.getNALuType(t,0),a=0,f=1);f<r;){if(c=t[f++],!a){a=c?0:1;continue}if(a===1){a=c?0:2;continue}if(!c)a=3;else if(c===1){if(h=f-a-1,g>=0){const y={data:t.subarray(g,h),type:E};u.push(y)}else{const y=this.getLastNalUnit(e.samples);y&&(l&&f<=4-l&&y.state&&(y.data=y.data.subarray(0,y.data.byteLength-l)),h>0&&(y.data=en(y.data,t.subarray(0,h)),y.state=0))}f<r?(m=this.getNALuType(t,f),g=f,E=m,a=0):a=-1}else a=0}if(g>=0&&a>=0){const y={data:t.subarray(g,r),type:E,state:a};u.push(y)}if(u.length===0){const y=this.getLastNalUnit(e.samples);y&&(y.data=en(y.data,t))}return e.naluState=a,u}}class wi{constructor(e){this.data=void 0,this.bytesAvailable=void 0,this.word=void 0,this.bitsAvailable=void 0,this.data=e,this.bytesAvailable=e.byteLength,this.word=0,this.bitsAvailable=0}loadWord(){const e=this.data,t=this.bytesAvailable,n=e.byteLength-t,r=new Uint8Array(4),a=Math.min(4,t);if(a===0)throw new Error("no bytes available");r.set(e.subarray(n,n+a)),this.word=new DataView(r.buffer).getUint32(0),this.bitsAvailable=a*8,this.bytesAvailable-=a}skipBits(e){let t;e=Math.min(e,this.bytesAvailable*8+this.bitsAvailable),this.bitsAvailable>e?(this.word<<=e,this.bitsAvailable-=e):(e-=this.bitsAvailable,t=e>>3,e-=t<<3,this.bytesAvailable-=t,this.loadWord(),this.word<<=e,this.bitsAvailable-=e)}readBits(e){let t=Math.min(this.bitsAvailable,e);const n=this.word>>>32-t;if(e>32&&Fe.error("Cannot read more than 32 bits at a time"),this.bitsAvailable-=t,this.bitsAvailable>0)this.word<<=t;else if(this.bytesAvailable>0)this.loadWord();else throw new Error("no bits available");return t=e-t,t>0&&this.bitsAvailable?n<<t|this.readBits(t):n}skipLZ(){let e;for(e=0;e<this.bitsAvailable;++e)if((this.word&2147483648>>>e)!==0)return this.word<<=e,this.bitsAvailable-=e,e;return this.loadWord(),e+this.skipLZ()}skipUEG(){this.skipBits(1+this.skipLZ())}skipEG(){this.skipBits(1+this.skipLZ())}readUEG(){const e=this.skipLZ();return this.readBits(e+1)-1}readEG(){const e=this.readUEG();return 1&e?1+e>>>1:-1*(e>>>1)}readBoolean(){return this.readBits(1)===1}readUByte(){return this.readBits(8)}readUShort(){return this.readBits(16)}readUInt(){return this.readBits(32)}}class Dp extends H0{parsePES(e,t,n,r){const a=this.parseNALu(e,n.data,r);let l=this.VideoSample,u,f=!1;n.data=null,l&&a.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.forEach(c=>{var h,m;switch(c.type){case 1:{let T=!1;u=!0;const S=c.data;if(f&&S.length>4){const A=this.readSliceType(S);(A===2||A===4||A===7||A===9)&&(T=!0)}if(T){var g;(g=l)!=null&&g.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.frame=!0,l.key=T;break}case 5:u=!0,(h=l)!=null&&h.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 6:{u=!0,ad(c.data,1,n.pts,t.samples);break}case 7:{var E,y;u=!0,f=!0;const T=c.data,S=this.readSPS(T);if(!e.sps||e.width!==S.width||e.height!==S.height||((E=e.pixelRatio)==null?void 0:E[0])!==S.pixelRatio[0]||((y=e.pixelRatio)==null?void 0:y[1])!==S.pixelRatio[1]){e.width=S.width,e.height=S.height,e.pixelRatio=S.pixelRatio,e.sps=[T];const A=T.subarray(1,4);let w="avc1.";for(let I=0;I<3;I++){let b=A[I].toString(16);b.length<2&&(b="0"+b),w+=b}e.codec=w}break}case 8:u=!0,e.pps=[c.data];break;case 9:u=!0,e.audFound=!0,(m=l)!=null&&m.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;case 12:u=!0;break;default:u=!1;break}l&&u&&l.units.push(c)}),r&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}getNALuType(e,t){return e[t]&31}readSliceType(e){const t=new wi(e);return t.readUByte(),t.readUEG(),t.readUEG()}skipScalingList(e,t){let n=8,r=8,a;for(let l=0;l<e;l++)r!==0&&(a=t.readEG(),r=(n+a+256)%256),n=r===0?n:r}readSPS(e){const t=new wi(e);let n=0,r=0,a=0,l=0,u,f,c;const h=t.readUByte.bind(t),m=t.readBits.bind(t),g=t.readUEG.bind(t),E=t.readBoolean.bind(t),y=t.skipBits.bind(t),T=t.skipEG.bind(t),S=t.skipUEG.bind(t),A=this.skipScalingList.bind(this);h();const w=h();if(m(5),y(3),h(),S(),w===100||w===110||w===122||w===244||w===44||w===83||w===86||w===118||w===128){const M=g();if(M===3&&y(1),S(),S(),y(1),E())for(f=M!==3?8:12,c=0;c<f;c++)E()&&(c<6?A(16,t):A(64,t))}S();const I=g();if(I===0)g();else if(I===1)for(y(1),T(),T(),u=g(),c=0;c<u;c++)T();S(),y(1);const b=g(),P=g(),G=m(1);G===0&&y(1),y(1),E()&&(n=g(),r=g(),a=g(),l=g());let D=[1,1];if(E()&&E())switch(h()){case 1:D=[1,1];break;case 2:D=[12,11];break;case 3:D=[10,11];break;case 4:D=[16,11];break;case 5:D=[40,33];break;case 6:D=[24,11];break;case 7:D=[20,11];break;case 8:D=[32,11];break;case 9:D=[80,33];break;case 10:D=[18,11];break;case 11:D=[15,11];break;case 12:D=[64,33];break;case 13:D=[160,99];break;case 14:D=[4,3];break;case 15:D=[3,2];break;case 16:D=[2,1];break;case 255:{D=[h()<<8|h(),h()<<8|h()];break}}return{width:Math.ceil((b+1)*16-n*2-r*2),height:(2-G)*(P+1)*16-(G?2:4)*(a+l),pixelRatio:D}}}class Pp extends H0{constructor(...e){super(...e),this.initVPS=null}parsePES(e,t,n,r){const a=this.parseNALu(e,n.data,r);let l=this.VideoSample,u,f=!1;n.data=null,l&&a.length&&!e.audFound&&(this.pushAccessUnit(l,e),l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),a.forEach(c=>{var h,m;switch(c.type){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:case 8:case 9:l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts)),l.frame=!0,u=!0;break;case 16:case 17:case 18:case 21:if(u=!0,f){var g;(g=l)!=null&&g.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null)}l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 19:case 20:u=!0,(h=l)!=null&&h.frame&&!l.key&&(this.pushAccessUnit(l,e),l=this.VideoSample=null),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0,l.frame=!0;break;case 39:u=!0,ad(c.data,2,n.pts,t.samples);break;case 32:u=!0,e.vps||(typeof e.params!="object"&&(e.params={}),e.params=Ue(e.params,this.readVPS(c.data)),this.initVPS=c.data),e.vps=[c.data];break;case 33:if(u=!0,f=!0,e.vps!==void 0&&e.vps[0]!==this.initVPS&&e.sps!==void 0&&!this.matchSPS(e.sps[0],c.data)&&(this.initVPS=e.vps[0],e.sps=e.pps=void 0),!e.sps){const E=this.readSPS(c.data);e.width=E.width,e.height=E.height,e.pixelRatio=E.pixelRatio,e.codec=E.codecString,e.sps=[],typeof e.params!="object"&&(e.params={});for(const y in E.params)e.params[y]=E.params[y]}this.pushParameterSet(e.sps,c.data,e.vps),l||(l=this.VideoSample=this.createVideoSample(!0,n.pts,n.dts)),l.key=!0;break;case 34:if(u=!0,typeof e.params=="object"){if(!e.pps){e.pps=[];const E=this.readPPS(c.data);for(const y in E)e.params[y]=E[y]}this.pushParameterSet(e.pps,c.data,e.vps)}break;case 35:u=!0,e.audFound=!0,(m=l)!=null&&m.frame&&(this.pushAccessUnit(l,e),l=null),l||(l=this.VideoSample=this.createVideoSample(!1,n.pts,n.dts));break;default:u=!1;break}l&&u&&l.units.push(c)}),r&&l&&(this.pushAccessUnit(l,e),this.VideoSample=null)}pushParameterSet(e,t,n){(n&&n[0]===this.initVPS||!n&&!e.length)&&e.push(t)}getNALuType(e,t){return(e[t]&126)>>>1}ebsp2rbsp(e){const t=new Uint8Array(e.byteLength);let n=0;for(let r=0;r<e.byteLength;r++)r>=2&&e[r]===3&&e[r-1]===0&&e[r-2]===0||(t[n]=e[r],n++);return new Uint8Array(t.buffer,0,n)}pushAccessUnit(e,t){super.pushAccessUnit(e,t),this.initVPS&&(this.initVPS=null)}readVPS(e){const t=new wi(e);t.readUByte(),t.readUByte(),t.readBits(4),t.skipBits(2),t.readBits(6);const n=t.readBits(3),r=t.readBoolean();return{numTemporalLayers:n+1,temporalIdNested:r}}readSPS(e){const t=new wi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.readBits(4);const n=t.readBits(3);t.readBoolean();const r=t.readBits(2),a=t.readBoolean(),l=t.readBits(5),u=t.readUByte(),f=t.readUByte(),c=t.readUByte(),h=t.readUByte(),m=t.readUByte(),g=t.readUByte(),E=t.readUByte(),y=t.readUByte(),T=t.readUByte(),S=t.readUByte(),A=t.readUByte(),w=[],I=[];for(let Pe=0;Pe<n;Pe++)w.push(t.readBoolean()),I.push(t.readBoolean());if(n>0)for(let Pe=n;Pe<8;Pe++)t.readBits(2);for(let Pe=0;Pe<n;Pe++)w[Pe]&&(t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte(),t.readUByte()),I[Pe]&&t.readUByte();t.readUEG();const b=t.readUEG();b==3&&t.skipBits(1);const P=t.readUEG(),G=t.readUEG(),D=t.readBoolean();let M=0,B=0,O=0,X=0;D&&(M+=t.readUEG(),B+=t.readUEG(),O+=t.readUEG(),X+=t.readUEG());const re=t.readUEG(),de=t.readUEG(),ae=t.readUEG(),oe=t.readBoolean();for(let Pe=oe?0:n;Pe<=n;Pe++)t.skipUEG(),t.skipUEG(),t.skipUEG();if(t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.skipUEG(),t.readBoolean()&&t.readBoolean())for(let nt=0;nt<4;nt++)for(let Lt=0;Lt<(nt===3?2:6);Lt++)if(!t.readBoolean())t.readUEG();else{const mt=Math.min(64,1<<4+(nt<<1));nt>1&&t.readEG();for(let Ft=0;Ft<mt;Ft++)t.readEG()}t.readBoolean(),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.skipUEG(),t.skipUEG(),t.readBoolean());const $=t.readUEG();let J=0;for(let Pe=0;Pe<$;Pe++){let nt=!1;if(Pe!==0&&(nt=t.readBoolean()),nt){Pe===$&&t.readUEG(),t.readBoolean(),t.readUEG();let Lt=0;for(let tn=0;tn<=J;tn++){const mt=t.readBoolean();let Ft=!1;mt||(Ft=t.readBoolean()),(mt||Ft)&&Lt++}J=Lt}else{const Lt=t.readUEG(),tn=t.readUEG();J=Lt+tn;for(let mt=0;mt<Lt;mt++)t.readUEG(),t.readBoolean();for(let mt=0;mt<tn;mt++)t.readUEG(),t.readBoolean()}}if(t.readBoolean()){const Pe=t.readUEG();for(let nt=0;nt<Pe;nt++){for(let Lt=0;Lt<ae+4;Lt++)t.readBits(1);t.readBits(1)}}let C=0,U=1,le=1,ue=!0,ge=1,he=0;t.readBoolean(),t.readBoolean();let Le=!1;if(t.readBoolean()){if(t.readBoolean()){const nn=t.readUByte(),Os=[1,12,10,16,40,24,20,32,80,18,15,64,160,4,3,2],Lr=[1,11,11,11,33,11,11,11,33,11,11,33,99,3,2,1];nn>0&&nn<16?(U=Os[nn-1],le=Lr[nn-1]):nn===255&&(U=t.readBits(16),le=t.readBits(16))}if(t.readBoolean()&&t.readBoolean(),t.readBoolean()&&(t.readBits(3),t.readBoolean(),t.readBoolean()&&(t.readUByte(),t.readUByte(),t.readUByte())),t.readBoolean()&&(t.readUEG(),t.readUEG()),t.readBoolean(),t.readBoolean(),t.readBoolean(),Le=t.readBoolean(),Le&&(M+=t.readUEG(),B+=t.readUEG(),O+=t.readUEG(),X+=t.readUEG()),t.readBoolean()&&(ge=t.readBits(32),he=t.readBits(32),t.readBoolean()&&t.readUEG(),t.readBoolean())){const Lr=t.readBoolean(),Ns=t.readBoolean();let Yn=!1;(Lr||Ns)&&(Yn=t.readBoolean(),Yn&&(t.readUByte(),t.readBits(5),t.readBoolean(),t.readBits(5)),t.readBits(4),t.readBits(4),Yn&&t.readBits(4),t.readBits(5),t.readBits(5),t.readBits(5));for(let Kr=0;Kr<=n;Kr++){ue=t.readBoolean();const zr=ue||t.readBoolean();let Fs=!1;zr?t.readEG():Fs=t.readBoolean();const qn=Fs?1:t.readUEG()+1;if(Lr)for(let rn=0;rn<qn;rn++)t.readUEG(),t.readUEG(),Yn&&(t.readUEG(),t.readUEG()),t.skipBits(1);if(Ns)for(let rn=0;rn<qn;rn++)t.readUEG(),t.readUEG(),Yn&&(t.readUEG(),t.readUEG()),t.skipBits(1)}}t.readBoolean()&&(t.readBoolean(),t.readBoolean(),t.readBoolean(),C=t.readUEG())}let be=P,$e=G;if(D||Le){let Pe=1,nt=1;b===1?Pe=nt=2:b==2&&(Pe=2),be=P-Pe*B-Pe*M,$e=G-nt*X-nt*O}const Ht=r?["A","B","C"][r]:"",Vi=u<<24|f<<16|c<<8|h;let Wn=0;for(let Pe=0;Pe<32;Pe++)Wn=(Wn|(Vi>>Pe&1)<<31-Pe)>>>0;let Tr=Wn.toString(16);return l===1&&Tr==="2"&&(Tr="6"),{codecString:`hvc1.${Ht}${l}.${Tr}.${a?"H":"L"}${A}.B0`,params:{general_tier_flag:a,general_profile_idc:l,general_profile_space:r,general_profile_compatibility_flags:[u,f,c,h],general_constraint_indicator_flags:[m,g,E,y,T,S],general_level_idc:A,bit_depth:re+8,bit_depth_luma_minus8:re,bit_depth_chroma_minus8:de,min_spatial_segmentation_idc:C,chroma_format_idc:b,frame_rate:{fixed:ue,fps:he/ge}},width:be,height:$e,pixelRatio:[U,le]}}readPPS(e){const t=new wi(this.ebsp2rbsp(e));t.readUByte(),t.readUByte(),t.skipUEG(),t.skipUEG(),t.skipBits(2),t.skipBits(3),t.skipBits(2),t.skipUEG(),t.skipUEG(),t.skipEG(),t.skipBits(2),t.readBoolean()&&t.skipUEG(),t.skipEG(),t.skipEG(),t.skipBits(4);const r=t.readBoolean(),a=t.readBoolean();let l=1;return a&&r?l=0:a?l=3:r&&(l=2),{parallelismType:l}}matchSPS(e,t){return String.fromCharCode.apply(null,e).substr(3)===String.fromCharCode.apply(null,t).substr(3)}}const ft=188;class vr{constructor(e,t,n,r){this.logger=void 0,this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.sampleAes=null,this.pmtParsed=!1,this.audioCodec=void 0,this.videoCodec=void 0,this._pmtId=-1,this._videoTrack=void 0,this._audioTrack=void 0,this._id3Track=void 0,this._txtTrack=void 0,this.aacOverFlow=null,this.remainderData=null,this.videoParser=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.logger=r,this.videoParser=null}static probe(e,t){const n=vr.syncOffset(e);return n>0&&t.warn(`MPEG2-TS detected but first sync word found @ offset ${n}`),n!==-1}static syncOffset(e){const t=e.length;let n=Math.min(ft*5,t-ft)+1,r=0;for(;r<n;){let a=!1,l=-1,u=0;for(let f=r;f<t;f+=ft)if(e[f]===71&&(t-f===ft||e[f+ft]===71)){if(u++,l===-1&&(l=f,l!==0&&(n=Math.min(l+ft*99,e.length-ft)+1)),a||(a=Bc(e,f)===0),a&&u>1&&(l===0&&u>2||f+ft>n))return l}else{if(u)return-1;break}r++}return-1}static createTrack(e,t){return{container:e==="video"||e==="audio"?"video/mp2t":void 0,type:e,id:n0[e],pid:-1,inputTimeScale:9e4,sequenceNumber:0,samples:[],dropped:0,duration:e==="audio"?t:void 0}}resetInitSegment(e,t,n,r){this.pmtParsed=!1,this._pmtId=-1,this._videoTrack=vr.createTrack("video"),this._videoTrack.duration=r,this._audioTrack=vr.createTrack("audio",r),this._id3Track=vr.createTrack("id3"),this._txtTrack=vr.createTrack("text"),this._audioTrack.segmentCodec="aac",this.aacOverFlow=null,this.remainderData=null,this.audioCodec=t,this.videoCodec=n}resetTimeStamp(){}resetContiguity(){const{_audioTrack:e,_videoTrack:t,_id3Track:n}=this;e&&(e.pesData=null),t&&(t.pesData=null),n&&(n.pesData=null),this.aacOverFlow=null,this.remainderData=null}demux(e,t,n=!1,r=!1){n||(this.sampleAes=null);let a;const l=this._videoTrack,u=this._audioTrack,f=this._id3Track,c=this._txtTrack;let h=l.pid,m=l.pesData,g=u.pid,E=f.pid,y=u.pesData,T=f.pesData,S=null,A=this.pmtParsed,w=this._pmtId,I=e.length;if(this.remainderData&&(e=en(this.remainderData,e),I=e.length,this.remainderData=null),I<ft&&!r)return this.remainderData=e,{audioTrack:u,videoTrack:l,id3Track:f,textTrack:c};const b=Math.max(0,vr.syncOffset(e));I-=(I-b)%ft,I<e.byteLength&&!r&&(this.remainderData=new Uint8Array(e.buffer,I,e.buffer.byteLength-I));let P=0;for(let D=b;D<I;D+=ft)if(e[D]===71){const M=!!(e[D+1]&64),B=Bc(e,D),O=(e[D+3]&48)>>4;let X;if(O>1){if(X=D+5+e[D+4],X===D+ft)continue}else X=D+4;switch(B){case h:if(M){if(m&&(a=Es(m,this.logger))){if(this.videoParser===null)switch(l.segmentCodec){case"avc":this.videoParser=new Dp;break;case"hevc":this.videoParser=new Pp;break}this.videoParser!==null&&this.videoParser.parsePES(l,c,a,!1)}m={data:[],size:0}}m&&(m.data.push(e.subarray(X,D+ft)),m.size+=D+ft-X);break;case g:if(M){if(y&&(a=Es(y,this.logger)))switch(u.segmentCodec){case"aac":this.parseAACPES(u,a);break;case"mp3":this.parseMPEGPES(u,a);break;case"ac3":this.parseAC3PES(u,a);break}y={data:[],size:0}}y&&(y.data.push(e.subarray(X,D+ft)),y.size+=D+ft-X);break;case E:M&&(T&&(a=Es(T,this.logger))&&this.parseID3PES(f,a),T={data:[],size:0}),T&&(T.data.push(e.subarray(X,D+ft)),T.size+=D+ft-X);break;case 0:M&&(X+=e[X]+1),w=this._pmtId=uR(e,X);break;case w:{M&&(X+=e[X]+1);const re=cR(e,X,this.typeSupported,n,this.observer,this.logger);h=re.videoPid,h>0&&(l.pid=h,l.segmentCodec=re.segmentVideoCodec),g=re.audioPid,g>0&&(u.pid=g,u.segmentCodec=re.segmentAudioCodec),E=re.id3Pid,E>0&&(f.pid=E),S!==null&&!A&&(this.logger.warn(`MPEG-TS PMT found at ${D} after unknown PID '${S}'. Backtracking to sync byte @${b} to parse all TS packets.`),S=null,D=b-188),A=this.pmtParsed=!0;break}case 17:case 8191:break;default:S=B;break}}else P++;P>0&&$c(this.observer,new Error(`Found ${P} TS packet/s that do not start with 0x47`),void 0,this.logger),l.pesData=m,u.pesData=y,f.pesData=T;const G={audioTrack:u,videoTrack:l,id3Track:f,textTrack:c};return r&&this.extractRemainingSamples(G),G}flush(){const{remainderData:e}=this;this.remainderData=null;let t;return e?t=this.demux(e,-1,!1,!0):t={videoTrack:this._videoTrack,audioTrack:this._audioTrack,id3Track:this._id3Track,textTrack:this._txtTrack},this.extractRemainingSamples(t),this.sampleAes?this.decrypt(t,this.sampleAes):t}extractRemainingSamples(e){const{audioTrack:t,videoTrack:n,id3Track:r,textTrack:a}=e,l=n.pesData,u=t.pesData,f=r.pesData;let c;if(l&&(c=Es(l,this.logger))){if(this.videoParser===null)switch(n.segmentCodec){case"avc":this.videoParser=new Dp;break;case"hevc":this.videoParser=new Pp;break}this.videoParser!==null&&(this.videoParser.parsePES(n,a,c,!0),n.pesData=null)}else n.pesData=l;if(u&&(c=Es(u,this.logger))){switch(t.segmentCodec){case"aac":this.parseAACPES(t,c);break;case"mp3":this.parseMPEGPES(t,c);break;case"ac3":this.parseAC3PES(t,c);break}t.pesData=null}else u!=null&&u.size&&this.logger.log("last AAC PES packet truncated,might overlap between fragments"),t.pesData=u;f&&(c=Es(f,this.logger))?(this.parseID3PES(r,c),r.pesData=null):r.pesData=f}demuxSampleAes(e,t,n){const r=this.demux(e,n,!0,!this.config.progressive),a=this.sampleAes=new lR(this.observer,this.config,t);return this.decrypt(r,a)}decrypt(e,t){return new Promise(n=>{const{audioTrack:r,videoTrack:a}=e;r.samples&&r.segmentCodec==="aac"?t.decryptAacSamples(r.samples,0,()=>{a.samples?t.decryptAvcSamples(a.samples,0,0,()=>{n(e)}):n(e)}):a.samples&&t.decryptAvcSamples(a.samples,0,0,()=>{n(e)})})}destroy(){this.observer&&this.observer.removeAllListeners(),this.config=this.logger=this.observer=null,this.aacOverFlow=this.videoParser=this.remainderData=this.sampleAes=null,this._videoTrack=this._audioTrack=this._id3Track=this._txtTrack=void 0}parseAACPES(e,t){let n=0;const r=this.aacOverFlow;let a=t.data;if(r){this.aacOverFlow=null;const m=r.missing,g=r.sample.unit.byteLength;if(m===-1)a=en(r.sample.unit,a);else{const E=g-m;r.sample.unit.set(a.subarray(0,m),E),e.samples.push(r.sample),n=r.missing}}let l,u;for(l=n,u=a.length;l<u-1&&!Uo(a,l);l++);if(l!==n){let m;const g=l<u-1;if(g?m=`AAC PES did not start with ADTS header,offset:${l}`:m="No ADTS header found in AAC PES",$c(this.observer,new Error(m),g,this.logger),!g)return}P0(e,this.observer,a,l,this.audioCodec);let f;if(t.pts!==void 0)f=t.pts;else if(r){const m=O0(e.samplerate);f=r.sample.pts+m}else{this.logger.warn("[tsdemuxer]: AAC PES unknown PTS");return}let c=0,h;for(;l<u;)if(h=N0(e,a,l,f,c),l+=h.length,h.missing){this.aacOverFlow=h;break}else for(c++;l<u-1&&!Uo(a,l);l++);}parseMPEGPES(e,t){const n=t.data,r=n.length;let a=0,l=0;const u=t.pts;if(u===void 0){this.logger.warn("[tsdemuxer]: MPEG PES unknown PTS");return}for(;l<r;)if($0(n,l)){const f=U0(e,n,l,u,a);if(f)l+=f.length,a++;else break}else l++}parseAC3PES(e,t){{const n=t.data,r=t.pts;if(r===void 0){this.logger.warn("[tsdemuxer]: AC3 PES unknown PTS");return}const a=n.length;let l=0,u=0,f;for(;u<a&&(f=V0(e,n,u,r,l++))>0;)u+=f}}parseID3PES(e,t){if(t.pts===void 0){this.logger.warn("[tsdemuxer]: ID3 PES unknown PTS");return}const n=Ue({},t,{type:this._videoTrack?Gt.emsg:Gt.audioId3,duration:Number.POSITIVE_INFINITY});e.samples.push(n)}}function Bc(i,e){return((i[e+1]&31)<<8)+i[e+2]}function uR(i,e){return(i[e+10]&31)<<8|i[e+11]}function cR(i,e,t,n,r,a){const l={audioPid:-1,videoPid:-1,id3Pid:-1,segmentVideoCodec:"avc",segmentAudioCodec:"aac"},u=(i[e+1]&15)<<8|i[e+2],f=e+3+u-4,c=(i[e+10]&15)<<8|i[e+11];for(e+=12+c;e<f;){const h=Bc(i,e),m=(i[e+3]&15)<<8|i[e+4];switch(i[e]){case 207:if(!n){ac("ADTS AAC",a);break}case 15:l.audioPid===-1&&(l.audioPid=h);break;case 21:l.id3Pid===-1&&(l.id3Pid=h);break;case 219:if(!n){ac("H.264",a);break}case 27:l.videoPid===-1&&(l.videoPid=h);break;case 3:case 4:!t.mpeg&&!t.mp3?a.log("MPEG audio found, not supported in this browser"):l.audioPid===-1&&(l.audioPid=h,l.segmentAudioCodec="mp3");break;case 193:if(!n){ac("AC-3",a);break}case 129:t.ac3?l.audioPid===-1&&(l.audioPid=h,l.segmentAudioCodec="ac3"):a.log("AC-3 audio found, not supported in this browser");break;case 6:if(l.audioPid===-1&&m>0){let g=e+5,E=m;for(;E>2;){switch(i[g]){case 106:t.ac3!==!0?a.log("AC-3 audio found, not supported in this browser for now"):(l.audioPid=h,l.segmentAudioCodec="ac3");break}const T=i[g+1]+2;g+=T,E-=T}}break;case 194:case 135:return $c(r,new Error("Unsupported EC-3 in M2TS found"),void 0,a),l;case 36:l.videoPid===-1&&(l.videoPid=h,l.segmentVideoCodec="hevc",a.log("HEVC in M2TS found"));break}e+=m+5}return l}function $c(i,e,t,n){n.warn(`parsing error: ${e.message}`),i.emit(L.ERROR,L.ERROR,{type:xe.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,levelRetry:t,error:e,reason:e.message})}function ac(i,e){e.log(`${i} with AES-128-CBC encryption found in unencrypted stream`)}function Es(i,e){let t=0,n,r,a,l,u;const f=i.data;if(!i||i.size===0)return null;for(;f[0].length<19&&f.length>1;)f[0]=en(f[0],f[1]),f.splice(1,1);if(n=f[0],(n[0]<<16)+(n[1]<<8)+n[2]===1){if(r=(n[4]<<8)+n[5],r&&r>i.size-6)return null;const h=n[7];h&192&&(l=(n[9]&14)*536870912+(n[10]&255)*4194304+(n[11]&254)*16384+(n[12]&255)*128+(n[13]&254)/2,h&64?(u=(n[14]&14)*536870912+(n[15]&255)*4194304+(n[16]&254)*16384+(n[17]&255)*128+(n[18]&254)/2,l-u>60*9e4&&(e.warn(`${Math.round((l-u)/9e4)}s delta between PTS and DTS, align them`),l=u)):u=l),a=n[8];let m=a+9;if(i.size<=m)return null;i.size-=m;const g=new Uint8Array(i.size);for(let E=0,y=f.length;E<y;E++){n=f[E];let T=n.byteLength;if(m)if(m>T){m-=T;continue}else n=n.subarray(m),T-=m,m=0;g.set(n,t),t+=T}return r&&(r-=a+3),{data:g,pts:l,dts:u,len:r}}return null}class dR{static getSilentFrame(e,t){switch(e){case"mp4a.40.2":if(t===1)return new Uint8Array([0,200,0,128,35,128]);if(t===2)return new Uint8Array([33,0,73,144,2,25,0,35,128]);if(t===3)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,142]);if(t===4)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,128,44,128,8,2,56]);if(t===5)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,56]);if(t===6)return new Uint8Array([0,200,0,128,32,132,1,38,64,8,100,0,130,48,4,153,0,33,144,2,0,178,0,32,8,224]);break;default:if(t===1)return new Uint8Array([1,64,34,128,163,78,230,128,186,8,0,0,0,28,6,241,193,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===2)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);if(t===3)return new Uint8Array([1,64,34,128,163,94,230,128,186,8,0,0,0,0,149,0,6,241,161,10,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,90,94]);break}}}const pr=Math.pow(2,32)-1;class j{static init(){j.types={avc1:[],avcC:[],hvc1:[],hvcC:[],btrt:[],dinf:[],dref:[],esds:[],ftyp:[],hdlr:[],mdat:[],mdhd:[],mdia:[],mfhd:[],minf:[],moof:[],moov:[],mp4a:[],".mp3":[],dac3:[],"ac-3":[],mvex:[],mvhd:[],pasp:[],sdtp:[],stbl:[],stco:[],stsc:[],stsd:[],stsz:[],stts:[],tfdt:[],tfhd:[],traf:[],trak:[],trun:[],trex:[],tkhd:[],vmhd:[],smhd:[]};let e;for(e in j.types)j.types.hasOwnProperty(e)&&(j.types[e]=[e.charCodeAt(0),e.charCodeAt(1),e.charCodeAt(2),e.charCodeAt(3)]);const t=new Uint8Array([0,0,0,0,0,0,0,0,118,105,100,101,0,0,0,0,0,0,0,0,0,0,0,0,86,105,100,101,111,72,97,110,100,108,101,114,0]),n=new Uint8Array([0,0,0,0,0,0,0,0,115,111,117,110,0,0,0,0,0,0,0,0,0,0,0,0,83,111,117,110,100,72,97,110,100,108,101,114,0]);j.HDLR_TYPES={video:t,audio:n};const r=new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,12,117,114,108,32,0,0,0,1]),a=new Uint8Array([0,0,0,0,0,0,0,0]);j.STTS=j.STSC=j.STCO=a,j.STSZ=new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0]),j.VMHD=new Uint8Array([0,0,0,1,0,0,0,0,0,0,0,0]),j.SMHD=new Uint8Array([0,0,0,0,0,0,0,0]),j.STSD=new Uint8Array([0,0,0,0,0,0,0,1]);const l=new Uint8Array([105,115,111,109]),u=new Uint8Array([97,118,99,49]),f=new Uint8Array([0,0,0,1]);j.FTYP=j.box(j.types.ftyp,l,f,l,u),j.DINF=j.box(j.types.dinf,j.box(j.types.dref,r))}static box(e,...t){let n=8,r=t.length;const a=r;for(;r--;)n+=t[r].byteLength;const l=new Uint8Array(n);for(l[0]=n>>24&255,l[1]=n>>16&255,l[2]=n>>8&255,l[3]=n&255,l.set(e,4),r=0,n=8;r<a;r++)l.set(t[r],n),n+=t[r].byteLength;return l}static hdlr(e){return j.box(j.types.hdlr,j.HDLR_TYPES[e])}static mdat(e){return j.box(j.types.mdat,e)}static mdhd(e,t){t*=e;const n=Math.floor(t/(pr+1)),r=Math.floor(t%(pr+1));return j.box(j.types.mdhd,new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,85,196,0,0]))}static mdia(e){return j.box(j.types.mdia,j.mdhd(e.timescale||0,e.duration||0),j.hdlr(e.type),j.minf(e))}static mfhd(e){return j.box(j.types.mfhd,new Uint8Array([0,0,0,0,e>>24,e>>16&255,e>>8&255,e&255]))}static minf(e){return e.type==="audio"?j.box(j.types.minf,j.box(j.types.smhd,j.SMHD),j.DINF,j.stbl(e)):j.box(j.types.minf,j.box(j.types.vmhd,j.VMHD),j.DINF,j.stbl(e))}static moof(e,t,n){return j.box(j.types.moof,j.mfhd(e),j.traf(n,t))}static moov(e){let t=e.length;const n=[];for(;t--;)n[t]=j.trak(e[t]);return j.box.apply(null,[j.types.moov,j.mvhd(e[0].timescale||0,e[0].duration||0)].concat(n).concat(j.mvex(e)))}static mvex(e){let t=e.length;const n=[];for(;t--;)n[t]=j.trex(e[t]);return j.box.apply(null,[j.types.mvex,...n])}static mvhd(e,t){t*=e;const n=Math.floor(t/(pr+1)),r=Math.floor(t%(pr+1)),a=new Uint8Array([1,0,0,0,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,e>>24&255,e>>16&255,e>>8&255,e&255,n>>24,n>>16&255,n>>8&255,n&255,r>>24,r>>16&255,r>>8&255,r&255,0,1,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,255,255,255,255]);return j.box(j.types.mvhd,a)}static sdtp(e){const t=e.samples||[],n=new Uint8Array(4+t.length);let r,a;for(r=0;r<t.length;r++)a=t[r].flags,n[r+4]=a.dependsOn<<4|a.isDependedOn<<2|a.hasRedundancy;return j.box(j.types.sdtp,n)}static stbl(e){return j.box(j.types.stbl,j.stsd(e),j.box(j.types.stts,j.STTS),j.box(j.types.stsc,j.STSC),j.box(j.types.stsz,j.STSZ),j.box(j.types.stco,j.STCO))}static avc1(e){let t=[],n=[],r,a,l;for(r=0;r<e.sps.length;r++)a=e.sps[r],l=a.byteLength,t.push(l>>>8&255),t.push(l&255),t=t.concat(Array.prototype.slice.call(a));for(r=0;r<e.pps.length;r++)a=e.pps[r],l=a.byteLength,n.push(l>>>8&255),n.push(l&255),n=n.concat(Array.prototype.slice.call(a));const u=j.box(j.types.avcC,new Uint8Array([1,t[3],t[4],t[5],255,224|e.sps.length].concat(t).concat([e.pps.length]).concat(n))),f=e.width,c=e.height,h=e.pixelRatio[0],m=e.pixelRatio[1];return j.box(j.types.avc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,f>>8&255,f&255,c>>8&255,c&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),u,j.box(j.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),j.box(j.types.pasp,new Uint8Array([h>>24,h>>16&255,h>>8&255,h&255,m>>24,m>>16&255,m>>8&255,m&255])))}static esds(e){const t=e.config;return new Uint8Array([0,0,0,0,3,25,0,1,0,4,17,64,21,0,0,0,0,0,0,0,0,0,0,0,5,2,...t,6,1,2])}static audioStsd(e){const t=e.samplerate||0;return new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,e.channelCount||0,0,16,0,0,0,0,t>>8&255,t&255,0,0])}static mp4a(e){return j.box(j.types.mp4a,j.audioStsd(e),j.box(j.types.esds,j.esds(e)))}static mp3(e){return j.box(j.types[".mp3"],j.audioStsd(e))}static ac3(e){return j.box(j.types["ac-3"],j.audioStsd(e),j.box(j.types.dac3,e.config))}static stsd(e){const{segmentCodec:t}=e;if(e.type==="audio"){if(t==="aac")return j.box(j.types.stsd,j.STSD,j.mp4a(e));if(t==="ac3"&&e.config)return j.box(j.types.stsd,j.STSD,j.ac3(e));if(t==="mp3"&&e.codec==="mp3")return j.box(j.types.stsd,j.STSD,j.mp3(e))}else if(e.pps&&e.sps){if(t==="avc")return j.box(j.types.stsd,j.STSD,j.avc1(e));if(t==="hevc"&&e.vps)return j.box(j.types.stsd,j.STSD,j.hvc1(e))}else throw new Error("video track missing pps or sps");throw new Error(`unsupported ${e.type} segment codec (${t}/${e.codec})`)}static tkhd(e){const t=e.id,n=(e.duration||0)*(e.timescale||0),r=e.width||0,a=e.height||0,l=Math.floor(n/(pr+1)),u=Math.floor(n%(pr+1));return j.box(j.types.tkhd,new Uint8Array([1,0,0,7,0,0,0,0,0,0,0,2,0,0,0,0,0,0,0,3,t>>24&255,t>>16&255,t>>8&255,t&255,0,0,0,0,l>>24,l>>16&255,l>>8&255,l&255,u>>24,u>>16&255,u>>8&255,u&255,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,64,0,0,0,r>>8&255,r&255,0,0,a>>8&255,a&255,0,0]))}static traf(e,t){const n=j.sdtp(e),r=e.id,a=Math.floor(t/(pr+1)),l=Math.floor(t%(pr+1));return j.box(j.types.traf,j.box(j.types.tfhd,new Uint8Array([0,0,0,0,r>>24,r>>16&255,r>>8&255,r&255])),j.box(j.types.tfdt,new Uint8Array([1,0,0,0,a>>24,a>>16&255,a>>8&255,a&255,l>>24,l>>16&255,l>>8&255,l&255])),j.trun(e,n.length+16+20+8+16+8+8),n)}static trak(e){return e.duration=e.duration||4294967295,j.box(j.types.trak,j.tkhd(e),j.mdia(e))}static trex(e){const t=e.id;return j.box(j.types.trex,new Uint8Array([0,0,0,0,t>>24,t>>16&255,t>>8&255,t&255,0,0,0,1,0,0,0,0,0,0,0,0,0,1,0,1]))}static trun(e,t){const n=e.samples||[],r=n.length,a=12+16*r,l=new Uint8Array(a);let u,f,c,h,m,g;for(t+=8+a,l.set([e.type==="video"?1:0,0,15,1,r>>>24&255,r>>>16&255,r>>>8&255,r&255,t>>>24&255,t>>>16&255,t>>>8&255,t&255],0),u=0;u<r;u++)f=n[u],c=f.duration,h=f.size,m=f.flags,g=f.cts,l.set([c>>>24&255,c>>>16&255,c>>>8&255,c&255,h>>>24&255,h>>>16&255,h>>>8&255,h&255,m.isLeading<<2|m.dependsOn,m.isDependedOn<<6|m.hasRedundancy<<4|m.paddingValue<<1|m.isNonSync,m.degradPrio&61440,m.degradPrio&15,g>>>24&255,g>>>16&255,g>>>8&255,g&255],12+16*u);return j.box(j.types.trun,l)}static initSegment(e){j.types||j.init();const t=j.moov(e);return en(j.FTYP,t)}static hvc1(e){const t=e.params,n=[e.vps,e.sps,e.pps],r=4,a=new Uint8Array([1,t.general_profile_space<<6|(t.general_tier_flag?32:0)|t.general_profile_idc,t.general_profile_compatibility_flags[0],t.general_profile_compatibility_flags[1],t.general_profile_compatibility_flags[2],t.general_profile_compatibility_flags[3],t.general_constraint_indicator_flags[0],t.general_constraint_indicator_flags[1],t.general_constraint_indicator_flags[2],t.general_constraint_indicator_flags[3],t.general_constraint_indicator_flags[4],t.general_constraint_indicator_flags[5],t.general_level_idc,240|t.min_spatial_segmentation_idc>>8,255&t.min_spatial_segmentation_idc,252|t.parallelismType,252|t.chroma_format_idc,248|t.bit_depth_luma_minus8,248|t.bit_depth_chroma_minus8,0,parseInt(t.frame_rate.fps),r-1|t.temporal_id_nested<<2|t.num_temporal_layers<<3|(t.frame_rate.fixed?64:0),n.length]);let l=a.length;for(let y=0;y<n.length;y+=1){l+=3;for(let T=0;T<n[y].length;T+=1)l+=2+n[y][T].length}const u=new Uint8Array(l);u.set(a,0),l=a.length;const f=n.length-1;for(let y=0;y<n.length;y+=1){u.set(new Uint8Array([32+y|(y===f?128:0),0,n[y].length]),l),l+=3;for(let T=0;T<n[y].length;T+=1)u.set(new Uint8Array([n[y][T].length>>8,n[y][T].length&255]),l),l+=2,u.set(n[y][T],l),l+=n[y][T].length}const c=j.box(j.types.hvcC,u),h=e.width,m=e.height,g=e.pixelRatio[0],E=e.pixelRatio[1];return j.box(j.types.hvc1,new Uint8Array([0,0,0,0,0,0,0,1,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,h>>8&255,h&255,m>>8&255,m&255,0,72,0,0,0,72,0,0,0,0,0,0,0,1,18,100,97,105,108,121,109,111,116,105,111,110,47,104,108,115,46,106,115,0,0,0,0,0,0,0,0,0,0,0,0,0,0,24,17,17]),c,j.box(j.types.btrt,new Uint8Array([0,28,156,128,0,45,198,192,0,45,198,192])),j.box(j.types.pasp,new Uint8Array([g>>24,g>>16&255,g>>8&255,g&255,E>>24,E>>16&255,E>>8&255,E&255])))}}j.types=void 0;j.HDLR_TYPES=void 0;j.STTS=void 0;j.STSC=void 0;j.STCO=void 0;j.STSZ=void 0;j.VMHD=void 0;j.SMHD=void 0;j.STSD=void 0;j.FTYP=void 0;j.DINF=void 0;const K0=9e4;function xd(i,e,t=1,n=!1){const r=i*e*t;return n?Math.round(r):r}function fR(i,e,t=1,n=!1){return xd(i,e,1/t,n)}function Li(i,e=!1){return xd(i,1e3,1/K0,e)}function hR(i,e=1){return xd(i,K0,1/e)}const mR=10*1e3,pR=1024,gR=1152,yR=1536;let xs=null,oc=null;function Op(i,e,t,n){return{duration:e,size:t,cts:n,flags:{isLeading:0,isDependedOn:0,hasRedundancy:0,degradPrio:0,dependsOn:i?2:1,isNonSync:i?0:1}}}class So extends gn{constructor(e,t,n,r){if(super("mp4-remuxer",r),this.observer=void 0,this.config=void 0,this.typeSupported=void 0,this.ISGenerated=!1,this._initPTS=null,this._initDTS=null,this.nextVideoTs=null,this.nextAudioTs=null,this.videoSampleDuration=null,this.isAudioContiguous=!1,this.isVideoContiguous=!1,this.videoTrackConfig=void 0,this.observer=e,this.config=t,this.typeSupported=n,this.ISGenerated=!1,xs===null){const l=(navigator.userAgent||"").match(/Chrome\/(\d+)/i);xs=l?parseInt(l[1]):0}if(oc===null){const a=navigator.userAgent.match(/Safari\/(\d+)/i);oc=a?parseInt(a[1]):0}}destroy(){this.config=this.videoTrackConfig=this._initPTS=this._initDTS=null}resetTimeStamp(e){this.log("initPTS & initDTS reset"),this._initPTS=this._initDTS=e}resetNextTimestamp(){this.log("reset next timestamp"),this.isVideoContiguous=!1,this.isAudioContiguous=!1}resetInitSegment(){this.log("ISGenerated flag reset"),this.ISGenerated=!1,this.videoTrackConfig=void 0}getVideoStartPts(e){let t=!1;const n=e[0].pts,r=e.reduce((a,l)=>{let u=l.pts,f=u-a;return f<-4294967296&&(t=!0,u=Jt(u,n),f=u-a),f>0?a:u},n);return t&&this.debug("PTS rollover detected"),r}remux(e,t,n,r,a,l,u,f){let c,h,m,g,E,y,T=a,S=a;const A=e.pid>-1,w=t.pid>-1,I=t.samples.length,b=e.samples.length>0,P=u&&I>0||I>1;if((!A||b)&&(!w||P)||this.ISGenerated||u){if(this.ISGenerated){var D,M,B,O;const ae=this.videoTrackConfig;(ae&&(t.width!==ae.width||t.height!==ae.height||((D=t.pixelRatio)==null?void 0:D[0])!==((M=ae.pixelRatio)==null?void 0:M[0])||((B=t.pixelRatio)==null?void 0:B[1])!==((O=ae.pixelRatio)==null?void 0:O[1]))||!ae&&P||this.nextAudioTs===null&&b)&&this.resetInitSegment()}this.ISGenerated||(m=this.generateIS(e,t,a,l));const X=this.isVideoContiguous;let re=-1,de;if(P&&(re=vR(t.samples),!X&&this.config.forceKeyFrameOnDiscontinuity))if(y=!0,re>0){this.warn(`Dropped ${re} out of ${I} video samples due to a missing keyframe`);const ae=this.getVideoStartPts(t.samples);t.samples=t.samples.slice(re),t.dropped+=re,S+=(t.samples[0].pts-ae)/t.inputTimeScale,de=S}else re===-1&&(this.warn(`No keyframe found out of ${I} video samples`),y=!1);if(this.ISGenerated){if(b&&P){const ae=this.getVideoStartPts(t.samples),ie=(Jt(e.samples[0].pts,ae)-ae)/t.inputTimeScale;T+=Math.max(0,ie),S+=Math.max(0,-ie)}if(b){if(e.samplerate||(this.warn("regenerate InitSegment as audio detected"),m=this.generateIS(e,t,a,l)),h=this.remuxAudio(e,T,this.isAudioContiguous,l,w||P||f===pe.AUDIO?S:void 0),P){const ae=h?h.endPTS-h.startPTS:0;t.inputTimeScale||(this.warn("regenerate InitSegment as video detected"),m=this.generateIS(e,t,a,l)),c=this.remuxVideo(t,S,X,ae)}}else P&&(c=this.remuxVideo(t,S,X,0));c&&(c.firstKeyFrame=re,c.independent=re!==-1,c.firstKeyFramePTS=de)}}return this.ISGenerated&&this._initPTS&&this._initDTS&&(n.samples.length&&(E=z0(n,a,this._initPTS,this._initDTS)),r.samples.length&&(g=W0(r,a,this._initPTS))),{audio:h,video:c,initSegment:m,independent:y,text:g,id3:E}}generateIS(e,t,n,r){const a=e.samples,l=t.samples,u=this.typeSupported,f={},c=this._initPTS;let h=!c||r,m="audio/mp4",g,E,y,T;if(h&&(g=E=1/0),e.config&&a.length){switch(e.timescale=e.samplerate,e.segmentCodec){case"mp3":u.mpeg?(m="audio/mpeg",e.codec=""):u.mp3&&(e.codec="mp3");break;case"ac3":e.codec="ac-3";break}f.audio={id:"audio",container:m,codec:e.codec,initSegment:e.segmentCodec==="mp3"&&u.mpeg?new Uint8Array(0):j.initSegment([e]),metadata:{channelCount:e.channelCount}},h&&(T=e.id,y=e.inputTimeScale,!c||y!==c.timescale?g=E=a[0].pts-Math.round(y*n):h=!1)}if(t.sps&&t.pps&&l.length){if(t.timescale=t.inputTimeScale,f.video={id:"main",container:"video/mp4",codec:t.codec,initSegment:j.initSegment([t]),metadata:{width:t.width,height:t.height}},h)if(T=t.id,y=t.inputTimeScale,!c||y!==c.timescale){const S=this.getVideoStartPts(l),A=Math.round(y*n);E=Math.min(E,Jt(l[0].dts,S)-A),g=Math.min(g,S-A)}else h=!1;this.videoTrackConfig={width:t.width,height:t.height,pixelRatio:t.pixelRatio}}if(Object.keys(f).length)return this.ISGenerated=!0,h?(this._initPTS={baseTime:g,timescale:y},this._initDTS={baseTime:E,timescale:y}):g=y=void 0,{tracks:f,initPTS:g,timescale:y,trackId:T}}remuxVideo(e,t,n,r){const a=e.inputTimeScale,l=e.samples,u=[],f=l.length,c=this._initPTS,h=c.baseTime*a/c.timescale;let m=this.nextVideoTs,g=8,E=this.videoSampleDuration,y,T,S=Number.POSITIVE_INFINITY,A=Number.NEGATIVE_INFINITY,w=!1;if(!n||m===null){const C=h+t*a,U=l[0].pts-Jt(l[0].dts,l[0].pts);xs&&m!==null&&Math.abs(C-U-(m+h))<15e3?n=!0:m=C-U-h}const I=m+h;for(let C=0;C<f;C++){const U=l[C];U.pts=Jt(U.pts,I),U.dts=Jt(U.dts,I),U.dts<l[C>0?C-1:C].dts&&(w=!0)}w&&l.sort(function(C,U){const le=C.dts-U.dts,ue=C.pts-U.pts;return le||ue}),y=l[0].dts,T=l[l.length-1].dts;const b=T-y,P=b?Math.round(b/(f-1)):E||e.inputTimeScale/30;if(n){const C=y-I,U=C>P,le=C<-1;if((U||le)&&(U?this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Li(C,!0)} ms (${C}dts) hole between fragments detected at ${t.toFixed(3)}`):this.warn(`${(e.segmentCodec||"").toUpperCase()}: ${Li(-C,!0)} ms (${C}dts) overlapping between fragments detected at ${t.toFixed(3)}`),!le||I>=l[0].pts||xs)){y=I;const ue=l[0].pts-C;if(U)l[0].dts=y,l[0].pts=ue;else{let ge=!0;for(let he=0;he<l.length&&!(l[he].dts>ue&&ge);he++){const Le=l[he].pts;if(l[he].dts-=C,l[he].pts-=C,he<l.length-1){const we=l[he+1].pts,be=l[he].pts,$e=we<=be,Ht=we<=Le;ge=$e==Ht}}}this.log(`Video: Initial PTS/DTS adjusted: ${Li(ue,!0)}/${Li(y,!0)}, delta: ${Li(C,!0)} ms`)}}y=Math.max(0,y);let G=0,D=0,M=y;for(let C=0;C<f;C++){const U=l[C],le=U.units,ue=le.length;let ge=0;for(let he=0;he<ue;he++)ge+=le[he].data.length;D+=ge,G+=ue,U.length=ge,U.dts<M?(U.dts=M,M+=P/4|0||1):M=U.dts,S=Math.min(U.pts,S),A=Math.max(U.pts,A)}T=l[f-1].dts;const B=D+4*G+8;let O;try{O=new Uint8Array(B)}catch(C){this.observer.emit(L.ERROR,L.ERROR,{type:xe.MUX_ERROR,details:H.REMUX_ALLOC_ERROR,fatal:!1,error:C,bytes:B,reason:`fail allocating video mdat ${B}`});return}const X=new DataView(O.buffer);X.setUint32(0,B),O.set(j.types.mdat,4);let re=!1,de=Number.POSITIVE_INFINITY,ae=Number.POSITIVE_INFINITY,oe=Number.NEGATIVE_INFINITY,ie=Number.NEGATIVE_INFINITY;for(let C=0;C<f;C++){const U=l[C],le=U.units;let ue=0;for(let Le=0,we=le.length;Le<we;Le++){const be=le[Le],$e=be.data,Ht=be.data.byteLength;X.setUint32(g,Ht),g+=4,O.set($e,g),g+=Ht,ue+=4+Ht}let ge;if(C<f-1)E=l[C+1].dts-U.dts,ge=l[C+1].pts-U.pts;else{const Le=this.config,we=C>0?U.dts-l[C-1].dts:P;if(ge=C>0?U.pts-l[C-1].pts:P,Le.stretchShortVideoTrack&&this.nextAudioTs!==null){const be=Math.floor(Le.maxBufferHole*a),$e=(r?S+r*a:this.nextAudioTs+h)-U.pts;$e>be?(E=$e-we,E<0?E=we:re=!0,this.log(`It is approximately ${$e/90} ms to the next segment; using duration ${E/90} ms for the last video frame.`)):E=we}else E=we}const he=Math.round(U.pts-U.dts);de=Math.min(de,E),oe=Math.max(oe,E),ae=Math.min(ae,ge),ie=Math.max(ie,ge),u.push(Op(U.key,E,ue,he))}if(u.length){if(xs){if(xs<70){const C=u[0].flags;C.dependsOn=2,C.isNonSync=0}}else if(oc&&ie-ae<oe-de&&P/oe<.025&&u[0].cts===0){this.warn("Found irregular gaps in sample duration. Using PTS instead of DTS to determine MP4 sample duration.");let C=y;for(let U=0,le=u.length;U<le;U++){const ue=C+u[U].duration,ge=C+u[U].cts;if(U<le-1){const he=ue+u[U+1].cts;u[U].duration=he-ge}else u[U].duration=U?u[U-1].duration:P;u[U].cts=0,C=ue}}}E=re||!E?P:E;const ee=T+E;this.nextVideoTs=m=ee-h,this.videoSampleDuration=E,this.isVideoContiguous=!0;const q={data1:j.moof(e.sequenceNumber++,y,Ue(e,{samples:u})),data2:O,startPTS:(S-h)/a,endPTS:(A+E-h)/a,startDTS:(y-h)/a,endDTS:m/a,type:"video",hasAudio:!1,hasVideo:!0,nb:u.length,dropped:e.dropped};return e.samples=[],e.dropped=0,q}getSamplesPerFrame(e){switch(e.segmentCodec){case"mp3":return gR;case"ac3":return yR;default:return pR}}remuxAudio(e,t,n,r,a){const l=e.inputTimeScale,u=e.samplerate?e.samplerate:l,f=l/u,c=this.getSamplesPerFrame(e),h=c*f,m=this._initPTS,g=e.segmentCodec==="mp3"&&this.typeSupported.mpeg,E=[],y=a!==void 0;let T=e.samples,S=g?0:8,A=this.nextAudioTs||-1;const w=m.baseTime*l/m.timescale,I=w+t*l;if(this.isAudioContiguous=n=n||T.length&&A>0&&(r&&Math.abs(I-(A+w))<9e3||Math.abs(Jt(T[0].pts,I)-(A+w))<20*h),T.forEach(function(ie){ie.pts=Jt(ie.pts,I)}),!n||A<0){if(T=T.filter(ie=>ie.pts>=0),!T.length)return;a===0?A=0:r&&!y?A=Math.max(0,I-w):A=T[0].pts-w}if(e.segmentCodec==="aac"){const ie=this.config.maxAudioFramesDrift;for(let ee=0,$=A+w;ee<T.length;ee++){const J=T[ee],q=J.pts,C=q-$,U=Math.abs(1e3*C/l);if(C<=-ie*h&&y)ee===0&&(this.warn(`Audio frame @ ${(q/l).toFixed(3)}s overlaps marker by ${Math.round(1e3*C/l)} ms.`),this.nextAudioTs=A=q-w,$=q);else if(C>=ie*h&&U<mR&&y){let le=Math.round(C/h);for($=q-le*h;$<0&&le&&h;)le--,$+=h;ee===0&&(this.nextAudioTs=A=$-w),this.warn(`Injecting ${le} audio frames @ ${(($-w)/l).toFixed(3)}s due to ${Math.round(1e3*C/l)} ms gap.`);for(let ue=0;ue<le;ue++){let ge=dR.getSilentFrame(e.parsedCodec||e.manifestCodec||e.codec,e.channelCount);ge||(this.log("Unable to get silent frame for given audio codec; duplicating last frame instead."),ge=J.unit.subarray()),T.splice(ee,0,{unit:ge,pts:$}),$+=h,ee++}}J.pts=$,$+=h}}let b=null,P=null,G,D=0,M=T.length;for(;M--;)D+=T[M].unit.byteLength;for(let ie=0,ee=T.length;ie<ee;ie++){const $=T[ie],J=$.unit;let q=$.pts;if(P!==null){const U=E[ie-1];U.duration=Math.round((q-P)/f)}else if(n&&e.segmentCodec==="aac"&&(q=A+w),b=q,D>0){D+=S;try{G=new Uint8Array(D)}catch(U){this.observer.emit(L.ERROR,L.ERROR,{type:xe.MUX_ERROR,details:H.REMUX_ALLOC_ERROR,fatal:!1,error:U,bytes:D,reason:`fail allocating audio mdat ${D}`});return}g||(new DataView(G.buffer).setUint32(0,D),G.set(j.types.mdat,4))}else return;G.set(J,S);const C=J.byteLength;S+=C,E.push(Op(!0,c,C,0)),P=q}const B=E.length;if(!B)return;const O=E[E.length-1];A=P-w,this.nextAudioTs=A+f*O.duration;const X=g?new Uint8Array(0):j.moof(e.sequenceNumber++,b/f,Ue({},e,{samples:E}));e.samples=[];const re=(b-w)/l,de=A/l,oe={data1:X,data2:G,startPTS:re,endPTS:de,startDTS:re,endDTS:de,type:"audio",hasAudio:!0,hasVideo:!1,nb:B};return this.isAudioContiguous=!0,oe}}function Jt(i,e){let t;if(e===null)return i;for(e<i?t=-8589934592:t=8589934592;Math.abs(i-e)>4294967296;)i+=t;return i}function vR(i){for(let e=0;e<i.length;e++)if(i[e].key)return e;return-1}function z0(i,e,t,n){const r=i.samples.length;if(!r)return;const a=i.inputTimeScale;for(let u=0;u<r;u++){const f=i.samples[u];f.pts=Jt(f.pts-t.baseTime*a/t.timescale,e*a)/a,f.dts=Jt(f.dts-n.baseTime*a/n.timescale,e*a)/a}const l=i.samples;return i.samples=[],{samples:l}}function W0(i,e,t){const n=i.samples.length;if(!n)return;const r=i.inputTimeScale;for(let l=0;l<n;l++){const u=i.samples[l];u.pts=Jt(u.pts-t.baseTime*r/t.timescale,e*r)/r}i.samples.sort((l,u)=>l.pts-u.pts);const a=i.samples;return i.samples=[],{samples:a}}class ER extends gn{constructor(e,t,n,r){super("passthrough-remuxer",r),this.emitInitSegment=!1,this.audioCodec=void 0,this.videoCodec=void 0,this.initData=void 0,this.initPTS=null,this.initTracks=void 0,this.lastEndTime=null,this.isVideoContiguous=!1}destroy(){}resetTimeStamp(e){this.lastEndTime=null;const t=this.initPTS;t&&e&&t.baseTime===e.baseTime&&t.timescale===e.timescale||(this.initPTS=e)}resetNextTimestamp(){this.isVideoContiguous=!1,this.lastEndTime=null}resetInitSegment(e,t,n,r){this.audioCodec=t,this.videoCodec=n,this.generateInitSegment(dL(e,r)),this.emitInitSegment=!0}generateInitSegment(e){let{audioCodec:t,videoCodec:n}=this;if(!(e!=null&&e.byteLength)){this.initTracks=void 0,this.initData=void 0;return}const r=this.initData=i0(e);r.audio&&(t=Np(r.audio,Ge.AUDIO,this)),r.video&&(n=Np(r.video,Ge.VIDEO,this));const a={};r.audio&&r.video?a.audiovideo={container:"video/mp4",codec:t+","+n,supplemental:r.video.supplemental,initSegment:e,id:"main"}:r.audio?a.audio={container:"audio/mp4",codec:t,initSegment:e,id:"audio"}:r.video?a.video={container:"video/mp4",codec:n,supplemental:r.video.supplemental,initSegment:e,id:"main"}:this.warn("initSegment does not contain moov or trak boxes."),this.initTracks=a}remux(e,t,n,r,a,l){var u,f;let{initPTS:c,lastEndTime:h}=this;const m={audio:void 0,video:void 0,text:r,id3:n,initSegment:void 0};ce(h)||(h=this.lastEndTime=a||0);const g=t.samples;if(!(g!=null&&g.length))return m;const E={initPTS:void 0,timescale:void 0,trackId:void 0};let y=this.initData;if((u=y)!=null&&u.length||(this.generateInitSegment(g),y=this.initData),!((f=y)!=null&&f.length))return this.warn("Failed to generate initSegment."),m;this.emitInitSegment&&(E.tracks=this.initTracks,this.emitInitSegment=!1);const T=hL(g,y,this),S=y.audio?T[y.audio.id]:null,A=y.video?T[y.video.id]:null,w=ao(A,1/0),I=ao(S,1/0),b=ao(A,0,!0),P=ao(S,0,!0);let G,D=a,M=0;if(S&&(!A||!c&&I<w||c&&c.trackId===y.audio.id)?(E.trackId=y.audio.id,G=S,M=P-I):A&&(E.trackId=y.video.id,G=A,M=b-w),G){const ie=G.timescale;D=G.start/ie,E.initPTS=G.start-a*ie,E.timescale=ie,c||(this.initPTS=c={baseTime:E.initPTS,timescale:ie,trackId:E.trackId})}(l||!c)&&(xR(c,D,a,M)||E.timescale!==c.timescale)&&(E.initPTS=D-a,E.timescale=1,c&&c.timescale===1&&this.warn(`Adjusting initPTS @${a} from ${c.baseTime/c.timescale} to ${E.initPTS}`),this.initPTS=c={baseTime:E.initPTS,timescale:1});const B=e?D-c.baseTime/c.timescale:h,O=B+M;M>0?this.lastEndTime=O:(this.warn("Duration parsed from mp4 should be greater than zero"),this.resetNextTimestamp());const X=!!y.audio,re=!!y.video;let de="";X&&(de+="audio"),re&&(de+="video");const ae={data1:g,startPTS:B,startDTS:B,endPTS:O,endDTS:O,type:de,hasAudio:X,hasVideo:re,nb:1,dropped:0};m.audio=X&&!re?ae:void 0,m.video=re?ae:void 0;const oe=A==null?void 0:A.sampleCount;if(oe){const ie=A.keyFrameIndex,ee=ie!==-1;ae.nb=oe,ae.dropped=ie===0||this.isVideoContiguous?0:ee?ie:oe,ae.independent=ee,ae.firstKeyFrame=ie,ee&&A.keyFrameStart&&(ae.firstKeyFramePTS=(A.keyFrameStart-c.baseTime)/c.timescale),this.isVideoContiguous||(m.independent=ee),this.isVideoContiguous||(this.isVideoContiguous=ee),ae.dropped&&this.warn(`fmp4 does not start with IDR: firstIDR ${ie}/${oe} dropped: ${ae.dropped} start: ${ae.firstKeyFramePTS||"NA"}`)}return m.initSegment=E,m.id3=z0(n,a,c,c),r.samples.length&&(m.text=W0(r,a,c)),m}}function ao(i,e,t=!1){return(i==null?void 0:i.start)!==void 0?(i.start+(t?i.duration:0))/i.timescale:e}function xR(i,e,t,n){if(i===null)return!0;const r=Math.max(n,1),a=e-i.baseTime/i.timescale;return Math.abs(a-t)>r}function Np(i,e,t){const n=i==null?void 0:i.codec;return n&&n.length>4?n:e===Ge.AUDIO?n==="ec-3"||n==="ac-3"||n==="alac"?n:n==="fLaC"||n==="Opus"?ko(n,!1):(t.warn(`Unhandled audio codec "${n}" in mp4 MAP`),n||"mp4a"):(t.warn(`Unhandled video codec "${n}" in mp4 MAP`),n||"avc1")}let jn;try{jn=self.performance.now.bind(self.performance)}catch{jn=Date.now}const To=[{demux:oR,remux:ER},{demux:vr,remux:So},{demux:rR,remux:So},{demux:iR,remux:So}];To.splice(2,0,{demux:sR,remux:So});class Fp{constructor(e,t,n,r,a,l){this.asyncResult=!1,this.logger=void 0,this.observer=void 0,this.typeSupported=void 0,this.config=void 0,this.id=void 0,this.demuxer=void 0,this.remuxer=void 0,this.decrypter=void 0,this.probe=void 0,this.decryptionPromise=null,this.transmuxConfig=void 0,this.currentTransmuxState=void 0,this.observer=e,this.typeSupported=t,this.config=n,this.id=a,this.logger=l}configure(e){this.transmuxConfig=e,this.decrypter&&this.decrypter.reset()}push(e,t,n,r){const a=n.transmuxing;a.executeStart=jn();let l=new Uint8Array(e);const{currentTransmuxState:u,transmuxConfig:f}=this;r&&(this.currentTransmuxState=r);const{contiguous:c,discontinuity:h,trackSwitch:m,accurateTimeOffset:g,timeOffset:E,initSegmentChange:y}=r||u,{audioCodec:T,videoCodec:S,defaultInitPts:A,duration:w,initSegmentData:I}=f,b=SR(l,t);if(b&&As(b.method)){const M=this.getDecrypter(),B=fd(b.method);if(M.isSync()){let O=M.softwareDecrypt(l,b.key.buffer,b.iv.buffer,B);if(n.part>-1){const re=M.flush();O=re&&re.buffer}if(!O)return a.executeEnd=jn(),lc(n);l=new Uint8Array(O)}else return this.asyncResult=!0,this.decryptionPromise=M.webCryptoDecrypt(l,b.key.buffer,b.iv.buffer,B).then(O=>{const X=this.push(O,null,n);return this.decryptionPromise=null,X}),this.decryptionPromise}const P=this.needsProbing(h,m);if(P){const M=this.configureTransmuxer(l);if(M)return this.logger.warn(`[transmuxer] ${M.message}`),this.observer.emit(L.ERROR,L.ERROR,{type:xe.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,fatal:!1,error:M,reason:M.message}),a.executeEnd=jn(),lc(n)}(h||m||y||P)&&this.resetInitSegment(I,T,S,w,t),(h||y||P)&&this.resetInitialTimestamp(A),c||this.resetContiguity();const G=this.transmux(l,b,E,g,n);this.asyncResult=Fi(G);const D=this.currentTransmuxState;return D.contiguous=!0,D.discontinuity=!1,D.trackSwitch=!1,a.executeEnd=jn(),G}flush(e){const t=e.transmuxing;t.executeStart=jn();const{decrypter:n,currentTransmuxState:r,decryptionPromise:a}=this;if(a)return this.asyncResult=!0,a.then(()=>this.flush(e));const l=[],{timeOffset:u}=r;if(n){const m=n.flush();m&&l.push(this.push(m.buffer,null,e))}const{demuxer:f,remuxer:c}=this;if(!f||!c){t.executeEnd=jn();const m=[lc(e)];return this.asyncResult?Promise.resolve(m):m}const h=f.flush(u);return Fi(h)?(this.asyncResult=!0,h.then(m=>(this.flushRemux(l,m,e),l))):(this.flushRemux(l,h,e),this.asyncResult?Promise.resolve(l):l)}flushRemux(e,t,n){const{audioTrack:r,videoTrack:a,id3Track:l,textTrack:u}=t,{accurateTimeOffset:f,timeOffset:c}=this.currentTransmuxState;this.logger.log(`[transmuxer.ts]: Flushed ${this.id} sn: ${n.sn}${n.part>-1?" part: "+n.part:""} of ${this.id===pe.MAIN?"level":"track"} ${n.level}`);const h=this.remuxer.remux(r,a,l,u,c,f,!0,this.id);e.push({remuxResult:h,chunkMeta:n}),n.transmuxing.executeEnd=jn()}resetInitialTimestamp(e){const{demuxer:t,remuxer:n}=this;!t||!n||(t.resetTimeStamp(e),n.resetTimeStamp(e))}resetContiguity(){const{demuxer:e,remuxer:t}=this;!e||!t||(e.resetContiguity(),t.resetNextTimestamp())}resetInitSegment(e,t,n,r,a){const{demuxer:l,remuxer:u}=this;!l||!u||(l.resetInitSegment(e,t,n,r),u.resetInitSegment(e,t,n,a))}destroy(){this.demuxer&&(this.demuxer.destroy(),this.demuxer=void 0),this.remuxer&&(this.remuxer.destroy(),this.remuxer=void 0)}transmux(e,t,n,r,a){let l;return t&&t.method==="SAMPLE-AES"?l=this.transmuxSampleAes(e,t,n,r,a):l=this.transmuxUnencrypted(e,n,r,a),l}transmuxUnencrypted(e,t,n,r){const{audioTrack:a,videoTrack:l,id3Track:u,textTrack:f}=this.demuxer.demux(e,t,!1,!this.config.progressive);return{remuxResult:this.remuxer.remux(a,l,u,f,t,n,!1,this.id),chunkMeta:r}}transmuxSampleAes(e,t,n,r,a){return this.demuxer.demuxSampleAes(e,t,n).then(l=>({remuxResult:this.remuxer.remux(l.audioTrack,l.videoTrack,l.id3Track,l.textTrack,n,r,!1,this.id),chunkMeta:a}))}configureTransmuxer(e){const{config:t,observer:n,typeSupported:r}=this;let a;for(let m=0,g=To.length;m<g;m++){var l;if((l=To[m].demux)!=null&&l.probe(e,this.logger)){a=To[m];break}}if(!a)return new Error("Failed to find demuxer by probing fragment data");const u=this.demuxer,f=this.remuxer,c=a.remux,h=a.demux;(!f||!(f instanceof c))&&(this.remuxer=new c(n,t,r,this.logger)),(!u||!(u instanceof h))&&(this.demuxer=new h(n,t,r,this.logger),this.probe=h.probe)}needsProbing(e,t){return!this.demuxer||!this.remuxer||e||t}getDecrypter(){let e=this.decrypter;return e||(e=this.decrypter=new cd(this.config)),e}}function SR(i,e){let t=null;return i.byteLength>0&&(e==null?void 0:e.key)!=null&&e.iv!==null&&e.method!=null&&(t=e),t}const lc=i=>({remuxResult:{},chunkMeta:i});function Fi(i){return"then"in i&&i.then instanceof Function}class TR{constructor(e,t,n,r,a){this.audioCodec=void 0,this.videoCodec=void 0,this.initSegmentData=void 0,this.duration=void 0,this.defaultInitPts=void 0,this.audioCodec=e,this.videoCodec=t,this.initSegmentData=n,this.duration=r,this.defaultInitPts=a||null}}class LR{constructor(e,t,n,r,a,l){this.discontinuity=void 0,this.contiguous=void 0,this.accurateTimeOffset=void 0,this.trackSwitch=void 0,this.timeOffset=void 0,this.initSegmentChange=void 0,this.discontinuity=e,this.contiguous=t,this.accurateTimeOffset=n,this.trackSwitch=r,this.timeOffset=a,this.initSegmentChange=l}}let Mp=0;class Y0{constructor(e,t,n,r){this.error=null,this.hls=void 0,this.id=void 0,this.instanceNo=Mp++,this.observer=void 0,this.frag=null,this.part=null,this.useWorker=void 0,this.workerContext=null,this.transmuxer=null,this.onTransmuxComplete=void 0,this.onFlush=void 0,this.onWorkerMessage=f=>{const c=f.data,h=this.hls;if(!(!h||!(c!=null&&c.event)||c.instanceNo!==this.instanceNo))switch(c.event){case"init":{var m;const g=(m=this.workerContext)==null?void 0:m.objectURL;g&&self.URL.revokeObjectURL(g);break}case"transmuxComplete":{this.handleTransmuxComplete(c.data);break}case"flush":{this.onFlush(c.data);break}case"workerLog":{h.logger[c.data.logType]&&h.logger[c.data.logType](c.data.message);break}default:{c.data=c.data||{},c.data.frag=this.frag,c.data.part=this.part,c.data.id=this.id,h.trigger(c.event,c.data);break}}},this.onWorkerError=f=>{if(!this.hls)return;const c=new Error(`${f.message}  (${f.filename}:${f.lineno})`);this.hls.config.enableWorker=!1,this.hls.logger.warn(`Error in "${this.id}" Web Worker, fallback to inline`),this.hls.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,fatal:!1,event:"demuxerWorker",error:c})};const a=e.config;this.hls=e,this.id=t,this.useWorker=!!a.enableWorker,this.onTransmuxComplete=n,this.onFlush=r;const l=(f,c)=>{c=c||{},c.frag=this.frag||void 0,f===L.ERROR&&(c=c,c.parent=this.id,c.part=this.part,this.error=c.error),this.hls.trigger(f,c)};this.observer=new md,this.observer.on(L.FRAG_DECRYPTED,l),this.observer.on(L.ERROR,l);const u=Zm(a.preferManagedMediaSource);if(this.useWorker&&typeof Worker<"u"){const f=this.hls.logger;if(a.workerPath||bA()){try{a.workerPath?(f.log(`loading Web Worker ${a.workerPath} for "${t}"`),this.workerContext=kA(a.workerPath)):(f.log(`injecting Web Worker for "${t}"`),this.workerContext=CA());const{worker:h}=this.workerContext;h.addEventListener("message",this.onWorkerMessage),h.addEventListener("error",this.onWorkerError),h.postMessage({instanceNo:this.instanceNo,cmd:"init",typeSupported:u,id:t,config:Ke(a)})}catch(h){f.warn(`Error setting up "${t}" Web Worker, fallback to inline`,h),this.terminateWorker(),this.error=null,this.transmuxer=new Fp(this.observer,u,a,"",t,e.logger)}return}}this.transmuxer=new Fp(this.observer,u,a,"",t,e.logger)}reset(){if(this.frag=null,this.part=null,this.workerContext){const e=this.instanceNo;this.instanceNo=Mp++;const t=this.hls.config,n=Zm(t.preferManagedMediaSource);this.workerContext.worker.postMessage({instanceNo:this.instanceNo,cmd:"reset",resetNo:e,typeSupported:n,id:this.id,config:Ke(t)})}}terminateWorker(){if(this.workerContext){const{worker:e}=this.workerContext;this.workerContext=null,e.removeEventListener("message",this.onWorkerMessage),e.removeEventListener("error",this.onWorkerError),DA(this.hls.config.workerPath)}}destroy(){if(this.workerContext)this.terminateWorker(),this.onWorkerMessage=this.onWorkerError=null;else{const t=this.transmuxer;t&&(t.destroy(),this.transmuxer=null)}const e=this.observer;e&&e.removeAllListeners(),this.frag=null,this.part=null,this.observer=null,this.hls=null}push(e,t,n,r,a,l,u,f,c,h){var m,g;c.transmuxing.start=self.performance.now();const{instanceNo:E,transmuxer:y}=this,T=l?l.start:a.start,S=a.decryptdata,A=this.frag,w=!(A&&a.cc===A.cc),I=!(A&&c.level===A.level),b=A?c.sn-A.sn:-1,P=this.part?c.part-this.part.index:-1,G=b===0&&c.id>1&&c.id===(A==null?void 0:A.stats.chunkCount),D=!I&&(b===1||b===0&&(P===1||G&&P<=0)),M=self.performance.now();(I||b||a.stats.parsing.start===0)&&(a.stats.parsing.start=M),l&&(P||!D)&&(l.stats.parsing.start=M);const B=!(A&&((m=a.initSegment)==null?void 0:m.url)===((g=A.initSegment)==null?void 0:g.url)),O=new LR(w,D,f,I,T,B);if(!D||w||B){this.hls.logger.log(`[transmuxer-interface]: Starting new transmux session for ${a.type} sn: ${c.sn}${c.part>-1?" part: "+c.part:""} ${this.id===pe.MAIN?"level":"track"}: ${c.level} id: ${c.id}
        discontinuity: ${w}
        trackSwitch: ${I}
        contiguous: ${D}
        accurateTimeOffset: ${f}
        timeOffset: ${T}
        initSegmentChange: ${B}`);const X=new TR(n,r,t,u,h);this.configureTransmuxer(X)}if(this.frag=a,this.part=l,this.workerContext)this.workerContext.worker.postMessage({instanceNo:E,cmd:"demux",data:e,decryptdata:S,chunkMeta:c,state:O},e instanceof ArrayBuffer?[e]:[]);else if(y){const X=y.push(e,S,c,O);Fi(X)?X.then(re=>{this.handleTransmuxComplete(re)}).catch(re=>{this.transmuxerError(re,c,"transmuxer-interface push error")}):this.handleTransmuxComplete(X)}}flush(e){e.transmuxing.start=self.performance.now();const{instanceNo:t,transmuxer:n}=this;if(this.workerContext)this.workerContext.worker.postMessage({instanceNo:t,cmd:"flush",chunkMeta:e});else if(n){const r=n.flush(e);Fi(r)?r.then(a=>{this.handleFlushResult(a,e)}).catch(a=>{this.transmuxerError(a,e,"transmuxer-interface flush error")}):this.handleFlushResult(r,e)}}transmuxerError(e,t,n){this.hls&&(this.error=e,this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.FRAG_PARSING_ERROR,chunkMeta:t,frag:this.frag||void 0,part:this.part||void 0,fatal:!1,error:e,err:e,reason:n}))}handleFlushResult(e,t){e.forEach(n=>{this.handleTransmuxComplete(n)}),this.onFlush(t)}configureTransmuxer(e){const{instanceNo:t,transmuxer:n}=this;this.workerContext?this.workerContext.worker.postMessage({instanceNo:t,cmd:"configure",config:e}):n&&n.configure(e)}handleTransmuxComplete(e){e.chunkMeta.transmuxing.end=self.performance.now(),this.onTransmuxComplete(e)}}const Up=100;class AR extends hd{constructor(e,t,n){super(e,t,n,"audio-stream-controller",pe.AUDIO),this.mainAnchor=null,this.mainFragLoading=null,this.audioOnly=!1,this.bufferedTrack=null,this.switchingTrack=null,this.trackId=-1,this.waitingData=null,this.mainDetails=null,this.flushing=!1,this.bufferFlushed=!1,this.cachedTrackLoadedData=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.resetItem()}resetItem(){this.mainDetails=this.mainAnchor=this.mainFragLoading=this.bufferedTrack=this.switchingTrack=this.waitingData=this.cachedTrackLoadedData=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){const{hls:e}=this;e&&(super.unregisterListeners(),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.AUDIO_TRACKS_UPDATED,this.onAudioTracksUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this))}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:a}){if(n===pe.MAIN){const l=t.cc,u=this.fragCurrent;if(this.initPTS[l]={baseTime:r,timescale:a},this.log(`InitPTS for cc: ${l} found from main: ${r}/${a}`),this.mainAnchor=t,this.state===Q.WAITING_INIT_PTS){const f=this.waitingData;(!f&&!this.loadingParts||f&&f.frag.cc!==l)&&this.syncWithAnchor(t,f==null?void 0:f.frag)}else!this.hls.hasEnoughToStart&&u&&u.cc!==l?(u.abortRequests(),this.syncWithAnchor(t,u)):this.state===Q.IDLE&&this.tick()}}getLoadPosition(){return!this.startFragRequested&&this.nextLoadPosition>=0?this.nextLoadPosition:super.getLoadPosition()}syncWithAnchor(e,t){var n;const r=((n=this.mainFragLoading)==null?void 0:n.frag)||null;if(t&&(r==null?void 0:r.cc)===t.cc)return;const a=(r||e).cc,l=this.getLevelDetails(),u=this.getLoadPosition(),f=m0(l,a,u);f&&(this.log(`Syncing with main frag at ${f.start} cc ${f.cc}`),this.startFragRequested=!1,this.nextLoadPosition=f.start,this.resetLoadingState(),this.state===Q.IDLE&&this.doTickIdle())}startLoad(e,t){if(!this.levels){this.startPosition=e,this.state=Q.STOPPED;return}const n=this.lastCurrentTime;this.stopLoad(),this.setInterval(Up),n>0&&e===-1?(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n,this.state=Q.IDLE):this.state=Q.WAITING_TRACK,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}doTick(){switch(this.state){case Q.IDLE:this.doTickIdle();break;case Q.WAITING_TRACK:{const{levels:t,trackId:n}=this,r=t==null?void 0:t[n],a=r==null?void 0:r.details;if(a&&!this.waitForLive(r)){if(this.waitForCdnTuneIn(a))break;this.state=Q.WAITING_INIT_PTS}break}case Q.FRAG_LOADING_WAITING_RETRY:{var e;const t=performance.now(),n=this.retryDate;if(!n||t>=n||(e=this.media)!=null&&e.seeking){const{levels:r,trackId:a}=this;this.log("RetryDate reached, switch back to IDLE state"),this.resetStartWhenNotLoaded((r==null?void 0:r[a])||null),this.state=Q.IDLE}break}case Q.WAITING_INIT_PTS:{const t=this.waitingData;if(t){const{frag:n,part:r,cache:a,complete:l}=t,u=this.mainAnchor;if(this.initPTS[n.cc]!==void 0){this.waitingData=null,this.state=Q.FRAG_LOADING;const f=a.flush().buffer,c={frag:n,part:r,payload:f,networkDetails:null};this._handleFragmentLoadProgress(c),l&&super._handleFragmentLoadComplete(c)}else u&&u.cc!==t.frag.cc&&this.syncWithAnchor(u,t.frag)}else this.state=Q.IDLE}}this.onTickEnd()}resetLoadingState(){const e=this.waitingData;e&&(this.fragmentTracker.removeFragment(e.frag),this.waitingData=null),super.resetLoadingState()}onTickEnd(){const{media:e}=this;e!=null&&e.readyState&&(this.lastCurrentTime=e.currentTime)}doTickIdle(){var e;const{hls:t,levels:n,media:r,trackId:a}=this,l=t.config;if(!this.buffering||!r&&!this.primaryPrefetch&&(this.startFragRequested||!l.startFragPrefetch)||!(n!=null&&n[a]))return;const u=n[a],f=u.details;if(!f||this.waitForLive(u)||this.waitForCdnTuneIn(f)){this.state=Q.WAITING_TRACK,this.startFragRequested=!1;return}const c=this.mediaBuffer?this.mediaBuffer:this.media;this.bufferFlushed&&c&&(this.bufferFlushed=!1,this.afterBufferFlushed(c,Ge.AUDIO,pe.AUDIO));const h=this.getFwdBufferInfo(c,pe.AUDIO);if(h===null)return;if(!this.switchingTrack&&this._streamEnded(h,f)){t.trigger(L.BUFFER_EOS,{type:"audio"}),this.state=Q.ENDED;return}const m=h.len,g=t.maxBufferLength,E=f.fragments,y=E[0].start,T=this.getLoadPosition(),S=this.flushing?T:h.end;if(this.switchingTrack&&r){const I=T;f.PTSKnown&&I<y&&(h.end>y||h.nextStart)&&(this.log("Alt audio track ahead of main track, seek to start of alt audio track"),r.currentTime=y+.05)}if(m>=g&&!this.switchingTrack&&S<E[E.length-1].start)return;let A=this.getNextFragment(S,f);if(A&&this.isLoopLoading(A,S)&&(A=this.getNextFragmentLoopLoading(A,f,h,pe.MAIN,g)),!A){this.bufferFlushed=!0;return}let w=((e=this.mainFragLoading)==null?void 0:e.frag)||null;if(!this.audioOnly&&this.startFragRequested&&w&&st(A)&&!A.endList&&(!f.live||!this.loadingParts&&S<this.hls.liveSyncPosition)&&(this.fragmentTracker.getState(w)===ot.OK&&(this.mainFragLoading=w=null),w&&st(w))){if(A.start>w.end){const b=this.fragmentTracker.getFragAtPos(S,pe.MAIN);b&&b.end>w.end&&(w=b,this.mainFragLoading={frag:b,targetBufferTime:null})}if(A.start>w.end)return}this.loadFragment(A,u,S)}onMediaDetaching(e,t){this.bufferFlushed=this.flushing=!1,super.onMediaDetaching(e,t)}onAudioTracksUpdated(e,{audioTracks:t}){this.resetTransmuxer(),this.levels=t.map(n=>new Di(n))}onAudioTrackSwitching(e,t){const n=!!t.url;this.trackId=t.id;const{fragCurrent:r}=this;r&&(r.abortRequests(),this.removeUnbufferedFrags(r.start)),this.resetLoadingState(),n?(this.switchingTrack=t,this.flushAudioIfNeeded(t),this.state!==Q.STOPPED&&(this.setInterval(Up),this.state=Q.IDLE,this.tick())):(this.resetTransmuxer(),this.switchingTrack=null,this.bufferedTrack=t,this.clearInterval())}onManifestLoading(){super.onManifestLoading(),this.bufferFlushed=this.flushing=this.audioOnly=!1,this.resetItem(),this.trackId=-1}onLevelLoaded(e,t){this.mainDetails=t.details;const n=this.cachedTrackLoadedData;n&&(this.cachedTrackLoadedData=null,this.onAudioTrackLoaded(L.AUDIO_TRACK_LOADED,n))}onAudioTrackLoaded(e,t){var n;const{levels:r}=this,{details:a,id:l,groupId:u,track:f}=t;if(!r){this.warn(`Audio tracks reset while loading track ${l} "${f.name}" of "${u}"`);return}const c=this.mainDetails;if(!c||a.endCC>c.endCC||c.expired){this.cachedTrackLoadedData=t,this.state!==Q.STOPPED&&(this.state=Q.WAITING_TRACK);return}this.cachedTrackLoadedData=null,this.log(`Audio track ${l} "${f.name}" of "${u}" loaded [${a.startSN},${a.endSN}]${a.lastPartSn?`[part-${a.lastPartSn}-${a.lastPartIndex}]`:""},duration:${a.totalduration}`);const h=r[l];let m=0;if(a.live||(n=h.details)!=null&&n.live){if(this.checkLiveUpdate(a),a.deltaUpdateFailed)return;if(h.details){var g;m=this.alignPlaylists(a,h.details,(g=this.levelLastLoaded)==null?void 0:g.details)}a.alignedSliding||(_0(a,c),a.alignedSliding||Mo(a,c),m=a.fragmentStart)}h.details=a,this.levelLastLoaded=h,this.startFragRequested||this.setStartPosition(c,m),this.hls.trigger(L.AUDIO_TRACK_UPDATED,{details:a,id:l,groupId:t.groupId}),this.state===Q.WAITING_TRACK&&!this.waitForCdnTuneIn(a)&&(this.state=Q.IDLE),this.tick()}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:a}=e,{config:l,trackId:u,levels:f}=this;if(!f){this.warn(`Audio tracks were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const c=f[u];if(!c){this.warn("Audio track is undefined on fragment load progress");return}const h=c.details;if(!h){this.warn("Audio track details undefined on fragment load progress"),this.removeUnbufferedFrags(n.start);return}const m=l.defaultAudioCodec||c.audioCodec||"mp4a.40.2";let g=this.transmuxer;g||(g=this.transmuxer=new Y0(this.hls,pe.AUDIO,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)));const E=this.initPTS[n.cc],y=(t=n.initSegment)==null?void 0:t.data;if(E!==void 0){const S=r?r.index:-1,A=S!==-1,w=new dd(n.level,n.sn,n.stats.chunkCount,a.byteLength,S,A);g.push(a,y,m,"",n,r,h.totalduration,!1,w,E)}else{this.log(`Unknown video PTS for cc ${n.cc}, waiting for video PTS before demuxing audio frag ${n.sn} of [${h.startSN} ,${h.endSN}],track ${u}`);const{cache:T}=this.waitingData=this.waitingData||{frag:n,part:r,cache:new b0,complete:!1};T.push(new Uint8Array(a)),this.state!==Q.STOPPED&&(this.state=Q.WAITING_INIT_PTS)}}_handleFragmentLoadComplete(e){if(this.waitingData){this.waitingData.complete=!0;return}super._handleFragmentLoadComplete(e)}onBufferReset(){this.mediaBuffer=null}onBufferCreated(e,t){this.bufferFlushed=this.flushing=!1;const n=t.tracks.audio;n&&(this.mediaBuffer=n.buffer||null)}onFragLoading(e,t){!this.audioOnly&&t.frag.type===pe.MAIN&&st(t.frag)&&(this.mainFragLoading=t,this.state===Q.IDLE&&this.tick())}onFragBuffered(e,t){const{frag:n,part:r}=t;if(n.type!==pe.AUDIO){!this.audioOnly&&n.type===pe.MAIN&&!n.elementaryStreams.video&&!n.elementaryStreams.audiovideo&&(this.audioOnly=!0,this.mainFragLoading=null);return}if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}, audioSwitch: ${this.switchingTrack?this.switchingTrack.name:"false"}`);return}if(st(n)){this.fragPrevious=n;const a=this.switchingTrack;a&&(this.bufferedTrack=a,this.switchingTrack=null,this.hls.trigger(L.AUDIO_TRACK_SWITCHED,Be({},a)))}this.fragBufferedComplete(n,r),this.media&&this.tick()}onError(e,t){var n;if(t.fatal){this.state=Q.ERROR;return}switch(t.details){case H.FRAG_GAP:case H.FRAG_PARSING_ERROR:case H.FRAG_DECRYPT_ERROR:case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pe.AUDIO,t);break;case H.AUDIO_TRACK_LOAD_ERROR:case H.AUDIO_TRACK_LOAD_TIMEOUT:case H.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Q.WAITING_TRACK&&((n=t.context)==null?void 0:n.type)===De.AUDIO_TRACK&&(this.state=Q.IDLE);break;case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)||this.resetLoadingState();break;case H.BUFFER_FULL_ERROR:if(t.parent!=="audio")return;this.reduceLengthAndFlushBuffer(t)&&(this.bufferedTrack=null,super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"));break;case H.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onBufferFlushing(e,{type:t}){t!==Ge.VIDEO&&(this.flushing=!0)}onBufferFlushed(e,{type:t}){if(t!==Ge.VIDEO){this.flushing=!1,this.bufferFlushed=!0,this.state===Q.ENDED&&(this.state=Q.IDLE);const n=this.mediaBuffer||this.media;n&&(this.afterBufferFlushed(n,t,pe.AUDIO),this.tick())}}_handleTransmuxComplete(e){var t;const n="audio",{hls:r}=this,{remuxResult:a,chunkMeta:l}=e,u=this.getCurrentContext(l);if(!u){this.resetWhenMissingContext(l);return}const{frag:f,part:c,level:h}=u,{details:m}=h,{audio:g,text:E,id3:y,initSegment:T}=a;if(this.fragContextChanged(f)||!m){this.fragmentTracker.removeFragment(f);return}if(this.state=Q.PARSING,this.switchingTrack&&g&&this.completeAudioSwitch(this.switchingTrack),T!=null&&T.tracks){const S=f.initSegment||f;this._bufferInitSegment(h,T.tracks,S,l),r.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:S,id:n,tracks:T.tracks})}if(g){const{startPTS:S,endPTS:A,startDTS:w,endDTS:I}=g;c&&(c.elementaryStreams[Ge.AUDIO]={startPTS:S,endPTS:A,startDTS:w,endDTS:I}),f.setElementaryStreamInfo(Ge.AUDIO,S,A,w,I),this.bufferFragmentData(g,f,c,l)}if(y!=null&&(t=y.samples)!=null&&t.length){const S=Ue({id:n,frag:f,details:m},y);r.trigger(L.FRAG_PARSING_METADATA,S)}if(E){const S=Ue({id:n,frag:f,details:m},E);r.trigger(L.FRAG_PARSING_USERDATA,S)}}_bufferInitSegment(e,t,n,r){if(this.state!==Q.PARSING||(t.video&&delete t.video,t.audiovideo&&delete t.audiovideo,!t.audio))return;const a=t.audio;a.id=pe.AUDIO;const l=e.audioCodec;this.log(`Init audio buffer, container:${a.container}, codecs[level/parsed]=[${l}/${a.codec}]`),l&&l.split(",").length===1&&(a.levelCodec=l),this.hls.trigger(L.BUFFER_CODECS,t);const u=a.initSegment;if(u!=null&&u.byteLength){const f={type:"audio",frag:n,part:null,chunkMeta:r,parent:n.type,data:u};this.hls.trigger(L.BUFFER_APPENDING,f)}this.tickImmediate()}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);if(this.switchingTrack||r===ot.NOT_LOADED||r===ot.PARTIAL){var a;if(!st(e))this._loadInitSegment(e,t);else if((a=t.details)!=null&&a.live&&!this.initPTS[e.cc]){this.log(`Waiting for video PTS in continuity counter ${e.cc} of live stream before loading audio fragment ${e.sn} of level ${this.trackId}`),this.state=Q.WAITING_INIT_PTS;const l=this.mainDetails;l&&l.fragmentStart!==t.details.fragmentStart&&Mo(t.details,l)}else super.loadFragment(e,t,n)}else this.clearTrackerIfNeeded(e)}flushAudioIfNeeded(e){if(this.media&&this.bufferedTrack){const{name:t,lang:n,assocLang:r,characteristics:a,audioCodec:l,channels:u}=this.bufferedTrack;jr({name:t,lang:n,assocLang:r,characteristics:a,audioCodec:l,channels:u},e,Ur)||(Po(e.url,this.hls)?(this.log("Switching audio track : flushing all audio"),super.flushMainBuffer(0,Number.POSITIVE_INFINITY,"audio"),this.bufferedTrack=null):this.bufferedTrack=e)}}completeAudioSwitch(e){const{hls:t}=this;this.flushAudioIfNeeded(e),this.bufferedTrack=e,this.switchingTrack=null,t.trigger(L.AUDIO_TRACK_SWITCHED,Be({},e))}}class Sd extends gn{constructor(e,t){super(t,e.logger),this.hls=void 0,this.canLoad=!1,this.timer=-1,this.hls=e}destroy(){this.clearTimer(),this.hls=this.log=this.warn=null}clearTimer(){this.timer!==-1&&(self.clearTimeout(this.timer),this.timer=-1)}startLoad(){this.canLoad=!0,this.loadPlaylist()}stopLoad(){this.canLoad=!1,this.clearTimer()}switchParams(e,t,n){const r=t==null?void 0:t.renditionReports;if(r){let a=-1;for(let l=0;l<r.length;l++){const u=r[l];let f;try{f=new self.URL(u.URI,t.url).href}catch(c){this.warn(`Could not construct new URL for Rendition Report: ${c}`),f=u.URI||""}if(f===e){a=l;break}else f===e.substring(0,f.length)&&(a=l)}if(a!==-1){const l=r[a],u=parseInt(l["LAST-MSN"])||(t==null?void 0:t.lastPartSn);let f=parseInt(l["LAST-PART"])||(t==null?void 0:t.lastPartIndex);if(this.hls.config.lowLatencyMode){const h=Math.min(t.age-t.partTarget,t.targetduration);f>=0&&h>t.partTarget&&(f+=1)}const c=n&&ep(n);return new tp(u,f>=0?f:void 0,c)}}}loadPlaylist(e){this.clearTimer()}loadingPlaylist(e,t){this.clearTimer()}shouldLoadPlaylist(e){return this.canLoad&&!!e&&!!e.url&&(!e.details||e.details.live)}getUrlWithDirectives(e,t){if(t)try{return t.addDirectives(e)}catch(n){this.warn(`Could not construct new URL with HLS Delivery Directives: ${n}`)}return e}playlistLoaded(e,t,n){const{details:r,stats:a}=t,l=self.performance.now(),u=a.loading.first?Math.max(0,l-a.loading.first):0;r.advancedDateTime=Date.now()-u;const f=this.hls.config.timelineOffset;if(f!==r.appliedTimelineOffset){const h=Math.max(f||0,0);r.appliedTimelineOffset=h,r.fragments.forEach(m=>{m.start=m.playlistOffset+h})}if(r.live||n!=null&&n.live){const h="levelInfo"in t?t.levelInfo:t.track;if(r.reloaded(n),n&&r.fragments.length>0){EA(n,r);const w=r.playlistParsingError;if(w){this.warn(w);const I=this.hls;if(!I.config.ignorePlaylistParsingErrors){var c;const{networkDetails:b}=t;I.trigger(L.ERROR,{type:xe.NETWORK_ERROR,details:H.LEVEL_PARSING_ERROR,fatal:!1,url:r.url,error:w,reason:w.message,level:t.level||void 0,parent:(c=r.fragments[0])==null?void 0:c.type,networkDetails:b,stats:a});return}r.playlistParsingError=null}}r.requestScheduled===-1&&(r.requestScheduled=a.loading.start);const m=this.hls.mainForwardBufferInfo,g=m?m.end-m.len:0,E=(r.edge-g)*1e3,y=L0(r,E);if(r.requestScheduled+y<l?r.requestScheduled=l:r.requestScheduled+=y,this.log(`live playlist ${e} ${r.advanced?"REFRESHED "+r.lastPartSn+"-"+r.lastPartIndex:r.updated?"UPDATED":"MISSED"}`),!this.canLoad||!r.live)return;let T,S,A;if(r.canBlockReload&&r.endSN&&r.advanced){const w=this.hls.config.lowLatencyMode,I=r.lastPartSn,b=r.endSN,P=r.lastPartIndex,G=P!==-1,D=I===b;G?D?(S=b+1,A=w?0:P):(S=I,A=w?P+1:r.maxPartIndex):S=b+1;const M=r.age,B=M+r.ageHeader;let O=Math.min(B-r.partTarget,r.targetduration*1.5);if(O>0){if(B>r.targetduration*3)this.log(`Playlist last advanced ${M.toFixed(2)}s ago. Omitting segment and part directives.`),S=void 0,A=void 0;else if(n!=null&&n.tuneInGoal&&B-r.partTarget>n.tuneInGoal)this.warn(`CDN Tune-in goal increased from: ${n.tuneInGoal} to: ${O} with playlist age: ${r.age}`),O=0;else{const X=Math.floor(O/r.targetduration);if(S+=X,A!==void 0){const re=Math.round(O%r.targetduration/r.partTarget);A+=re}this.log(`CDN Tune-in age: ${r.ageHeader}s last advanced ${M.toFixed(2)}s goal: ${O} skip sn ${X} to part ${A}`)}r.tuneInGoal=O}if(T=this.getDeliveryDirectives(r,t.deliveryDirectives,S,A),w||!D){r.requestScheduled=l,this.loadingPlaylist(h,T);return}}else(r.canBlockReload||r.canSkipUntil)&&(T=this.getDeliveryDirectives(r,t.deliveryDirectives,S,A));T&&S!==void 0&&r.canBlockReload&&(r.requestScheduled=a.loading.first+Math.max(y-u*2,y/2)),this.scheduleLoading(h,T,r)}else this.clearTimer()}scheduleLoading(e,t,n){const r=n||e.details;if(!r){this.loadingPlaylist(e,t);return}const a=self.performance.now(),l=r.requestScheduled;if(a>=l){this.loadingPlaylist(e,t);return}const u=l-a;this.log(`reload live playlist ${e.name||e.bitrate+"bps"} in ${Math.round(u)} ms`),this.clearTimer(),this.timer=self.setTimeout(()=>this.loadingPlaylist(e,t),u)}getDeliveryDirectives(e,t,n,r){let a=ep(e);return t!=null&&t.skip&&e.deltaUpdateFailed&&(n=t.msn,r=t.part,a=Eo.No),new tp(n,r,a)}checkRetry(e){const t=e.details,n=Oo(e),r=e.errorAction,{action:a,retryCount:l=0,retryConfig:u}=r||{},f=!!r&&!!u&&(a===St.RetryRequest||!r.resolved&&a===St.SendAlternateToPenaltyBox);if(f){var c;if(l>=u.maxNumRetry)return!1;if(n&&(c=e.context)!=null&&c.deliveryDirectives)this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" without delivery-directives`),this.loadPlaylist();else{const h=ud(u,l);this.clearTimer(),this.timer=self.setTimeout(()=>this.loadPlaylist(),h),this.warn(`Retrying playlist loading ${l+1}/${u.maxNumRetry} after "${t}" in ${h}ms`)}e.levelRetry=!0,r.resolved=!0}return f}}function q0(i,e){if(i.length!==e.length)return!1;for(let t=0;t<i.length;t++)if(!Mi(i[t].attrs,e[t].attrs))return!1;return!0}function Mi(i,e,t){const n=i["STABLE-RENDITION-ID"];return n&&!t?n===e["STABLE-RENDITION-ID"]:!(t||["LANGUAGE","NAME","CHARACTERISTICS","AUTOSELECT","DEFAULT","FORCED","ASSOC-LANGUAGE"]).some(r=>i[r]!==e[r])}function Gc(i,e){return e.label.toLowerCase()===i.name.toLowerCase()&&(!e.language||e.language.toLowerCase()===(i.lang||"").toLowerCase())}class RR extends Sd{constructor(e){super(e,"audio-track-controller"),this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.registerListeners()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.AUDIO_TRACK_LOADED,this.onAudioTrackLoaded,this),e.off(L.ERROR,this.onError,this)}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,super.destroy()}onManifestLoading(){this.tracks=[],this.tracksInGroup=[],this.groupIds=null,this.currentTrack=null,this.trackId=-1,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.audioTracks||[]}onAudioTrackLoaded(e,t){const{id:n,groupId:r,details:a}=t,l=this.tracksInGroup[n];if(!l||l.groupId!==r){this.warn(`Audio track with id:${n} and group:${r} not found in active group ${l==null?void 0:l.groupId}`);return}const u=l.details;l.details=t.details,this.log(`Audio track ${n} "${l.name}" lang:${l.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.audioGroups||null,r=this.groupIds;let a=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(u=>(r==null?void 0:r.indexOf(u))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const u=this.tracks.filter(g=>!n||n.indexOf(g.groupId)!==-1);if(u.length)this.selectDefaultTrack&&!u.some(g=>g.default)&&(this.selectDefaultTrack=!1),u.forEach((g,E)=>{g.id=E});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=u;const f=this.hls.config.audioPreference;if(!a&&f){const g=In(f,u,Ur);if(g>-1)a=u[g];else{const E=In(f,this.tracks);a=this.tracks[E]}}let c=this.findTrackId(a);c===-1&&a&&(c=this.findTrackId(null));const h={audioTracks:u};this.log(`Updating audio tracks, ${u.length} track(s) found in group(s): ${n==null?void 0:n.join(",")}`),this.hls.trigger(L.AUDIO_TRACKS_UPDATED,h);const m=this.trackId;if(c!==-1&&m===-1)this.setAudioTrack(c);else if(u.length&&m===-1){var l;const g=new Error(`No audio track selected for current audio group-ID(s): ${(l=this.groupIds)==null?void 0:l.join(",")} track count: ${u.length}`);this.warn(g.message),this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.AUDIO_TRACK_LOAD_ERROR,fatal:!0,error:g})}}}onError(e,t){t.fatal||!t.context||t.context.type===De.AUDIO_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allAudioTracks(){return this.tracks}get audioTracks(){return this.tracksInGroup}get audioTrack(){return this.trackId}set audioTrack(e){this.selectDefaultTrack=!1,this.setAudioTrack(e)}setAudioOption(e){const t=this.hls;if(t.config.audioPreference=e,e){const n=this.allAudioTracks;if(this.selectDefaultTrack=!1,n.length){const r=this.currentTrack;if(r&&jr(e,r,Ur))return r;const a=In(e,this.tracksInGroup,Ur);if(a>-1){const l=this.tracksInGroup[a];return this.setAudioTrack(a),l}else if(r){let l=t.loadLevel;l===-1&&(l=t.firstAutoLevel);const u=UL(e,t.levels,n,l,Ur);if(u===-1)return null;t.nextLoadLevel=u}if(e.channels||e.audioCodec){const l=In(e,n);if(l>-1)return n[l]}}}return null}setAudioTrack(e){const t=this.tracksInGroup;if(e<0||e>=t.length){this.warn(`Invalid audio track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e],a=r.details&&!r.details.live;if(e===this.trackId&&r===n&&a||(this.log(`Switching to audio-track ${e} "${r.name}" lang:${r.lang} group:${r.groupId} channels:${r.channels}`),this.trackId=e,this.currentTrack=r,this.hls.trigger(L.AUDIO_TRACK_SWITCHING,Be({},r)),a))return;const l=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(l)}findTrackId(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(!(this.selectDefaultTrack&&!r.default)&&(!e||jr(e,r,Ur)))return n}if(e){const{name:n,lang:r,assocLang:a,characteristics:l,audioCodec:u,channels:f}=e;for(let c=0;c<t.length;c++){const h=t[c];if(jr({name:n,lang:r,assocLang:a,characteristics:l,audioCodec:u,channels:f},h,Ur))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Mi(e.attrs,h.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return c}for(let c=0;c<t.length;c++){const h=t[c];if(Mi(e.attrs,h.attrs,["LANGUAGE"]))return c}}return-1}loadPlaylist(e){super.loadPlaylist();const t=this.currentTrack;this.shouldLoadPlaylist(t)&&Po(t.url,this.hls)&&this.scheduleLoading(t,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),l=e.details,u=l==null?void 0:l.age;this.log(`Loading audio-track ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${a}`),this.hls.trigger(L.AUDIO_TRACK_LOADING,{url:a,id:n,groupId:r,deliveryDirectives:t||null,track:e})}}class IR{constructor(e){this.tracks=void 0,this.queues={video:[],audio:[],audiovideo:[]},this.tracks=e}destroy(){this.tracks=this.queues=null}append(e,t,n){if(this.queues===null||this.tracks===null)return;const r=this.queues[t];r.push(e),r.length===1&&!n&&this.executeNext(t)}appendBlocker(e){return new Promise(t=>{const n={label:"async-blocker",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.append(n,e)})}prependBlocker(e){return new Promise(t=>{if(this.queues){const n={label:"async-blocker-prepend",execute:t,onStart:()=>{},onComplete:()=>{},onError:()=>{}};this.queues[e].unshift(n)}})}removeBlockers(){this.queues!==null&&[this.queues.video,this.queues.audio,this.queues.audiovideo].forEach(e=>{var t;const n=(t=e[0])==null?void 0:t.label;(n==="async-blocker"||n==="async-blocker-prepend")&&(e[0].execute(),e.splice(0,1))})}unblockAudio(e){if(this.queues===null)return;this.queues.audio[0]===e&&this.shiftAndExecuteNext("audio")}executeNext(e){if(this.queues===null||this.tracks===null)return;const t=this.queues[e];if(t.length){const r=t[0];try{r.execute()}catch(a){var n;if(r.onError(a),this.queues===null||this.tracks===null)return;const l=(n=this.tracks[e])==null?void 0:n.buffer;l!=null&&l.updating||this.shiftAndExecuteNext(e)}}}shiftAndExecuteNext(e){this.queues!==null&&(this.queues[e].shift(),this.executeNext(e))}current(e){var t;return((t=this.queues)==null?void 0:t[e][0])||null}toString(){const{queues:e,tracks:t}=this;return e===null||t===null?"<destroyed>":`
${this.list("video")}
${this.list("audio")}
${this.list("audiovideo")}}`}list(e){var t,n;return(t=this.queues)!=null&&t[e]||(n=this.tracks)!=null&&n[e]?`${e}: (${this.listSbInfo(e)}) ${this.listOps(e)}`:""}listSbInfo(e){var t;const n=(t=this.tracks)==null?void 0:t[e],r=n==null?void 0:n.buffer;return r?`SourceBuffer${r.updating?" updating":""}${n.ended?" ended":""}${n.ending?" ending":""}`:"none"}listOps(e){var t;return((t=this.queues)==null?void 0:t[e].map(n=>n.label).join(", "))||""}}const Bp=/(avc[1234]|hvc1|hev1|dvh[1e]|vp09|av01)(?:\.[^.,]+)+/,X0="HlsJsTrackRemovedError";class wR extends Error{constructor(e){super(e),this.name=X0}}class _R extends gn{constructor(e,t){super("buffer-controller",e.logger),this.hls=void 0,this.fragmentTracker=void 0,this.details=null,this._objectUrl=null,this.operationQueue=null,this.bufferCodecEventsTotal=0,this.media=null,this.mediaSource=null,this.lastMpegAudioChunk=null,this.blockedAudioAppend=null,this.lastVideoAppendEnd=0,this.appendSource=void 0,this.transferData=void 0,this.overrides=void 0,this.appendErrors={audio:0,video:0,audiovideo:0},this.tracks={},this.sourceBuffers=[[null,null],[null,null]],this._onEndStreaming=n=>{var r;this.hls&&((r=this.mediaSource)==null?void 0:r.readyState)==="open"&&this.hls.pauseBuffering()},this._onStartStreaming=n=>{this.hls&&this.hls.resumeBuffering()},this._onMediaSourceOpen=n=>{const{media:r,mediaSource:a}=this;n&&this.log("Media source opened"),!(!r||!a)&&(a.removeEventListener("sourceopen",this._onMediaSourceOpen),r.removeEventListener("emptied",this._onMediaEmptied),this.updateDuration(),this.hls.trigger(L.MEDIA_ATTACHED,{media:r,mediaSource:a}),this.mediaSource!==null&&this.checkPendingTracks())},this._onMediaSourceClose=()=>{this.log("Media source closed")},this._onMediaSourceEnded=()=>{this.log("Media source ended")},this._onMediaEmptied=()=>{const{mediaSrc:n,_objectUrl:r}=this;n!==r&&this.error(`Media element src was set while attaching MediaSource (${r} > ${n})`)},this.hls=e,this.fragmentTracker=t,this.appendSource=tL(Er(e.config.preferManagedMediaSource)),this.initTracks(),this.registerListeners()}hasSourceTypes(){return Object.keys(this.tracks).length>0}destroy(){this.unregisterListeners(),this.details=null,this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.transferData=this.overrides=void 0,this.operationQueue&&(this.operationQueue.destroy(),this.operationQueue=null),this.hls=this.fragmentTracker=null,this._onMediaSourceOpen=this._onMediaSourceClose=null,this._onMediaSourceEnded=null,this._onStartStreaming=this._onEndStreaming=null}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.BUFFER_RESET,this.onBufferReset,this),e.on(L.BUFFER_APPENDING,this.onBufferAppending,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.BUFFER_EOS,this.onBufferEos,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.FRAG_PARSED,this.onFragParsed,this),e.on(L.FRAG_CHANGED,this.onFragChanged,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.BUFFER_RESET,this.onBufferReset,this),e.off(L.BUFFER_APPENDING,this.onBufferAppending,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_EOS,this.onBufferEos,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.FRAG_PARSED,this.onFragParsed,this),e.off(L.FRAG_CHANGED,this.onFragChanged,this),e.off(L.ERROR,this.onError,this)}transferMedia(){const{media:e,mediaSource:t}=this;if(!e)return null;const n={};if(this.operationQueue){const a=this.isUpdating();a||this.operationQueue.removeBlockers();const l=this.isQueued();(a||l)&&this.warn(`Transfering MediaSource with${l?" operations in queue":""}${a?" updating SourceBuffer(s)":""} ${this.operationQueue}`),this.operationQueue.destroy()}const r=this.transferData;return!this.sourceBufferCount&&r&&r.mediaSource===t?Ue(n,r.tracks):this.sourceBuffers.forEach(a=>{const[l]=a;l&&(n[l]=Ue({},this.tracks[l]),this.removeBuffer(l)),a[0]=a[1]=null}),{media:e,mediaSource:t,tracks:n}}initTracks(){const e={};this.sourceBuffers=[[null,null],[null,null]],this.tracks=e,this.resetQueue(),this.resetAppendErrors(),this.lastMpegAudioChunk=this.blockedAudioAppend=null,this.lastVideoAppendEnd=0}onManifestLoading(){this.bufferCodecEventsTotal=0,this.details=null}onManifestParsed(e,t){var n;let r=2;(t.audio&&!t.video||!t.altAudio)&&(r=1),this.bufferCodecEventsTotal=r,this.log(`${r} bufferCodec event(s) expected.`),(n=this.transferData)!=null&&n.mediaSource&&this.sourceBufferCount&&r&&this.bufferCreated()}onMediaAttaching(e,t){const n=this.media=t.media,r=Er(this.appendSource);if(this.transferData=this.overrides=void 0,n&&r){const a=!!t.mediaSource;(a||t.overrides)&&(this.transferData=t,this.overrides=t.overrides);const l=this.mediaSource=t.mediaSource||new r;if(this.assignMediaSource(l),a)this._objectUrl=n.src,this.attachTransferred();else{const u=this._objectUrl=self.URL.createObjectURL(l);if(this.appendSource)try{n.removeAttribute("src");const f=self.ManagedMediaSource;n.disableRemotePlayback=n.disableRemotePlayback||f&&l instanceof f,$p(n),bR(n,u),n.load()}catch{n.src=u}else n.src=u}n.addEventListener("emptied",this._onMediaEmptied)}}assignMediaSource(e){var t,n;this.log(`${((t=this.transferData)==null?void 0:t.mediaSource)===e?"transferred":"created"} media source: ${(n=e.constructor)==null?void 0:n.name}`),e.addEventListener("sourceopen",this._onMediaSourceOpen),e.addEventListener("sourceended",this._onMediaSourceEnded),e.addEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(e.addEventListener("startstreaming",this._onStartStreaming),e.addEventListener("endstreaming",this._onEndStreaming))}attachTransferred(){const e=this.media,t=this.transferData;if(!t||!e)return;const n=this.tracks,r=t.tracks,a=r?Object.keys(r):null,l=a?a.length:0,u=()=>{this.media&&this.mediaSourceOpenOrEnded&&this._onMediaSourceOpen()};if(r&&a&&l){if(!this.tracksReady){this.hls.config.startFragPrefetch=!0,this.log("attachTransferred: waiting for SourceBuffer track info");return}if(this.log(`attachTransferred: (bufferCodecEventsTotal ${this.bufferCodecEventsTotal})
required tracks: ${Ke(n,(f,c)=>f==="initSegment"?void 0:c)};
transfer tracks: ${Ke(r,(f,c)=>f==="initSegment"?void 0:c)}}`),!Jg(r,n)){t.mediaSource=null,t.tracks=void 0;const f=e.currentTime,c=this.details,h=Math.max(f,(c==null?void 0:c.fragments[0].start)||0);if(h-f>1){this.log(`attachTransferred: waiting for playback to reach new tracks start time ${f} -> ${h}`);return}this.warn(`attachTransferred: resetting MediaSource for incompatible tracks ("${Object.keys(r)}"->"${Object.keys(n)}") start time: ${h} currentTime: ${f}`),this.onMediaDetaching(L.MEDIA_DETACHING,{}),this.onMediaAttaching(L.MEDIA_ATTACHING,t),e.currentTime=h;return}this.transferData=void 0,a.forEach(f=>{const c=f,h=r[c];if(h){const m=h.buffer;if(m){const g=this.fragmentTracker,E=h.id;if(g.hasFragments(E)||g.hasParts(E)){const S=Ie.getBuffered(m);g.detectEvictedFragments(c,S,E,null,!0)}const y=uc(c),T=[c,m];this.sourceBuffers[y]=T,m.updating&&this.operationQueue&&this.operationQueue.prependBlocker(c),this.trackSourceBuffer(c,h)}}}),u(),this.bufferCreated()}else this.log("attachTransferred: MediaSource w/o SourceBuffers"),u()}get mediaSourceOpenOrEnded(){var e;const t=(e=this.mediaSource)==null?void 0:e.readyState;return t==="open"||t==="ended"}onMediaDetaching(e,t){const n=!!t.transferMedia;this.transferData=this.overrides=void 0;const{media:r,mediaSource:a,_objectUrl:l}=this;if(a){if(this.log(`media source ${n?"transferring":"detaching"}`),n)this.sourceBuffers.forEach(([u])=>{u&&this.removeBuffer(u)}),this.resetQueue();else{if(this.mediaSourceOpenOrEnded){const u=a.readyState==="open";try{const f=a.sourceBuffers;for(let c=f.length;c--;)u&&f[c].abort(),a.removeSourceBuffer(f[c]);u&&a.endOfStream()}catch(f){this.warn(`onMediaDetaching: ${f.message} while calling endOfStream`)}}this.sourceBufferCount&&this.onBufferReset()}a.removeEventListener("sourceopen",this._onMediaSourceOpen),a.removeEventListener("sourceended",this._onMediaSourceEnded),a.removeEventListener("sourceclose",this._onMediaSourceClose),this.appendSource&&(a.removeEventListener("startstreaming",this._onStartStreaming),a.removeEventListener("endstreaming",this._onEndStreaming)),this.mediaSource=null,this._objectUrl=null}r&&(r.removeEventListener("emptied",this._onMediaEmptied),n||(l&&self.URL.revokeObjectURL(l),this.mediaSrc===l?(r.removeAttribute("src"),this.appendSource&&$p(r),r.load()):this.warn("media|source.src was changed by a third party - skip cleanup")),this.media=null),this.hls.trigger(L.MEDIA_DETACHED,t)}onBufferReset(){this.sourceBuffers.forEach(([e])=>{e&&this.resetBuffer(e)}),this.initTracks()}resetBuffer(e){var t;const n=(t=this.tracks[e])==null?void 0:t.buffer;if(this.removeBuffer(e),n)try{var r;(r=this.mediaSource)!=null&&r.sourceBuffers.length&&this.mediaSource.removeSourceBuffer(n)}catch(a){this.warn(`onBufferReset ${e}`,a)}delete this.tracks[e]}removeBuffer(e){this.removeBufferListeners(e),this.sourceBuffers[uc(e)]=[null,null];const t=this.tracks[e];t&&(t.buffer=void 0)}resetQueue(){this.operationQueue&&this.operationQueue.destroy(),this.operationQueue=new IR(this.tracks)}onBufferCodecs(e,t){const n=this.tracks,r=Object.keys(t);this.log(`BUFFER_CODECS: "${r}" (current SB count ${this.sourceBufferCount})`);const a="audiovideo"in t&&(n.audio||n.video)||n.audiovideo&&("audio"in t||"video"in t),l=!a&&this.sourceBufferCount&&this.media&&r.some(u=>!n[u]);if(a||l){this.warn(`Unsupported transition between "${Object.keys(n)}" and "${r}" SourceBuffers`);return}r.forEach(u=>{var f,c,h;const m=t[u],{id:g,codec:E,levelCodec:y,container:T,metadata:S,supplemental:A}=m;let w=n[u];const I=(f=this.transferData)==null||(c=f.tracks)==null?void 0:c[u],b=I!=null&&I.buffer?I:w,P=(b==null?void 0:b.pendingCodec)||(b==null?void 0:b.codec),G=b==null?void 0:b.levelCodec;w||(w=n[u]={buffer:void 0,listeners:[],codec:E,supplemental:A,container:T,levelCodec:y,metadata:S,id:g});const D=vo(P,G),M=D==null?void 0:D.replace(Bp,"$1");let B=vo(E,y);const O=(h=B)==null?void 0:h.replace(Bp,"$1");B&&D&&M!==O&&(u.slice(0,5)==="audio"&&(B=ko(B,this.appendSource)),this.log(`switching codec ${P} to ${B}`),B!==(w.pendingCodec||w.codec)&&(w.pendingCodec=B),w.container=T,this.appendChangeType(u,T,B))}),(this.tracksReady||this.sourceBufferCount)&&(t.tracks=this.sourceBufferTracks),!this.sourceBufferCount&&this.mediaSourceOpenOrEnded&&this.checkPendingTracks()}get sourceBufferTracks(){return Object.keys(this.tracks).reduce((e,t)=>{const n=this.tracks[t];return e[t]={id:n.id,container:n.container,codec:n.codec,levelCodec:n.levelCodec},e},{})}appendChangeType(e,t,n){const r=`${t};codecs=${n}`,a={label:`change-type=${r}`,execute:()=>{const l=this.tracks[e];if(l){const u=l.buffer;u!=null&&u.changeType&&(this.log(`changing ${e} sourceBuffer type to ${r}`),u.changeType(r),l.codec=n,l.container=t)}this.shiftAndExecuteNext(e)},onStart:()=>{},onComplete:()=>{},onError:l=>{this.warn(`Failed to change ${e} SourceBuffer type`,l)}};this.append(a,e,this.isPending(this.tracks[e]))}blockAudio(e){var t;const n=e.start,r=n+e.duration*.05;if(((t=this.fragmentTracker.getAppendedFrag(n,pe.MAIN))==null?void 0:t.gap)===!0)return;const l={label:"block-audio",execute:()=>{var u;const f=this.tracks.video;(this.lastVideoAppendEnd>r||f!=null&&f.buffer&&Ie.isBuffered(f.buffer,r)||((u=this.fragmentTracker.getAppendedFrag(r,pe.MAIN))==null?void 0:u.gap)===!0)&&(this.blockedAudioAppend=null,this.shiftAndExecuteNext("audio"))},onStart:()=>{},onComplete:()=>{},onError:u=>{this.warn("Error executing block-audio operation",u)}};this.blockedAudioAppend={op:l,frag:e},this.append(l,"audio",!0)}unblockAudio(){const{blockedAudioAppend:e,operationQueue:t}=this;e&&t&&(this.blockedAudioAppend=null,t.unblockAudio(e.op))}onBufferAppending(e,t){const{tracks:n}=this,{data:r,type:a,parent:l,frag:u,part:f,chunkMeta:c,offset:h}=t,m=c.buffering[a],{sn:g,cc:E}=u,y=self.performance.now();m.start=y;const T=u.stats.buffering,S=f?f.stats.buffering:null;T.start===0&&(T.start=y),S&&S.start===0&&(S.start=y);const A=n.audio;let w=!1;a==="audio"&&(A==null?void 0:A.container)==="audio/mpeg"&&(w=!this.lastMpegAudioChunk||c.id===1||this.lastMpegAudioChunk.sn!==c.sn,this.lastMpegAudioChunk=c);const I=n.video,b=I==null?void 0:I.buffer;if(b&&g!=="initSegment"){const D=f||u,M=this.blockedAudioAppend;if(a==="audio"&&l!=="main"&&!this.blockedAudioAppend){const O=D.start+D.duration*.05,X=b.buffered,re=this.currentOp("video");!X.length&&!re?this.blockAudio(D):!re&&!Ie.isBuffered(b,O)&&this.lastVideoAppendEnd<O&&this.blockAudio(D)}else if(a==="video"){const B=D.end;if(M){const O=M.frag.start;(B>O||B<this.lastVideoAppendEnd||Ie.isBuffered(b,O))&&this.unblockAudio()}this.lastVideoAppendEnd=B}}const P=(f||u).start,G={label:`append-${a}`,execute:()=>{var D;m.executeStart=self.performance.now();const M=(D=this.tracks[a])==null?void 0:D.buffer;M&&(w?this.updateTimestampOffset(M,P,.1,a,g,E):h!==void 0&&ce(h)&&this.updateTimestampOffset(M,h,1e-6,a,g,E)),this.appendExecutor(r,a)},onStart:()=>{},onComplete:()=>{const D=self.performance.now();m.executeEnd=m.end=D,T.first===0&&(T.first=D),S&&S.first===0&&(S.first=D);const M={};this.sourceBuffers.forEach(([B,O])=>{B&&(M[B]=Ie.getBuffered(O))}),this.appendErrors[a]=0,a==="audio"||a==="video"?this.appendErrors.audiovideo=0:(this.appendErrors.audio=0,this.appendErrors.video=0),this.hls.trigger(L.BUFFER_APPENDED,{type:a,frag:u,part:f,chunkMeta:c,parent:u.type,timeRanges:M})},onError:D=>{var M;const B={type:xe.MEDIA_ERROR,parent:u.type,details:H.BUFFER_APPEND_ERROR,sourceBufferName:a,frag:u,part:f,chunkMeta:c,error:D,err:D,fatal:!1},O=(M=this.media)==null?void 0:M.error;if(D.code===DOMException.QUOTA_EXCEEDED_ERR||D.name=="QuotaExceededError"||"quota"in D)B.details=H.BUFFER_FULL_ERROR;else if(D.code===DOMException.INVALID_STATE_ERR&&this.mediaSourceOpenOrEnded&&!O)B.errorAction=Pi(!0);else if(D.name===X0&&this.sourceBufferCount===0)B.errorAction=Pi(!0);else{const X=++this.appendErrors[a];this.warn(`Failed ${X}/${this.hls.config.appendErrorMaxRetry} times to append segment in "${a}" sourceBuffer (${O||"no media error"})`),(X>=this.hls.config.appendErrorMaxRetry||O)&&(B.fatal=!0)}this.hls.trigger(L.ERROR,B)}};this.append(G,a,this.isPending(this.tracks[a]))}getFlushOp(e,t,n){return this.log(`queuing "${e}" remove ${t}-${n}`),{label:"remove",execute:()=>{this.removeExecutor(e,t,n)},onStart:()=>{},onComplete:()=>{this.hls.trigger(L.BUFFER_FLUSHED,{type:e})},onError:r=>{this.warn(`Failed to remove ${t}-${n} from "${e}" SourceBuffer`,r)}}}onBufferFlushing(e,t){const{type:n,startOffset:r,endOffset:a}=t;n?this.append(this.getFlushOp(n,r,a),n):this.sourceBuffers.forEach(([l])=>{l&&this.append(this.getFlushOp(l,r,a),l)})}onFragParsed(e,t){const{frag:n,part:r}=t,a=[],l=r?r.elementaryStreams:n.elementaryStreams;l[Ge.AUDIOVIDEO]?a.push("audiovideo"):(l[Ge.AUDIO]&&a.push("audio"),l[Ge.VIDEO]&&a.push("video"));const u=()=>{const f=self.performance.now();n.stats.buffering.end=f,r&&(r.stats.buffering.end=f);const c=r?r.stats:n.stats;this.hls.trigger(L.FRAG_BUFFERED,{frag:n,part:r,stats:c,id:n.type})};a.length===0&&this.warn(`Fragments must have at least one ElementaryStreamType set. type: ${n.type} level: ${n.level} sn: ${n.sn}`),this.blockBuffers(u,a).catch(f=>{this.warn(`Fragment buffered callback ${f}`),this.stepOperationQueue(this.sourceBufferTypes)})}onFragChanged(e,t){this.trimBuffers()}get bufferedToEnd(){return this.sourceBufferCount>0&&!this.sourceBuffers.some(([e])=>{var t,n;return e&&(!((t=this.tracks[e])!=null&&t.ended)||((n=this.tracks[e])==null?void 0:n.ending))})}onBufferEos(e,t){var n;this.sourceBuffers.forEach(([l])=>{if(l){const u=this.tracks[l];(!t.type||t.type===l)&&(u.ending=!0,u.ended||(u.ended=!0,this.log(`${l} buffer reached EOS`)))}});const r=((n=this.overrides)==null?void 0:n.endOfStream)!==!1;this.sourceBufferCount>0&&!this.sourceBuffers.some(([l])=>{var u;return l&&!((u=this.tracks[l])!=null&&u.ended)})&&(r?(this.log("Queueing EOS"),this.blockUntilOpen(()=>{this.tracksEnded();const{mediaSource:l}=this;if(!l||l.readyState!=="open"){l&&this.log(`Could not call mediaSource.endOfStream(). mediaSource.readyState: ${l.readyState}`);return}this.log("Calling mediaSource.endOfStream()"),l.endOfStream(),this.hls.trigger(L.BUFFERED_TO_END,void 0)})):(this.tracksEnded(),this.hls.trigger(L.BUFFERED_TO_END,void 0)))}tracksEnded(){this.sourceBuffers.forEach(([e])=>{if(e!==null){const t=this.tracks[e];t&&(t.ending=!1)}})}onLevelUpdated(e,{details:t}){t.fragments.length&&(this.details=t,this.updateDuration())}updateDuration(){this.blockUntilOpen(()=>{const e=this.getDurationAndRange();e&&this.updateMediaSource(e)})}onError(e,t){if(t.details===H.BUFFER_APPEND_ERROR&&t.frag){var n;const r=(n=t.errorAction)==null?void 0:n.nextAutoLevel;ce(r)&&r!==t.frag.level&&this.resetAppendErrors()}}resetAppendErrors(){this.appendErrors={audio:0,video:0,audiovideo:0}}trimBuffers(){const{hls:e,details:t,media:n}=this;if(!n||t===null||!this.sourceBufferCount)return;const r=e.config,a=n.currentTime,l=t.levelTargetDuration,u=t.live&&r.liveBackBufferLength!==null?r.liveBackBufferLength:r.backBufferLength;if(ce(u)&&u>=0){const f=Math.max(u,l),c=Math.floor(a/l)*l-f;this.flushBackBuffer(a,l,c)}if(ce(r.frontBufferFlushThreshold)&&r.frontBufferFlushThreshold>0){const f=Math.max(r.maxBufferLength,r.frontBufferFlushThreshold),c=Math.max(f,l),h=Math.floor(a/l)*l+c;this.flushFrontBuffer(a,l,h)}}flushBackBuffer(e,t,n){this.sourceBuffers.forEach(([r,a])=>{if(a){const u=Ie.getBuffered(a);if(u.length>0&&n>u.start(0)){var l;this.hls.trigger(L.BACK_BUFFER_REACHED,{bufferEnd:n});const f=this.tracks[r];if((l=this.details)!=null&&l.live)this.hls.trigger(L.LIVE_BACK_BUFFER_REACHED,{bufferEnd:n});else if(f!=null&&f.ended){this.log(`Cannot flush ${r} back buffer while SourceBuffer is in ended state`);return}this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:n,type:r})}}})}flushFrontBuffer(e,t,n){this.sourceBuffers.forEach(([r,a])=>{if(a){const l=Ie.getBuffered(a),u=l.length;if(u<2)return;const f=l.start(u-1),c=l.end(u-1);if(n>f||e>=f&&e<=c)return;this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:f,endOffset:1/0,type:r})}})}getDurationAndRange(){var e;const{details:t,mediaSource:n}=this;if(!t||!this.media||(n==null?void 0:n.readyState)!=="open")return null;const r=t.edge;if(t.live&&this.hls.config.liveDurationInfinity){if(t.fragments.length&&t.live&&n.setLiveSeekableRange){const c=Math.max(0,t.fragmentStart),h=Math.max(c,r);return{duration:1/0,start:c,end:h}}return{duration:1/0}}const a=(e=this.overrides)==null?void 0:e.duration;if(a)return ce(a)?{duration:a}:null;const l=this.media.duration,u=ce(n.duration)?n.duration:0;return r>u&&r>l||!ce(l)?{duration:r}:null}updateMediaSource({duration:e,start:t,end:n}){const r=this.mediaSource;!this.media||!r||r.readyState!=="open"||(r.duration!==e&&(ce(e)&&this.log(`Updating MediaSource duration to ${e.toFixed(3)}`),r.duration=e),t!==void 0&&n!==void 0&&(this.log(`MediaSource duration is set to ${r.duration}. Setting seekable range to ${t}-${n}.`),r.setLiveSeekableRange(t,n)))}get tracksReady(){const e=this.pendingTrackCount;return e>0&&(e>=this.bufferCodecEventsTotal||this.isPending(this.tracks.audiovideo))}checkPendingTracks(){const{bufferCodecEventsTotal:e,pendingTrackCount:t,tracks:n}=this;if(this.log(`checkPendingTracks (pending: ${t} codec events expected: ${e}) ${Ke(n)}`),this.tracksReady){var r;const a=(r=this.transferData)==null?void 0:r.tracks;a&&Object.keys(a).length?this.attachTransferred():this.createSourceBuffers()}}bufferCreated(){if(this.sourceBufferCount){const e={};this.sourceBuffers.forEach(([t,n])=>{if(t){const r=this.tracks[t];e[t]={buffer:n,container:r.container,codec:r.codec,supplemental:r.supplemental,levelCodec:r.levelCodec,id:r.id,metadata:r.metadata}}}),this.hls.trigger(L.BUFFER_CREATED,{tracks:e}),this.log(`SourceBuffers created. Running queue: ${this.operationQueue}`),this.sourceBuffers.forEach(([t])=>{this.executeNext(t)})}else{const e=new Error("could not create source buffer for media codec(s)");this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_INCOMPATIBLE_CODECS_ERROR,fatal:!0,error:e,reason:e.message})}}createSourceBuffers(){const{tracks:e,sourceBuffers:t,mediaSource:n}=this;if(!n)throw new Error("createSourceBuffers called when mediaSource was null");for(const a in e){const l=a,u=e[l];if(this.isPending(u)){const f=this.getTrackCodec(u,l),c=`${u.container};codecs=${f}`;u.codec=f,this.log(`creating sourceBuffer(${c})${this.currentOp(l)?" Queued":""} ${Ke(u)}`);try{const h=n.addSourceBuffer(c),m=uc(l),g=[l,h];t[m]=g,u.buffer=h}catch(h){var r;this.error(`error while trying to add sourceBuffer: ${h.message}`),this.shiftAndExecuteNext(l),(r=this.operationQueue)==null||r.removeBlockers(),delete this.tracks[l],this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_ADD_CODEC_ERROR,fatal:!1,error:h,sourceBufferName:l,mimeType:c,parent:u.id});return}this.trackSourceBuffer(l,u)}}this.bufferCreated()}getTrackCodec(e,t){const n=e.supplemental;let r=e.codec;n&&(t==="video"||t==="audiovideo")&&kc(n,"video")&&(r=SL(r,n));const a=vo(r,e.levelCodec);return a?t.slice(0,5)==="audio"?ko(a,this.appendSource):a:""}trackSourceBuffer(e,t){const n=t.buffer;if(!n)return;const r=this.getTrackCodec(t,e);this.tracks[e]={buffer:n,codec:r,container:t.container,levelCodec:t.levelCodec,supplemental:t.supplemental,metadata:t.metadata,id:t.id,listeners:[]},this.removeBufferListeners(e),this.addBufferListener(e,"updatestart",this.onSBUpdateStart),this.addBufferListener(e,"updateend",this.onSBUpdateEnd),this.addBufferListener(e,"error",this.onSBUpdateError),this.appendSource&&this.addBufferListener(e,"bufferedchange",(a,l)=>{const u=l.removedRanges;u!=null&&u.length&&this.hls.trigger(L.BUFFER_FLUSHED,{type:a})})}get mediaSrc(){var e,t;const n=((e=this.media)==null||(t=e.querySelector)==null?void 0:t.call(e,"source"))||this.media;return n==null?void 0:n.src}onSBUpdateStart(e){const t=this.currentOp(e);t&&t.onStart()}onSBUpdateEnd(e){var t;if(((t=this.mediaSource)==null?void 0:t.readyState)==="closed"){this.resetBuffer(e);return}const n=this.currentOp(e);n&&(n.onComplete(),this.shiftAndExecuteNext(e))}onSBUpdateError(e,t){var n;const r=new Error(`${e} SourceBuffer error. MediaSource readyState: ${(n=this.mediaSource)==null?void 0:n.readyState}`);this.error(`${r}`,t),this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_APPENDING_ERROR,sourceBufferName:e,error:r,fatal:!1});const a=this.currentOp(e);a&&a.onError(r)}updateTimestampOffset(e,t,n,r,a,l){const u=t-e.timestampOffset;Math.abs(u)>=n&&(this.log(`Updating ${r} SourceBuffer timestampOffset to ${t} (sn: ${a} cc: ${l})`),e.timestampOffset=t)}removeExecutor(e,t,n){const{media:r,mediaSource:a}=this,l=this.tracks[e],u=l==null?void 0:l.buffer;if(!r||!a||!u){this.warn(`Attempting to remove from the ${e} SourceBuffer, but it does not exist`),this.shiftAndExecuteNext(e);return}const f=ce(r.duration)?r.duration:1/0,c=ce(a.duration)?a.duration:1/0,h=Math.max(0,t),m=Math.min(n,f,c);m>h&&(!l.ending||l.ended)?(l.ended=!1,this.log(`Removing [${h},${m}] from the ${e} SourceBuffer`),u.remove(h,m)):this.shiftAndExecuteNext(e)}appendExecutor(e,t){const n=this.tracks[t],r=n==null?void 0:n.buffer;if(!r)throw new wR(`Attempting to append to the ${t} SourceBuffer, but it does not exist`);n.ending=!1,n.ended=!1,r.appendBuffer(e)}blockUntilOpen(e){if(this.isUpdating()||this.isQueued())this.blockBuffers(e).catch(t=>{this.warn(`SourceBuffer blocked callback ${t}`),this.stepOperationQueue(this.sourceBufferTypes)});else try{e()}catch(t){this.warn(`Callback run without blocking ${this.operationQueue} ${t}`)}}isUpdating(){return this.sourceBuffers.some(([e,t])=>e&&t.updating)}isQueued(){return this.sourceBuffers.some(([e])=>e&&!!this.currentOp(e))}isPending(e){return!!e&&!e.buffer}blockBuffers(e,t=this.sourceBufferTypes){if(!t.length)return this.log("Blocking operation requested, but no SourceBuffers exist"),Promise.resolve().then(e);const{operationQueue:n}=this,r=t.map(l=>this.appendBlocker(l));return t.length>1&&!!this.blockedAudioAppend&&this.unblockAudio(),Promise.all(r).then(l=>{n===this.operationQueue&&(e(),this.stepOperationQueue(this.sourceBufferTypes))})}stepOperationQueue(e){e.forEach(t=>{var n;const r=(n=this.tracks[t])==null?void 0:n.buffer;!r||r.updating||this.shiftAndExecuteNext(t)})}append(e,t,n){this.operationQueue&&this.operationQueue.append(e,t,n)}appendBlocker(e){if(this.operationQueue)return this.operationQueue.appendBlocker(e)}currentOp(e){return this.operationQueue?this.operationQueue.current(e):null}executeNext(e){e&&this.operationQueue&&this.operationQueue.executeNext(e)}shiftAndExecuteNext(e){this.operationQueue&&this.operationQueue.shiftAndExecuteNext(e)}get pendingTrackCount(){return Object.keys(this.tracks).reduce((e,t)=>e+(this.isPending(this.tracks[t])?1:0),0)}get sourceBufferCount(){return this.sourceBuffers.reduce((e,[t])=>e+(t?1:0),0)}get sourceBufferTypes(){return this.sourceBuffers.map(([e])=>e).filter(e=>!!e)}addBufferListener(e,t,n){const r=this.tracks[e];if(!r)return;const a=r.buffer;if(!a)return;const l=n.bind(this,e);r.listeners.push({event:t,listener:l}),a.addEventListener(t,l)}removeBufferListeners(e){const t=this.tracks[e];if(!t)return;const n=t.buffer;n&&(t.listeners.forEach(r=>{n.removeEventListener(r.event,r.listener)}),t.listeners.length=0)}}function $p(i){const e=i.querySelectorAll("source");[].slice.call(e).forEach(t=>{i.removeChild(t)})}function bR(i,e){const t=self.document.createElement("source");t.type="video/mp4",t.src=e,i.appendChild(t)}function uc(i){return i==="audio"?1:0}class Td{constructor(e){this.hls=void 0,this.autoLevelCapping=void 0,this.firstLevel=void 0,this.media=void 0,this.restrictedLevels=void 0,this.timer=void 0,this.clientRect=void 0,this.streamController=void 0,this.hls=e,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.firstLevel=-1,this.media=null,this.restrictedLevels=[],this.timer=void 0,this.clientRect=null,this.registerListeners()}setStreamController(e){this.streamController=e}destroy(){this.hls&&this.unregisterListener(),this.timer&&this.stopCapping(),this.media=null,this.clientRect=null,this.hls=this.streamController=null}registerListeners(){const{hls:e}=this;e.on(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.BUFFER_CODECS,this.onBufferCodecs,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListener(){const{hls:e}=this;e.off(L.FPS_DROP_LEVEL_CAPPING,this.onFpsDropLevelCapping,this),e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}onFpsDropLevelCapping(e,t){const n=this.hls.levels[t.droppedLevel];this.isLevelAllowed(n)&&this.restrictedLevels.push({bitrate:n.bitrate,height:n.height,width:n.width})}onMediaAttaching(e,t){this.media=t.media instanceof HTMLVideoElement?t.media:null,this.clientRect=null,this.timer&&this.hls.levels.length&&this.detectPlayerSize()}onManifestParsed(e,t){const n=this.hls;this.restrictedLevels=[],this.firstLevel=t.firstLevel,n.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onLevelsUpdated(e,t){this.timer&&ce(this.autoLevelCapping)&&this.detectPlayerSize()}onBufferCodecs(e,t){this.hls.config.capLevelToPlayerSize&&t.video&&this.startCapping()}onMediaDetaching(){this.stopCapping(),this.media=null}detectPlayerSize(){if(this.media){if(this.mediaHeight<=0||this.mediaWidth<=0){this.clientRect=null;return}const e=this.hls.levels;if(e.length){const t=this.hls,n=this.getMaxLevel(e.length-1);n!==this.autoLevelCapping&&t.logger.log(`Setting autoLevelCapping to ${n}: ${e[n].height}p@${e[n].bitrate} for media ${this.mediaWidth}x${this.mediaHeight}`),t.autoLevelCapping=n,t.autoLevelEnabled&&t.autoLevelCapping>this.autoLevelCapping&&this.streamController&&this.streamController.nextLevelSwitch(),this.autoLevelCapping=t.autoLevelCapping}}}getMaxLevel(e){const t=this.hls.levels;if(!t.length)return-1;const n=t.filter((r,a)=>this.isLevelAllowed(r)&&a<=e);return this.clientRect=null,Td.getMaxLevelByMediaSize(n,this.mediaWidth,this.mediaHeight)}startCapping(){this.timer||(this.autoLevelCapping=Number.POSITIVE_INFINITY,self.clearInterval(this.timer),this.timer=self.setInterval(this.detectPlayerSize.bind(this),1e3),this.detectPlayerSize())}stopCapping(){this.restrictedLevels=[],this.firstLevel=-1,this.autoLevelCapping=Number.POSITIVE_INFINITY,this.timer&&(self.clearInterval(this.timer),this.timer=void 0)}getDimensions(){if(this.clientRect)return this.clientRect;const e=this.media,t={width:0,height:0};if(e){const n=e.getBoundingClientRect();t.width=n.width,t.height=n.height,!t.width&&!t.height&&(t.width=n.right-n.left||e.width||0,t.height=n.bottom-n.top||e.height||0)}return this.clientRect=t,t}get mediaWidth(){return this.getDimensions().width*this.contentScaleFactor}get mediaHeight(){return this.getDimensions().height*this.contentScaleFactor}get contentScaleFactor(){let e=1;if(!this.hls.config.ignoreDevicePixelRatio)try{e=self.devicePixelRatio}catch{}return Math.min(e,this.hls.config.maxDevicePixelRatio)}isLevelAllowed(e){return!this.restrictedLevels.some(n=>e.bitrate===n.bitrate&&e.width===n.width&&e.height===n.height)}static getMaxLevelByMediaSize(e,t,n){if(!(e!=null&&e.length))return-1;const r=(u,f)=>f?u.width!==f.width||u.height!==f.height:!0;let a=e.length-1;const l=Math.max(t,n);for(let u=0;u<e.length;u+=1){const f=e[u];if((f.width>=l||f.height>=l)&&r(f,e[u+1])){a=u;break}}return a}}const CR={MANIFEST:"m",AUDIO:"a",VIDEO:"v",MUXED:"av",INIT:"i",CAPTION:"c",TIMED_TEXT:"tt",KEY:"k",OTHER:"o"},Dt=CR,kR={HLS:"h"},DR=kR,PR="CMCD-Object",OR="CMCD-Request",NR="CMCD-Session",FR="CMCD-Status",Ri={OBJECT:PR,REQUEST:OR,SESSION:NR,STATUS:FR},MR={[Ri.OBJECT]:["br","ab","d","ot","tb","tpb","lb","tab","lab","url"],[Ri.REQUEST]:["pb","bl","tbl","dl","ltc","mtp","nor","nrr","rc","sn","sta","su","ttfb","ttfbb","ttlb","cmsdd","cmsds","smrt","df","cs"],[Ri.SESSION]:["cid","pr","sf","sid","st","v","msd"],[Ri.STATUS]:["bs","bsd","cdn","rtp","bg","pt","ec","e"]};class bs{constructor(e,t){Array.isArray(e)&&(e=e.map(n=>n instanceof bs?n:new bs(n))),this.value=e,this.params=t}}const UR="Dict";function BR(i){return Array.isArray(i)?JSON.stringify(i):i instanceof Map?"Map{}":i instanceof Set?"Set{}":typeof i=="object"?JSON.stringify(i):String(i)}function $R(i,e,t,n){return new Error(`failed to ${i} "${BR(e)}" as ${t}`,{cause:n})}function bn(i,e,t){return $R("serialize",i,e,t)}class Q0{constructor(e){this.description=e}}const Gp="Bare Item",GR="Boolean";function jR(i){if(typeof i!="boolean")throw bn(i,GR);return i?"?1":"?0"}function VR(i){return btoa(String.fromCharCode(...i))}const HR="Byte Sequence";function KR(i){if(ArrayBuffer.isView(i)===!1)throw bn(i,HR);return`:${VR(i)}:`}const zR="Integer";function WR(i){return i<-999999999999999||999999999999999<i}function J0(i){if(WR(i))throw bn(i,zR);return i.toString()}function YR(i){return`@${J0(i.getTime()/1e3)}`}function Z0(i,e){if(i<0)return-Z0(-i,e);const t=Math.pow(10,e);if(Math.abs(i*t%1-.5)<Number.EPSILON){const r=Math.floor(i*t);return(r%2===0?r:r+1)/t}else return Math.round(i*t)/t}const qR="Decimal";function XR(i){const e=Z0(i,3);if(Math.floor(Math.abs(e)).toString().length>12)throw bn(i,qR);const t=e.toString();return t.includes(".")?t:`${t}.0`}const QR="String",JR=/[\x00-\x1f\x7f]+/;function ZR(i){if(JR.test(i))throw bn(i,QR);return`"${i.replace(/\\/g,"\\\\").replace(/"/g,'\\"')}"`}function e1(i){return i.description||i.toString().slice(7,-1)}const t1="Token";function jp(i){const e=e1(i);if(/^([a-zA-Z*])([!#$%&'*+\-.^_`|~\w:/]*)$/.test(e)===!1)throw bn(e,t1);return e}function jc(i){switch(typeof i){case"number":if(!ce(i))throw bn(i,Gp);return Number.isInteger(i)?J0(i):XR(i);case"string":return ZR(i);case"symbol":return jp(i);case"boolean":return jR(i);case"object":if(i instanceof Date)return YR(i);if(i instanceof Uint8Array)return KR(i);if(i instanceof Q0)return jp(i);default:throw bn(i,Gp)}}const n1="Key";function Vc(i){if(/^[a-z*][a-z0-9\-_.*]*$/.test(i)===!1)throw bn(i,n1);return i}function Ld(i){return i==null?"":Object.entries(i).map(([e,t])=>t===!0?`;${Vc(e)}`:`;${Vc(e)}=${jc(t)}`).join("")}function ey(i){return i instanceof bs?`${jc(i.value)}${Ld(i.params)}`:jc(i)}function r1(i){return`(${i.value.map(ey).join(" ")})${Ld(i.params)}`}function s1(i,e={whitespace:!0}){if(typeof i!="object")throw bn(i,UR);const t=i instanceof Map?i.entries():Object.entries(i),n=e!=null&&e.whitespace?" ":"";return Array.from(t).map(([r,a])=>{a instanceof bs||(a=new bs(a));let l=Vc(r);return a.value===!0?l+=Ld(a.params):(l+="=",Array.isArray(a.value)?l+=r1(a):l+=ey(a)),l}).join(`,${n}`)}function i1(i,e){return s1(i,e)}function a1(i){return["ot","sf","st","e","sta"].includes(i)}function o1(i){return typeof i=="number"?ce(i):i!=null&&i!==""&&i!==!1}function l1(i,e){const t=new URL(i),n=new URL(e);if(t.origin!==n.origin)return i;const r=t.pathname.split("/").slice(1),a=n.pathname.split("/").slice(1,-1);for(;r[0]===a[0];)r.shift(),a.shift();for(;a.length;)a.shift(),r.unshift("..");return r.join("/")}const Lo=i=>Math.round(i),u1=(i,e)=>(e!=null&&e.baseUrl&&(i=l1(i,e.baseUrl)),encodeURIComponent(i)),oo=i=>Lo(i/100)*100,c1={br:Lo,d:Lo,bl:oo,dl:oo,mtp:oo,nor:u1,rtp:oo,tb:Lo};function d1(i,e){const t={};if(i==null||typeof i!="object")return t;const n=Object.keys(i).sort(),r=Ue({},c1,e==null?void 0:e.formatters),a=e==null?void 0:e.filter;return n.forEach(l=>{if((a==null?void 0:a(l))===!1)return;let u=i[l];const f=r[l];f&&(u=f(u,e)),!(l==="v"&&u===1)&&(l=="pr"&&u===1||o1(u)&&(a1(l)&&typeof u=="string"&&(u=new Q0(u)),t[l]=u))}),t}function ty(i,e={}){return i?i1(d1(i,e),Ue({whitespace:!1},e)):""}function f1(i,e={}){const t={};if(!i)return t;const n=Object.entries(i),r=Object.entries(MR).concat(Object.entries((e==null?void 0:e.customHeaderMap)||{})),a=n.reduce((l,u)=>{var f,c;const[h,m]=u,g=((f=r.find(E=>E[1].includes(h)))===null||f===void 0?void 0:f[0])||Ri.REQUEST;return(c=l[g])!==null&&c!==void 0||(l[g]={}),l[g][h]=m,l},{});return Object.entries(a).reduce((l,[u,f])=>(l[u]=ty(f,e),l),t)}function h1(i,e,t){return Ue(i,f1(e,t))}const m1="CMCD";function p1(i,e={}){if(!i)return"";const t=ty(i,e);return`${m1}=${encodeURIComponent(t)}`}const Vp=/CMCD=[^&#]+/;function g1(i,e,t){const n=p1(e,t);if(!n)return i;if(Vp.test(i))return i.replace(Vp,n);const r=i.includes("?")?"&":"?";return`${i}${r}${n}`}class y1{constructor(e){this.hls=void 0,this.config=void 0,this.media=void 0,this.sid=void 0,this.cid=void 0,this.useHeaders=!1,this.includeKeys=void 0,this.initialized=!1,this.starved=!1,this.buffering=!0,this.audioBuffer=void 0,this.videoBuffer=void 0,this.onWaiting=()=>{this.initialized&&(this.starved=!0),this.buffering=!0},this.onPlaying=()=>{this.initialized||(this.initialized=!0),this.buffering=!1},this.applyPlaylistData=r=>{try{this.apply(r,{ot:Dt.MANIFEST,su:!this.initialized})}catch(a){this.hls.logger.warn("Could not generate manifest CMCD data.",a)}},this.applyFragmentData=r=>{try{const{frag:a,part:l}=r,u=this.hls.levels[a.level],f=this.getObjectType(a),c={d:(l||a).duration*1e3,ot:f};(f===Dt.VIDEO||f===Dt.AUDIO||f==Dt.MUXED)&&(c.br=u.bitrate/1e3,c.tb=this.getTopBandwidth(f)/1e3,c.bl=this.getBufferLength(f));const h=l?this.getNextPart(l):this.getNextFrag(a);h!=null&&h.url&&h.url!==a.url&&(c.nor=h.url),this.apply(r,c)}catch(a){this.hls.logger.warn("Could not generate segment CMCD data.",a)}},this.hls=e;const t=this.config=e.config,{cmcd:n}=t;n!=null&&(t.pLoader=this.createPlaylistLoader(),t.fLoader=this.createFragmentLoader(),this.sid=n.sessionId||e.sessionId,this.cid=n.contentId,this.useHeaders=n.useHeaders===!0,this.includeKeys=n.includeKeys,this.registerListeners())}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHED,this.onMediaDetached,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this)}unregisterListeners(){const e=this.hls;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHED,this.onMediaDetached,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this)}destroy(){this.unregisterListeners(),this.onMediaDetached(),this.hls=this.config=this.audioBuffer=this.videoBuffer=null,this.onWaiting=this.onPlaying=this.media=null}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("waiting",this.onWaiting),this.media.addEventListener("playing",this.onPlaying)}onMediaDetached(){this.media&&(this.media.removeEventListener("waiting",this.onWaiting),this.media.removeEventListener("playing",this.onPlaying),this.media=null)}onBufferCreated(e,t){var n,r;this.audioBuffer=(n=t.tracks.audio)==null?void 0:n.buffer,this.videoBuffer=(r=t.tracks.video)==null?void 0:r.buffer}createData(){var e;return{v:1,sf:DR.HLS,sid:this.sid,cid:this.cid,pr:(e=this.media)==null?void 0:e.playbackRate,mtp:this.hls.bandwidthEstimate/1e3}}apply(e,t={}){Ue(t,this.createData());const n=t.ot===Dt.INIT||t.ot===Dt.VIDEO||t.ot===Dt.MUXED;this.starved&&n&&(t.bs=!0,t.su=!0,this.starved=!1),t.su==null&&(t.su=this.buffering);const{includeKeys:r}=this;r&&(t=Object.keys(t).reduce((l,u)=>(r.includes(u)&&(l[u]=t[u]),l),{}));const a={baseUrl:e.url};this.useHeaders?(e.headers||(e.headers={}),h1(e.headers,t,a)):e.url=g1(e.url,t,a)}getNextFrag(e){var t;const n=(t=this.hls.levels[e.level])==null?void 0:t.details;if(n){const r=e.sn-n.startSN;return n.fragments[r+1]}}getNextPart(e){var t,n;const{index:r,fragment:a}=e,l=(t=this.hls.levels[a.level])==null||(n=t.details)==null?void 0:n.partList;if(l){const{sn:u}=a;for(let f=l.length-1;f>=0;f--){const c=l[f];if(c.index===r&&c.fragment.sn===u)return l[f+1]}}}getObjectType(e){const{type:t}=e;if(t==="subtitle")return Dt.TIMED_TEXT;if(e.sn==="initSegment")return Dt.INIT;if(t==="audio")return Dt.AUDIO;if(t==="main")return this.hls.audioTracks.length?Dt.VIDEO:Dt.MUXED}getTopBandwidth(e){let t=0,n;const r=this.hls;if(e===Dt.AUDIO)n=r.audioTracks;else{const a=r.maxAutoLevel,l=a>-1?a+1:r.levels.length;n=r.levels.slice(0,l)}return n.forEach(a=>{a.bitrate>t&&(t=a.bitrate)}),t>0?t:NaN}getBufferLength(e){const t=this.media,n=e===Dt.AUDIO?this.audioBuffer:this.videoBuffer;return!n||!t?NaN:Ie.bufferInfo(n,t.currentTime,this.config.maxBufferHole).len*1e3}createPlaylistLoader(){const{pLoader:e}=this.config,t=this.applyPlaylistData,n=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new n(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,l,u){t(a),this.loader.load(a,l,u)}}}createFragmentLoader(){const{fLoader:e}=this.config,t=this.applyFragmentData,n=e||this.config.loader;return class{constructor(a){this.loader=void 0,this.loader=new n(a)}get stats(){return this.loader.stats}get context(){return this.loader.context}destroy(){this.loader.destroy()}abort(){this.loader.abort()}load(a,l,u){t(a),this.loader.load(a,l,u)}}}}const v1=3e5;class E1 extends gn{constructor(e){super("content-steering",e.logger),this.hls=void 0,this.loader=null,this.uri=null,this.pathwayId=".",this._pathwayPriority=null,this.timeToLoad=300,this.reloadTimer=-1,this.updated=0,this.started=!1,this.enabled=!0,this.levels=null,this.audioTracks=null,this.subtitleTracks=null,this.penalizedPathways={},this.hls=e,this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.ERROR,this.onError,this))}pathways(){return(this.levels||[]).reduce((e,t)=>(e.indexOf(t.pathwayId)===-1&&e.push(t.pathwayId),e),[])}get pathwayPriority(){return this._pathwayPriority}set pathwayPriority(e){this.updatePathwayPriority(e)}startLoad(){if(this.started=!0,this.clearTimeout(),this.enabled&&this.uri){if(this.updated){const e=this.timeToLoad*1e3-(performance.now()-this.updated);if(e>0){this.scheduleRefresh(this.uri,e);return}}this.loadSteeringManifest(this.uri)}}stopLoad(){this.started=!1,this.loader&&(this.loader.destroy(),this.loader=null),this.clearTimeout()}clearTimeout(){this.reloadTimer!==-1&&(self.clearTimeout(this.reloadTimer),this.reloadTimer=-1)}destroy(){this.unregisterListeners(),this.stopLoad(),this.hls=null,this.levels=this.audioTracks=this.subtitleTracks=null}removeLevel(e){const t=this.levels;t&&(this.levels=t.filter(n=>n!==e))}onManifestLoading(){this.stopLoad(),this.enabled=!0,this.timeToLoad=300,this.updated=0,this.uri=null,this.pathwayId=".",this.levels=this.audioTracks=this.subtitleTracks=null}onManifestLoaded(e,t){const{contentSteering:n}=t;n!==null&&(this.pathwayId=n.pathwayId,this.uri=n.uri,this.started&&this.startLoad())}onManifestParsed(e,t){this.audioTracks=t.audioTracks,this.subtitleTracks=t.subtitleTracks}onError(e,t){const{errorAction:n}=t;if((n==null?void 0:n.action)===St.SendAlternateToPenaltyBox&&n.flags===hn.MoveAllAlternatesMatchingHost){const r=this.levels;let a=this._pathwayPriority,l=this.pathwayId;if(t.context){const{groupId:u,pathwayId:f,type:c}=t.context;u&&r?l=this.getPathwayForGroupId(u,c,l):f&&(l=f)}l in this.penalizedPathways||(this.penalizedPathways[l]=performance.now()),!a&&r&&(a=this.pathways()),a&&a.length>1&&(this.updatePathwayPriority(a),n.resolved=this.pathwayId!==l),t.details===H.BUFFER_APPEND_ERROR&&!t.fatal?n.resolved=!0:n.resolved||this.warn(`Could not resolve ${t.details} ("${t.error.message}") with content-steering for Pathway: ${l} levels: ${r&&r.length} priorities: ${Ke(a)} penalized: ${Ke(this.penalizedPathways)}`)}}filterParsedLevels(e){this.levels=e;let t=this.getLevelsForPathway(this.pathwayId);if(t.length===0){const n=e[0].pathwayId;this.log(`No levels found in Pathway ${this.pathwayId}. Setting initial Pathway to "${n}"`),t=this.getLevelsForPathway(n),this.pathwayId=n}return t.length!==e.length&&this.log(`Found ${t.length}/${e.length} levels in Pathway "${this.pathwayId}"`),t}getLevelsForPathway(e){return this.levels===null?[]:this.levels.filter(t=>e===t.pathwayId)}updatePathwayPriority(e){this._pathwayPriority=e;let t;const n=this.penalizedPathways,r=performance.now();Object.keys(n).forEach(a=>{r-n[a]>v1&&delete n[a]});for(let a=0;a<e.length;a++){const l=e[a];if(l in n)continue;if(l===this.pathwayId)return;const u=this.hls.nextLoadLevel,f=this.hls.levels[u];if(t=this.getLevelsForPathway(l),t.length>0){this.log(`Setting Pathway to "${l}"`),this.pathwayId=l,I0(t),this.hls.trigger(L.LEVELS_UPDATED,{levels:t});const c=this.hls.levels[u];f&&c&&this.levels&&(c.attrs["STABLE-VARIANT-ID"]!==f.attrs["STABLE-VARIANT-ID"]&&c.bitrate!==f.bitrate&&this.log(`Unstable Pathways change from bitrate ${f.bitrate} to ${c.bitrate}`),this.hls.nextLoadLevel=u);break}}}getPathwayForGroupId(e,t,n){const r=this.getLevelsForPathway(n).concat(this.levels||[]);for(let a=0;a<r.length;a++)if(t===De.AUDIO_TRACK&&r[a].hasAudioGroup(e)||t===De.SUBTITLE_TRACK&&r[a].hasSubtitleGroup(e))return r[a].pathwayId;return n}clonePathways(e){const t=this.levels;if(!t)return;const n={},r={};e.forEach(a=>{const{ID:l,"BASE-ID":u,"URI-REPLACEMENT":f}=a;if(t.some(h=>h.pathwayId===l))return;const c=this.getLevelsForPathway(u).map(h=>{const m=new qe(h.attrs);m["PATHWAY-ID"]=l;const g=m.AUDIO&&`${m.AUDIO}_clone_${l}`,E=m.SUBTITLES&&`${m.SUBTITLES}_clone_${l}`;g&&(n[m.AUDIO]=g,m.AUDIO=g),E&&(r[m.SUBTITLES]=E,m.SUBTITLES=E);const y=ny(h.uri,m["STABLE-VARIANT-ID"],"PER-VARIANT-URIS",f),T=new Di({attrs:m,audioCodec:h.audioCodec,bitrate:h.bitrate,height:h.height,name:h.name,url:y,videoCodec:h.videoCodec,width:h.width});if(h.audioGroups)for(let S=1;S<h.audioGroups.length;S++)T.addGroupId("audio",`${h.audioGroups[S]}_clone_${l}`);if(h.subtitleGroups)for(let S=1;S<h.subtitleGroups.length;S++)T.addGroupId("text",`${h.subtitleGroups[S]}_clone_${l}`);return T});t.push(...c),Hp(this.audioTracks,n,f,l),Hp(this.subtitleTracks,r,f,l)})}loadSteeringManifest(e){const t=this.hls.config,n=t.loader;this.loader&&this.loader.destroy(),this.loader=new n(t);let r;try{r=new self.URL(e)}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest URI: ${e}`);return}if(r.protocol!=="data:"){const h=(this.hls.bandwidthEstimate||t.abrEwmaDefaultEstimate)|0;r.searchParams.set("_HLS_pathway",this.pathwayId),r.searchParams.set("_HLS_throughput",""+h)}const a={responseType:"json",url:r.href},l=t.steeringManifestLoadPolicy.default,u=l.errorRetry||l.timeoutRetry||{},f={loadPolicy:l,timeout:l.maxLoadTimeMs,maxRetry:u.maxNumRetry||0,retryDelay:u.retryDelayMs||0,maxRetryDelay:u.maxRetryDelayMs||0},c={onSuccess:(h,m,g,E)=>{this.log(`Loaded steering manifest: "${r}"`);const y=h.data;if((y==null?void 0:y.VERSION)!==1){this.log(`Steering VERSION ${y.VERSION} not supported!`);return}this.updated=performance.now(),this.timeToLoad=y.TTL;const{"RELOAD-URI":T,"PATHWAY-CLONES":S,"PATHWAY-PRIORITY":A}=y;if(T)try{this.uri=new self.URL(T,r).href}catch{this.enabled=!1,this.log(`Failed to parse Steering Manifest RELOAD-URI: ${T}`);return}this.scheduleRefresh(this.uri||g.url),S&&this.clonePathways(S);const w={steeringManifest:y,url:r.toString()};this.hls.trigger(L.STEERING_MANIFEST_LOADED,w),A&&this.updatePathwayPriority(A)},onError:(h,m,g,E)=>{if(this.log(`Error loading steering manifest: ${h.code} ${h.text} (${m.url})`),this.stopLoad(),h.code===410){this.enabled=!1,this.log(`Steering manifest ${m.url} no longer available`);return}let y=this.timeToLoad*1e3;if(h.code===429){const T=this.loader;if(typeof(T==null?void 0:T.getResponseHeader)=="function"){const S=T.getResponseHeader("Retry-After");S&&(y=parseFloat(S)*1e3)}this.log(`Steering manifest ${m.url} rate limited`);return}this.scheduleRefresh(this.uri||m.url,y)},onTimeout:(h,m,g)=>{this.log(`Timeout loading steering manifest (${m.url})`),this.scheduleRefresh(this.uri||m.url)}};this.log(`Requesting steering manifest: ${r}`),this.loader.load(a,f,c)}scheduleRefresh(e,t=this.timeToLoad*1e3){this.clearTimeout(),this.reloadTimer=self.setTimeout(()=>{var n;const r=(n=this.hls)==null?void 0:n.media;if(r&&!r.ended){this.loadSteeringManifest(e);return}this.scheduleRefresh(e,this.timeToLoad*1e3)},t)}}function Hp(i,e,t,n){i&&Object.keys(e).forEach(r=>{const a=i.filter(l=>l.groupId===r).map(l=>{const u=Ue({},l);return u.details=void 0,u.attrs=new qe(u.attrs),u.url=u.attrs.URI=ny(l.url,l.attrs["STABLE-RENDITION-ID"],"PER-RENDITION-URIS",t),u.groupId=u.attrs["GROUP-ID"]=e[r],u.attrs["PATHWAY-ID"]=n,u});i.push(...a)})}function ny(i,e,t,n){const{HOST:r,PARAMS:a,[t]:l}=n;let u;e&&(u=l==null?void 0:l[e],u&&(i=u));const f=new self.URL(i);return r&&!u&&(f.host=r),a&&Object.keys(a).sort().forEach(c=>{c&&f.searchParams.set(c,a[c])}),f.href}function Zt(i,e,t){mn(i,e,t),i.addEventListener(e,t)}function mn(i,e,t){i.removeEventListener(e,t)}class Rs extends gn{constructor(e){super("eme",e.logger),this.hls=void 0,this.config=void 0,this.media=null,this.keyFormatPromise=null,this.keySystemAccessPromises={},this._requestLicenseFailureCount=0,this.mediaKeySessions=[],this.keyIdToKeySessionPromise={},this.mediaKeys=null,this.setMediaKeysQueue=Rs.CDMCleanupPromise?[Rs.CDMCleanupPromise]:[],this.onWaitingForKey=t=>{this.log(`"${t.type}" event`)},this.hls=e,this.config=e.config,this.registerListeners()}destroy(){this.onDestroying(),this.onMediaDetached();const e=this.config;e.requestMediaKeySystemAccessFunc=null,e.licenseXhrSetup=e.licenseResponseCallback=void 0,e.drmSystems=e.drmSystemOptions={},this.hls=this.config=this.keyIdToKeySessionPromise=null,this.onWaitingForKey=null}registerListeners(){this.hls.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.on(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.on(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),this.hls.off(L.MEDIA_DETACHED,this.onMediaDetached,this),this.hls.off(L.MANIFEST_LOADING,this.onManifestLoading,this),this.hls.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),this.hls.off(L.DESTROYING,this.onDestroying,this)}getLicenseServerUrl(e){const{drmSystems:t,widevineLicenseUrl:n}=this.config,r=t[e];if(r)return r.licenseUrl;if(e===et.WIDEVINE&&n)return n}getLicenseServerUrlOrThrow(e){const t=this.getLicenseServerUrl(e);if(t===void 0)throw new Error(`no license server URL configured for key-system "${e}"`);return t}getServerCertificateUrl(e){const{drmSystems:t}=this.config,n=t[e];if(n)return n.serverCertificateUrl;this.log(`No Server Certificate in config.drmSystems["${e}"]`)}attemptKeySystemAccess(e){const t=this.hls.levels,n=(l,u,f)=>!!l&&f.indexOf(l)===u,r=t.map(l=>l.audioCodec).filter(n),a=t.map(l=>l.videoCodec).filter(n);return r.length+a.length===0&&a.push("avc1.42e01e"),new Promise((l,u)=>{const f=c=>{const h=c.shift();this.getMediaKeysPromise(h,r,a).then(m=>l({keySystem:h,mediaKeys:m})).catch(m=>{c.length?f(c):m instanceof Qt?u(m):u(new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_ACCESS,error:m,fatal:!0},m.message))})};f(e)})}requestMediaKeySystemAccess(e,t){const{requestMediaKeySystemAccessFunc:n}=this.config;if(typeof n!="function"){let r=`Configured requestMediaKeySystemAccess is not a function ${n}`;return E0===null&&self.location.protocol==="http:"&&(r=`navigator.requestMediaKeySystemAccess is not available over insecure protocol ${location.protocol}`),Promise.reject(new Error(r))}return n(e,t)}getMediaKeysPromise(e,t,n){const r=cA(e,t,n,this.config.drmSystemOptions),a=this.keySystemAccessPromises[e];let l=a==null?void 0:a.keySystemAccess;if(!l){this.log(`Requesting encrypted media "${e}" key-system access with config: ${Ke(r)}`),l=this.requestMediaKeySystemAccess(e,r);const u=this.keySystemAccessPromises[e]={keySystemAccess:l};return l.catch(f=>{this.log(`Failed to obtain access to key-system "${e}": ${f}`)}),l.then(f=>{this.log(`Access for key-system "${f.keySystem}" obtained`);const c=this.fetchServerCertificate(e);return this.log(`Create media-keys for "${e}"`),u.mediaKeys=f.createMediaKeys().then(h=>(this.log(`Media-keys created for "${e}"`),u.hasMediaKeys=!0,c.then(m=>m?this.setMediaKeysServerCertificate(h,e,m):h))),u.mediaKeys.catch(h=>{this.error(`Failed to create media-keys for "${e}"}: ${h}`)}),u.mediaKeys})}return l.then(()=>a.mediaKeys)}createMediaKeySessionContext({decryptdata:e,keySystem:t,mediaKeys:n}){this.log(`Creating key-system session "${t}" keyId: ${Br.hexDump(e.keyId||[])}`);const r=n.createSession(),a={decryptdata:e,keySystem:t,mediaKeys:n,mediaKeysSession:r,keyStatus:"status-pending"};return this.mediaKeySessions.push(a),a}renewKeySession(e){const t=e.decryptdata;if(t.pssh){const n=this.createMediaKeySessionContext(e),r=this.getKeyIdString(t),a="cenc";this.keyIdToKeySessionPromise[r]=this.generateRequestWithPreferredKeySession(n,a,t.pssh.buffer,"expired")}else this.warn("Could not renew expired session. Missing pssh initData.");this.removeSession(e)}getKeyIdString(e){if(!e)throw new Error("Could not read keyId of undefined decryptdata");if(e.keyId===null)throw new Error("keyId is null");return Br.hexDump(e.keyId)}updateKeySession(e,t){var n;const r=e.mediaKeysSession;return this.log(`Updating key-session "${r.sessionId}" for keyID ${Br.hexDump(((n=e.decryptdata)==null?void 0:n.keyId)||[])}
      } (data length: ${t&&t.byteLength})`),r.update(t)}getSelectedKeySystemFormats(){return Object.keys(this.keySystemAccessPromises).map(e=>({keySystem:e,hasMediaKeys:this.keySystemAccessPromises[e].hasMediaKeys})).filter(({hasMediaKeys:e})=>!!e).map(({keySystem:e})=>gp(e)).filter(e=>!!e)}getKeySystemAccess(e){return this.getKeySystemSelectionPromise(e).then(({keySystem:t,mediaKeys:n})=>this.attemptSetMediaKeys(t,n))}selectKeySystem(e){return new Promise((t,n)=>this.getKeySystemSelectionPromise(e).then(({keySystem:r})=>{const a=gp(r);a?t(a):n(new Error(`Unable to find format for key-system "${r}"`))}).catch(n))}selectKeySystemFormat(e){const t=Object.keys(e.levelkeys||{});return this.keyFormatPromise||(this.log(`Selecting key-system from fragment (sn: ${e.sn} ${e.type}: ${e.level}) key formats ${t.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(t)),this.keyFormatPromise}getKeyFormatPromise(e){const t=xo(this.config),n=e.map(Fc).filter(r=>!!r&&t.indexOf(r)!==-1);return this.selectKeySystem(n)}loadKey(e){const t=e.keyInfo.decryptdata,n=this.getKeyIdString(t),r=`(keyId: ${n} format: "${t.keyFormat}" method: ${t.method} uri: ${t.uri})`;this.log(`Starting session for key ${r}`);let a=this.keyIdToKeySessionPromise[n];return a||(a=this.getKeySystemForKeyPromise(t).then(({keySystem:u,mediaKeys:f})=>(this.throwIfDestroyed(),this.log(`Handle encrypted media sn: ${e.frag.sn} ${e.frag.type}: ${e.frag.level} using key ${r}`),this.attemptSetMediaKeys(u,f).then(()=>(this.throwIfDestroyed(),this.createMediaKeySessionContext({keySystem:u,mediaKeys:f,decryptdata:t}))))),(this.keyIdToKeySessionPromise[n]=a.then(u=>{const f="cenc",c=t.pssh?t.pssh.buffer:null;return this.generateRequestWithPreferredKeySession(u,f,c,"playlist-key")})).catch(u=>this.handleError(u))),a}throwIfDestroyed(e="Invalid state"){if(!this.hls)throw new Error("invalid state")}handleError(e){this.hls&&(this.error(e.message),e instanceof Qt?this.hls.trigger(L.ERROR,e.data):this.hls.trigger(L.ERROR,{type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_KEYS,error:e,fatal:!0}))}getKeySystemForKeyPromise(e){const t=this.getKeyIdString(e),n=this.keyIdToKeySessionPromise[t];if(!n){const r=Fc(e.keyFormat),a=r?[r]:xo(this.config);return this.attemptKeySystemAccess(a)}return n}getKeySystemSelectionPromise(e){if(e.length||(e=xo(this.config)),e.length===0)throw new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_CONFIGURED_LICENSE,fatal:!0},`Missing key-system license configuration options ${Ke({drmSystems:this.config.drmSystems})}`);return this.attemptKeySystemAccess(e)}attemptSetMediaKeys(e,t){if(this.mediaKeys===t)return Promise.resolve();const n=this.setMediaKeysQueue.slice();this.log(`Setting media-keys for "${e}"`);const r=Promise.all(n).then(()=>{if(!this.media)throw this.mediaKeys=null,new Error("Attempted to set mediaKeys without media element attached");return this.media.setMediaKeys(t)});return this.mediaKeys=t,this.setMediaKeysQueue.push(r),r.then(()=>{this.log(`Media-keys set for "${e}"`),n.push(r),this.setMediaKeysQueue=this.setMediaKeysQueue.filter(a=>n.indexOf(a)===-1)})}generateRequestWithPreferredKeySession(e,t,n,r){var a,l;const u=(a=this.config.drmSystems)==null||(l=a[e.keySystem])==null?void 0:l.generateRequest;if(u)try{const y=u.call(this.hls,t,n,e);if(!y)throw new Error("Invalid response from configured generateRequest filter");t=y.initDataType,n=y.initData?y.initData:null,e.decryptdata.pssh=n?new Uint8Array(n):null}catch(y){var f;if(this.warn(y.message),(f=this.hls)!=null&&f.config.debug)throw y}if(n===null)return this.log(`Skipping key-session request for "${r}" (no initData)`),Promise.resolve(e);const c=this.getKeyIdString(e.decryptdata);this.log(`Generating key-session request for "${r}": ${c} (init data type: ${t} length: ${n?n.byteLength:null})`);const h=new md,m=e._onmessage=y=>{const T=e.mediaKeysSession;if(!T){h.emit("error",new Error("invalid state"));return}const{messageType:S,message:A}=y;this.log(`"${S}" message event for session "${T.sessionId}" message size: ${A.byteLength}`),S==="license-request"||S==="license-renewal"?this.renewLicense(e,A).catch(w=>{h.eventNames().length?h.emit("error",w):this.handleError(w)}):S==="license-release"?e.keySystem===et.FAIRPLAY&&(this.updateKeySession(e,Nc("acknowledged")),this.removeSession(e)):this.warn(`unhandled media key message type "${S}"`)},g=e._onkeystatuseschange=y=>{if(!e.mediaKeysSession){h.emit("error",new Error("invalid state"));return}this.onKeyStatusChange(e);const S=e.keyStatus;h.emit("keyStatus",S),S==="expired"&&(this.warn(`${e.keySystem} expired for key ${c}`),this.renewKeySession(e))};Zt(e.mediaKeysSession,"message",m),Zt(e.mediaKeysSession,"keystatuseschange",g);const E=new Promise((y,T)=>{h.on("error",T),h.on("keyStatus",S=>{S.startsWith("usable")?y():S==="output-restricted"?T(new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_STATUS_OUTPUT_RESTRICTED,fatal:!1},"HDCP level output restricted")):S==="internal-error"?T(new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_STATUS_INTERNAL_ERROR,fatal:!0},`key status changed to "${S}"`)):S==="expired"?T(new Error("key expired while generating request")):this.warn(`unhandled key status change "${S}"`)})});return e.mediaKeysSession.generateRequest(t,n).then(()=>{var y;this.log(`Request generated for key-session "${(y=e.mediaKeysSession)==null?void 0:y.sessionId}" keyId: ${c}`)}).catch(y=>{throw new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_NO_SESSION,error:y,fatal:!1},`Error generating key-session request: ${y}`)}).then(()=>E).catch(y=>{throw h.removeAllListeners(),this.removeSession(e),y}).then(()=>(h.removeAllListeners(),e))}onKeyStatusChange(e){e.mediaKeysSession.keyStatuses.forEach((t,n)=>{if(typeof n=="string"&&typeof t=="object"){const r=n;n=t,t=r}this.log(`key status change "${t}" for keyStatuses keyId: ${Br.hexDump("buffer"in n?new Uint8Array(n.buffer,n.byteOffset,n.byteLength):new Uint8Array(n))} session keyId: ${Br.hexDump(new Uint8Array(e.decryptdata.keyId||[]))} uri: ${e.decryptdata.uri}`),e.keyStatus=t})}fetchServerCertificate(e){const t=this.config,n=t.loader,r=new n(t),a=this.getServerCertificateUrl(e);return a?(this.log(`Fetching server certificate for "${e}"`),new Promise((l,u)=>{const f={responseType:"arraybuffer",url:a},c=t.certLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,E,y,T)=>{l(g.data)},onError:(g,E,y,T)=>{u(new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:Be({url:f.url,data:void 0},g)},`"${e}" certificate request failed (${a}). Status: ${g.code} (${g.text})`))},onTimeout:(g,E,y)=>{u(new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_REQUEST_FAILED,fatal:!0,networkDetails:y,response:{url:f.url,data:void 0}},`"${e}" certificate request timed out (${a})`))},onAbort:(g,E,y)=>{u(new Error("aborted"))}};r.load(f,h,m)})):Promise.resolve()}setMediaKeysServerCertificate(e,t,n){return new Promise((r,a)=>{e.setServerCertificate(n).then(l=>{this.log(`setServerCertificate ${l?"success":"not supported by CDM"} (${n==null?void 0:n.byteLength}) on "${t}"`),r(e)}).catch(l=>{a(new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SERVER_CERTIFICATE_UPDATE_FAILED,error:l,fatal:!0},l.message))})})}renewLicense(e,t){return this.requestLicense(e,new Uint8Array(t)).then(n=>this.updateKeySession(e,new Uint8Array(n)).catch(r=>{throw new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_SESSION_UPDATE_FAILED,error:r,fatal:!0},r.message)}))}unpackPlayReadyKeyMessage(e,t){const n=String.fromCharCode.apply(null,new Uint16Array(t.buffer));if(!n.includes("PlayReadyKeyMessage"))return e.setRequestHeader("Content-Type","text/xml; charset=utf-8"),t;const r=new DOMParser().parseFromString(n,"application/xml"),a=r.querySelectorAll("HttpHeader");if(a.length>0){let h;for(let m=0,g=a.length;m<g;m++){var l,u;h=a[m];const E=(l=h.querySelector("name"))==null?void 0:l.textContent,y=(u=h.querySelector("value"))==null?void 0:u.textContent;E&&y&&e.setRequestHeader(E,y)}}const f=r.querySelector("Challenge"),c=f==null?void 0:f.textContent;if(!c)throw new Error("Cannot find <Challenge> in key message");return Nc(atob(c))}setupLicenseXHR(e,t,n,r){const a=this.config.licenseXhrSetup;return a?Promise.resolve().then(()=>{if(!n.decryptdata)throw new Error("Key removed");return a.call(this.hls,e,t,n,r)}).catch(l=>{if(!n.decryptdata)throw l;return e.open("POST",t,!0),a.call(this.hls,e,t,n,r)}).then(l=>(e.readyState||e.open("POST",t,!0),{xhr:e,licenseChallenge:l||r})):(e.open("POST",t,!0),Promise.resolve({xhr:e,licenseChallenge:r}))}requestLicense(e,t){const n=this.config.keyLoadPolicy.default;return new Promise((r,a)=>{const l=this.getLicenseServerUrlOrThrow(e.keySystem);this.log(`Sending license request to URL: ${l}`);const u=new XMLHttpRequest;u.responseType="arraybuffer",u.onreadystatechange=()=>{if(!this.hls||!e.mediaKeysSession)return a(new Error("invalid state"));if(u.readyState===4)if(u.status===200){this._requestLicenseFailureCount=0;let f=u.response;this.log(`License received ${f instanceof ArrayBuffer?f.byteLength:f}`);const c=this.config.licenseResponseCallback;if(c)try{f=c.call(this.hls,u,l,e)}catch(h){this.error(h)}r(f)}else{const f=n.errorRetry,c=f?f.maxNumRetry:0;if(this._requestLicenseFailureCount++,this._requestLicenseFailureCount>c||u.status>=400&&u.status<500)a(new Qt({type:xe.KEY_SYSTEM_ERROR,details:H.KEY_SYSTEM_LICENSE_REQUEST_FAILED,fatal:!0,networkDetails:u,response:{url:l,data:void 0,code:u.status,text:u.statusText}},`License Request XHR failed (${l}). Status: ${u.status} (${u.statusText})`));else{const h=c-this._requestLicenseFailureCount+1;this.warn(`Retrying license request, ${h} attempts left`),this.requestLicense(e,t).then(r,a)}}},e.licenseXhr&&e.licenseXhr.readyState!==XMLHttpRequest.DONE&&e.licenseXhr.abort(),e.licenseXhr=u,this.setupLicenseXHR(u,l,e,t).then(({xhr:f,licenseChallenge:c})=>{e.keySystem==et.PLAYREADY&&(c=this.unpackPlayReadyKeyMessage(f,c)),f.send(c)})})}onDestroying(){this.unregisterListeners(),this._clear()}onMediaAttached(e,t){if(!this.config.emeEnabled)return;const n=t.media;this.media=n,Zt(n,"waitingforkey",this.onWaitingForKey)}onMediaDetached(){const e=this.media;e&&(mn(e,"waitingforkey",this.onWaitingForKey),this.media=null,this.mediaKeys=null)}_clear(){var e;if(this._requestLicenseFailureCount=0,this.keyIdToKeySessionPromise={},!this.mediaKeys&&!this.mediaKeySessions.length)return;const t=this.media,n=this.mediaKeySessions.slice();this.mediaKeySessions=[],this.mediaKeys=null,Qo.clearKeyUriToKeyIdMap();const r=n.length;Rs.CDMCleanupPromise=Promise.all(n.map(a=>this.removeSession(a)).concat(t==null||(e=t.setMediaKeys(null))==null?void 0:e.catch(a=>{var l;this.log(`Could not clear media keys: ${a}`),(l=this.hls)==null||l.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_MEDIA_KEYS_ERROR,fatal:!1,error:new Error(`Could not clear media keys: ${a}`)})}))).catch(a=>{var l;this.log(`Could not close sessions and clear media keys: ${a}`),(l=this.hls)==null||l.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close sessions and clear media keys: ${a}`)})}).then(()=>{r&&this.log("finished closing key sessions and clearing media keys")})}onManifestLoading(){this.keyFormatPromise=null}onManifestLoaded(e,{sessionKeys:t}){if(!(!t||!this.config.emeEnabled)&&!this.keyFormatPromise){const n=t.reduce((r,a)=>(r.indexOf(a.keyFormat)===-1&&r.push(a.keyFormat),r),[]);this.log(`Selecting key-system from session-keys ${n.join(", ")}`),this.keyFormatPromise=this.getKeyFormatPromise(n)}}removeSession(e){const{mediaKeysSession:t,licenseXhr:n}=e;if(t){this.log(`Remove licenses and keys and close session ${t.sessionId}`),e._onmessage&&(t.removeEventListener("message",e._onmessage),e._onmessage=void 0),e._onkeystatuseschange&&(t.removeEventListener("keystatuseschange",e._onkeystatuseschange),e._onkeystatuseschange=void 0),n&&n.readyState!==XMLHttpRequest.DONE&&n.abort(),e.mediaKeysSession=e.decryptdata=e.licenseXhr=void 0;const r=this.mediaKeySessions.indexOf(e);r>-1&&this.mediaKeySessions.splice(r,1);const{drmSystemOptions:a}=this.config;return(fA(a)?new Promise((u,f)=>{self.setTimeout(()=>f(new Error("MediaKeySession.remove() timeout")),8e3),t.remove().then(u)}):Promise.resolve()).catch(u=>{var f;this.log(`Could not remove session: ${u}`),(f=this.hls)==null||f.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_REMOVE_SESSION_ERROR,fatal:!1,error:new Error(`Could not remove session: ${u}`)})}).then(()=>t.close()).catch(u=>{var f;this.log(`Could not close session: ${u}`),(f=this.hls)==null||f.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.KEY_SYSTEM_DESTROY_CLOSE_SESSION_ERROR,fatal:!1,error:new Error(`Could not close session: ${u}`)})})}}}Rs.CDMCleanupPromise=void 0;class Qt extends Error{constructor(e,t){super(t),this.data=void 0,e.error||(e.error=new Error(t)),this.data=e,e.err=e.error}}class x1{constructor(e){this.hls=void 0,this.isVideoPlaybackQualityAvailable=!1,this.timer=void 0,this.media=null,this.lastTime=void 0,this.lastDroppedFrames=0,this.lastDecodedFrames=0,this.streamController=void 0,this.hls=e,this.registerListeners()}setStreamController(e){this.streamController=e}registerListeners(){this.hls.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.on(L.MEDIA_DETACHING,this.onMediaDetaching,this)}unregisterListeners(){this.hls.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),this.hls.off(L.MEDIA_DETACHING,this.onMediaDetaching,this)}destroy(){this.timer&&clearInterval(this.timer),this.unregisterListeners(),this.isVideoPlaybackQualityAvailable=!1,this.media=null}onMediaAttaching(e,t){const n=this.hls.config;if(n.capLevelOnFPSDrop){const r=t.media instanceof self.HTMLVideoElement?t.media:null;this.media=r,r&&typeof r.getVideoPlaybackQuality=="function"&&(this.isVideoPlaybackQualityAvailable=!0),self.clearInterval(this.timer),this.timer=self.setInterval(this.checkFPSInterval.bind(this),n.fpsDroppedMonitoringPeriod)}}onMediaDetaching(){this.media=null}checkFPS(e,t,n){const r=performance.now();if(t){if(this.lastTime){const a=r-this.lastTime,l=n-this.lastDroppedFrames,u=t-this.lastDecodedFrames,f=1e3*l/a,c=this.hls;if(c.trigger(L.FPS_DROP,{currentDropped:l,currentDecoded:u,totalDroppedFrames:n}),f>0&&l>c.config.fpsDroppedMonitoringThreshold*u){let h=c.currentLevel;c.logger.warn("drop FPS ratio greater than max allowed value for currentLevel: "+h),h>0&&(c.autoLevelCapping===-1||c.autoLevelCapping>=h)&&(h=h-1,c.trigger(L.FPS_DROP_LEVEL_CAPPING,{level:h,droppedLevel:c.currentLevel}),c.autoLevelCapping=h,this.streamController.nextLevelSwitch())}}this.lastTime=r,this.lastDroppedFrames=n,this.lastDecodedFrames=t}}checkFPSInterval(){const e=this.media;if(e)if(this.isVideoPlaybackQualityAvailable){const t=e.getVideoPlaybackQuality();this.checkFPS(e,t.totalVideoFrames,t.droppedVideoFrames)}else this.checkFPS(e,e.webkitDecodedFrameCount,e.webkitDroppedFrameCount)}}function ry(i,e){let t;try{t=new Event("addtrack")}catch{t=document.createEvent("Event"),t.initEvent("addtrack",!1,!1)}t.track=i,e.dispatchEvent(t)}function sy(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues&&!i.cues.getCueById(e.id))try{if(i.addCue(e),!i.cues.getCueById(e.id))throw new Error(`addCue is failed for: ${e}`)}catch(n){Fe.debug(`[texttrack-utils]: ${n}`);try{const r=new self.TextTrackCue(e.startTime,e.endTime,e.text);r.id=e.id,i.addCue(r)}catch(r){Fe.debug(`[texttrack-utils]: Legacy TextTrackCue fallback failed: ${r}`)}}t==="disabled"&&(i.mode=t)}function Ts(i,e){const t=i.mode;if(t==="disabled"&&(i.mode="hidden"),i.cues)for(let n=i.cues.length;n--;)e&&i.cues[n].removeEventListener("enter",e),i.removeCue(i.cues[n]);t==="disabled"&&(i.mode=t)}function Hc(i,e,t,n){const r=i.mode;if(r==="disabled"&&(i.mode="hidden"),i.cues&&i.cues.length>0){const a=T1(i.cues,e,t);for(let l=0;l<a.length;l++)(!n||n(a[l]))&&i.removeCue(a[l])}r==="disabled"&&(i.mode=r)}function S1(i,e){if(e<=i[0].startTime)return 0;const t=i.length-1;if(e>i[t].endTime)return-1;let n=0,r=t,a;for(;n<=r;)if(a=Math.floor((r+n)/2),e<i[a].startTime)r=a-1;else if(e>i[a].startTime&&n<t)n=a+1;else return a;return i[n].startTime-e<e-i[r].startTime?n:r}function T1(i,e,t){const n=[],r=S1(i,e);if(r>-1)for(let a=r,l=i.length;a<l;a++){const u=i[a];if(u.startTime>=e&&u.endTime<=t)n.push(u);else if(u.startTime>t)return n}return n}function Ao(i){const e=[];for(let t=0;t<i.length;t++){const n=i[t];(n.kind==="subtitles"||n.kind==="captions")&&n.label&&e.push(i[t])}return e}class L1 extends Sd{constructor(e){super(e,"subtitle-track-controller"),this.media=null,this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0,this.queuedDefaultTrack=-1,this.useTextTrackPolling=!1,this.subtitlePollingInterval=-1,this._subtitleDisplay=!0,this.asyncPollTrackChange=()=>this.pollTrackChange(0),this.onTextTracksChanged=()=>{if(this.useTextTrackPolling||self.clearInterval(this.subtitlePollingInterval),!this.media||!this.hls.config.renderTextTracksNatively)return;let t=null;const n=Ao(this.media.textTracks);for(let a=0;a<n.length;a++)if(n[a].mode==="hidden")t=n[a];else if(n[a].mode==="showing"){t=n[a];break}const r=this.findTrackForTextTrack(t);this.subtitleTrack!==r&&this.setSubtitleTrack(r)},this.registerListeners()}destroy(){this.unregisterListeners(),this.tracks.length=0,this.tracksInGroup.length=0,this.currentTrack=null,this.onTextTracksChanged=this.asyncPollTrackChange=null,super.destroy()}get subtitleDisplay(){return this._subtitleDisplay}set subtitleDisplay(e){this._subtitleDisplay=e,this.trackId>-1&&this.toggleTrackModes()}registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.ERROR,this.onError,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.LEVEL_SWITCHING,this.onLevelSwitching,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.ERROR,this.onError,this)}onMediaAttached(e,t){this.media=t.media,this.media&&(this.queuedDefaultTrack>-1&&(this.subtitleTrack=this.queuedDefaultTrack,this.queuedDefaultTrack=-1),this.useTextTrackPolling=!(this.media.textTracks&&"onchange"in this.media.textTracks),this.useTextTrackPolling?this.pollTrackChange(500):this.media.textTracks.addEventListener("change",this.asyncPollTrackChange))}pollTrackChange(e){self.clearInterval(this.subtitlePollingInterval),this.subtitlePollingInterval=self.setInterval(this.onTextTracksChanged,e)}onMediaDetaching(e,t){const n=this.media;if(!n)return;const r=!!t.transferMedia;if(self.clearInterval(this.subtitlePollingInterval),this.useTextTrackPolling||n.textTracks.removeEventListener("change",this.asyncPollTrackChange),this.trackId>-1&&(this.queuedDefaultTrack=this.trackId),this.subtitleTrack=-1,this.media=null,r)return;Ao(n.textTracks).forEach(l=>{Ts(l)})}onManifestLoading(){this.tracks=[],this.groupIds=null,this.tracksInGroup=[],this.trackId=-1,this.currentTrack=null,this.selectDefaultTrack=!0}onManifestParsed(e,t){this.tracks=t.subtitleTracks}onSubtitleTrackLoaded(e,t){const{id:n,groupId:r,details:a}=t,l=this.tracksInGroup[n];if(!l||l.groupId!==r){this.warn(`Subtitle track with id:${n} and group:${r} not found in active group ${l==null?void 0:l.groupId}`);return}const u=l.details;l.details=t.details,this.log(`Subtitle track ${n} "${l.name}" lang:${l.lang} group:${r} loaded [${a.startSN}-${a.endSN}]`),n===this.trackId&&this.playlistLoaded(n,t,u)}onLevelLoading(e,t){this.switchLevel(t.level)}onLevelSwitching(e,t){this.switchLevel(t.level)}switchLevel(e){const t=this.hls.levels[e];if(!t)return;const n=t.subtitleGroups||null,r=this.groupIds;let a=this.currentTrack;if(!n||(r==null?void 0:r.length)!==(n==null?void 0:n.length)||n!=null&&n.some(l=>(r==null?void 0:r.indexOf(l))===-1)){this.groupIds=n,this.trackId=-1,this.currentTrack=null;const l=this.tracks.filter(h=>!n||n.indexOf(h.groupId)!==-1);if(l.length)this.selectDefaultTrack&&!l.some(h=>h.default)&&(this.selectDefaultTrack=!1),l.forEach((h,m)=>{h.id=m});else if(!a&&!this.tracksInGroup.length)return;this.tracksInGroup=l;const u=this.hls.config.subtitlePreference;if(!a&&u){this.selectDefaultTrack=!1;const h=In(u,l);if(h>-1)a=l[h];else{const m=In(u,this.tracks);a=this.tracks[m]}}let f=this.findTrackId(a);f===-1&&a&&(f=this.findTrackId(null));const c={subtitleTracks:l};this.log(`Updating subtitle tracks, ${l.length} track(s) found in "${n==null?void 0:n.join(",")}" group-id`),this.hls.trigger(L.SUBTITLE_TRACKS_UPDATED,c),f!==-1&&this.trackId===-1&&this.setSubtitleTrack(f)}}findTrackId(e){const t=this.tracksInGroup,n=this.selectDefaultTrack;for(let r=0;r<t.length;r++){const a=t[r];if(!(n&&!a.default||!n&&!e)&&(!e||jr(a,e)))return r}if(e){for(let r=0;r<t.length;r++){const a=t[r];if(Mi(e.attrs,a.attrs,["LANGUAGE","ASSOC-LANGUAGE","CHARACTERISTICS"]))return r}for(let r=0;r<t.length;r++){const a=t[r];if(Mi(e.attrs,a.attrs,["LANGUAGE"]))return r}}return-1}findTrackForTextTrack(e){if(e){const t=this.tracksInGroup;for(let n=0;n<t.length;n++){const r=t[n];if(Gc(r,e))return n}}return-1}onError(e,t){t.fatal||!t.context||t.context.type===De.SUBTITLE_TRACK&&t.context.id===this.trackId&&(!this.groupIds||this.groupIds.indexOf(t.context.groupId)!==-1)&&this.checkRetry(t)}get allSubtitleTracks(){return this.tracks}get subtitleTracks(){return this.tracksInGroup}get subtitleTrack(){return this.trackId}set subtitleTrack(e){this.selectDefaultTrack=!1,this.setSubtitleTrack(e)}setSubtitleOption(e){if(this.hls.config.subtitlePreference=e,e){if(e.id===-1)return this.setSubtitleTrack(-1),null;const t=this.allSubtitleTracks;if(this.selectDefaultTrack=!1,t.length){const n=this.currentTrack;if(n&&jr(e,n))return n;const r=In(e,this.tracksInGroup);if(r>-1){const a=this.tracksInGroup[r];return this.setSubtitleTrack(r),a}else{if(n)return null;{const a=In(e,t);if(a>-1)return t[a]}}}}return null}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentTrack)&&this.scheduleLoading(this.currentTrack,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=e.id,r=e.groupId,a=this.getUrlWithDirectives(e.url,t),l=e.details,u=l==null?void 0:l.age;this.log(`Loading subtitle ${n} "${e.name}" lang:${e.lang} group:${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${a}`),this.hls.trigger(L.SUBTITLE_TRACK_LOADING,{url:a,id:n,groupId:r,deliveryDirectives:t||null,track:e})}toggleTrackModes(){const{media:e}=this;if(!e)return;const t=Ao(e.textTracks),n=this.currentTrack;let r;if(n&&(r=t.filter(a=>Gc(n,a))[0],r||this.warn(`Unable to find subtitle TextTrack with name "${n.name}" and language "${n.lang}"`)),[].slice.call(t).forEach(a=>{a.mode!=="disabled"&&a!==r&&(a.mode="disabled")}),r){const a=this.subtitleDisplay?"showing":"hidden";r.mode!==a&&(r.mode=a)}}setSubtitleTrack(e){const t=this.tracksInGroup;if(!this.media){this.queuedDefaultTrack=e;return}if(e<-1||e>=t.length||!ce(e)){this.warn(`Invalid subtitle track id: ${e}`);return}this.selectDefaultTrack=!1;const n=this.currentTrack,r=t[e]||null;if(this.trackId=e,this.currentTrack=r,this.toggleTrackModes(),!r){this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:e});return}const a=!!r.details&&!r.details.live;if(e===this.trackId&&r===n&&a)return;this.log(`Switching to subtitle-track ${e}`+(r?` "${r.name}" lang:${r.lang} group:${r.groupId}`:""));const{id:l,groupId:u="",name:f,type:c,url:h}=r;this.hls.trigger(L.SUBTITLE_TRACK_SWITCH,{id:l,groupId:u,name:f,type:c,url:h});const m=this.switchParams(r.url,n==null?void 0:n.details,r.details);this.loadPlaylist(m)}}function A1(){try{return crypto.randomUUID()}catch{try{const e=URL.createObjectURL(new Blob),t=e.toString();return URL.revokeObjectURL(e),t.slice(t.lastIndexOf("/")+1)}catch{let t=new Date().getTime();return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const a=(t+Math.random()*16)%16|0;return t=Math.floor(t/16),(r=="x"?a:a&3|8).toString(16)})}}}function _i(i){let e=5381,t=i.length;for(;t;)e=e*33^i.charCodeAt(--t);return(e>>>0).toString()}const Is=.025;let Bo=function(i){return i[i.Point=0]="Point",i[i.Range=1]="Range",i}({});function R1(i,e,t){return`${i.identifier}-${t+1}-${_i(e)}`}class I1{constructor(e,t){this.base=void 0,this._duration=null,this._timelineStart=null,this.appendInPlaceDisabled=void 0,this.appendInPlaceStarted=void 0,this.dateRange=void 0,this.hasPlayed=!1,this.cumulativeDuration=0,this.resumeOffset=NaN,this.playoutLimit=NaN,this.restrictions={skip:!1,jump:!1},this.snapOptions={out:!1,in:!1},this.assetList=[],this.assetListLoader=void 0,this.assetListResponse=null,this.resumeAnchor=void 0,this.error=void 0,this.resetOnResume=void 0,this.base=t,this.dateRange=e,this.setDateRange(e)}setDateRange(e){this.dateRange=e,this.resumeOffset=e.attr.optionalFloat("X-RESUME-OFFSET",this.resumeOffset),this.playoutLimit=e.attr.optionalFloat("X-PLAYOUT-LIMIT",this.playoutLimit),this.restrictions=e.attr.enumeratedStringList("X-RESTRICT",this.restrictions),this.snapOptions=e.attr.enumeratedStringList("X-SNAP",this.snapOptions)}reset(){var e;this.appendInPlaceStarted=!1,(e=this.assetListLoader)==null||e.destroy(),this.assetListLoader=void 0,this.supplementsPrimary||(this.assetListResponse=null,this.assetList=[],this._duration=null)}isAssetPastPlayoutLimit(e){var t;if(e>0&&e>=this.assetList.length)return!0;const n=this.playoutLimit;return e<=0||isNaN(n)?!1:n===0?!0:(((t=this.assetList[e])==null?void 0:t.startOffset)||0)>n}findAssetIndex(e){return this.assetList.indexOf(e)}get identifier(){return this.dateRange.id}get startDate(){return this.dateRange.startDate}get startTime(){const e=this.dateRange.startTime;if(this.snapOptions.out){const t=this.dateRange.tagAnchor;if(t)return cc(e,t)}return e}get startOffset(){return this.cue.pre?0:this.startTime}get startIsAligned(){if(this.startTime===0||this.snapOptions.out)return!0;const e=this.dateRange.tagAnchor;if(e){const t=this.dateRange.startTime,n=cc(t,e);return t-n<.1}return!1}get resumptionOffset(){const e=this.resumeOffset,t=ce(e)?e:this.duration;return this.cumulativeDuration+t}get resumeTime(){const e=this.startOffset+this.resumptionOffset;if(this.snapOptions.in){const t=this.resumeAnchor;if(t)return cc(e,t)}return e}get appendInPlace(){return this.appendInPlaceStarted?!0:this.appendInPlaceDisabled?!1:!!(!this.cue.once&&!this.cue.pre&&this.startIsAligned&&(isNaN(this.playoutLimit)&&isNaN(this.resumeOffset)||this.resumeOffset&&this.duration&&Math.abs(this.resumeOffset-this.duration)<Is))}set appendInPlace(e){if(this.appendInPlaceStarted){this.resetOnResume=!e;return}this.appendInPlaceDisabled=!e}get timelineStart(){return this._timelineStart!==null?this._timelineStart:this.startTime}set timelineStart(e){this._timelineStart=e}get duration(){const e=this.playoutLimit;let t;return this._duration!==null?t=this._duration:this.dateRange.duration?t=this.dateRange.duration:t=this.dateRange.plannedDuration||0,!isNaN(e)&&e<t&&(t=e),t}set duration(e){this._duration=e}get cue(){return this.dateRange.cue}get timelineOccupancy(){return this.dateRange.attr["X-TIMELINE-OCCUPIES"]==="RANGE"?Bo.Range:Bo.Point}get supplementsPrimary(){return this.dateRange.attr["X-TIMELINE-STYLE"]==="PRIMARY"}get contentMayVary(){return this.dateRange.attr["X-CONTENT-MAY-VARY"]!=="NO"}get assetUrl(){return this.dateRange.attr["X-ASSET-URI"]}get assetListUrl(){return this.dateRange.attr["X-ASSET-LIST"]}get baseUrl(){return this.base.url}get assetListLoaded(){return this.assetList.length>0||this.assetListResponse!==null}toString(){return w1(this)}}function cc(i,e){return i-e.start<e.duration/2&&!(Math.abs(i-(e.start+e.duration))<Is)?e.start:e.start+e.duration}function iy(i,e,t){const n=new self.URL(i,t);return n.protocol!=="data:"&&n.searchParams.set("_HLS_primary_id",e),n}function dc(i,e){for(;(t=i.assetList[++e])!=null&&t.error;)var t;return e}function w1(i){return`["${i.identifier}" ${i.cue.pre?"<pre>":i.cue.post?"<post>":""}${i.timelineStart.toFixed(2)}-${i.resumeTime.toFixed(2)}]`}function Ss(i){const e=i.timelineStart,t=i.duration||0;return`["${i.identifier}" ${e.toFixed(2)}-${(e+t).toFixed(2)}]`}class _1{constructor(e,t,n,r){this.hls=void 0,this.interstitial=void 0,this.assetItem=void 0,this.tracks=null,this.hasDetails=!1,this.mediaAttached=null,this._currentTime=void 0,this._bufferedEosTime=void 0,this.checkPlayout=()=>{this.reachedPlayout(this.currentTime)&&this.hls.trigger(L.PLAYOUT_LIMIT_REACHED,{})};const a=this.hls=new e(t);this.interstitial=n,this.assetItem=r;let l=r.uri;try{l=iy(l,t.primarySessionId).href}catch{}a.loadSource(l);const u=()=>{this.hasDetails=!0};a.once(L.LEVEL_LOADED,u),a.once(L.AUDIO_TRACK_LOADED,u),a.once(L.SUBTITLE_TRACK_LOADED,u),a.on(L.MEDIA_ATTACHING,(f,{media:c})=>{this.removeMediaListeners(),this.mediaAttached=c,this.interstitial.playoutLimit&&(c.addEventListener("timeupdate",this.checkPlayout),this.appendInPlace&&a.on(L.BUFFER_APPENDED,()=>{const m=this.bufferedEnd;this.reachedPlayout(m)&&(this._bufferedEosTime=m,a.trigger(L.BUFFERED_TO_END,void 0))}))})}get appendInPlace(){var e;return((e=this.interstitial)==null?void 0:e.appendInPlace)||!1}bufferedInPlaceToEnd(e){var t;if(!this.appendInPlace)return!1;if((t=this.hls)!=null&&t.bufferedToEnd)return!0;if(!e||!this._bufferedEosTime)return!1;const n=this.timelineOffset,r=Ie.bufferInfo(e,n,0);return this.getAssetTime(r.end)>=this._bufferedEosTime-.02}reachedPlayout(e){const n=this.interstitial.playoutLimit;return this.startOffset+e>=n}get destroyed(){var e;return!((e=this.hls)!=null&&e.userConfig)}get assetId(){return this.assetItem.identifier}get interstitialId(){return this.assetItem.parentIdentifier}get media(){var e;return((e=this.hls)==null?void 0:e.media)||null}get bufferedEnd(){const e=this.media||this.mediaAttached;if(!e)return this._bufferedEosTime?this._bufferedEosTime:this.currentTime;const t=Ie.bufferInfo(e,e.currentTime,.001);return this.getAssetTime(t.end)}get currentTime(){const e=this.media||this.mediaAttached;return e?this.getAssetTime(e.currentTime):this._currentTime||0}get duration(){const e=this.assetItem.duration;return e||0}get remaining(){const e=this.duration;return e?Math.max(0,e-this.currentTime):0}get startOffset(){return this.assetItem.startOffset}get timelineOffset(){var e;return((e=this.hls)==null?void 0:e.config.timelineOffset)||0}set timelineOffset(e){const t=this.timelineOffset;if(e!==t){const n=e-t;if(Math.abs(n)>1/9e4){if(this.hasDetails)throw new Error("Cannot set timelineOffset after playlists are loaded");this.hls.config.timelineOffset=e}}}getAssetTime(e){const t=this.timelineOffset,n=this.duration;return Math.min(Math.max(0,e-t),n)}removeMediaListeners(){const e=this.mediaAttached;e&&(this._currentTime=e.currentTime,this.bufferSnapShot(),e.removeEventListener("timeupdate",this.checkPlayout))}bufferSnapShot(){if(this.mediaAttached){var e;(e=this.hls)!=null&&e.bufferedToEnd&&(this._bufferedEosTime=this.bufferedEnd)}}destroy(){this.removeMediaListeners(),this.hls.destroy(),this.hls=this.interstitial=null,this.tracks=this.mediaAttached=this.checkPlayout=null}attachMedia(e){this.hls.attachMedia(e)}detachMedia(){this.removeMediaListeners(),this.mediaAttached=null,this.hls.detachMedia()}resumeBuffering(){this.hls.resumeBuffering()}pauseBuffering(){this.hls.pauseBuffering()}transferMedia(){return this.bufferSnapShot(),this.hls.transferMedia()}resetDetails(){const e=this.hls;if(this.hasDetails){e.stopLoad();const t=n=>delete n.details;e.levels.forEach(t),e.allAudioTracks.forEach(t),e.allSubtitleTracks.forEach(t),this.hasDetails=!1}}on(e,t,n){this.hls.on(e,t)}once(e,t,n){this.hls.once(e,t)}off(e,t,n){this.hls.off(e,t)}toString(){var e;return`HlsAssetPlayer: ${Ss(this.assetItem)} ${(e=this.hls)==null?void 0:e.sessionId} ${this.appendInPlace?"append-in-place":""}`}}const Kp=.033;class b1 extends gn{constructor(e,t){super("interstitials-sched",t),this.onScheduleUpdate=void 0,this.eventMap={},this.events=null,this.items=null,this.durations={primary:0,playout:0,integrated:0},this.onScheduleUpdate=e}destroy(){this.reset(),this.onScheduleUpdate=null}reset(){this.eventMap={},this.setDurations(0,0,0),this.events&&this.events.forEach(e=>e.reset()),this.events=this.items=null}resetErrorsInRange(e,t){return this.events?this.events.reduce((n,r)=>e<=r.startOffset&&t>r.startOffset?(delete r.error,n+1):n,0):0}get duration(){const e=this.items;return e?e[e.length-1].end:0}get length(){return this.items?this.items.length:0}getEvent(e){return e&&this.eventMap[e]||null}hasEvent(e){return e in this.eventMap}findItemIndex(e,t){if(e.event)return this.findEventIndex(e.event.identifier);let n=-1;e.nextEvent?n=this.findEventIndex(e.nextEvent.identifier)-1:e.previousEvent&&(n=this.findEventIndex(e.previousEvent.identifier)+1);const r=this.items;if(r)for(r[n]||(t===void 0&&(t=e.start),n=this.findItemIndexAtTime(t));n>=0&&(a=r[n])!=null&&a.event;){var a;n--}return n}findItemIndexAtTime(e,t){const n=this.items;if(n)for(let r=0;r<n.length;r++){let a=n[r];if(t&&t!=="primary"&&(a=a[t]),e===a.start||e>a.start&&e<a.end)return r}return-1}findJumpRestrictedIndex(e,t){const n=this.items;if(n)for(let r=e;r<=t&&n[r];r++){const a=n[r].event;if(a!=null&&a.restrictions.jump&&!a.appendInPlace)return r}return-1}findEventIndex(e){const t=this.items;if(t)for(let r=t.length;r--;){var n;if(((n=t[r].event)==null?void 0:n.identifier)===e)return r}return-1}findAssetIndex(e,t){const n=e.assetList,r=n.length;if(r>1)for(let a=0;a<r;a++){const l=n[a];if(!l.error){const u=l.timelineStart;if(t===u||t>u&&t<u+(l.duration||0))return a}}return 0}get assetIdAtEnd(){var e,t;const n=(e=this.items)==null||(t=e[this.length-1])==null?void 0:t.event;if(n){const r=n.assetList,a=r[r.length-1];if(a)return a.identifier}return null}parseInterstitialDateRanges(e,t){const n=e.main.details,{dateRanges:r}=n,a=this.events,l=this.parseDateRanges(r,{url:n.url},t),u=Object.keys(r),f=a?a.filter(c=>!u.includes(c.identifier)):[];l.length&&l.sort((c,h)=>{const m=c.cue.pre,g=c.cue.post,E=h.cue.pre,y=h.cue.post;if(m&&!E)return-1;if(E&&!m||g&&!y)return 1;if(y&&!g)return-1;if(!m&&!E&&!g&&!y){const T=c.startTime,S=h.startTime;if(T!==S)return T-S}return c.dateRange.tagOrder-h.dateRange.tagOrder}),this.events=l,f.forEach(c=>{this.removeEvent(c)}),this.updateSchedule(e,f)}updateSchedule(e,t=[]){const n=this.events||[];if(n.length||t.length||this.length<2){const r=this.items,a=this.parseSchedule(n,e);(t.length||(r==null?void 0:r.length)!==a.length||a.some((u,f)=>Math.abs(u.playout.start-r[f].playout.start)>.005||Math.abs(u.playout.end-r[f].playout.end)>.005))&&(this.items=a,this.onScheduleUpdate(t,r))}}parseDateRanges(e,t,n){const r=[],a=Object.keys(e);for(let l=0;l<a.length;l++){const u=a[l],f=e[u];if(f.isInterstitial){let c=this.eventMap[u];c?c.setDateRange(f):(c=new I1(f,t),this.eventMap[u]=c,n===!1&&(c.appendInPlace=n)),r.push(c)}}return r}parseSchedule(e,t){const n=[],r=t.main.details,a=r.live?1/0:r.edge;let l=0;if(e=e.filter(f=>!f.error&&!(f.cue.once&&f.hasPlayed)),e.length){this.resolveOffsets(e,t);let f=0,c=0;if(e.forEach((h,m)=>{const g=h.cue.pre,E=h.cue.post,y=e[m-1]||null,T=h.appendInPlace,S=E?a:h.startOffset,A=h.duration,w=h.timelineOccupancy===Bo.Range?A:0,I=h.resumptionOffset,b=(y==null?void 0:y.startTime)===S,P=S+h.cumulativeDuration;let G=T?P+A:S+I;if(g||!E&&S<=0){const M=c;c+=w,h.timelineStart=P;const B=l;l+=A,n.push({event:h,start:P,end:G,playout:{start:B,end:l},integrated:{start:M,end:c}})}else if(S<=a){if(!b){const O=S-f;if(O>Kp){const X=f,re=c;c+=O;const de=l;l+=O;const ae={previousEvent:e[m-1]||null,nextEvent:h,start:X,end:X+O,playout:{start:de,end:l},integrated:{start:re,end:c}};n.push(ae)}else O>0&&y&&(y.cumulativeDuration+=O,n[n.length-1].end=S)}E&&(G=P),h.timelineStart=P;const M=c;c+=w;const B=l;l+=A,n.push({event:h,start:P,end:G,playout:{start:B,end:l},integrated:{start:M,end:c}})}else return;const D=h.resumeTime;E||D>a?f=a:f=D}),f<a){var u;const h=f,m=c,g=a-f;c+=g;const E=l;l+=g,n.push({previousEvent:((u=n[n.length-1])==null?void 0:u.event)||null,nextEvent:null,start:f,end:h+g,playout:{start:E,end:l},integrated:{start:m,end:c}})}this.setDurations(a,l,c)}else n.push({previousEvent:null,nextEvent:null,start:0,end:a,playout:{start:0,end:a},integrated:{start:0,end:a}}),this.setDurations(a,a,a);return n}setDurations(e,t,n){this.durations={primary:e,playout:t,integrated:n}}resolveOffsets(e,t){const n=t.main.details,r=n.live?1/0:n.edge;let a=0,l=-1;e.forEach((u,f)=>{const c=u.cue.pre,h=u.cue.post,m=c?0:h?r:u.startTime;this.updateAssetDurations(u),l===m?u.cumulativeDuration=a:(a=0,l=m),!h&&u.snapOptions.in&&(u.resumeAnchor=Hr(null,n.fragments,u.startOffset+u.resumptionOffset,0,0)||void 0),u.appendInPlace&&!u.appendInPlaceStarted&&(this.primaryCanResumeInPlaceAt(u,t)||(u.appendInPlace=!1)),!u.appendInPlace&&f+1<e.length&&e[f+1].startTime-e[f].resumeTime<Kp&&(e[f+1].appendInPlace=!1,e[f+1].appendInPlace&&this.warn(`Could not change append strategy for abutting event ${u}`));const E=ce(u.resumeOffset)?u.resumeOffset:u.duration;a+=E})}primaryCanResumeInPlaceAt(e,t){const n=e.resumeTime,r=e.startTime+e.resumptionOffset;return Math.abs(n-r)>Is?(this.log(`"${e.identifier}" resumption ${n} not aligned with estimated timeline end ${r}`),!1):t?!Object.keys(t).some(l=>{const u=t[l].details,f=u.edge;if(n>=f)return this.log(`"${e.identifier}" resumption ${n} past ${l} playlist end ${f}`),!1;const c=Hr(null,u.fragments,n);if(!c)return this.log(`"${e.identifier}" resumption ${n} does not align with any fragments in ${l} playlist (${u.fragStart}-${u.fragmentEnd})`),!0;const h=l==="audio"?.175:0;return Math.abs(c.start-n)<Is+h||Math.abs(c.end-n)<Is+h?!1:(this.log(`"${e.identifier}" resumption ${n} not aligned with ${l} fragment bounds (${c.start}-${c.end} sn: ${c.sn} cc: ${c.cc})`),!0)}):(this.log(`"${e.identifier}" resumption ${n} can not be aligned with media (none selected)`),!1)}updateAssetDurations(e){if(!e.assetListLoaded)return;const t=e.timelineStart;let n=0,r=!1,a=!1;e.assetList.forEach((l,u)=>{const f=t+n;l.startOffset=n,l.timelineStart=f,r||(r=l.duration===null),a||(a=!!l.error);const c=l.error?0:l.duration||0;n+=c}),r&&!a?e.duration=Math.max(n,e.duration):e.duration=n}removeEvent(e){e.reset(),delete this.eventMap[e.identifier]}}function gr(i){return`[${i.event?'"'+i.event.identifier+'"':"primary"}: ${i.start.toFixed(2)}-${i.end.toFixed(2)}]`}class C1{constructor(e){this.hls=void 0,this.hls=e}destroy(){this.hls=null}loadAssetList(e,t){const n=e.assetListUrl;let r;try{r=iy(n,this.hls.sessionId,e.baseUrl)}catch(g){const E=this.assignAssetListError(e,H.ASSET_LIST_LOAD_ERROR,g,n);this.hls.trigger(L.ERROR,E);return}t&&r.protocol!=="data:"&&r.searchParams.set("_HLS_start_offset",""+t);const a=this.hls.config,l=a.loader,u=new l(a),f={responseType:"json",url:r.href},c=a.interstitialAssetListLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,E,y,T)=>{const S=g.data,A=S==null?void 0:S.ASSETS;if(!Array.isArray(A)){const w=this.assignAssetListError(e,H.ASSET_LIST_PARSING_ERROR,new Error("Invalid interstitial asset list"),y.url,E,T);this.hls.trigger(L.ERROR,w);return}e.assetListResponse=S,this.hls.trigger(L.ASSET_LIST_LOADED,{event:e,assetListResponse:S,networkDetails:T})},onError:(g,E,y,T)=>{const S=this.assignAssetListError(e,H.ASSET_LIST_LOAD_ERROR,new Error(`Error loading X-ASSET-LIST: HTTP status ${g.code} ${g.text} (${E.url})`),E.url,T,y);this.hls.trigger(L.ERROR,S)},onTimeout:(g,E,y)=>{const T=this.assignAssetListError(e,H.ASSET_LIST_LOAD_TIMEOUT,new Error(`Timeout loading X-ASSET-LIST (${E.url})`),E.url,g,y);this.hls.trigger(L.ERROR,T)}};return u.load(f,h,m),this.hls.trigger(L.ASSET_LIST_LOADING,{event:e}),u}assignAssetListError(e,t,n,r,a,l){return e.error=n,{type:xe.NETWORK_ERROR,details:t,fatal:!1,interstitial:e,url:r,error:n,networkDetails:l,stats:a}}}function zp(i){i==null||i.play().catch(()=>{})}class k1 extends gn{constructor(e,t){super("interstitials",e.logger),this.HlsPlayerClass=void 0,this.hls=void 0,this.assetListLoader=void 0,this.mediaSelection=null,this.altSelection=null,this.media=null,this.detachedData=null,this.requiredTracks=null,this.manager=null,this.playerQueue=[],this.bufferedPos=-1,this.timelinePos=-1,this.schedule=void 0,this.playingItem=null,this.bufferingItem=null,this.waitingItem=null,this.endedItem=null,this.playingAsset=null,this.endedAsset=null,this.bufferingAsset=null,this.shouldPlay=!1,this.onPlay=()=>{this.shouldPlay=!0},this.onPause=()=>{this.shouldPlay=!1},this.onSeeking=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;const r=n-this.timelinePos;if(Math.abs(r)<1/7056e5)return;const l=r<=-.01;this.timelinePos=n,this.bufferedPos=n;const u=this.playingItem;if(!u){this.checkBuffer();return}if(l&&this.schedule.resetErrorsInRange(n,n-r)&&this.updateSchedule(),this.checkBuffer(),l&&n<u.start||n>=u.end){var f;const g=this.schedule.findItemIndexAtTime(this.timelinePos);if(!this.isInterstitial(u)&&(f=this.media)!=null&&f.paused&&(this.shouldPlay=!1),!l){const E=this.findItemIndex(u);if(g>E){const y=this.schedule.findJumpRestrictedIndex(E+1,g);if(y>E){this.setSchedulePosition(y);return}}}this.setSchedulePosition(g);return}const c=this.playingAsset;if(!c){if(this.playingLastItem&&this.isInterstitial(u)){const g=u.event.assetList[0];g&&(this.endedItem=this.playingItem,this.playingItem=null,this.setScheduleToAssetAtTime(n,g))}return}const h=c.timelineStart,m=c.duration||0;(l&&n<h||n>=h+m)&&this.setScheduleToAssetAtTime(n,c)},this.onTimeupdate=()=>{const n=this.currentTime;if(n===void 0||this.playbackDisabled)return;if(n>this.timelinePos)this.timelinePos=n,n>this.bufferedPos&&this.checkBuffer();else return;const r=this.playingItem;if(!r||this.playingLastItem)return;if(n>=r.end){this.timelinePos=r.end;const u=this.findItemIndex(r);this.setSchedulePosition(u+1)}const a=this.playingAsset;if(!a)return;const l=a.timelineStart+(a.duration||0);n>=l&&this.setScheduleToAssetAtTime(n,a)},this.onScheduleUpdate=(n,r)=>{const a=this.schedule,l=this.playingItem,u=a.events||[],f=a.items||[],c=a.durations,h=n.map(y=>y.identifier),m=!!(u.length||h.length);(m||r)&&this.log(`INTERSTITIALS_UPDATED (${u.length}): ${u}
Schedule: ${f.map(y=>gr(y))} pos: ${this.timelinePos}`),h.length&&this.log(`Removed events ${h}`),this.playerQueue.forEach(y=>{if(y.interstitial.appendInPlace){const T=y.assetItem.timelineStart,S=y.timelineOffset-T;if(S)try{y.timelineOffset=T}catch(A){Math.abs(S)>Is&&this.warn(`${A} ("${y.assetId}" ${y.timelineOffset}->${T})`)}}});let g=null;if(l){const y=this.updateItem(l,this.timelinePos);this.itemsMatch(l,y)&&(this.playingItem=y,this.waitingItem=this.endedItem=null,g=()=>this.trimInPlace(y,l))}else this.waitingItem=this.updateItem(this.waitingItem),this.endedItem=this.updateItem(this.endedItem);const E=this.bufferingItem;if(E){const y=this.updateItem(E,this.bufferedPos);this.itemsMatch(E,y)?(this.bufferingItem=y,g||(g=()=>this.trimInPlace(y,E))):E.event&&(this.bufferingItem=this.playingItem,this.clearInterstitial(E.event,null))}if(n.forEach(y=>{y.assetList.forEach(T=>{this.clearAssetPlayer(T.identifier,null)})}),m||r){if(this.hls.trigger(L.INTERSTITIALS_UPDATED,{events:u.slice(0),schedule:f.slice(0),durations:c,removedIds:h}),this.isInterstitial(l)&&h.includes(l.event.identifier)){this.warn(`Interstitial "${l.event.identifier}" removed while playing`),this.primaryFallback(l.event);return}g&&g(),this.checkBuffer()}},this.hls=e,this.HlsPlayerClass=t,this.assetListLoader=new C1(e),this.schedule=new b1(this.onScheduleUpdate,e.logger),this.registerListeners()}registerListeners(){const e=this.hls;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.on(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.on(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.on(L.MEDIA_ENDED,this.onMediaEnded,this),e.on(L.ERROR,this.onError,this),e.on(L.DESTROYING,this.onDestroying,this)}unregisterListeners(){const e=this.hls;e&&(e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_UPDATED,this.onAudioTrackUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_UPDATED,this.onSubtitleTrackUpdated,this),e.off(L.EVENT_CUE_ENTER,this.onInterstitialCueEnter,this),e.off(L.ASSET_LIST_LOADED,this.onAssetListLoaded,this),e.off(L.BUFFER_CODECS,this.onBufferCodecs,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.BUFFERED_TO_END,this.onBufferedToEnd,this),e.off(L.MEDIA_ENDED,this.onMediaEnded,this),e.off(L.ERROR,this.onError,this),e.off(L.DESTROYING,this.onDestroying,this))}startLoad(){this.resumeBuffering()}stopLoad(){this.pauseBuffering()}resumeBuffering(){var e;(e=this.getBufferingPlayer())==null||e.resumeBuffering()}pauseBuffering(){var e;(e=this.getBufferingPlayer())==null||e.pauseBuffering()}destroy(){this.unregisterListeners(),this.stopLoad(),this.assetListLoader&&this.assetListLoader.destroy(),this.emptyPlayerQueue(),this.clearScheduleState(),this.schedule&&this.schedule.destroy(),this.media=this.detachedData=this.mediaSelection=this.requiredTracks=this.altSelection=this.manager=null,this.hls=this.HlsPlayerClass=this.schedule=this.log=null,this.assetListLoader=null,this.onPlay=this.onPause=this.onSeeking=this.onTimeupdate=null,this.onScheduleUpdate=null}onDestroying(){const e=this.primaryMedia||this.media;e&&this.removeMediaListeners(e)}removeMediaListeners(e){mn(e,"play",this.onPlay),mn(e,"pause",this.onPause),mn(e,"seeking",this.onSeeking),mn(e,"timeupdate",this.onTimeupdate)}onMediaAttaching(e,t){const n=this.media=t.media;Zt(n,"seeking",this.onSeeking),Zt(n,"timeupdate",this.onTimeupdate),Zt(n,"play",this.onPlay),Zt(n,"pause",this.onPause)}onMediaAttached(e,t){const n=this.effectivePlayingItem,r=this.detachedData;if(this.detachedData=null,n===null)this.checkStart();else if(!r){this.clearScheduleState();const a=this.findItemIndex(n);this.setSchedulePosition(a)}}clearScheduleState(){this.playingItem=this.bufferingItem=this.waitingItem=this.endedItem=this.playingAsset=this.endedAsset=this.bufferingAsset=null}onMediaDetaching(e,t){const n=!!t.transferMedia,r=this.media;if(this.media=null,!n&&(r&&this.removeMediaListeners(r),this.detachedData)){const a=this.getBufferingPlayer();a&&(this.playingAsset=this.endedAsset=this.bufferingAsset=this.bufferingItem=this.waitingItem=this.detachedData=null,a.detachMedia()),this.shouldPlay=!1}}get interstitialsManager(){if(!this.manager){if(!this.hls)return null;const e=this,t=()=>e.bufferingItem||e.waitingItem,n=m=>m&&e.getAssetPlayer(m.identifier),r=(m,g,E,y,T)=>{if(m){let S=m[g].start;const A=m.event;if(A){if(g==="playout"||A.timelineOccupancy!==Bo.Point){const w=n(E);(w==null?void 0:w.interstitial)===A&&(S+=w.assetItem.startOffset+w[T])}}else{const w=y==="bufferedPos"?l():e[y];S+=w-m.start}return S}return 0},a=(m,g)=>{if(m!==0&&g!=="primary"&&e.schedule.length){var E;const y=e.schedule.findItemIndexAtTime(m),T=(E=e.schedule.items)==null?void 0:E[y];if(T){const S=T[g].start-T.start;return m+S}}return m},l=()=>{const m=e.bufferedPos;return m===Number.MAX_VALUE?u("primary"):Math.max(m,0)},u=m=>{var g;return(g=e.primaryDetails)!=null&&g.live?e.primaryDetails.edge:e.schedule.durations[m]},f=(m,g)=>{var E,y;const T=e.effectivePlayingItem;if(T!=null&&(E=T.event)!=null&&E.restrictions.skip)return;e.log(`seek to ${m} "${g}"`);const S=e.effectivePlayingItem,A=e.schedule.findItemIndexAtTime(m,g),w=(y=e.schedule.items)==null?void 0:y[A],I=e.getBufferingPlayer(),b=I==null?void 0:I.interstitial,P=b==null?void 0:b.appendInPlace,G=S&&e.itemsMatch(S,w);if(S&&(P||G)){const M=n(e.playingAsset),B=(M==null?void 0:M.media)||e.primaryMedia;if(B){const O=g==="primary"?B.currentTime:r(S,g,e.playingAsset,"timelinePos","currentTime"),X=m-O,re=(P?O:B.currentTime)+X;if(re>=0&&(!M||P||re<=M.duration)){B.currentTime=re;return}}}if(w){let M=m;if(g!=="primary"){const O=w[g].start,X=m-O;M=w.start+X}const B=!e.isInterstitial(w);if((!e.isInterstitial(S)||S.event.appendInPlace)&&(B||w.event.appendInPlace)){const O=e.media||(P?I==null?void 0:I.media:null);O&&(O.currentTime=M)}else if(S){const O=e.findItemIndex(S);if(A>O){const re=e.schedule.findJumpRestrictedIndex(O+1,A);if(re>O){e.setSchedulePosition(re);return}}let X=0;if(B)e.timelinePos=M,e.checkBuffer();else{var D;const re=w==null||(D=w.event)==null?void 0:D.assetList;if(re){const de=m-(w[g]||w).start;for(let ae=re.length;ae--;){const oe=re[ae];if(oe.duration&&de>=oe.startOffset&&de<oe.startOffset+oe.duration){X=ae;break}}}}e.setSchedulePosition(A,X)}}},c=()=>{const m=e.effectivePlayingItem;if(e.isInterstitial(m))return m;const g=t();return e.isInterstitial(g)?g:null},h={get currentTime(){const m=c(),g=e.effectivePlayingItem;return g&&g===m?r(g,"playout",e.effectivePlayingAsset,"timelinePos","currentTime")-g.playout.start:0},set currentTime(m){const g=c(),E=e.effectivePlayingItem;E&&E===g&&f(m+E.playout.start,"playout")},get duration(){const m=c();return m?m.playout.end-m.playout.start:0},get assetPlayers(){var m;const g=(m=c())==null?void 0:m.event.assetList;return g?g.map(E=>e.getAssetPlayer(E.identifier)):[]},get playingIndex(){var m;const g=(m=c())==null?void 0:m.event;return g&&e.effectivePlayingAsset?g.findAssetIndex(e.effectivePlayingAsset):-1},get scheduleItem(){return c()}};this.manager={get events(){var m,g;return((m=e.schedule)==null||(g=m.events)==null?void 0:g.slice(0))||[]},get schedule(){var m,g;return((m=e.schedule)==null||(g=m.items)==null?void 0:g.slice(0))||[]},get interstitialPlayer(){return c()?h:null},get playerQueue(){return e.playerQueue.slice(0)},get bufferingAsset(){return e.bufferingAsset},get bufferingItem(){return t()},get bufferingIndex(){const m=t();return e.findItemIndex(m)},get playingAsset(){return e.effectivePlayingAsset},get playingItem(){return e.effectivePlayingItem},get playingIndex(){const m=e.effectivePlayingItem;return e.findItemIndex(m)},primary:{get bufferedEnd(){return l()},get currentTime(){const m=e.timelinePos;return m>0?m:0},set currentTime(m){f(m,"primary")},get duration(){return u("primary")},get seekableStart(){var m;return((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0}},integrated:{get bufferedEnd(){return r(t(),"integrated",e.bufferingAsset,"bufferedPos","bufferedEnd")},get currentTime(){return r(e.effectivePlayingItem,"integrated",e.effectivePlayingAsset,"timelinePos","currentTime")},set currentTime(m){f(m,"integrated")},get duration(){return u("integrated")},get seekableStart(){var m;return a(((m=e.primaryDetails)==null?void 0:m.fragmentStart)||0,"integrated")}},skip:()=>{const m=e.effectivePlayingItem,g=m==null?void 0:m.event;if(g&&!g.restrictions.skip){const E=e.findItemIndex(m);if(g.appendInPlace){const y=m.playout.start+m.event.duration;f(y+.001,"playout")}else e.advanceAfterAssetEnded(g,E,1/0)}}}}return this.manager}get effectivePlayingItem(){return this.waitingItem||this.playingItem||this.endedItem}get effectivePlayingAsset(){return this.playingAsset||this.endedAsset}get playingLastItem(){var e;const t=this.playingItem,n=(e=this.schedule)==null?void 0:e.items;return!this.playbackStarted||!t||!n?!1:this.findItemIndex(t)===n.length-1}get playbackStarted(){return this.effectivePlayingItem!==null}get currentTime(){var e,t,n;if(this.mediaSelection===null)return;const r=this.waitingItem||this.playingItem;if(this.isInterstitial(r)&&!r.event.appendInPlace)return;let a=this.media;!a&&(e=this.bufferingItem)!=null&&(t=e.event)!=null&&t.appendInPlace&&(a=this.primaryMedia);const l=(n=a)==null?void 0:n.currentTime;if(!(l===void 0||!ce(l)))return l}get primaryMedia(){var e;return this.media||((e=this.detachedData)==null?void 0:e.media)||null}isInterstitial(e){return!!(e!=null&&e.event)}retreiveMediaSource(e,t){const n=this.getAssetPlayer(e);n&&this.transferMediaFromPlayer(n,t)}transferMediaFromPlayer(e,t){const n=e.interstitial.appendInPlace,r=e.media;if(n&&r===this.primaryMedia){if(this.bufferingAsset=null,(!t||this.isInterstitial(t)&&!t.event.appendInPlace)&&t&&r){this.detachedData={media:r};return}const a=e.transferMedia();this.log(`transfer MediaSource from ${e} ${Ke(a)}`),this.detachedData=a}else t&&r&&(this.shouldPlay||(this.shouldPlay=!r.paused))}transferMediaTo(e,t){var n,r;if(e.media===t)return;let a=null;const l=this.hls,u=e!==l,f=u&&e.interstitial.appendInPlace,c=(n=this.detachedData)==null?void 0:n.mediaSource;let h;if(l.media)f&&(a=l.transferMedia(),this.detachedData=a),h="Primary";else if(c){const E=this.getBufferingPlayer();E?(a=E.transferMedia(),h=`${E}`):h="detached MediaSource"}else h="detached media";if(!a){if(c)a=this.detachedData,this.log(`using detachedData: MediaSource ${Ke(a)}`);else if(!this.detachedData||l.media===t){const E=this.playerQueue;E.length>1&&E.forEach(y=>{if(u&&y.interstitial.appendInPlace!==f){const T=y.interstitial;this.clearInterstitial(y.interstitial,null),T.appendInPlace=!1,T.appendInPlace&&this.warn(`Could not change append strategy for queued assets ${T}`)}}),this.hls.detachMedia(),this.detachedData={media:t}}}const m=a&&"mediaSource"in a&&((r=a.mediaSource)==null?void 0:r.readyState)!=="closed",g=m&&a?a:t;if(this.log(`${m?"transfering MediaSource":"attaching media"} to ${u?e:"Primary"} from ${h}`),g===a){const E=u&&e.assetId===this.schedule.assetIdAtEnd;g.overrides={duration:this.schedule.duration,endOfStream:!u||E,cueRemoval:!u}}e.attachMedia(g)}onInterstitialCueEnter(){this.onTimeupdate()}checkStart(){const e=this.schedule,t=e.events;if(!t||this.playbackDisabled||!this.media)return;this.bufferedPos===-1&&(this.bufferedPos=0);const n=this.timelinePos,r=this.effectivePlayingItem;if(n===-1){const a=this.hls.startPosition;if(this.timelinePos=a,t.length&&t[0].cue.pre){const l=e.findEventIndex(t[0].identifier);this.setSchedulePosition(l)}else if(a>=0||!this.primaryLive){const l=this.timelinePos=a>0?a:0,u=e.findItemIndexAtTime(l);this.setSchedulePosition(u)}}else if(r&&!this.playingItem){const a=e.findItemIndex(r);this.setSchedulePosition(a)}}advanceAfterAssetEnded(e,t,n){const r=dc(e,n);if(!e.isAssetPastPlayoutLimit(r))this.setSchedulePosition(t,r);else{const a=this.schedule.items;if(a){const l=t+1,u=a.length;if(l>=u){this.setSchedulePosition(-1);return}const f=e.resumeTime;this.timelinePos<f&&(this.timelinePos=f,this.checkBuffer()),this.setSchedulePosition(l)}}}setScheduleToAssetAtTime(e,t){const n=this.schedule,r=t.parentIdentifier,a=n.getEvent(r);if(a){const l=n.findEventIndex(r),u=n.findAssetIndex(a,e);this.advanceAfterAssetEnded(a,l,u-1)}}setSchedulePosition(e,t){const n=this.schedule.items;if(!n||this.playbackDisabled)return;this.log(`setSchedulePosition ${e}, ${t}`);const r=e>=0?n[e]:null,a=this.playingItem,l=this.playingLastItem;if(this.isInterstitial(a)){var u;const c=a.event,h=this.playingAsset,m=h==null?void 0:h.identifier,g=m?this.getAssetPlayer(m):null;if(g&&m&&(!this.eventItemsMatch(a,r)||t!==void 0&&m!==((u=c.assetList)==null?void 0:u[t].identifier))){var f;const E=c.findAssetIndex(h);if(this.log(`INTERSTITIAL_ASSET_ENDED ${E+1}/${c.assetList.length} ${Ss(h)}`),this.endedAsset=h,this.playingAsset=null,this.hls.trigger(L.INTERSTITIAL_ASSET_ENDED,{asset:h,assetListIndex:E,event:c,schedule:n.slice(0),scheduleIndex:e,player:g}),a!==this.playingItem){this.itemsMatch(a,this.playingItem)&&!this.playingAsset&&this.advanceAfterAssetEnded(c,this.findItemIndex(this.playingItem),E);return}this.retreiveMediaSource(m,r),g.media&&!((f=this.detachedData)!=null&&f.mediaSource)&&g.detachMedia()}if(!this.eventItemsMatch(a,r)&&(this.endedItem=a,this.playingItem=null,this.log(`INTERSTITIAL_ENDED ${c} ${gr(a)}`),c.hasPlayed=!0,this.hls.trigger(L.INTERSTITIAL_ENDED,{event:c,schedule:n.slice(0),scheduleIndex:e}),c.cue.once)){this.updateSchedule();const E=this.schedule.items;if(r&&E){const y=this.findItemIndex(r);this.advanceSchedule(y,E,t,a,l)}return}}this.advanceSchedule(e,n,t,a,l)}advanceSchedule(e,t,n,r,a){const l=e>=0?t[e]:null,u=this.primaryMedia,f=this.playerQueue;if(f.length&&f.forEach(c=>{const h=c.interstitial,m=this.schedule.findEventIndex(h.identifier);(m<e||m>e+1)&&this.clearInterstitial(h,l)}),this.isInterstitial(l)){this.timelinePos=Math.min(Math.max(this.timelinePos,l.start),l.end);const c=l.event;if(n===void 0){n=this.schedule.findAssetIndex(c,this.timelinePos);const E=dc(c,n-1);if(c.isAssetPastPlayoutLimit(E)){this.advanceAfterAssetEnded(c,e,n);return}n=E}const h=this.waitingItem;this.assetsBuffered(l,u)||this.setBufferingItem(l);let m=this.preloadAssets(c,n);if(this.eventItemsMatch(l,h||r)||(this.waitingItem=l,this.log(`INTERSTITIAL_STARTED ${gr(l)} ${c.appendInPlace?"append in place":""}`),this.hls.trigger(L.INTERSTITIAL_STARTED,{event:c,schedule:t.slice(0),scheduleIndex:e})),!c.assetListLoaded){this.log(`Waiting for ASSET-LIST to complete loading ${c}`);return}if(c.assetListLoader&&(c.assetListLoader.destroy(),c.assetListLoader=void 0),!u){this.log(`Waiting for attachMedia to start Interstitial ${c}`);return}this.waitingItem=this.endedItem=null,this.playingItem=l;const g=c.assetList[n];if(!g){const E=t[e+1],y=this.media;E&&y&&!this.isInterstitial(E)&&y.currentTime<E.start&&(y.currentTime=this.timelinePos=E.start),this.advanceAfterAssetEnded(c,e,n||0);return}if(m||(m=this.getAssetPlayer(g.identifier)),m===null||m.destroyed){const E=c.assetList.length;this.warn(`asset ${n+1}/${E} player destroyed ${c}`),m=this.createAssetPlayer(c,g,n)}if(!this.eventItemsMatch(l,this.bufferingItem)&&c.appendInPlace&&this.isAssetBuffered(g))return;this.startAssetPlayer(m,n,t,e,u),this.shouldPlay&&zp(m.media)}else l!==null?(this.resumePrimary(l,e,r),this.shouldPlay&&zp(this.hls.media)):a&&this.isInterstitial(r)&&(this.endedItem=null,this.playingItem=r,r.event.appendInPlace||this.attachPrimary(this.schedule.durations.primary,null))}get playbackDisabled(){return this.hls.config.enableInterstitialPlayback===!1}get primaryDetails(){var e,t;return(e=this.mediaSelection)==null||(t=e.main)==null?void 0:t.details}get primaryLive(){var e;return!!((e=this.primaryDetails)!=null&&e.live)}resumePrimary(e,t,n){var r;if(this.playingItem=e,this.playingAsset=this.endedAsset=null,this.waitingItem=this.endedItem=null,this.bufferedToItem(e),this.log(`resuming ${gr(e)}`),!((r=this.detachedData)!=null&&r.mediaSource)){let l=this.timelinePos;(l<e.start||l>=e.end)&&(l=this.getPrimaryResumption(e,t),this.timelinePos=l),this.attachPrimary(l,e)}if(!n)return;const a=this.schedule.items;a&&(this.log(`INTERSTITIALS_PRIMARY_RESUMED ${gr(e)}`),this.hls.trigger(L.INTERSTITIALS_PRIMARY_RESUMED,{schedule:a.slice(0),scheduleIndex:t}),this.checkBuffer())}getPrimaryResumption(e,t){const n=e.start;if(this.primaryLive){const r=this.primaryDetails;if(t===0)return this.hls.startPosition;if(r&&(n<r.fragmentStart||n>r.edge))return this.hls.liveSyncPosition||-1}return n}isAssetBuffered(e){const t=this.getAssetPlayer(e.identifier);return t!=null&&t.hls?t.hls.bufferedToEnd:Ie.bufferInfo(this.primaryMedia,this.timelinePos,0).end+1>=e.timelineStart+(e.duration||0)}attachPrimary(e,t,n){t?this.setBufferingItem(t):this.bufferingItem=this.playingItem,this.bufferingAsset=null;const r=this.primaryMedia;if(!r)return;const a=this.hls;a.media?this.checkBuffer():(this.transferMediaTo(a,r),n&&this.startLoadingPrimaryAt(e,n)),n||(this.timelinePos=e,this.startLoadingPrimaryAt(e,n))}startLoadingPrimaryAt(e,t){var n;const r=this.hls;!r.loadingEnabled||!r.media||Math.abs((((n=r.mainForwardBufferInfo)==null?void 0:n.start)||r.media.currentTime)-e)>.5?r.startLoad(e,t):r.bufferingEnabled||r.resumeBuffering()}onManifestLoading(){this.stopLoad(),this.schedule.reset(),this.emptyPlayerQueue(),this.clearScheduleState(),this.shouldPlay=!1,this.bufferedPos=this.timelinePos=-1,this.mediaSelection=this.altSelection=this.manager=this.requiredTracks=null,this.hls.off(L.BUFFER_CODECS,this.onBufferCodecs,this),this.hls.on(L.BUFFER_CODECS,this.onBufferCodecs,this)}onLevelUpdated(e,t){if(t.level===-1)return;const n=this.hls.levels[t.level],r=Be(Be({},this.mediaSelection||this.altSelection),{},{main:n});this.mediaSelection=r,this.schedule.parseInterstitialDateRanges(r,this.hls.config.interstitialAppendInPlace),!this.effectivePlayingItem&&this.schedule.items&&this.checkStart()}onAudioTrackUpdated(e,t){const n=this.hls.audioTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Be(Be({},this.altSelection),{},{audio:n});return}const a=Be(Be({},r),{},{audio:n});this.mediaSelection=a}onSubtitleTrackUpdated(e,t){const n=this.hls.subtitleTracks[t.id],r=this.mediaSelection;if(!r){this.altSelection=Be(Be({},this.altSelection),{},{subtitles:n});return}const a=Be(Be({},r),{},{subtitles:n});this.mediaSelection=a}onAudioTrackSwitching(e,t){const n=rp(t);this.playerQueue.forEach(r=>r.hls.setAudioOption(t)||r.hls.setAudioOption(n))}onSubtitleTrackSwitch(e,t){const n=rp(t);this.playerQueue.forEach(r=>r.hls.setSubtitleOption(t)||t.id!==-1&&r.hls.setSubtitleOption(n))}onBufferCodecs(e,t){const n=t.tracks;n&&(this.requiredTracks=n)}onBufferAppended(e,t){this.checkBuffer()}onBufferFlushed(e,t){const n=this.playingItem;if(n&&!this.itemsMatch(n,this.bufferingItem)&&!this.isInterstitial(n)){const r=this.timelinePos;this.bufferedPos=r,this.checkBuffer()}}onBufferedToEnd(e){const t=this.schedule.events;if(this.bufferedPos<Number.MAX_VALUE&&t){for(let r=0;r<t.length;r++){const a=t[r];if(a.cue.post){var n;const l=this.schedule.findEventIndex(a.identifier),u=(n=this.schedule.items)==null?void 0:n[l];this.isInterstitial(u)&&this.eventItemsMatch(u,this.bufferingItem)&&this.bufferedToItem(u,0);break}}this.bufferedPos=Number.MAX_VALUE}}onMediaEnded(e){const t=this.playingItem;if(!this.playingLastItem&&t){const n=this.findItemIndex(t);this.setSchedulePosition(n+1)}else this.shouldPlay=!1}updateItem(e,t){const n=this.schedule.items;if(e&&n){const r=this.findItemIndex(e,t);return n[r]||null}return null}trimInPlace(e,t){if(this.isInterstitial(e)&&e.event.appendInPlace&&t.end-e.end>.25){e.event.assetList.forEach((a,l)=>{e.event.isAssetPastPlayoutLimit(l)&&this.clearAssetPlayer(a.identifier,null)});const n=e.end+.25,r=Ie.bufferInfo(this.primaryMedia,n,0);(r.end>n||(r.nextStart||0)>n)&&(this.attachPrimary(n,null),this.flushFrontBuffer(n))}}itemsMatch(e,t){return!!t&&(e===t||e.event&&t.event&&this.eventItemsMatch(e,t)||!e.event&&!t.event&&this.findItemIndex(e)===this.findItemIndex(t))}eventItemsMatch(e,t){var n;return!!t&&(e===t||e.event.identifier===((n=t.event)==null?void 0:n.identifier))}findItemIndex(e,t){return e?this.schedule.findItemIndex(e,t):-1}updateSchedule(){const e=this.mediaSelection;e&&this.schedule.updateSchedule(e,[])}checkBuffer(e){const t=this.schedule.items;if(!t)return;const n=Ie.bufferInfo(this.primaryMedia,this.timelinePos,0);e&&(this.bufferedPos=this.timelinePos),e||(e=n.len<1),this.updateBufferedPos(n.end,t,e)}updateBufferedPos(e,t,n){const r=this.schedule,a=this.bufferingItem;if(this.bufferedPos>e)return;if(t.length===1&&this.itemsMatch(t[0],a)){this.bufferedPos=e;return}const l=this.playingItem,u=this.findItemIndex(l);let f=r.findItemIndexAtTime(e);if(this.bufferedPos<e){var c,h;const m=this.findItemIndex(a),g=Math.min(m+1,t.length-1),E=t[g];if((f===-1&&a&&e>=a.end||(c=E.event)!=null&&c.appendInPlace&&e+.01>=E.start)&&(f=g),g-u>1&&(a==null||(h=a.event)==null?void 0:h.appendInPlace)===!1)return;if(this.bufferedPos=e,f>m&&f>u)this.bufferedToItem(E);else{const y=this.primaryDetails;this.primaryLive&&y&&e>y.edge-y.targetduration&&E.start<y.edge+this.hls.config.interstitialLiveLookAhead&&this.isInterstitial(E)&&this.preloadAssets(E.event,0)}}else n&&l&&!this.itemsMatch(l,a)&&(f===u?this.bufferedToItem(l):f===u+1&&this.bufferedToItem(t[f]))}assetsBuffered(e,t){return e.event.assetList.length===0?!1:!e.event.assetList.some(r=>{const a=this.getAssetPlayer(r.identifier);return!(a!=null&&a.bufferedInPlaceToEnd(t))})}setBufferingItem(e){const t=this.bufferingItem,n=this.schedule;if(this.itemsMatch(e,t))this.bufferingItem!==e&&(this.bufferingItem=e);else{const{items:r,events:a}=n;if(!r||!a)return t;const l=this.isInterstitial(e),u=this.getBufferingPlayer();this.bufferingItem=e,this.bufferedPos=Math.max(e.start,Math.min(e.end,this.timelinePos));const f=u?u.remaining:t?t.end-this.timelinePos:0;this.log(`INTERSTITIALS_BUFFERED_TO_BOUNDARY ${gr(e)}`+(t?` (${f.toFixed(2)} remaining)`:"")),this.playbackDisabled||(l?e.event.assetList.forEach(c=>{const h=this.getAssetPlayer(c.identifier);h&&h.resumeBuffering()}):(this.hls.resumeBuffering(),this.playerQueue.forEach(c=>c.pauseBuffering()))),this.hls.trigger(L.INTERSTITIALS_BUFFERED_TO_BOUNDARY,{events:a.slice(0),schedule:r.slice(0),bufferingIndex:this.findItemIndex(e),playingIndex:this.findItemIndex(this.playingItem)})}return t}bufferedToItem(e,t=0){const n=this.setBufferingItem(e);if(!this.playbackDisabled){if(this.isInterstitial(e))this.bufferedToEvent(e,t);else if(n!==null){this.bufferingAsset=null;const r=this.detachedData;r?r.mediaSource?this.attachPrimary(e.start,e,!0):this.preloadPrimary(e):this.preloadPrimary(e)}}}preloadPrimary(e){const t=this.findItemIndex(e),n=this.getPrimaryResumption(e,t);this.startLoadingPrimaryAt(n)}bufferedToEvent(e,t){const n=e.event,r=n.assetList.length===0&&!n.assetListLoader,a=n.cue.once;if(r||!a){const l=this.preloadAssets(n,t);if(l!=null&&l.interstitial.appendInPlace){const u=n.assetList[t],f=this.primaryMedia;u&&f&&this.bufferAssetPlayer(l,f)}}}preloadAssets(e,t){const n=e.assetUrl,r=e.assetList.length,a=r===0&&!e.assetListLoader,l=e.cue.once;if(a){const f=e.timelineStart;if(e.appendInPlace){var u;const g=this.playingItem;!this.isInterstitial(g)&&(g==null||(u=g.nextEvent)==null?void 0:u.identifier)===e.identifier&&this.flushFrontBuffer(f+.25)}let c,h=0;if(!this.playingItem&&this.primaryLive&&(h=this.hls.startPosition,h===-1&&(h=this.hls.liveSyncPosition||0)),h&&!(e.cue.pre||e.cue.post)){const g=h-f;g>0&&(c=Math.round(g*1e3)/1e3)}if(this.log(`Load interstitial asset ${t+1}/${n?1:r} ${e}${c?` live-start: ${h} start-offset: ${c}`:""}`),n)return this.createAsset(e,0,0,f,e.duration,n);const m=this.assetListLoader.loadAssetList(e,c);m&&(e.assetListLoader=m)}else if(!l&&r){for(let f=t;f<r;f++){const c=e.assetList[f],h=this.getAssetPlayerQueueIndex(c.identifier);(h===-1||this.playerQueue[h].destroyed)&&!c.error&&this.createAssetPlayer(e,c,f)}return this.getAssetPlayer(e.assetList[t].identifier)}return null}flushFrontBuffer(e){const t=this.requiredTracks;if(!t)return;this.log(`Removing front buffer starting at ${e}`),Object.keys(t).forEach(r=>{this.hls.trigger(L.BUFFER_FLUSHING,{startOffset:e,endOffset:1/0,type:r})})}getAssetPlayerQueueIndex(e){const t=this.playerQueue;for(let n=0;n<t.length;n++)if(e===t[n].assetId)return n;return-1}getAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);return this.playerQueue[t]||null}getBufferingPlayer(){const{playerQueue:e,primaryMedia:t}=this;if(t){for(let n=0;n<e.length;n++)if(e[n].media===t)return e[n]}return null}createAsset(e,t,n,r,a,l){const u={parentIdentifier:e.identifier,identifier:R1(e,l,t),duration:a,startOffset:n,timelineStart:r,uri:l};return this.createAssetPlayer(e,u,t)}createAssetPlayer(e,t,n){const r=this.hls,a=r.userConfig;let l=a.videoPreference;const u=r.loadLevelObj||r.levels[r.currentLevel];(l||u)&&(l=Ue({},l),u.videoCodec&&(l.videoCodec=u.videoCodec),u.videoRange&&(l.allowedVideoRanges=[u.videoRange]));const f=r.audioTracks[r.audioTrack],c=r.subtitleTracks[r.subtitleTrack];let h=0;if(this.primaryLive||e.appendInPlace){const I=this.timelinePos-t.timelineStart;if(I>1){const b=t.duration;b&&I<b&&(h=I)}}const m=t.identifier,g=Be(Be({},a),{},{autoStartLoad:!0,startFragPrefetch:!0,primarySessionId:r.sessionId,assetPlayerId:m,abrEwmaDefaultEstimate:r.bandwidthEstimate,interstitialsController:void 0,startPosition:h,liveDurationInfinity:!1,testBandwidth:!1,videoPreference:l,audioPreference:f||a.audioPreference,subtitlePreference:c||a.subtitlePreference});e.appendInPlace&&(e.appendInPlaceStarted=!0,t.timelineStart&&(g.timelineOffset=t.timelineStart));const E=g.cmcd;E!=null&&E.sessionId&&E.contentId&&(g.cmcd=Ue({},E,{contentId:_i(t.uri)})),this.getAssetPlayer(m)&&this.warn(`Duplicate date range identifier ${e} and asset ${m}`);const y=new _1(this.HlsPlayerClass,g,e,t);this.playerQueue.push(y),e.assetList[n]=t;const T=I=>{if(I.live){const G=new Error(`Interstitials MUST be VOD assets ${e}`),D={fatal:!0,type:xe.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:G};this.handleAssetItemError(D,e,this.schedule.findEventIndex(e.identifier),n,G.message);return}const b=I.edge-I.fragmentStart,P=t.duration;(P===null||b>P)&&(this.log(`Interstitial asset "${m}" duration change ${P} > ${b}`),t.duration=b,this.updateSchedule())};y.on(L.LEVEL_UPDATED,(I,{details:b})=>T(b)),y.on(L.LEVEL_PTS_UPDATED,(I,{details:b})=>T(b));const S=(I,b)=>{const P=this.getAssetPlayer(m);if(P&&b.tracks){P.off(L.BUFFER_CODECS,S),P.tracks=b.tracks;const G=this.primaryMedia;this.bufferingAsset===P.assetItem&&G&&!P.media&&this.bufferAssetPlayer(P,G)}};y.on(L.BUFFER_CODECS,S);const A=()=>{var I;const b=this.getAssetPlayer(m);if(this.log(`buffered to end of asset ${b}`),!b)return;const P=this.schedule.findEventIndex(e.identifier),G=(I=this.schedule.items)==null?void 0:I[P];if(this.isInterstitial(G)){const M=e.findAssetIndex(t),B=dc(e,M);if(!e.isAssetPastPlayoutLimit(B))this.bufferedToItem(G,B);else{var D;const O=(D=this.schedule.items)==null?void 0:D[P+1];O&&this.bufferedToItem(O)}}};y.on(L.BUFFERED_TO_END,A);const w=I=>()=>{if(!this.getAssetPlayer(m))return;this.shouldPlay=!0;const P=this.schedule.findEventIndex(e.identifier);this.advanceAfterAssetEnded(e,P,I)};return y.once(L.MEDIA_ENDED,w(n)),y.once(L.PLAYOUT_LIMIT_REACHED,w(1/0)),y.on(L.ERROR,(I,b)=>{const P=this.getAssetPlayer(m);if(b.details===H.BUFFER_STALLED_ERROR){if(P!=null&&P.media){const G=P.currentTime,D=P.duration-G;G&&e.appendInPlace&&D/P.media.playbackRate<.5?(this.log(`Advancing buffer past end of asset ${m} ${e} at ${P.media.currentTime}`),A()):(this.warn(`Stalled at ${G} of ${G+D} in asset ${m} ${e}`),this.onTimeupdate(),this.checkBuffer(!0))}return}this.handleAssetItemError(b,e,this.schedule.findEventIndex(e.identifier),n,`Asset player error ${b.error} ${e}`)}),y.on(L.DESTROYING,()=>{if(!this.getAssetPlayer(m))return;const b=new Error(`Asset player destroyed unexpectedly ${m}`),P={fatal:!0,type:xe.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:b};this.handleAssetItemError(P,e,this.schedule.findEventIndex(e.identifier),n,b.message)}),this.log(`INTERSTITIAL_ASSET_PLAYER_CREATED ${Ss(t)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_PLAYER_CREATED,{asset:t,assetListIndex:n,event:e,player:y}),y}clearInterstitial(e,t){e.assetList.forEach(n=>{this.clearAssetPlayer(n.identifier,t)}),e.reset()}resetAssetPlayer(e){const t=this.getAssetPlayerQueueIndex(e);if(t!==-1){this.log(`reset asset player "${e}" after error`);const n=this.playerQueue[t];this.transferMediaFromPlayer(n,null),n.resetDetails()}}clearAssetPlayer(e,t){const n=this.getAssetPlayerQueueIndex(e);if(n!==-1){this.log(`clear asset player "${e}" toSegment: ${t&&gr(t)}`);const r=this.playerQueue[n];this.transferMediaFromPlayer(r,t),this.playerQueue.splice(n,1),r.destroy()}}emptyPlayerQueue(){let e;for(;e=this.playerQueue.pop();)e.destroy();this.playerQueue=[]}startAssetPlayer(e,t,n,r,a){const{interstitial:l,assetItem:u,assetId:f}=e,c=l.assetList.length,h=this.playingAsset;this.endedAsset=null,this.playingAsset=u,(!h||h.identifier!==f)&&(h&&(this.clearAssetPlayer(h.identifier,n[r]),delete h.error),this.log(`INTERSTITIAL_ASSET_STARTED ${t+1}/${c} ${Ss(u)}`),this.hls.trigger(L.INTERSTITIAL_ASSET_STARTED,{asset:u,assetListIndex:t,event:l,schedule:n.slice(0),scheduleIndex:r,player:e})),this.bufferAssetPlayer(e,a)}bufferAssetPlayer(e,t){var n,r;const{interstitial:a,assetItem:l}=e,u=this.schedule.findEventIndex(a.identifier),f=(n=this.schedule.items)==null?void 0:n[u];if(!f)return;this.setBufferingItem(f),this.bufferingAsset=l;const c=this.getBufferingPlayer();if(c===e)return;const h=a.appendInPlace;if(h&&(c==null?void 0:c.interstitial.appendInPlace)===!1)return;const m=(c==null?void 0:c.tracks)||((r=this.detachedData)==null?void 0:r.tracks)||this.requiredTracks;if(h&&l!==this.playingAsset){if(!e.tracks)return;if(m&&!Jg(m,e.tracks)){const g=new Error(`Asset ${Ss(l)} SourceBuffer tracks ('${Object.keys(e.tracks)}') are not compatible with primary content tracks ('${Object.keys(m)}')`),E={fatal:!0,type:xe.OTHER_ERROR,details:H.INTERSTITIAL_ASSET_ITEM_ERROR,error:g},y=a.findAssetIndex(l);this.handleAssetItemError(E,a,u,y,g.message);return}}this.transferMediaTo(e,t)}handleAssetItemError(e,t,n,r,a){if(e.details===H.BUFFER_STALLED_ERROR)return;const l=t.assetList[r];this.warn(`INTERSTITIAL_ASSET_ERROR ${l&&Ss(l)} ${e.error}`);const u=l==null?void 0:l.identifier,f=this.getAssetPlayerQueueIndex(u),c=this.playerQueue[f]||null,h=this.schedule.items,m=Ue({},e,{fatal:!1,errorAction:Pi(!0),asset:l,assetListIndex:r,event:t,schedule:h,scheduleIndex:n,player:c});if(this.hls.trigger(L.INTERSTITIAL_ASSET_ERROR,m),!e.fatal)return;const g=this.playingAsset,E=new Error(a);if(l&&(this.clearAssetPlayer(u,null),l.error=E),!t.assetList.some(y=>!y.error))t.error=E;else{for(let y=r;y<t.assetList.length;y++)this.resetAssetPlayer(t.assetList[y].identifier);this.updateSchedule()}t.error?this.primaryFallback(t):g&&g.identifier===u&&this.advanceAfterAssetEnded(t,n,r)}primaryFallback(e){const t=e.timelineStart,n=this.effectivePlayingItem;if(this.updateSchedule(),n){this.log(`Fallback to primary from event "${e.identifier}" start: ${t} pos: ${this.timelinePos} playing: ${n?gr(n):"<none>"} error: ${e.error}`);let r=this.timelinePos;r===-1&&(r=this.hls.startPosition);const a=this.updateItem(n,r);this.itemsMatch(n,a)&&this.clearInterstitial(e,null),e.appendInPlace&&(this.attachPrimary(t,null),this.flushFrontBuffer(t));const l=this.schedule.findItemIndexAtTime(r);this.setSchedulePosition(l)}else this.checkStart()}onAssetListLoaded(e,t){var n;const r=t.event,a=r.identifier,l=t.assetListResponse.ASSETS;if(!this.schedule.hasEvent(a))return;const u=r.timelineStart,f=r.duration;let c=0;l.forEach((y,T)=>{const S=parseFloat(y.DURATION);this.createAsset(r,T,c,u+c,S,y.URI),c+=S}),r.duration=c,this.log(`Loaded asset-list with duration: ${c} (was: ${f}) ${r}`);const h=this.waitingItem,m=(h==null?void 0:h.event.identifier)===a;this.updateSchedule();const g=(n=this.bufferingItem)==null?void 0:n.event;if(m){var E;const y=this.schedule.findEventIndex(a),T=(E=this.schedule.items)==null?void 0:E[y];if(T){if(!this.playingItem&&this.timelinePos>T.end&&this.schedule.findItemIndexAtTime(this.timelinePos)!==y){r.error=new Error(`Interstitial no longer within playback range ${this.timelinePos} ${r}`),this.primaryFallback(r);return}this.setBufferingItem(T)}this.setSchedulePosition(y)}else if((g==null?void 0:g.identifier)===a&&g.appendInPlace){const y=r.assetList[0],T=this.getAssetPlayer(y.identifier),S=this.primaryMedia;y&&T&&S&&this.bufferAssetPlayer(T,S)}}onError(e,t){switch(t.details){case H.ASSET_LIST_PARSING_ERROR:case H.ASSET_LIST_LOAD_ERROR:case H.ASSET_LIST_LOAD_TIMEOUT:{const n=t.interstitial;n&&this.primaryFallback(n);break}case H.BUFFER_STALLED_ERROR:{this.onTimeupdate(),this.checkBuffer(!0);break}}}}const Wp=500;class D1 extends hd{constructor(e,t,n){super(e,t,n,"subtitle-stream-controller",pe.SUBTITLE),this.currentTrackId=-1,this.tracksBuffered=[],this.mainDetails=null,this.registerListeners()}onHandlerDestroying(){this.unregisterListeners(),super.onHandlerDestroying(),this.mainDetails=null}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.on(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.on(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.SUBTITLE_TRACK_SWITCH,this.onSubtitleTrackSwitch,this),e.off(L.SUBTITLE_TRACK_LOADED,this.onSubtitleTrackLoaded,this),e.off(L.SUBTITLE_FRAG_PROCESSED,this.onSubtitleFragProcessed,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}startLoad(e,t){this.stopLoad(),this.state=Q.IDLE,this.setInterval(Wp),this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}onManifestLoading(){super.onManifestLoading(),this.mainDetails=null}onMediaDetaching(e,t){this.tracksBuffered=[],super.onMediaDetaching(e,t)}onLevelLoaded(e,t){this.mainDetails=t.details}onSubtitleFragProcessed(e,t){const{frag:n,success:r}=t;if(this.fragContextChanged(n)||(st(n)&&(this.fragPrevious=n),this.state=Q.IDLE),!r)return;const a=this.tracksBuffered[this.currentTrackId];if(!a)return;let l;const u=n.start;for(let c=0;c<a.length;c++)if(u>=a[c].start&&u<=a[c].end){l=a[c];break}const f=n.start+n.duration;l?l.end=f:(l={start:u,end:f},a.push(l)),this.fragmentTracker.fragBuffered(n),this.fragBufferedComplete(n,null),this.media&&this.tick()}onBufferFlushing(e,t){const{startOffset:n,endOffset:r}=t;if(n===0&&r!==Number.POSITIVE_INFINITY){const a=r-1;if(a<=0)return;t.endOffsetSubtitles=Math.max(0,a),this.tracksBuffered.forEach(l=>{for(let u=0;u<l.length;){if(l[u].end<=a){l.shift();continue}else if(l[u].start<a)l[u].start=a;else break;u++}}),this.fragmentTracker.removeFragmentsInRange(n,a,pe.SUBTITLE)}}onError(e,t){const n=t.frag;(n==null?void 0:n.type)===pe.SUBTITLE&&(t.details===H.FRAG_GAP&&this.fragmentTracker.fragBuffered(n,!0),this.fragCurrent&&this.fragCurrent.abortRequests(),this.state!==Q.STOPPED&&(this.state=Q.IDLE))}onSubtitleTracksUpdated(e,{subtitleTracks:t}){if(this.levels&&q0(this.levels,t)){this.levels=t.map(n=>new Di(n));return}this.tracksBuffered=[],this.levels=t.map(n=>{const r=new Di(n);return this.tracksBuffered[r.id]=[],r}),this.fragmentTracker.removeFragmentsInRange(0,Number.POSITIVE_INFINITY,pe.SUBTITLE),this.fragPrevious=null,this.mediaBuffer=null}onSubtitleTrackSwitch(e,t){var n;if(this.currentTrackId=t.id,!((n=this.levels)!=null&&n.length)||this.currentTrackId===-1){this.clearInterval();return}const r=this.levels[this.currentTrackId];r!=null&&r.details?this.mediaBuffer=this.mediaBufferTimeRanges:this.mediaBuffer=null,r&&this.state!==Q.STOPPED&&this.setInterval(Wp)}onSubtitleTrackLoaded(e,t){var n;const{currentTrackId:r,levels:a}=this,{details:l,id:u}=t;if(!a){this.warn(`Subtitle tracks were reset while loading level ${u}`);return}const f=a[u];if(u>=a.length||!f)return;this.log(`Subtitle track ${u} loaded [${l.startSN},${l.endSN}]${l.lastPartSn?`[part-${l.lastPartSn}-${l.lastPartIndex}]`:""},duration:${l.totalduration}`),this.mediaBuffer=this.mediaBufferTimeRanges;let c=0;if(l.live||(n=f.details)!=null&&n.live){if(l.deltaUpdateFailed)return;const m=this.mainDetails;if(!m){this.startFragRequested=!1;return}const g=m.fragments[0];if(!f.details)l.hasProgramDateTime&&m.hasProgramDateTime?(Mo(l,m),c=l.fragmentStart):g&&(c=g.start,Uc(l,c));else{var h;c=this.alignPlaylists(l,f.details,(h=this.levelLastLoaded)==null?void 0:h.details),c===0&&g&&(c=g.start,Uc(l,c))}m&&!this.startFragRequested&&this.setStartPosition(m,c)}f.details=l,this.levelLastLoaded=f,u===r&&(this.hls.trigger(L.SUBTITLE_TRACK_UPDATED,{details:l,id:u,groupId:t.groupId}),this.tick(),l.live&&!this.fragCurrent&&this.media&&this.state===Q.IDLE&&(Hr(null,l.fragments,this.media.currentTime,0)||(this.warn("Subtitle playlist not aligned with playback"),f.details=void 0)))}_handleFragmentLoadComplete(e){const{frag:t,payload:n}=e,r=t.decryptdata,a=this.hls;if(!this.fragContextChanged(t)&&n&&n.byteLength>0&&r!=null&&r.key&&r.iv&&As(r.method)){const l=performance.now();this.decrypter.decrypt(new Uint8Array(n),r.key.buffer,r.iv.buffer,fd(r.method)).catch(u=>{throw a.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.FRAG_DECRYPT_ERROR,fatal:!1,error:u,reason:u.message,frag:t}),u}).then(u=>{const f=performance.now();a.trigger(L.FRAG_DECRYPTED,{frag:t,payload:u,stats:{tstart:l,tdecrypt:f}})}).catch(u=>{this.warn(`${u.name}: ${u.message}`),this.state=Q.IDLE})}}doTick(){if(!this.media){this.state=Q.IDLE;return}if(this.state===Q.IDLE){const{currentTrackId:e,levels:t}=this,n=t==null?void 0:t[e];if(!n||!t.length||!n.details||this.waitForLive(n))return;const{config:r}=this,a=this.getLoadPosition(),l=Ie.bufferedInfo(this.tracksBuffered[this.currentTrackId]||[],a,r.maxBufferHole),{end:u,len:f}=l,c=n.details,h=this.hls.maxBufferLength+c.levelTargetDuration;if(f>h)return;const m=c.fragments,g=m.length,E=c.edge;let y=null;const T=this.fragPrevious;if(u<E){const w=r.maxFragLookUpTolerance,I=u>E-w?0:w;y=Hr(T,m,Math.max(m[0].start,u),I),!y&&T&&T.start<m[0].start&&(y=m[0])}else y=m[g-1];if(y=this.filterReplacedPrimary(y,n.details),!y)return;const S=y.sn-c.startSN,A=m[S-1];if(A&&A.cc===y.cc&&this.fragmentTracker.getState(A)===ot.NOT_LOADED&&(y=A),this.fragmentTracker.getState(y)===ot.NOT_LOADED){const w=this.mapToInitFragWhenRequired(y);w&&this.loadFragment(w,n,u)}}}loadFragment(e,t,n){st(e)?super.loadFragment(e,t,n):this._loadInitSegment(e,t)}get mediaBufferTimeRanges(){return new P1(this.tracksBuffered[this.currentTrackId]||[])}}class P1{constructor(e){this.buffered=void 0;const t=(n,r,a)=>{if(r=r>>>0,r>a-1)throw new DOMException(`Failed to execute '${n}' on 'TimeRanges': The index provided (${r}) is greater than the maximum bound (${a})`);return e[r][n]};this.buffered={get length(){return e.length},end(n){return t("end",n,e.length)},start(n){return t("start",n,e.length)}}}}const O1={42:225,92:233,94:237,95:243,96:250,123:231,124:247,125:209,126:241,127:9608,128:174,129:176,130:189,131:191,132:8482,133:162,134:163,135:9834,136:224,137:32,138:232,139:226,140:234,141:238,142:244,143:251,144:193,145:201,146:211,147:218,148:220,149:252,150:8216,151:161,152:42,153:8217,154:9473,155:169,156:8480,157:8226,158:8220,159:8221,160:192,161:194,162:199,163:200,164:202,165:203,166:235,167:206,168:207,169:239,170:212,171:217,172:249,173:219,174:171,175:187,176:195,177:227,178:205,179:204,180:236,181:210,182:242,183:213,184:245,185:123,186:125,187:92,188:94,189:95,190:124,191:8764,192:196,193:228,194:214,195:246,196:223,197:165,198:164,199:9475,200:197,201:229,202:216,203:248,204:9487,205:9491,206:9495,207:9499},ay=i=>String.fromCharCode(O1[i]||i),fn=15,$n=100,N1={17:1,18:3,21:5,22:7,23:9,16:11,19:12,20:14},F1={17:2,18:4,21:6,22:8,23:10,19:13,20:15},M1={25:1,26:3,29:5,30:7,31:9,24:11,27:12,28:14},U1={25:2,26:4,29:6,30:8,31:10,27:13,28:15},B1=["white","green","blue","cyan","red","yellow","magenta","black","transparent"];class $1{constructor(){this.time=null,this.verboseLevel=0}log(e,t){if(this.verboseLevel>=e){const n=typeof t=="function"?t():t;Fe.log(`${this.time} [${e}] ${n}`)}}}const Mr=function(e){const t=[];for(let n=0;n<e.length;n++)t.push(e[n].toString(16));return t};class oy{constructor(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}reset(){this.foreground="white",this.underline=!1,this.italics=!1,this.background="black",this.flash=!1}setStyles(e){const t=["foreground","underline","italics","background","flash"];for(let n=0;n<t.length;n++){const r=t[n];e.hasOwnProperty(r)&&(this[r]=e[r])}}isDefault(){return this.foreground==="white"&&!this.underline&&!this.italics&&this.background==="black"&&!this.flash}equals(e){return this.foreground===e.foreground&&this.underline===e.underline&&this.italics===e.italics&&this.background===e.background&&this.flash===e.flash}copy(e){this.foreground=e.foreground,this.underline=e.underline,this.italics=e.italics,this.background=e.background,this.flash=e.flash}toString(){return"color="+this.foreground+", underline="+this.underline+", italics="+this.italics+", background="+this.background+", flash="+this.flash}}class G1{constructor(){this.uchar=" ",this.penState=new oy}reset(){this.uchar=" ",this.penState.reset()}setChar(e,t){this.uchar=e,this.penState.copy(t)}setPenState(e){this.penState.copy(e)}equals(e){return this.uchar===e.uchar&&this.penState.equals(e.penState)}copy(e){this.uchar=e.uchar,this.penState.copy(e.penState)}isEmpty(){return this.uchar===" "&&this.penState.isDefault()}}class j1{constructor(e){this.chars=[],this.pos=0,this.currPenState=new oy,this.cueStartTime=null,this.logger=void 0;for(let t=0;t<$n;t++)this.chars.push(new G1);this.logger=e}equals(e){for(let t=0;t<$n;t++)if(!this.chars[t].equals(e.chars[t]))return!1;return!0}copy(e){for(let t=0;t<$n;t++)this.chars[t].copy(e.chars[t])}isEmpty(){let e=!0;for(let t=0;t<$n;t++)if(!this.chars[t].isEmpty()){e=!1;break}return e}setCursor(e){this.pos!==e&&(this.pos=e),this.pos<0?(this.logger.log(3,"Negative cursor position "+this.pos),this.pos=0):this.pos>$n&&(this.logger.log(3,"Too large cursor position "+this.pos),this.pos=$n)}moveCursor(e){const t=this.pos+e;if(e>1)for(let n=this.pos+1;n<t+1;n++)this.chars[n].setPenState(this.currPenState);this.setCursor(t)}backSpace(){this.moveCursor(-1),this.chars[this.pos].setChar(" ",this.currPenState)}insertChar(e){e>=144&&this.backSpace();const t=ay(e);if(this.pos>=$n){this.logger.log(0,()=>"Cannot insert "+e.toString(16)+" ("+t+") at position "+this.pos+". Skipping it!");return}this.chars[this.pos].setChar(t,this.currPenState),this.moveCursor(1)}clearFromPos(e){let t;for(t=e;t<$n;t++)this.chars[t].reset()}clear(){this.clearFromPos(0),this.pos=0,this.currPenState.reset()}clearToEndOfRow(){this.clearFromPos(this.pos)}getTextString(){const e=[];let t=!0;for(let n=0;n<$n;n++){const r=this.chars[n].uchar;r!==" "&&(t=!1),e.push(r)}return t?"":e.join("")}setPenStyles(e){this.currPenState.setStyles(e),this.chars[this.pos].setPenState(this.currPenState)}}class fc{constructor(e){this.rows=[],this.currRow=fn-1,this.nrRollUpRows=null,this.lastOutputScreen=null,this.logger=void 0;for(let t=0;t<fn;t++)this.rows.push(new j1(e));this.logger=e}reset(){for(let e=0;e<fn;e++)this.rows[e].clear();this.currRow=fn-1}equals(e){let t=!0;for(let n=0;n<fn;n++)if(!this.rows[n].equals(e.rows[n])){t=!1;break}return t}copy(e){for(let t=0;t<fn;t++)this.rows[t].copy(e.rows[t])}isEmpty(){let e=!0;for(let t=0;t<fn;t++)if(!this.rows[t].isEmpty()){e=!1;break}return e}backSpace(){this.rows[this.currRow].backSpace()}clearToEndOfRow(){this.rows[this.currRow].clearToEndOfRow()}insertChar(e){this.rows[this.currRow].insertChar(e)}setPen(e){this.rows[this.currRow].setPenStyles(e)}moveCursor(e){this.rows[this.currRow].moveCursor(e)}setCursor(e){this.logger.log(2,"setCursor: "+e),this.rows[this.currRow].setCursor(e)}setPAC(e){this.logger.log(2,()=>"pacData = "+Ke(e));let t=e.row-1;if(this.nrRollUpRows&&t<this.nrRollUpRows-1&&(t=this.nrRollUpRows-1),this.nrRollUpRows&&this.currRow!==t){for(let u=0;u<fn;u++)this.rows[u].clear();const a=this.currRow+1-this.nrRollUpRows,l=this.lastOutputScreen;if(l){const u=l.rows[a].cueStartTime,f=this.logger.time;if(u!==null&&f!==null&&u<f)for(let c=0;c<this.nrRollUpRows;c++)this.rows[t-this.nrRollUpRows+c+1].copy(l.rows[a+c])}}this.currRow=t;const n=this.rows[this.currRow];if(e.indent!==null){const a=e.indent,l=Math.max(a-1,0);n.setCursor(e.indent),e.color=n.chars[l].penState.foreground}const r={foreground:e.color,underline:e.underline,italics:e.italics,background:"black",flash:!1};this.setPen(r)}setBkgData(e){this.logger.log(2,()=>"bkgData = "+Ke(e)),this.backSpace(),this.setPen(e),this.insertChar(32)}setRollUpRows(e){this.nrRollUpRows=e}rollUp(){if(this.nrRollUpRows===null){this.logger.log(3,"roll_up but nrRollUpRows not set yet");return}this.logger.log(1,()=>this.getDisplayText());const e=this.currRow+1-this.nrRollUpRows,t=this.rows.splice(e,1)[0];t.clear(),this.rows.splice(this.currRow,0,t),this.logger.log(2,"Rolling up")}getDisplayText(e){e=e||!1;const t=[];let n="",r=-1;for(let a=0;a<fn;a++){const l=this.rows[a].getTextString();l&&(r=a+1,e?t.push("Row "+r+": '"+l+"'"):t.push(l.trim()))}return t.length>0&&(e?n="["+t.join(" | ")+"]":n=t.join(`
`)),n}getTextAndFormat(){return this.rows}}class Yp{constructor(e,t,n){this.chNr=void 0,this.outputFilter=void 0,this.mode=void 0,this.verbose=void 0,this.displayedMemory=void 0,this.nonDisplayedMemory=void 0,this.lastOutputScreen=void 0,this.currRollUpRow=void 0,this.writeScreen=void 0,this.cueStartTime=void 0,this.logger=void 0,this.chNr=e,this.outputFilter=t,this.mode=null,this.verbose=0,this.displayedMemory=new fc(n),this.nonDisplayedMemory=new fc(n),this.lastOutputScreen=new fc(n),this.currRollUpRow=this.displayedMemory.rows[fn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null,this.logger=n}reset(){this.mode=null,this.displayedMemory.reset(),this.nonDisplayedMemory.reset(),this.lastOutputScreen.reset(),this.outputFilter.reset(),this.currRollUpRow=this.displayedMemory.rows[fn-1],this.writeScreen=this.displayedMemory,this.mode=null,this.cueStartTime=null}getHandler(){return this.outputFilter}setHandler(e){this.outputFilter=e}setPAC(e){this.writeScreen.setPAC(e)}setBkgData(e){this.writeScreen.setBkgData(e)}setMode(e){e!==this.mode&&(this.mode=e,this.logger.log(2,()=>"MODE="+e),this.mode==="MODE_POP-ON"?this.writeScreen=this.nonDisplayedMemory:(this.writeScreen=this.displayedMemory,this.writeScreen.reset()),this.mode!=="MODE_ROLL-UP"&&(this.displayedMemory.nrRollUpRows=null,this.nonDisplayedMemory.nrRollUpRows=null),this.mode=e)}insertChars(e){for(let n=0;n<e.length;n++)this.writeScreen.insertChar(e[n]);const t=this.writeScreen===this.displayedMemory?"DISP":"NON_DISP";this.logger.log(2,()=>t+": "+this.writeScreen.getDisplayText(!0)),(this.mode==="MODE_PAINT-ON"||this.mode==="MODE_ROLL-UP")&&(this.logger.log(1,()=>"DISPLAYED: "+this.displayedMemory.getDisplayText(!0)),this.outputDataUpdate())}ccRCL(){this.logger.log(2,"RCL - Resume Caption Loading"),this.setMode("MODE_POP-ON")}ccBS(){this.logger.log(2,"BS - BackSpace"),this.mode!=="MODE_TEXT"&&(this.writeScreen.backSpace(),this.writeScreen===this.displayedMemory&&this.outputDataUpdate())}ccAOF(){}ccAON(){}ccDER(){this.logger.log(2,"DER- Delete to End of Row"),this.writeScreen.clearToEndOfRow(),this.outputDataUpdate()}ccRU(e){this.logger.log(2,"RU("+e+") - Roll Up"),this.writeScreen=this.displayedMemory,this.setMode("MODE_ROLL-UP"),this.writeScreen.setRollUpRows(e)}ccFON(){this.logger.log(2,"FON - Flash On"),this.writeScreen.setPen({flash:!0})}ccRDC(){this.logger.log(2,"RDC - Resume Direct Captioning"),this.setMode("MODE_PAINT-ON")}ccTR(){this.logger.log(2,"TR"),this.setMode("MODE_TEXT")}ccRTD(){this.logger.log(2,"RTD"),this.setMode("MODE_TEXT")}ccEDM(){this.logger.log(2,"EDM - Erase Displayed Memory"),this.displayedMemory.reset(),this.outputDataUpdate(!0)}ccCR(){this.logger.log(2,"CR - Carriage Return"),this.writeScreen.rollUp(),this.outputDataUpdate(!0)}ccENM(){this.logger.log(2,"ENM - Erase Non-displayed Memory"),this.nonDisplayedMemory.reset()}ccEOC(){if(this.logger.log(2,"EOC - End Of Caption"),this.mode==="MODE_POP-ON"){const e=this.displayedMemory;this.displayedMemory=this.nonDisplayedMemory,this.nonDisplayedMemory=e,this.writeScreen=this.nonDisplayedMemory,this.logger.log(1,()=>"DISP: "+this.displayedMemory.getDisplayText())}this.outputDataUpdate(!0)}ccTO(e){this.logger.log(2,"TO("+e+") - Tab Offset"),this.writeScreen.moveCursor(e)}ccMIDROW(e){const t={flash:!1};if(t.underline=e%2===1,t.italics=e>=46,t.italics)t.foreground="white";else{const n=Math.floor(e/2)-16,r=["white","green","blue","cyan","red","yellow","magenta"];t.foreground=r[n]}this.logger.log(2,"MIDROW: "+Ke(t)),this.writeScreen.setPen(t)}outputDataUpdate(e=!1){const t=this.logger.time;t!==null&&this.outputFilter&&(this.cueStartTime===null&&!this.displayedMemory.isEmpty()?this.cueStartTime=t:this.displayedMemory.equals(this.lastOutputScreen)||(this.outputFilter.newCue(this.cueStartTime,t,this.lastOutputScreen),e&&this.outputFilter.dispatchCue&&this.outputFilter.dispatchCue(),this.cueStartTime=this.displayedMemory.isEmpty()?null:t),this.lastOutputScreen.copy(this.displayedMemory))}cueSplitAtTime(e){this.outputFilter&&(this.displayedMemory.isEmpty()||(this.outputFilter.newCue&&this.outputFilter.newCue(this.cueStartTime,e,this.displayedMemory),this.cueStartTime=e))}}class qp{constructor(e,t,n){this.channels=void 0,this.currentChannel=0,this.cmdHistory=H1(),this.logger=void 0;const r=this.logger=new $1;this.channels=[null,new Yp(e,t,r),new Yp(e+1,n,r)]}getHandler(e){return this.channels[e].getHandler()}setHandler(e,t){this.channels[e].setHandler(t)}addData(e,t){this.logger.time=e;for(let n=0;n<t.length;n+=2){const r=t[n]&127,a=t[n+1]&127;let l=!1,u=null;if(r===0&&a===0)continue;this.logger.log(3,()=>"["+Mr([t[n],t[n+1]])+"] -> ("+Mr([r,a])+")");const f=this.cmdHistory;if(r>=16&&r<=31){if(V1(r,a,f)){lo(null,null,f),this.logger.log(3,()=>"Repeated command ("+Mr([r,a])+") is dropped");continue}lo(r,a,this.cmdHistory),l=this.parseCmd(r,a),l||(l=this.parseMidrow(r,a)),l||(l=this.parsePAC(r,a)),l||(l=this.parseBackgroundAttributes(r,a))}else lo(null,null,f);if(!l&&(u=this.parseChars(r,a),u)){const h=this.currentChannel;h&&h>0?this.channels[h].insertChars(u):this.logger.log(2,"No channel found yet. TEXT-MODE?")}!l&&!u&&this.logger.log(2,()=>"Couldn't parse cleaned data "+Mr([r,a])+" orig: "+Mr([t[n],t[n+1]]))}}parseCmd(e,t){const n=(e===20||e===28||e===21||e===29)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=33&&t<=35;if(!(n||r))return!1;const a=e===20||e===21||e===23?1:2,l=this.channels[a];return e===20||e===21||e===28||e===29?t===32?l.ccRCL():t===33?l.ccBS():t===34?l.ccAOF():t===35?l.ccAON():t===36?l.ccDER():t===37?l.ccRU(2):t===38?l.ccRU(3):t===39?l.ccRU(4):t===40?l.ccFON():t===41?l.ccRDC():t===42?l.ccTR():t===43?l.ccRTD():t===44?l.ccEDM():t===45?l.ccCR():t===46?l.ccENM():t===47&&l.ccEOC():l.ccTO(t-32),this.currentChannel=a,!0}parseMidrow(e,t){let n=0;if((e===17||e===25)&&t>=32&&t<=47){if(e===17?n=1:n=2,n!==this.currentChannel)return this.logger.log(0,"Mismatch channel in midrow parsing"),!1;const r=this.channels[n];return r?(r.ccMIDROW(t),this.logger.log(3,()=>"MIDROW ("+Mr([e,t])+")"),!0):!1}return!1}parsePAC(e,t){let n;const r=(e>=17&&e<=23||e>=25&&e<=31)&&t>=64&&t<=127,a=(e===16||e===24)&&t>=64&&t<=95;if(!(r||a))return!1;const l=e<=23?1:2;t>=64&&t<=95?n=l===1?N1[e]:M1[e]:n=l===1?F1[e]:U1[e];const u=this.channels[l];return u?(u.setPAC(this.interpretPAC(n,t)),this.currentChannel=l,!0):!1}interpretPAC(e,t){let n;const r={color:null,italics:!1,indent:null,underline:!1,row:e};return t>95?n=t-96:n=t-64,r.underline=(n&1)===1,n<=13?r.color=["white","green","blue","cyan","red","yellow","magenta","white"][Math.floor(n/2)]:n<=15?(r.italics=!0,r.color="white"):r.indent=Math.floor((n-16)/2)*4,r}parseChars(e,t){let n,r=null,a=null;if(e>=25?(n=2,a=e-8):(n=1,a=e),a>=17&&a<=19){let l;a===17?l=t+80:a===18?l=t+112:l=t+144,this.logger.log(2,()=>"Special char '"+ay(l)+"' in channel "+n),r=[l]}else e>=32&&e<=127&&(r=t===0?[e]:[e,t]);return r&&this.logger.log(3,()=>"Char codes =  "+Mr(r).join(",")),r}parseBackgroundAttributes(e,t){const n=(e===16||e===24)&&t>=32&&t<=47,r=(e===23||e===31)&&t>=45&&t<=47;if(!(n||r))return!1;let a;const l={};e===16||e===24?(a=Math.floor((t-32)/2),l.background=B1[a],t%2===1&&(l.background=l.background+"_semi")):t===45?l.background="transparent":(l.foreground="black",t===47&&(l.underline=!0));const u=e<=23?1:2;return this.channels[u].setBkgData(l),!0}reset(){for(let e=0;e<Object.keys(this.channels).length;e++){const t=this.channels[e];t&&t.reset()}lo(null,null,this.cmdHistory)}cueSplitAtTime(e){for(let t=0;t<this.channels.length;t++){const n=this.channels[t];n&&n.cueSplitAtTime(e)}}}function lo(i,e,t){t.a=i,t.b=e}function V1(i,e,t){return t.a===i&&t.b===e}function H1(){return{a:null,b:null}}var Ad=function(){if(Fo!=null&&Fo.VTTCue)return self.VTTCue;const i=["","lr","rl"],e=["start","middle","end","left","right"];function t(u,f){if(typeof f!="string"||!Array.isArray(u))return!1;const c=f.toLowerCase();return~u.indexOf(c)?c:!1}function n(u){return t(i,u)}function r(u){return t(e,u)}function a(u,...f){let c=1;for(;c<arguments.length;c++){const h=arguments[c];for(const m in h)u[m]=h[m]}return u}function l(u,f,c){const h=this,m={enumerable:!0};h.hasBeenReset=!1;let g="",E=!1,y=u,T=f,S=c,A=null,w="",I=!0,b="auto",P="start",G=50,D="middle",M=50,B="middle";Object.defineProperty(h,"id",a({},m,{get:function(){return g},set:function(O){g=""+O}})),Object.defineProperty(h,"pauseOnExit",a({},m,{get:function(){return E},set:function(O){E=!!O}})),Object.defineProperty(h,"startTime",a({},m,{get:function(){return y},set:function(O){if(typeof O!="number")throw new TypeError("Start time must be set to a number.");y=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"endTime",a({},m,{get:function(){return T},set:function(O){if(typeof O!="number")throw new TypeError("End time must be set to a number.");T=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"text",a({},m,{get:function(){return S},set:function(O){S=""+O,this.hasBeenReset=!0}})),Object.defineProperty(h,"region",a({},m,{get:function(){return A},set:function(O){A=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"vertical",a({},m,{get:function(){return w},set:function(O){const X=n(O);if(X===!1)throw new SyntaxError("An invalid or illegal string was specified.");w=X,this.hasBeenReset=!0}})),Object.defineProperty(h,"snapToLines",a({},m,{get:function(){return I},set:function(O){I=!!O,this.hasBeenReset=!0}})),Object.defineProperty(h,"line",a({},m,{get:function(){return b},set:function(O){if(typeof O!="number"&&O!=="auto")throw new SyntaxError("An invalid number or illegal string was specified.");b=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"lineAlign",a({},m,{get:function(){return P},set:function(O){const X=r(O);if(!X)throw new SyntaxError("An invalid or illegal string was specified.");P=X,this.hasBeenReset=!0}})),Object.defineProperty(h,"position",a({},m,{get:function(){return G},set:function(O){if(O<0||O>100)throw new Error("Position must be between 0 and 100.");G=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"positionAlign",a({},m,{get:function(){return D},set:function(O){const X=r(O);if(!X)throw new SyntaxError("An invalid or illegal string was specified.");D=X,this.hasBeenReset=!0}})),Object.defineProperty(h,"size",a({},m,{get:function(){return M},set:function(O){if(O<0||O>100)throw new Error("Size must be between 0 and 100.");M=O,this.hasBeenReset=!0}})),Object.defineProperty(h,"align",a({},m,{get:function(){return B},set:function(O){const X=r(O);if(!X)throw new SyntaxError("An invalid or illegal string was specified.");B=X,this.hasBeenReset=!0}})),h.displayState=void 0}return l.prototype.getCueAsHTML=function(){return self.WebVTT.convertCueToDOMTree(self,this.text)},l}();class K1{decode(e,t){if(!e)return"";if(typeof e!="string")throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}function ly(i){function e(n,r,a,l){return(n|0)*3600+(r|0)*60+(a|0)+parseFloat(l||0)}const t=i.match(/^(?:(\d+):)?(\d{2}):(\d{2})(\.\d+)?/);return t?parseFloat(t[2])>59?e(t[2],t[3],0,t[4]):e(t[1],t[2],t[3],t[4]):null}let z1=class{constructor(){this.values=Object.create(null)}set(e,t){!this.get(e)&&t!==""&&(this.values[e]=t)}get(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t}has(e){return e in this.values}alt(e,t,n){for(let r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}}integer(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))}percent(e,t){if(/^([\d]{1,3})(\.[\d]*)?%$/.test(t)){const n=parseFloat(t);if(n>=0&&n<=100)return this.set(e,n),!0}return!1}};function uy(i,e,t,n){const r=n?i.split(n):[i];for(const a in r){if(typeof r[a]!="string")continue;const l=r[a].split(t);if(l.length!==2)continue;const u=l[0],f=l[1];e(u,f)}}const Kc=new Ad(0,0,""),uo=Kc.align==="middle"?"middle":"center";function W1(i,e,t){const n=i;function r(){const u=ly(i);if(u===null)throw new Error("Malformed timestamp: "+n);return i=i.replace(/^[^\sa-zA-Z-]+/,""),u}function a(u,f){const c=new z1;uy(u,function(g,E){let y;switch(g){case"region":for(let T=t.length-1;T>=0;T--)if(t[T].id===E){c.set(g,t[T].region);break}break;case"vertical":c.alt(g,E,["rl","lr"]);break;case"line":y=E.split(","),c.integer(g,y[0]),c.percent(g,y[0])&&c.set("snapToLines",!1),c.alt(g,y[0],["auto"]),y.length===2&&c.alt("lineAlign",y[1],["start",uo,"end"]);break;case"position":y=E.split(","),c.percent(g,y[0]),y.length===2&&c.alt("positionAlign",y[1],["start",uo,"end","line-left","line-right","auto"]);break;case"size":c.percent(g,E);break;case"align":c.alt(g,E,["start",uo,"end","left","right"]);break}},/:/,/\s/),f.region=c.get("region",null),f.vertical=c.get("vertical","");let h=c.get("line","auto");h==="auto"&&Kc.line===-1&&(h=-1),f.line=h,f.lineAlign=c.get("lineAlign","start"),f.snapToLines=c.get("snapToLines",!0),f.size=c.get("size",100),f.align=c.get("align",uo);let m=c.get("position","auto");m==="auto"&&Kc.position===50&&(m=f.align==="start"||f.align==="left"?0:f.align==="end"||f.align==="right"?100:50),f.position=m}function l(){i=i.replace(/^\s+/,"")}if(l(),e.startTime=r(),l(),i.slice(0,3)!=="-->")throw new Error("Malformed time stamp (time stamps must be separated by '-->'): "+n);i=i.slice(3),l(),e.endTime=r(),l(),a(i,e)}function cy(i){return i.replace(/<br(?: \/)?>/gi,`
`)}class Y1{constructor(){this.state="INITIAL",this.buffer="",this.decoder=new K1,this.regionList=[],this.cue=null,this.oncue=void 0,this.onparsingerror=void 0,this.onflush=void 0}parse(e){const t=this;e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));function n(){let a=t.buffer,l=0;for(a=cy(a);l<a.length&&a[l]!=="\r"&&a[l]!==`
`;)++l;const u=a.slice(0,l);return a[l]==="\r"&&++l,a[l]===`
`&&++l,t.buffer=a.slice(l),u}function r(a){uy(a,function(l,u){},/:/)}try{let a="";if(t.state==="INITIAL"){if(!/\r\n|\n/.test(t.buffer))return this;a=n();const u=a.match(/^(ï»¿)?WEBVTT([ \t].*)?$/);if(!(u!=null&&u[0]))throw new Error("Malformed WebVTT signature.");t.state="HEADER"}let l=!1;for(;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(l?l=!1:a=n(),t.state){case"HEADER":/:/.test(a)?r(a):a||(t.state="ID");continue;case"NOTE":a||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(a)){t.state="NOTE";break}if(!a)continue;if(t.cue=new Ad(0,0,""),t.state="CUE",a.indexOf("-->")===-1){t.cue.id=a;continue}case"CUE":if(!t.cue){t.state="BADCUE";continue}try{W1(a,t.cue,t.regionList)}catch{t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":{const u=a.indexOf("-->")!==-1;if(!a||u&&(l=!0)){t.oncue&&t.cue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}if(t.cue===null)continue;t.cue.text&&(t.cue.text+=`
`),t.cue.text+=a}continue;case"BADCUE":a||(t.state="ID")}}}catch{t.state==="CUETEXT"&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state=t.state==="INITIAL"?"BADWEBVTT":"BADCUE"}return this}flush(){const e=this;try{if((e.cue||e.state==="HEADER")&&(e.buffer+=`

`,e.parse()),e.state==="INITIAL"||e.state==="BADWEBVTT")throw new Error("Malformed WebVTT signature.")}catch(t){e.onparsingerror&&e.onparsingerror(t)}return e.onflush&&e.onflush(),this}}const q1=/\r\n|\n\r|\n|\r/g,hc=function(e,t,n=0){return e.slice(n,n+t.length)===t},X1=function(e){let t=parseInt(e.slice(-3));const n=parseInt(e.slice(-6,-4)),r=parseInt(e.slice(-9,-7)),a=e.length>9?parseInt(e.substring(0,e.indexOf(":"))):0;if(!ce(t)||!ce(n)||!ce(r)||!ce(a))throw Error(`Malformed X-TIMESTAMP-MAP: Local:${e}`);return t+=1e3*n,t+=60*1e3*r,t+=60*60*1e3*a,t};function Rd(i,e,t){return _i(i.toString())+_i(e.toString())+_i(t)}const Q1=function(e,t,n){let r=e[t],a=e[r.prevCC];if(!a||!a.new&&r.new){e.ccOffset=e.presentationOffset=r.start,r.new=!1;return}for(;(l=a)!=null&&l.new;){var l;e.ccOffset+=r.start-a.start,r.new=!1,r=a,a=e[r.prevCC]}e.presentationOffset=n};function J1(i,e,t,n,r,a,l){const u=new Y1,f=Vt(new Uint8Array(i)).trim().replace(q1,`
`).split(`
`),c=[],h=e?hR(e.baseTime,e.timescale):0;let m="00:00.000",g=0,E=0,y,T=!0;u.oncue=function(S){const A=t[n];let w=t.ccOffset;const I=(g-h)/9e4;if(A!=null&&A.new&&(E!==void 0?w=t.ccOffset=A.start:Q1(t,n,I)),I){if(!e){y=new Error("Missing initPTS for VTT MPEGTS");return}w=I-t.presentationOffset}const b=S.endTime-S.startTime,P=Jt((S.startTime+w-E)*9e4,r*9e4)/9e4;S.startTime=Math.max(P,0),S.endTime=Math.max(P+b,0);const G=S.text.trim();S.text=decodeURIComponent(encodeURIComponent(G)),S.id||(S.id=Rd(S.startTime,S.endTime,G)),S.endTime>0&&c.push(S)},u.onparsingerror=function(S){y=S},u.onflush=function(){if(y){l(y);return}a(c)},f.forEach(S=>{if(T)if(hc(S,"X-TIMESTAMP-MAP=")){T=!1,S.slice(16).split(",").forEach(A=>{hc(A,"LOCAL:")?m=A.slice(6):hc(A,"MPEGTS:")&&(g=parseInt(A.slice(7)))});try{E=X1(m)/1e3}catch(A){y=A}return}else S===""&&(T=!1);u.parse(S+`
`)}),u.flush()}const mc="stpp.ttml.im1t",dy=/^(\d{2,}):(\d{2}):(\d{2}):(\d{2})\.?(\d+)?$/,fy=/^(\d*(?:\.\d*)?)(h|m|s|ms|f|t)$/,Z1={left:"start",center:"center",right:"end",start:"start",end:"end"};function Xp(i,e,t,n){const r=Ce(new Uint8Array(i),["mdat"]);if(r.length===0){n(new Error("Could not parse IMSC1 mdat"));return}const a=r.map(u=>Vt(u)),l=fR(e.baseTime,1,e.timescale);try{a.forEach(u=>t(eI(u,l)))}catch(u){n(u)}}function eI(i,e){const r=new DOMParser().parseFromString(i,"text/xml").getElementsByTagName("tt")[0];if(!r)throw new Error("Invalid ttml");const a={frameRate:30,subFrameRate:1,frameRateMultiplier:0,tickRate:0},l=Object.keys(a).reduce((m,g)=>(m[g]=r.getAttribute(`ttp:${g}`)||a[g],m),{}),u=r.getAttribute("xml:space")!=="preserve",f=Qp(pc(r,"styling","style")),c=Qp(pc(r,"layout","region")),h=pc(r,"body","[begin]");return[].map.call(h,m=>{const g=hy(m,u);if(!g||!m.hasAttribute("begin"))return null;const E=yc(m.getAttribute("begin"),l),y=yc(m.getAttribute("dur"),l);let T=yc(m.getAttribute("end"),l);if(E===null)throw Jp(m);if(T===null){if(y===null)throw Jp(m);T=E+y}const S=new Ad(E-e,T-e,g);S.id=Rd(S.startTime,S.endTime,S.text);const A=c[m.getAttribute("region")],w=f[m.getAttribute("style")],I=tI(A,w,f),{textAlign:b}=I;if(b){const P=Z1[b];P&&(S.lineAlign=P),S.align=b}return Ue(S,I),S}).filter(m=>m!==null)}function pc(i,e,t){const n=i.getElementsByTagName(e)[0];return n?[].slice.call(n.querySelectorAll(t)):[]}function Qp(i){return i.reduce((e,t)=>{const n=t.getAttribute("xml:id");return n&&(e[n]=t),e},{})}function hy(i,e){return[].slice.call(i.childNodes).reduce((t,n,r)=>{var a;return n.nodeName==="br"&&r?t+`
`:(a=n.childNodes)!=null&&a.length?hy(n,e):e?t+n.textContent.trim().replace(/\s+/g," "):t+n.textContent},"")}function tI(i,e,t){const n="http://www.w3.org/ns/ttml#styling";let r=null;const a=["displayAlign","textAlign","color","backgroundColor","fontSize","fontFamily"],l=i!=null&&i.hasAttribute("style")?i.getAttribute("style"):null;return l&&t.hasOwnProperty(l)&&(r=t[l]),a.reduce((u,f)=>{const c=gc(e,n,f)||gc(i,n,f)||gc(r,n,f);return c&&(u[f]=c),u},{})}function gc(i,e,t){return i&&i.hasAttributeNS(e,t)?i.getAttributeNS(e,t):null}function Jp(i){return new Error(`Could not parse ttml timestamp ${i}`)}function yc(i,e){if(!i)return null;let t=ly(i);return t===null&&(dy.test(i)?t=nI(i,e):fy.test(i)&&(t=rI(i,e))),t}function nI(i,e){const t=dy.exec(i),n=(t[4]|0)+(t[5]|0)/e.subFrameRate;return(t[1]|0)*3600+(t[2]|0)*60+(t[3]|0)+n/e.frameRate}function rI(i,e){const t=fy.exec(i),n=Number(t[1]);switch(t[2]){case"h":return n*3600;case"m":return n*60;case"ms":return n*1e3;case"f":return n/e.frameRate;case"t":return n/e.tickRate}return n}class co{constructor(e,t){this.timelineController=void 0,this.cueRanges=[],this.trackName=void 0,this.startTime=null,this.endTime=null,this.screen=null,this.timelineController=e,this.trackName=t}dispatchCue(){this.startTime!==null&&(this.timelineController.addCues(this.trackName,this.startTime,this.endTime,this.screen,this.cueRanges),this.startTime=null)}newCue(e,t,n){(this.startTime===null||this.startTime>e)&&(this.startTime=e),this.endTime=t,this.screen=n,this.timelineController.createCaptionsTrack(this.trackName)}reset(){this.cueRanges=[],this.startTime=null}}class sI{constructor(e){this.hls=void 0,this.media=null,this.config=void 0,this.enabled=!0,this.Cues=void 0,this.textTracks=[],this.tracks=[],this.initPTS=[],this.unparsedVttFrags=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.cea608Parser1=void 0,this.cea608Parser2=void 0,this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=eg(),this.captionsProperties=void 0,this.hls=e,this.config=e.config,this.Cues=e.config.cueHandler,this.captionsProperties={textTrack1:{label:this.config.captionsTextTrack1Label,languageCode:this.config.captionsTextTrack1LanguageCode},textTrack2:{label:this.config.captionsTextTrack2Label,languageCode:this.config.captionsTextTrack2LanguageCode},textTrack3:{label:this.config.captionsTextTrack3Label,languageCode:this.config.captionsTextTrack3LanguageCode},textTrack4:{label:this.config.captionsTextTrack4Label,languageCode:this.config.captionsTextTrack4LanguageCode}},e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.on(L.FRAG_LOADING,this.onFragLoading,this),e.on(L.FRAG_LOADED,this.onFragLoaded,this),e.on(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.on(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.on(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.on(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this)}destroy(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.SUBTITLE_TRACKS_UPDATED,this.onSubtitleTracksUpdated,this),e.off(L.FRAG_LOADING,this.onFragLoading,this),e.off(L.FRAG_LOADED,this.onFragLoaded,this),e.off(L.FRAG_PARSING_USERDATA,this.onFragParsingUserdata,this),e.off(L.FRAG_DECRYPTED,this.onFragDecrypted,this),e.off(L.INIT_PTS_FOUND,this.onInitPtsFound,this),e.off(L.SUBTITLE_TRACKS_CLEARED,this.onSubtitleTracksCleared,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),this.hls=this.config=this.media=null,this.cea608Parser1=this.cea608Parser2=void 0}initCea608Parsers(){const e=new co(this,"textTrack1"),t=new co(this,"textTrack2"),n=new co(this,"textTrack3"),r=new co(this,"textTrack4");this.cea608Parser1=new qp(1,e,t),this.cea608Parser2=new qp(3,n,r)}addCues(e,t,n,r,a){let l=!1;for(let u=a.length;u--;){const f=a[u],c=iI(f[0],f[1],t,n);if(c>=0&&(f[0]=Math.min(f[0],t),f[1]=Math.max(f[1],n),l=!0,c/(n-t)>.5))return}if(l||a.push([t,n]),this.config.renderTextTracksNatively){const u=this.captionsTracks[e];this.Cues.newCue(u,t,n,r)}else{const u=this.Cues.newCue(null,t,n,r);this.hls.trigger(L.CUES_PARSED,{type:"captions",cues:u,track:e})}}onInitPtsFound(e,{frag:t,id:n,initPTS:r,timescale:a}){const{unparsedVttFrags:l}=this;n===pe.MAIN&&(this.initPTS[t.cc]={baseTime:r,timescale:a}),l.length&&(this.unparsedVttFrags=[],l.forEach(u=>{this.initPTS[u.frag.cc]?this.onFragLoaded(L.FRAG_LOADED,u):this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:u.frag,error:new Error("Subtitle discontinuity domain does not match main")})}))}getExistingTrack(e,t){const{media:n}=this;if(n)for(let r=0;r<n.textTracks.length;r++){const a=n.textTracks[r];if(Zp(a,{name:e,lang:t,characteristics:"transcribes-spoken-dialog,describes-music-and-sound"}))return a}return null}createCaptionsTrack(e){this.config.renderTextTracksNatively?this.createNativeTrack(e):this.createNonNativeTrack(e)}createNativeTrack(e){if(this.captionsTracks[e])return;const{captionsProperties:t,captionsTracks:n,media:r}=this,{label:a,languageCode:l}=t[e],u=this.getExistingTrack(a,l);if(u)n[e]=u,Ts(n[e]),ry(n[e],r);else{const f=this.createTextTrack("captions",a,l);f&&(f[e]=!0,n[e]=f)}}createNonNativeTrack(e){if(this.nonNativeCaptionsTracks[e])return;const t=this.captionsProperties[e];if(!t)return;const n=t.label,r={_id:e,label:n,kind:"captions",default:t.media?!!t.media.default:!1,closedCaptions:t.media};this.nonNativeCaptionsTracks[e]=r,this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:[r]})}createTextTrack(e,t,n){const r=this.media;if(r)return r.addTextTrack(e,t,n)}onMediaAttaching(e,t){this.media=t.media,t.mediaSource||this._cleanTracks()}onMediaDetaching(e,t){const n=!!t.transferMedia;if(this.media=null,n)return;const{captionsTracks:r}=this;Object.keys(r).forEach(a=>{Ts(r[a]),delete r[a]}),this.nonNativeCaptionsTracks={}}onManifestLoading(){this.lastCc=-1,this.lastSn=-1,this.lastPartIndex=-1,this.prevCC=-1,this.vttCCs=eg(),this._cleanTracks(),this.tracks=[],this.captionsTracks={},this.nonNativeCaptionsTracks={},this.textTracks=[],this.unparsedVttFrags=[],this.initPTS=[],this.cea608Parser1&&this.cea608Parser2&&(this.cea608Parser1.reset(),this.cea608Parser2.reset())}_cleanTracks(){const{media:e}=this;if(!e)return;const t=e.textTracks;if(t)for(let n=0;n<t.length;n++)Ts(t[n])}onSubtitleTracksUpdated(e,t){const n=t.subtitleTracks||[],r=n.some(a=>a.textCodec===mc);if(this.config.enableWebVTT||r&&this.config.enableIMSC1){if(q0(this.tracks,n)){this.tracks=n;return}if(this.textTracks=[],this.tracks=n,this.config.renderTextTracksNatively){const l=this.media,u=l?Ao(l.textTracks):null;if(this.tracks.forEach((f,c)=>{let h;if(u){let m=null;for(let g=0;g<u.length;g++)if(u[g]&&Zp(u[g],f)){m=u[g],u[g]=null;break}m&&(h=m)}if(h)Ts(h);else{const m=my(f);h=this.createTextTrack(m,f.name,f.lang),h&&(h.mode="disabled")}h&&this.textTracks.push(h)}),u!=null&&u.length){const f=u.filter(c=>c!==null).map(c=>c.label);f.length&&this.hls.logger.warn(`Media element contains unused subtitle tracks: ${f.join(", ")}. Replace media element for each source to clear TextTracks and captions menu.`)}}else if(this.tracks.length){const l=this.tracks.map(u=>({label:u.name,kind:u.type.toLowerCase(),default:u.default,subtitleTrack:u}));this.hls.trigger(L.NON_NATIVE_TEXT_TRACKS_FOUND,{tracks:l})}}}onManifestLoaded(e,t){this.config.enableCEA708Captions&&t.captions&&t.captions.forEach(n=>{const r=/(?:CC|SERVICE)([1-4])/.exec(n.instreamId);if(!r)return;const a=`textTrack${r[1]}`,l=this.captionsProperties[a];l&&(l.label=n.name,n.lang&&(l.languageCode=n.lang),l.media=n)})}closedCaptionsForLevel(e){const t=this.hls.levels[e.level];return t==null?void 0:t.attrs["CLOSED-CAPTIONS"]}onFragLoading(e,t){if(this.enabled&&t.frag.type===pe.MAIN){var n,r;const{cea608Parser1:a,cea608Parser2:l,lastSn:u}=this,{cc:f,sn:c}=t.frag,h=(n=(r=t.part)==null?void 0:r.index)!=null?n:-1;a&&l&&(c!==u+1||c===u&&h!==this.lastPartIndex+1||f!==this.lastCc)&&(a.reset(),l.reset()),this.lastCc=f,this.lastSn=c,this.lastPartIndex=h}}onFragLoaded(e,t){const{frag:n,payload:r}=t;if(n.type===pe.SUBTITLE)if(r.byteLength){const a=n.decryptdata,l="stats"in t;if(a==null||!a.encrypted||l){const u=this.tracks[n.level],f=this.vttCCs;f[n.cc]||(f[n.cc]={start:n.start,prevCC:this.prevCC,new:!0},this.prevCC=n.cc),u&&u.textCodec===mc?this._parseIMSC1(n,r):this._parseVTTs(t)}}else this.hls.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:new Error("Empty subtitle payload")})}_parseIMSC1(e,t){const n=this.hls;Xp(t,this.initPTS[e.cc],r=>{this._appendCues(r,e.level),n.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:e})},r=>{n.logger.log(`Failed to parse IMSC1: ${r}`),n.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:e,error:r})})}_parseVTTs(e){var t;const{frag:n,payload:r}=e,{initPTS:a,unparsedVttFrags:l}=this,u=a.length-1;if(!a[n.cc]&&u===-1){l.push(e);return}const f=this.hls,c=(t=n.initSegment)!=null&&t.data?en(n.initSegment.data,new Uint8Array(r)).buffer:r;J1(c,this.initPTS[n.cc],this.vttCCs,n.cc,n.start,h=>{this._appendCues(h,n.level),f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!0,frag:n})},h=>{const m=h.message==="Missing initPTS for VTT MPEGTS";m?l.push(e):this._fallbackToIMSC1(n,r),f.logger.log(`Failed to parse VTT cue: ${h}`),!(m&&u>n.cc)&&f.trigger(L.SUBTITLE_FRAG_PROCESSED,{success:!1,frag:n,error:h})})}_fallbackToIMSC1(e,t){const n=this.tracks[e.level];n.textCodec||Xp(t,this.initPTS[e.cc],()=>{n.textCodec=mc,this._parseIMSC1(e,t)},()=>{n.textCodec="wvtt"})}_appendCues(e,t){const n=this.hls;if(this.config.renderTextTracksNatively){const r=this.textTracks[t];if(!r||r.mode==="disabled")return;e.forEach(a=>sy(r,a))}else{const r=this.tracks[t];if(!r)return;const a=r.default?"default":"subtitles"+t;n.trigger(L.CUES_PARSED,{type:"subtitles",cues:e,track:a})}}onFragDecrypted(e,t){const{frag:n}=t;n.type===pe.SUBTITLE&&this.onFragLoaded(L.FRAG_LOADED,t)}onSubtitleTracksCleared(){this.tracks=[],this.captionsTracks={}}onFragParsingUserdata(e,t){if(!this.enabled||!this.config.enableCEA708Captions)return;const{frag:n,samples:r}=t;if(!(n.type===pe.MAIN&&this.closedCaptionsForLevel(n)==="NONE"))for(let a=0;a<r.length;a++){const l=r[a].bytes;if(l){this.cea608Parser1||this.initCea608Parsers();const u=this.extractCea608Data(l);this.cea608Parser1.addData(r[a].pts,u[0]),this.cea608Parser2.addData(r[a].pts,u[1])}}}onBufferFlushing(e,{startOffset:t,endOffset:n,endOffsetSubtitles:r,type:a}){const{media:l}=this;if(!(!l||l.currentTime<n)){if(!a||a==="video"){const{captionsTracks:u}=this;Object.keys(u).forEach(f=>Hc(u[f],t,n))}if(this.config.renderTextTracksNatively&&t===0&&r!==void 0){const{textTracks:u}=this;Object.keys(u).forEach(f=>Hc(u[f],t,r))}}}extractCea608Data(e){const t=[[],[]],n=e[0]&31;let r=2;for(let a=0;a<n;a++){const l=e[r++],u=127&e[r++],f=127&e[r++];if(u===0&&f===0)continue;if((4&l)!==0){const h=3&l;(h===0||h===1)&&(t[h].push(u),t[h].push(f))}}return t}}function my(i){return i.characteristics&&/transcribes-spoken-dialog/gi.test(i.characteristics)&&/describes-music-and-sound/gi.test(i.characteristics)?"captions":"subtitles"}function Zp(i,e){return!!i&&i.kind===my(e)&&Gc(e,i)}function iI(i,e,t,n){return Math.min(e,n)-Math.max(i,t)}function eg(){return{ccOffset:0,presentationOffset:0,0:{start:0,prevCC:-1,new:!0}}}const aI=/\s/,oI={newCue(i,e,t,n){const r=[];let a,l,u,f,c;const h=self.VTTCue||self.TextTrackCue;for(let g=0;g<n.rows.length;g++)if(a=n.rows[g],u=!0,f=0,c="",!a.isEmpty()){var m;for(let T=0;T<a.chars.length;T++)aI.test(a.chars[T].uchar)&&u?f++:(c+=a.chars[T].uchar,u=!1);a.cueStartTime=e,e===t&&(t+=1e-4),f>=16?f--:f++;const E=cy(c.trim()),y=Rd(e,t,E);i!=null&&(m=i.cues)!=null&&m.getCueById(y)||(l=new h(e,t,E),l.id=y,l.line=g+1,l.align="left",l.position=10+Math.min(80,Math.floor(f*8/32)*10),r.push(l))}return i&&r.length&&(r.sort((g,E)=>g.line==="auto"||E.line==="auto"?0:g.line>8&&E.line>8?E.line-g.line:g.line-E.line),r.forEach(g=>sy(i,g))),r}};function lI(){if(self.fetch&&self.AbortController&&self.ReadableStream&&self.Request)try{return new self.ReadableStream({}),!0}catch{}return!1}const uI=/(\d+)-(\d+)\/(\d+)/;class tg{constructor(e){this.fetchSetup=void 0,this.requestTimeout=void 0,this.request=null,this.response=null,this.controller=void 0,this.context=null,this.config=null,this.callbacks=null,this.stats=void 0,this.loader=null,this.fetchSetup=e.fetchSetup||hI,this.controller=new self.AbortController,this.stats=new id}destroy(){this.loader=this.callbacks=this.context=this.config=this.request=null,this.abortInternal(),this.response=null,this.fetchSetup=this.controller=this.stats=null}abortInternal(){this.controller&&!this.stats.loading.end&&(this.stats.aborted=!0,this.controller.abort())}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.response)}load(e,t,n){const r=this.stats;if(r.loading.start)throw new Error("Loader can only be used once.");r.loading.start=self.performance.now();const a=cI(e,this.controller.signal),l=e.responseType==="arraybuffer",u=l?"byteLength":"length",{maxTimeToFirstByteMs:f,maxLoadTimeMs:c}=t.loadPolicy;this.context=e,this.config=t,this.callbacks=n,this.request=this.fetchSetup(e,a),self.clearTimeout(this.requestTimeout),t.timeout=f&&ce(f)?f:c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},t.timeout),(Fi(this.request)?this.request.then(self.fetch):self.fetch(this.request)).then(m=>{var g;this.response=this.loader=m;const E=Math.max(self.performance.now(),r.loading.start);if(self.clearTimeout(this.requestTimeout),t.timeout=c,this.requestTimeout=self.setTimeout(()=>{this.callbacks&&(this.abortInternal(),this.callbacks.onTimeout(r,e,this.response))},c-(E-r.loading.start)),!m.ok){const{status:T,statusText:S}=m;throw new mI(S||"fetch, bad network response",T,m)}r.loading.first=E,r.total=fI(m.headers)||r.total;const y=(g=this.callbacks)==null?void 0:g.onProgress;return y&&ce(t.highWaterMark)?this.loadProgressively(m,r,e,t.highWaterMark,y):l?m.arrayBuffer():e.responseType==="json"?m.json():m.text()}).then(m=>{var g,E;const y=this.response;if(!y)throw new Error("loader destroyed");self.clearTimeout(this.requestTimeout),r.loading.end=Math.max(self.performance.now(),r.loading.first);const T=m[u];T&&(r.loaded=r.total=T);const S={url:y.url,data:m,code:y.status},A=(g=this.callbacks)==null?void 0:g.onProgress;A&&!ce(t.highWaterMark)&&A(r,e,m,y),(E=this.callbacks)==null||E.onSuccess(S,r,e,y)}).catch(m=>{var g;if(self.clearTimeout(this.requestTimeout),r.aborted)return;const E=m&&m.code||0,y=m?m.message:null;(g=this.callbacks)==null||g.onError({code:E,text:y},e,m?m.details:null,r)})}getCacheAge(){let e=null;if(this.response){const t=this.response.headers.get("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.response?this.response.headers.get(e):null}loadProgressively(e,t,n,r=0,a){const l=new b0,u=e.body.getReader(),f=()=>u.read().then(c=>{if(c.done)return l.dataLength&&a(t,n,l.flush().buffer,e),Promise.resolve(new ArrayBuffer(0));const h=c.value,m=h.length;return t.loaded+=m,m<r||l.dataLength?(l.push(h),l.dataLength>=r&&a(t,n,l.flush().buffer,e)):a(t,n,h.buffer,e),f()}).catch(()=>Promise.reject());return f()}}function cI(i,e){const t={method:"GET",mode:"cors",credentials:"same-origin",signal:e,headers:new self.Headers(Ue({},i.headers))};return i.rangeEnd&&t.headers.set("Range","bytes="+i.rangeStart+"-"+String(i.rangeEnd-1)),t}function dI(i){const e=uI.exec(i);if(e)return parseInt(e[2])-parseInt(e[1])+1}function fI(i){const e=i.get("Content-Range");if(e){const n=dI(e);if(ce(n))return n}const t=i.get("Content-Length");if(t)return parseInt(t)}function hI(i,e){return new self.Request(i.url,e)}class mI extends Error{constructor(e,t,n){super(e),this.code=void 0,this.details=void 0,this.code=t,this.details=n}}const pI=/^age:\s*[\d.]+\s*$/im;class py{constructor(e){this.xhrSetup=void 0,this.requestTimeout=void 0,this.retryTimeout=void 0,this.retryDelay=void 0,this.config=null,this.callbacks=null,this.context=null,this.loader=null,this.stats=void 0,this.xhrSetup=e&&e.xhrSetup||null,this.stats=new id,this.retryDelay=0}destroy(){this.callbacks=null,this.abortInternal(),this.loader=null,this.config=null,this.context=null,this.xhrSetup=null}abortInternal(){const e=this.loader;self.clearTimeout(this.requestTimeout),self.clearTimeout(this.retryTimeout),e&&(e.onreadystatechange=null,e.onprogress=null,e.readyState!==4&&(this.stats.aborted=!0,e.abort()))}abort(){var e;this.abortInternal(),(e=this.callbacks)!=null&&e.onAbort&&this.callbacks.onAbort(this.stats,this.context,this.loader)}load(e,t,n){if(this.stats.loading.start)throw new Error("Loader can only be used once.");this.stats.loading.start=self.performance.now(),this.context=e,this.config=t,this.callbacks=n,this.loadInternal()}loadInternal(){const{config:e,context:t}=this;if(!e||!t)return;const n=this.loader=new self.XMLHttpRequest,r=this.stats;r.loading.first=0,r.loaded=0,r.aborted=!1;const a=this.xhrSetup;a?Promise.resolve().then(()=>{if(!(this.loader!==n||this.stats.aborted))return a(n,t.url)}).catch(l=>{if(!(this.loader!==n||this.stats.aborted))return n.open("GET",t.url,!0),a(n,t.url)}).then(()=>{this.loader!==n||this.stats.aborted||this.openAndSendXhr(n,t,e)}).catch(l=>{var u;(u=this.callbacks)==null||u.onError({code:n.status,text:l.message},t,n,r)}):this.openAndSendXhr(n,t,e)}openAndSendXhr(e,t,n){e.readyState||e.open("GET",t.url,!0);const r=t.headers,{maxTimeToFirstByteMs:a,maxLoadTimeMs:l}=n.loadPolicy;if(r)for(const u in r)e.setRequestHeader(u,r[u]);t.rangeEnd&&e.setRequestHeader("Range","bytes="+t.rangeStart+"-"+(t.rangeEnd-1)),e.onreadystatechange=this.readystatechange.bind(this),e.onprogress=this.loadprogress.bind(this),e.responseType=t.responseType,self.clearTimeout(this.requestTimeout),n.timeout=a&&ce(a)?a:l,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),n.timeout),e.send()}readystatechange(){const{context:e,loader:t,stats:n}=this;if(!e||!t)return;const r=t.readyState,a=this.config;if(!n.aborted&&r>=2&&(n.loading.first===0&&(n.loading.first=Math.max(self.performance.now(),n.loading.start),a.timeout!==a.loadPolicy.maxLoadTimeMs&&(self.clearTimeout(this.requestTimeout),a.timeout=a.loadPolicy.maxLoadTimeMs,this.requestTimeout=self.setTimeout(this.loadtimeout.bind(this),a.loadPolicy.maxLoadTimeMs-(n.loading.first-n.loading.start)))),r===4)){self.clearTimeout(this.requestTimeout),t.onreadystatechange=null,t.onprogress=null;const c=t.status,h=t.responseType==="text"?t.responseText:null;if(c>=200&&c<300){const y=h??t.response;if(y!=null){var l,u;n.loading.end=Math.max(self.performance.now(),n.loading.first);const T=t.responseType==="arraybuffer"?y.byteLength:y.length;n.loaded=n.total=T,n.bwEstimate=n.total*8e3/(n.loading.end-n.loading.first);const S=(l=this.callbacks)==null?void 0:l.onProgress;S&&S(n,e,y,t);const A={url:t.responseURL,data:y,code:c};(u=this.callbacks)==null||u.onSuccess(A,n,e,t);return}}const m=a.loadPolicy.errorRetry,g=n.retry,E={url:e.url,data:void 0,code:c};if(No(m,g,!1,E))this.retry(m);else{var f;Fe.error(`${c} while loading ${e.url}`),(f=this.callbacks)==null||f.onError({code:c,text:t.statusText},e,t,n)}}}loadtimeout(){if(!this.config)return;const e=this.config.loadPolicy.timeoutRetry,t=this.stats.retry;if(No(e,t,!0))this.retry(e);else{var n;Fe.warn(`timeout while loading ${(n=this.context)==null?void 0:n.url}`);const r=this.callbacks;r&&(this.abortInternal(),r.onTimeout(this.stats,this.context,this.loader))}}retry(e){const{context:t,stats:n}=this;this.retryDelay=ud(e,n.retry),n.retry++,Fe.warn(`${status?"HTTP Status "+status:"Timeout"} while loading ${t==null?void 0:t.url}, retrying ${n.retry}/${e.maxNumRetry} in ${this.retryDelay}ms`),this.abortInternal(),this.loader=null,self.clearTimeout(this.retryTimeout),this.retryTimeout=self.setTimeout(this.loadInternal.bind(this),this.retryDelay)}loadprogress(e){const t=this.stats;t.loaded=e.loaded,e.lengthComputable&&(t.total=e.total)}getCacheAge(){let e=null;if(this.loader&&pI.test(this.loader.getAllResponseHeaders())){const t=this.loader.getResponseHeader("age");e=t?parseFloat(t):null}return e}getResponseHeader(e){return this.loader&&new RegExp(`^${e}:\\s*[\\d.]+\\s*$`,"im").test(this.loader.getAllResponseHeaders())?this.loader.getResponseHeader(e):null}}const gI={maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:null,errorRetry:null},yI=Be(Be({autoStartLoad:!0,startPosition:-1,defaultAudioCodec:void 0,debug:!1,capLevelOnFPSDrop:!1,capLevelToPlayerSize:!1,ignoreDevicePixelRatio:!1,maxDevicePixelRatio:Number.POSITIVE_INFINITY,preferManagedMediaSource:!0,initialLiveManifestSize:1,maxBufferLength:30,backBufferLength:1/0,frontBufferFlushThreshold:1/0,startOnSegmentBoundary:!1,maxBufferSize:60*1e3*1e3,maxFragLookUpTolerance:.25,maxBufferHole:.1,detectStallWithCurrentTimeMs:1250,highBufferWatchdogPeriod:2,nudgeOffset:.1,nudgeMaxRetry:3,nudgeOnVideoHole:!0,liveSyncMode:"edge",liveSyncDurationCount:3,liveSyncOnStallIncrease:1,liveMaxLatencyDurationCount:1/0,liveSyncDuration:void 0,liveMaxLatencyDuration:void 0,maxLiveSyncPlaybackRate:1,liveDurationInfinity:!1,liveBackBufferLength:null,maxMaxBufferLength:600,enableWorker:!0,workerPath:null,enableSoftwareAES:!0,startLevel:void 0,startFragPrefetch:!1,fpsDroppedMonitoringPeriod:5e3,fpsDroppedMonitoringThreshold:.2,appendErrorMaxRetry:3,ignorePlaylistParsingErrors:!1,loader:py,fLoader:void 0,pLoader:void 0,xhrSetup:void 0,licenseXhrSetup:void 0,licenseResponseCallback:void 0,abrController:BL,bufferController:_R,capLevelController:Td,errorController:HL,fpsController:x1,stretchShortVideoTrack:!1,maxAudioFramesDrift:1,forceKeyFrameOnDiscontinuity:!0,abrEwmaFastLive:3,abrEwmaSlowLive:9,abrEwmaFastVoD:3,abrEwmaSlowVoD:9,abrEwmaDefaultEstimate:5e5,abrEwmaDefaultEstimateMax:5e6,abrBandWidthFactor:.95,abrBandWidthUpFactor:.7,abrMaxWithRealBitrate:!1,maxStarvationDelay:4,maxLoadingDelay:4,minAutoBitrate:0,emeEnabled:!1,widevineLicenseUrl:void 0,drmSystems:{},drmSystemOptions:{},requestMediaKeySystemAccessFunc:E0,requireKeySystemAccessOnStart:!1,testBandwidth:!0,progressive:!1,lowLatencyMode:!0,cmcd:void 0,enableDateRangeMetadataCues:!0,enableEmsgMetadataCues:!0,enableEmsgKLVMetadata:!1,enableID3MetadataCues:!0,enableInterstitialPlayback:!0,interstitialAppendInPlace:!0,interstitialLiveLookAhead:10,useMediaCapabilities:!0,preserveManualLevelOnError:!1,certLoadPolicy:{default:gI},keyLoadPolicy:{default:{maxTimeToFirstByteMs:8e3,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"},errorRetry:{maxNumRetry:8,retryDelayMs:1e3,maxRetryDelayMs:2e4,backoff:"linear"}}},manifestLoadPolicy:{default:{maxTimeToFirstByteMs:1/0,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},playlistLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:2,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},fragLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:12e4,timeoutRetry:{maxNumRetry:4,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:6,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},steeringManifestLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:2e4,timeoutRetry:{maxNumRetry:2,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:1,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},interstitialAssetListLoadPolicy:{default:{maxTimeToFirstByteMs:1e4,maxLoadTimeMs:3e4,timeoutRetry:{maxNumRetry:0,retryDelayMs:0,maxRetryDelayMs:0},errorRetry:{maxNumRetry:0,retryDelayMs:1e3,maxRetryDelayMs:8e3}}},manifestLoadingTimeOut:1e4,manifestLoadingMaxRetry:1,manifestLoadingRetryDelay:1e3,manifestLoadingMaxRetryTimeout:64e3,levelLoadingTimeOut:1e4,levelLoadingMaxRetry:4,levelLoadingRetryDelay:1e3,levelLoadingMaxRetryTimeout:64e3,fragLoadingTimeOut:2e4,fragLoadingMaxRetry:6,fragLoadingRetryDelay:1e3,fragLoadingMaxRetryTimeout:64e3},vI()),{},{subtitleStreamController:D1,subtitleTrackController:L1,timelineController:sI,audioStreamController:AR,audioTrackController:RR,emeController:Rs,cmcdController:y1,contentSteeringController:E1,interstitialsController:k1});function vI(){return{cueHandler:oI,enableWebVTT:!0,enableIMSC1:!0,enableCEA708Captions:!0,captionsTextTrack1Label:"English",captionsTextTrack1LanguageCode:"en",captionsTextTrack2Label:"Spanish",captionsTextTrack2LanguageCode:"es",captionsTextTrack3Label:"Unknown CC",captionsTextTrack3LanguageCode:"",captionsTextTrack4Label:"Unknown CC",captionsTextTrack4LanguageCode:"",renderTextTracksNatively:!0}}function EI(i,e,t){if((e.liveSyncDurationCount||e.liveMaxLatencyDurationCount)&&(e.liveSyncDuration||e.liveMaxLatencyDuration))throw new Error("Illegal hls.js config: don't mix up liveSyncDurationCount/liveMaxLatencyDurationCount and liveSyncDuration/liveMaxLatencyDuration");if(e.liveMaxLatencyDurationCount!==void 0&&(e.liveSyncDurationCount===void 0||e.liveMaxLatencyDurationCount<=e.liveSyncDurationCount))throw new Error('Illegal hls.js config: "liveMaxLatencyDurationCount" must be greater than "liveSyncDurationCount"');if(e.liveMaxLatencyDuration!==void 0&&(e.liveSyncDuration===void 0||e.liveMaxLatencyDuration<=e.liveSyncDuration))throw new Error('Illegal hls.js config: "liveMaxLatencyDuration" must be greater than "liveSyncDuration"');const n=zc(i),r=["manifest","level","frag"],a=["TimeOut","MaxRetry","RetryDelay","MaxRetryTimeout"];return r.forEach(l=>{const u=`${l==="level"?"playlist":l}LoadPolicy`,f=e[u]===void 0,c=[];a.forEach(h=>{const m=`${l}Loading${h}`,g=e[m];if(g!==void 0&&f){c.push(m);const E=n[u].default;switch(e[u]={default:E},h){case"TimeOut":E.maxLoadTimeMs=g,E.maxTimeToFirstByteMs=g;break;case"MaxRetry":E.errorRetry.maxNumRetry=g,E.timeoutRetry.maxNumRetry=g;break;case"RetryDelay":E.errorRetry.retryDelayMs=g,E.timeoutRetry.retryDelayMs=g;break;case"MaxRetryTimeout":E.errorRetry.maxRetryDelayMs=g,E.timeoutRetry.maxRetryDelayMs=g;break}}}),c.length&&t.warn(`hls.js config: "${c.join('", "')}" setting(s) are deprecated, use "${u}": ${Ke(e[u])}`)}),Be(Be({},n),e)}function zc(i){return i&&typeof i=="object"?Array.isArray(i)?i.map(zc):Object.keys(i).reduce((e,t)=>(e[t]=zc(i[t]),e),{}):i}function xI(i,e){const t=i.loader;t!==tg&&t!==py?(e.log("[config]: Custom loader detected, cannot enable progressive streaming"),i.progressive=!1):lI()&&(i.loader=tg,i.progressive=!0,i.enableSoftwareAES=!0,e.log("[config]: Progressive streaming enabled, using FetchLoader"))}const Ro=2,SI=.1,TI=.05,LI=100;class AI extends p0{constructor(e,t){super("gap-controller",e.logger),this.hls=null,this.fragmentTracker=null,this.media=null,this.mediaSource=void 0,this.nudgeRetry=0,this.stallReported=!1,this.stalled=null,this.moved=!1,this.seeking=!1,this.buffered={},this.lastCurrentTime=0,this.ended=0,this.waiting=0,this.onMediaPlaying=()=>{this.ended=0,this.waiting=0},this.onMediaWaiting=()=>{var n;(n=this.media)!=null&&n.seeking||(this.waiting=self.performance.now(),this.tick())},this.onMediaEnded=()=>{if(this.hls){var n;this.ended=((n=this.media)==null?void 0:n.currentTime)||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1})}},this.hls=e,this.fragmentTracker=t,this.registerListeners()}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.BUFFER_APPENDED,this.onBufferAppended,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.BUFFER_APPENDED,this.onBufferAppended,this))}destroy(){super.destroy(),this.unregisterListeners(),this.media=this.hls=this.fragmentTracker=null,this.mediaSource=void 0}onMediaAttached(e,t){this.setInterval(LI),this.mediaSource=t.mediaSource;const n=this.media=t.media;Zt(n,"playing",this.onMediaPlaying),Zt(n,"waiting",this.onMediaWaiting),Zt(n,"ended",this.onMediaEnded)}onMediaDetaching(e,t){this.clearInterval();const{media:n}=this;n&&(mn(n,"playing",this.onMediaPlaying),mn(n,"waiting",this.onMediaWaiting),mn(n,"ended",this.onMediaEnded),this.media=null),this.mediaSource=void 0}onBufferAppended(e,t){this.buffered=t.timeRanges}get hasBuffered(){return Object.keys(this.buffered).length>0}tick(){var e;if(!((e=this.media)!=null&&e.readyState)||!this.hasBuffered)return;const t=this.media.currentTime;this.poll(t,this.lastCurrentTime),this.lastCurrentTime=t}poll(e,t){var n,r;const a=(n=this.hls)==null?void 0:n.config;if(!a)return;const l=this.media;if(!l)return;const{seeking:u}=l,f=this.seeking&&!u,c=!this.seeking&&u,h=l.paused&&!u||l.ended||l.playbackRate===0;if(this.seeking=u,e!==t){t&&(this.ended=0),this.moved=!0,u||(this.nudgeRetry=0,a.nudgeOnVideoHole&&!h&&e>t&&this.nudgeOnVideoHole(e,t)),this.waiting===0&&this.stallResolved(e);return}if(c||f){f&&this.stallResolved(e);return}if(h){this.nudgeRetry=0,this.stallResolved(e),!this.ended&&l.ended&&this.hls&&(this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!1}));return}if(!Ie.getBuffered(l).length){this.nudgeRetry=0;return}const m=Ie.bufferInfo(l,e,0),g=m.nextStart||0,E=this.fragmentTracker;if(u&&E&&this.hls){const G=ng(this.hls.inFlightFragments,e),D=m.len>Ro,M=!g||G||g-e>Ro&&!E.getPartialFragment(e);if(D||M)return;this.moved=!1}const y=(r=this.hls)==null?void 0:r.latestLevelDetails;if(!this.moved&&this.stalled!==null&&E){if(!(m.len>0)&&!g)return;const D=Math.max(g,m.start||0)-e,B=!!(y!=null&&y.live)?y.targetduration*2:Ro,O=E.getPartialFragment(e);if(D>0&&(D<=B||O)){l.paused||this._trySkipBufferHole(O);return}}const T=a.detectStallWithCurrentTimeMs,S=self.performance.now(),A=this.waiting;let w=this.stalled;if(w===null)if(A>0&&S-A<T)w=this.stalled=A;else{this.stalled=S;return}const I=S-w;if(!u&&(I>=T||A)&&this.hls){var b;if(((b=this.mediaSource)==null?void 0:b.readyState)==="ended"&&!(y!=null&&y.live)&&Math.abs(e-((y==null?void 0:y.edge)||0))<1){if(this.ended)return;this.ended=e||1,this.hls.trigger(L.MEDIA_ENDED,{stalled:!0});return}if(this._reportStall(m),!this.media||!this.hls)return}const P=Ie.bufferInfo(l,e,a.maxBufferHole);this._tryFixBufferStall(P,I,e)}stallResolved(e){const t=this.stalled;if(t&&this.hls&&(this.stalled=null,this.stallReported)){const n=self.performance.now()-t;this.log(`playback not stuck anymore @${e}, after ${Math.round(n)}ms`),this.stallReported=!1,this.waiting=0,this.hls.trigger(L.STALL_RESOLVED,{})}}nudgeOnVideoHole(e,t){var n;const r=this.buffered.video;if(this.hls&&this.media&&this.fragmentTracker&&(n=this.buffered.audio)!=null&&n.length&&r&&r.length>1&&e>r.end(0)){const a=Ie.bufferedInfo(Ie.timeRangesToArray(this.buffered.audio),e,0);if(a.len>1&&t>=a.start){const l=Ie.timeRangesToArray(r),u=Ie.bufferedInfo(l,t,0).bufferedIndex;if(u>-1&&u<l.length-1){const f=Ie.bufferedInfo(l,e,0).bufferedIndex,c=l[u].end,h=l[u+1].start;if((f===-1||f>u)&&h-c<1&&e-c<2){const m=new Error(`nudging playhead to flush pipeline after video hole. currentTime: ${e} hole: ${c} -> ${h} buffered index: ${f}`);this.warn(m.message),this.media.currentTime+=1e-6;const g=this.fragmentTracker.getPartialFragment(e)||void 0,E=Ie.bufferInfo(this.media,e,0);this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:m,reason:m.message,frag:g,buffer:E.len,bufferInfo:E})}}}}}_tryFixBufferStall(e,t,n){var r,a;const{fragmentTracker:l,media:u}=this,f=(r=this.hls)==null?void 0:r.config;if(!u||!l||!f)return;const c=(a=this.hls)==null?void 0:a.latestLevelDetails,h=l.getPartialFragment(n);if((h||c!=null&&c.live&&n<c.fragmentStart)&&(this._trySkipBufferHole(h)||!this.media))return;const m=e.buffered,g=this.adjacentTraversal(e,n);(m&&m.length>1&&e.len>f.maxBufferHole||e.nextStart&&(e.nextStart-n<f.maxBufferHole||g))&&(t>f.highBufferWatchdogPeriod*1e3||this.waiting)&&(this.warn("Trying to nudge playhead over buffer-hole"),this._tryNudgeBuffer(e))}adjacentTraversal(e,t){const n=this.fragmentTracker,r=e.nextStart;if(n&&r){const a=n.getFragAtPos(t,pe.MAIN),l=n.getFragAtPos(r,pe.MAIN);if(a&&l)return l.sn-a.sn<2}return!1}_reportStall(e){const{hls:t,media:n,stallReported:r,stalled:a}=this;if(!r&&a!==null&&n&&t){this.stallReported=!0;const l=new Error(`Playback stalling at @${n.currentTime} due to low buffer (${Ke(e)})`);this.warn(l.message),t.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_STALLED_ERROR,fatal:!1,error:l,buffer:e.len,bufferInfo:e,stalled:{start:a}})}}_trySkipBufferHole(e){var t;const{fragmentTracker:n,media:r}=this,a=(t=this.hls)==null?void 0:t.config;if(!r||!n||!a)return 0;const l=r.currentTime,u=Ie.bufferInfo(r,l,0),f=l<u.start?u.start:u.nextStart;if(f&&this.hls){const h=u.len<=a.maxBufferHole,m=u.len>0&&u.len<1&&r.readyState<3,g=f-l;if(g>0&&(h||m)){if(g>a.maxBufferHole){let y=!1;if(l===0){const T=n.getAppendedFrag(0,pe.MAIN);T&&f<T.end&&(y=!0)}if(!y){const T=e||n.getAppendedFrag(l,pe.MAIN);if(T){var c;if(!((c=this.hls.loadLevelObj)!=null&&c.details)||ng(this.hls.inFlightFragments,f))return 0;let A=!1,w=T.end;for(;w<f;){const I=n.getAppendedFrag(w,pe.MAIN)||n.getPartialFragment(w);if(I)w+=I.duration;else{A=!0;break}}if(A)return 0}}}const E=Math.max(f+TI,l+SI);if(this.warn(`skipping hole, adjusting currentTime from ${l} to ${E}`),this.moved=!0,r.currentTime=E,!(e!=null&&e.gap)){const y=new Error(`fragment loaded with buffer holes, seeking from ${l} to ${E}`);this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_SEEK_OVER_HOLE,fatal:!1,error:y,reason:y.message,frag:e||void 0,buffer:u.len,bufferInfo:u})}return E}}return 0}_tryNudgeBuffer(e){const{hls:t,media:n,nudgeRetry:r}=this,a=t==null?void 0:t.config;if(!n||!a)return 0;const l=n.currentTime;if(this.nudgeRetry++,r<a.nudgeMaxRetry){const u=l+(r+1)*a.nudgeOffset,f=new Error(`Nudging 'currentTime' from ${l} to ${u}`);this.warn(f.message),n.currentTime=u,t.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_NUDGE_ON_STALL,error:f,fatal:!1,buffer:e.len,bufferInfo:e})}else{const u=new Error(`Playhead still not moving while enough data buffered @${l} after ${a.nudgeMaxRetry} nudges`);this.error(u.message),t.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.BUFFER_STALLED_ERROR,error:u,fatal:!0,buffer:e.len,bufferInfo:e})}}}function ng(i,e){const t=rg(i.main);if(t&&t.start<=e)return t;const n=rg(i.audio);return n&&n.start<=e?n:null}function rg(i){if(!i)return null;switch(i.state){case Q.IDLE:case Q.STOPPED:case Q.ENDED:case Q.ERROR:return null}return i.frag}const RI=.25;function Wc(){if(!(typeof self>"u"))return self.VTTCue||self.TextTrackCue}function sg(i,e,t,n,r){let a=new i(e,t,"");try{a.value=n,r&&(a.type=r)}catch{a=new i(e,t,Ke(r?Be({type:r},n):n))}return a}const fo=(()=>{const i=Wc();try{i&&new i(0,Number.POSITIVE_INFINITY,"")}catch{return Number.MAX_VALUE}return Number.POSITIVE_INFINITY})();class II{constructor(e){this.hls=void 0,this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.removeCues=!0,this.onEventCueEnter=()=>{this.hls&&this.hls.trigger(L.EVENT_CUE_ENTER,{})},this.hls=e,this._registerListeners()}destroy(){this._unregisterListeners(),this.id3Track=null,this.media=null,this.dateRangeCuesAppended={},this.hls=this.onEventCueEnter=null}_registerListeners(){const{hls:e}=this;e.on(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.on(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MEDIA_ATTACHING,this.onMediaAttaching,this),e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.FRAG_PARSING_METADATA,this.onFragParsingMetadata,this),e.off(L.BUFFER_FLUSHING,this.onBufferFlushing,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.LEVEL_PTS_UPDATED,this.onLevelPtsUpdated,this)}onMediaAttaching(e,t){var n;this.media=t.media,((n=t.overrides)==null?void 0:n.cueRemoval)===!1&&(this.removeCues=!1)}onMediaAttached(){const e=this.hls.latestLevelDetails;e&&this.updateDateRangeCues(e)}onMediaDetaching(e,t){this.media=null,!t.transferMedia&&(this.id3Track&&(this.removeCues&&Ts(this.id3Track,this.onEventCueEnter),this.id3Track=null),this.dateRangeCuesAppended={})}onManifestLoading(){this.dateRangeCuesAppended={}}createTrack(e){const t=this.getID3Track(e.textTracks);return t.mode="hidden",t}getID3Track(e){if(this.media){for(let t=0;t<e.length;t++){const n=e[t];if(n.kind==="metadata"&&n.label==="id3")return ry(n,this.media),n}return this.media.addTextTrack("metadata","id3")}}onFragParsingMetadata(e,t){if(!this.media)return;const{hls:{config:{enableEmsgMetadataCues:n,enableID3MetadataCues:r}}}=this;if(!n&&!r)return;const{samples:a}=t;this.id3Track||(this.id3Track=this.createTrack(this.media));const l=Wc();if(l)for(let u=0;u<a.length;u++){const f=a[u].type;if(f===Gt.emsg&&!n||!r)continue;const c=F0(a[u].data);if(c){const h=a[u].pts;let m=h+a[u].duration;m>fo&&(m=fo),m-h<=0&&(m=h+RI);for(let E=0;E<c.length;E++){const y=c[E];if(!M0(y)){this.updateId3CueEnds(h,f);const T=sg(l,h,m,y,f);T&&this.id3Track.addCue(T)}}}}}updateId3CueEnds(e,t){var n;const r=(n=this.id3Track)==null?void 0:n.cues;if(r)for(let a=r.length;a--;){const l=r[a];l.type===t&&l.startTime<e&&l.endTime===fo&&(l.endTime=e)}}onBufferFlushing(e,{startOffset:t,endOffset:n,type:r}){const{id3Track:a,hls:l}=this;if(!l)return;const{config:{enableEmsgMetadataCues:u,enableID3MetadataCues:f}}=l;if(a&&(u||f)){let c;r==="audio"?c=h=>h.type===Gt.audioId3&&f:r==="video"?c=h=>h.type===Gt.emsg&&u:c=h=>h.type===Gt.audioId3&&f||h.type===Gt.emsg&&u,Hc(a,t,n,c)}}onLevelUpdated(e,{details:t}){this.updateDateRangeCues(t,!0)}onLevelPtsUpdated(e,t){Math.abs(t.drift)>.01&&this.updateDateRangeCues(t.details)}updateDateRangeCues(e,t){if(!this.media||!e.hasProgramDateTime||!this.hls.config.enableDateRangeMetadataCues)return;const{id3Track:n}=this,{dateRanges:r}=e,a=Object.keys(r);let l=this.dateRangeCuesAppended;if(n&&t){var u;if((u=n.cues)!=null&&u.length){const h=Object.keys(l).filter(m=>!a.includes(m));for(let m=h.length;m--;){const g=h[m],E=l[g].cues;delete l[g],Object.keys(E).forEach(y=>{try{const T=E[y];T.removeEventListener("enter",this.onEventCueEnter),n.removeCue(T)}catch{}})}}else l=this.dateRangeCuesAppended={}}const f=e.fragments[e.fragments.length-1];if(a.length===0||!ce(f==null?void 0:f.programDateTime))return;this.id3Track||(this.id3Track=this.createTrack(this.media));const c=Wc();for(let h=0;h<a.length;h++){const m=a[h],g=r[m],E=g.startTime,y=l[m],T=(y==null?void 0:y.cues)||{};let S=(y==null?void 0:y.durationKnown)||!1,A=fo;const{duration:w,endDate:I}=g;if(I&&w!==null)A=E+w,S=!0;else if(g.endOnNext&&!S){const P=a.reduce((G,D)=>{if(D!==g.id){const M=r[D];if(M.class===g.class&&M.startDate>g.startDate&&(!G||g.startDate<G.startDate))return M}return G},null);P&&(A=P.startTime,S=!0)}const b=Object.keys(g.attr);for(let P=0;P<b.length;P++){const G=b[P];if(!rA(G))continue;const D=T[G];if(D)S&&!y.durationKnown?D.endTime=A:Math.abs(D.startTime-E)>.01&&(D.startTime=E,D.endTime=A);else if(c){let M=g.attr[G];sA(G)&&(M=Zg(M));const O=sg(c,E,A,{key:G,data:M},Gt.dateRange);O&&(O.id=m,this.id3Track.addCue(O),T[G]=O,this.hls.config.interstitialsController&&(G==="X-ASSET-LIST"||G==="X-ASSET-URL")&&O.addEventListener("enter",this.onEventCueEnter))}}l[m]={cues:T,dateRange:g,durationKnown:S}}}}class wI{constructor(e){this.hls=void 0,this.config=void 0,this.media=null,this.currentTime=0,this.stallCount=0,this._latency=null,this._targetLatencyUpdated=!1,this.onTimeupdate=()=>{const{media:t}=this,n=this.levelDetails;if(!t||!n)return;this.currentTime=t.currentTime;const r=this.computeLatency();if(r===null)return;this._latency=r;const{lowLatencyMode:a,maxLiveSyncPlaybackRate:l}=this.config;if(!a||l===1||!n.live)return;const u=this.targetLatency;if(u===null)return;const f=r-u,c=Math.min(this.maxLatency,u+n.targetduration);if(f<c&&f>.05&&this.forwardBufferLength>1){const m=Math.min(2,Math.max(1,l)),g=Math.round(2/(1+Math.exp(-.75*f-this.edgeStalled))*20)/20,E=Math.min(m,Math.max(1,g));this.changeMediaPlaybackRate(t,E)}else t.playbackRate!==1&&t.playbackRate!==0&&this.changeMediaPlaybackRate(t,1)},this.hls=e,this.config=e.config,this.registerListeners()}get levelDetails(){var e;return((e=this.hls)==null?void 0:e.latestLevelDetails)||null}get latency(){return this._latency||0}get maxLatency(){const{config:e}=this;if(e.liveMaxLatencyDuration!==void 0)return e.liveMaxLatencyDuration;const t=this.levelDetails;return t?e.liveMaxLatencyDurationCount*t.targetduration:0}get targetLatency(){const e=this.levelDetails;if(e===null||this.hls===null)return null;const{holdBack:t,partHoldBack:n,targetduration:r}=e,{liveSyncDuration:a,liveSyncDurationCount:l,lowLatencyMode:u}=this.config,f=this.hls.userConfig;let c=u&&n||t;(this._targetLatencyUpdated||f.liveSyncDuration||f.liveSyncDurationCount||c===0)&&(c=a!==void 0?a:l*r);const h=r;return c+Math.min(this.stallCount*this.config.liveSyncOnStallIncrease,h)}set targetLatency(e){this.stallCount=0,this.config.liveSyncDuration=e,this._targetLatencyUpdated=!0}get liveSyncPosition(){const e=this.estimateLiveEdge(),t=this.targetLatency;if(e===null||t===null)return null;const n=this.levelDetails;if(n===null)return null;const r=n.edge,a=e-t-this.edgeStalled,l=r-n.totalduration,u=r-(this.config.lowLatencyMode&&n.partTarget||n.targetduration);return Math.min(Math.max(l,a),u)}get drift(){const e=this.levelDetails;return e===null?1:e.drift}get edgeStalled(){const e=this.levelDetails;if(e===null)return 0;const t=(this.config.lowLatencyMode&&e.partTarget||e.targetduration)*3;return Math.max(e.age-t,0)}get forwardBufferLength(){const{media:e}=this,t=this.levelDetails;if(!e||!t)return 0;const n=e.buffered.length;return(n?e.buffered.end(n-1):t.edge)-this.currentTime}destroy(){this.unregisterListeners(),this.onMediaDetaching(),this.hls=null}registerListeners(){const{hls:e}=this;e&&(e.on(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.on(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.on(L.ERROR,this.onError,this))}unregisterListeners(){const{hls:e}=this;e&&(e.off(L.MEDIA_ATTACHED,this.onMediaAttached,this),e.off(L.MEDIA_DETACHING,this.onMediaDetaching,this),e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_UPDATED,this.onLevelUpdated,this),e.off(L.ERROR,this.onError,this))}onMediaAttached(e,t){this.media=t.media,this.media.addEventListener("timeupdate",this.onTimeupdate)}onMediaDetaching(){this.media&&(this.media.removeEventListener("timeupdate",this.onTimeupdate),this.media=null)}onManifestLoading(){this._latency=null,this.stallCount=0}onLevelUpdated(e,{details:t}){t.advanced&&this.onTimeupdate(),!t.live&&this.media&&this.media.removeEventListener("timeupdate",this.onTimeupdate)}onError(e,t){var n;t.details===H.BUFFER_STALLED_ERROR&&(this.stallCount++,this.hls&&(n=this.levelDetails)!=null&&n.live&&this.hls.logger.warn("[latency-controller]: Stall detected, adjusting target latency"))}changeMediaPlaybackRate(e,t){var n,r;e.playbackRate!==t&&((n=this.hls)==null||n.logger.debug(`[latency-controller]: latency=${this.latency.toFixed(3)}, targetLatency=${(r=this.targetLatency)==null?void 0:r.toFixed(3)}, forwardBufferLength=${this.forwardBufferLength.toFixed(3)}: adjusting playback rate from ${e.playbackRate} to ${t}`),e.playbackRate=t)}estimateLiveEdge(){const e=this.levelDetails;return e===null?null:e.edge+e.age}computeLatency(){const e=this.estimateLiveEdge();return e===null?null:e-this.currentTime}}class _I extends Sd{constructor(e,t){super(e,"level-controller"),this._levels=[],this._firstLevel=-1,this._maxAutoLevel=-1,this._startLevel=void 0,this.currentLevel=null,this.currentLevelIndex=-1,this.manualLevelIndex=-1,this.steering=void 0,this.onParsedComplete=void 0,this.steering=t,this._registerListeners()}_registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this),e.on(L.ERROR,this.onError,this)}_unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.MANIFEST_LOADED,this.onManifestLoaded,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this),e.off(L.ERROR,this.onError,this)}destroy(){this._unregisterListeners(),this.steering=null,this.resetLevels(),super.destroy()}stopLoad(){this._levels.forEach(t=>{t.loadError=0,t.fragmentError=0}),super.stopLoad()}resetLevels(){this._startLevel=void 0,this.manualLevelIndex=-1,this.currentLevelIndex=-1,this.currentLevel=null,this._levels=[],this._maxAutoLevel=-1}onManifestLoading(e,t){this.resetLevels()}onManifestLoaded(e,t){const n=this.hls.config.preferManagedMediaSource,r=[],a={},l={};let u=!1,f=!1,c=!1;t.levels.forEach(h=>{const m=h.attrs;let{audioCodec:g,videoCodec:E}=h;g&&(h.audioCodec=g=ko(g,n)||void 0),E&&(E=h.videoCodec=TL(E));const{width:y,height:T,unknownCodecs:S}=h;let A=S?S.length:0;if(S)for(let O=A;O--;){const X=S[O];this.isAudioSupported(X)?(h.audioCodec=g=g?`${g},${X}`:X,A--,ws.audio[g.substring(0,4)]=2):this.isVideoSupported(X)&&(h.videoCodec=E=E?`${E},${X}`:X,A--,ws.video[E.substring(0,4)]=2)}if(u||(u=!!(y&&T)),f||(f=!!E),c||(c=!!g),A||g&&!this.isAudioSupported(g)||E&&!this.isVideoSupported(E)){this.log(`Some or all CODECS not supported "${m.CODECS}"`);return}const{CODECS:w,"FRAME-RATE":I,"HDCP-LEVEL":b,"PATHWAY-ID":P,RESOLUTION:G,"VIDEO-RANGE":D}=m,B=`${`${P||"."}-`}${h.bitrate}-${G}-${I}-${w}-${D}-${b}`;if(a[B])if(a[B].uri!==h.url&&!h.attrs["PATHWAY-ID"]){const O=l[B]+=1;h.attrs["PATHWAY-ID"]=new Array(O+1).join(".");const X=this.createLevel(h);a[B]=X,r.push(X)}else a[B].addGroupId("audio",m.AUDIO),a[B].addGroupId("text",m.SUBTITLES);else{const O=this.createLevel(h);a[B]=O,l[B]=1,r.push(O)}}),this.filterAndSortMediaOptions(r,t,u,f,c)}createLevel(e){const t=new Di(e),n=e.supplemental;if(n!=null&&n.videoCodec&&!this.isVideoSupported(n.videoCodec)){const r=new Error(`SUPPLEMENTAL-CODECS not supported "${n.videoCodec}"`);this.log(r.message),t.supportedResult=u0(r,[])}return t}isAudioSupported(e){return kc(e,"audio",this.hls.config.preferManagedMediaSource)}isVideoSupported(e){return kc(e,"video",this.hls.config.preferManagedMediaSource)}filterAndSortMediaOptions(e,t,n,r,a){let l=[],u=[],f=e;if((n||r)&&a&&(f=f.filter(({videoCodec:S,videoRange:A,width:w,height:I})=>(!!S||!!(w&&I))&&CL(A))),f.length===0){Promise.resolve().then(()=>{if(this.hls){let S="no level with compatible codecs found in manifest",A=S;t.levels.length&&(A=`one or more CODECS in variant not supported: ${Ke(t.levels.map(I=>I.attrs.CODECS).filter((I,b,P)=>P.indexOf(I)===b))}`,this.warn(A),S+=` (${A})`);const w=new Error(S);this.hls.trigger(L.ERROR,{type:xe.MEDIA_ERROR,details:H.MANIFEST_INCOMPATIBLE_CODECS_ERROR,fatal:!0,url:t.url,error:w,reason:A})}});return}t.audioTracks&&(l=t.audioTracks.filter(S=>!S.audioCodec||this.isAudioSupported(S.audioCodec)),ig(l)),t.subtitles&&(u=t.subtitles,ig(u));const c=f.slice(0);f.sort((S,A)=>{if(S.attrs["HDCP-LEVEL"]!==A.attrs["HDCP-LEVEL"])return(S.attrs["HDCP-LEVEL"]||"")>(A.attrs["HDCP-LEVEL"]||"")?1:-1;if(n&&S.height!==A.height)return S.height-A.height;if(S.frameRate!==A.frameRate)return S.frameRate-A.frameRate;if(S.videoRange!==A.videoRange)return Do.indexOf(S.videoRange)-Do.indexOf(A.videoRange);if(S.videoCodec!==A.videoCodec){const w=Qm(S.videoCodec),I=Qm(A.videoCodec);if(w!==I)return I-w}if(S.uri===A.uri&&S.codecSet!==A.codecSet){const w=Co(S.codecSet),I=Co(A.codecSet);if(w!==I)return I-w}return S.averageBitrate!==A.averageBitrate?S.averageBitrate-A.averageBitrate:0});let h=c[0];if(this.steering&&(f=this.steering.filterParsedLevels(f),f.length!==c.length)){for(let S=0;S<c.length;S++)if(c[S].pathwayId===f[0].pathwayId){h=c[S];break}}this._levels=f;for(let S=0;S<f.length;S++)if(f[S]===h){var m;this._firstLevel=S;const A=h.bitrate,w=this.hls.bandwidthEstimate;if(this.log(`manifest loaded, ${f.length} level(s) found, first bitrate: ${A}`),((m=this.hls.userConfig)==null?void 0:m.abrEwmaDefaultEstimate)===void 0){const I=Math.min(A,this.hls.config.abrEwmaDefaultEstimateMax);I>w&&w===this.hls.abrEwmaDefaultEstimate&&(this.hls.bandwidthEstimate=I)}break}const g=a&&!r,E=this.hls.config,y=!!(E.audioStreamController&&E.audioTrackController),T={levels:f,audioTracks:l,subtitleTracks:u,sessionData:t.sessionData,sessionKeys:t.sessionKeys,firstLevel:this._firstLevel,stats:t.stats,audio:a,video:r,altAudio:y&&!g&&l.some(S=>!!S.url)};this.hls.trigger(L.MANIFEST_PARSED,T)}get levels(){return this._levels.length===0?null:this._levels}get loadLevelObj(){return this.currentLevel}get level(){return this.currentLevelIndex}set level(e){const t=this._levels;if(t.length===0)return;if(e<0||e>=t.length){const h=new Error("invalid level idx"),m=e<0;if(this.hls.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.LEVEL_SWITCH_ERROR,level:e,fatal:m,error:h,reason:h.message}),m)return;e=Math.min(e,t.length-1)}const n=this.currentLevelIndex,r=this.currentLevel,a=r?r.attrs["PATHWAY-ID"]:void 0,l=t[e],u=l.attrs["PATHWAY-ID"];if(this.currentLevelIndex=e,this.currentLevel=l,n===e&&r&&a===u)return;this.log(`Switching to level ${e} (${l.height?l.height+"p ":""}${l.videoRange?l.videoRange+" ":""}${l.codecSet?l.codecSet+" ":""}@${l.bitrate})${u?" with Pathway "+u:""} from level ${n}${a?" with Pathway "+a:""}`);const f={level:e,attrs:l.attrs,details:l.details,bitrate:l.bitrate,averageBitrate:l.averageBitrate,maxBitrate:l.maxBitrate,realBitrate:l.realBitrate,width:l.width,height:l.height,codecSet:l.codecSet,audioCodec:l.audioCodec,videoCodec:l.videoCodec,audioGroups:l.audioGroups,subtitleGroups:l.subtitleGroups,loaded:l.loaded,loadError:l.loadError,fragmentError:l.fragmentError,name:l.name,id:l.id,uri:l.uri,url:l.url,urlId:0,audioGroupIds:l.audioGroupIds,textGroupIds:l.textGroupIds};this.hls.trigger(L.LEVEL_SWITCHING,f);const c=l.details;if(!c||c.live){const h=this.switchParams(l.uri,r==null?void 0:r.details,c);this.loadPlaylist(h)}}get manualLevel(){return this.manualLevelIndex}set manualLevel(e){this.manualLevelIndex=e,this._startLevel===void 0&&(this._startLevel=e),e!==-1&&(this.level=e)}get firstLevel(){return this._firstLevel}set firstLevel(e){this._firstLevel=e}get startLevel(){if(this._startLevel===void 0){const e=this.hls.config.startLevel;return e!==void 0?e:this.hls.firstAutoLevel}return this._startLevel}set startLevel(e){this._startLevel=e}get pathways(){return this.steering?this.steering.pathways():[]}get pathwayPriority(){return this.steering?this.steering.pathwayPriority:null}set pathwayPriority(e){if(this.steering){const t=this.steering.pathways(),n=e.filter(r=>t.indexOf(r)!==-1);if(e.length<1){this.warn(`pathwayPriority ${e} should contain at least one pathway from list: ${t}`);return}this.steering.pathwayPriority=n}}onError(e,t){t.fatal||!t.context||t.context.type===De.LEVEL&&t.context.level===this.level&&this.checkRetry(t)}onFragBuffered(e,{frag:t}){if(t!==void 0&&t.type===pe.MAIN){const n=t.elementaryStreams;if(!Object.keys(n).some(a=>!!n[a]))return;const r=this._levels[t.level];r!=null&&r.loadError&&(this.log(`Resetting level error count of ${r.loadError} on frag buffered`),r.loadError=0)}}onLevelLoaded(e,t){var n;const{level:r,details:a}=t,l=t.levelInfo;if(!l){var u;this.warn(`Invalid level index ${r}`),(u=t.deliveryDirectives)!=null&&u.skip&&(a.deltaUpdateFailed=!0);return}if(l===this.currentLevel||t.withoutMultiVariant){l.fragmentError===0&&(l.loadError=0);let f=l.details;f===t.details&&f.advanced&&(f=void 0),this.playlistLoaded(r,t,f)}else(n=t.deliveryDirectives)!=null&&n.skip&&(a.deltaUpdateFailed=!0)}loadPlaylist(e){super.loadPlaylist(),this.shouldLoadPlaylist(this.currentLevel)&&this.scheduleLoading(this.currentLevel,e)}loadingPlaylist(e,t){super.loadingPlaylist(e,t);const n=this.getUrlWithDirectives(e.uri,t),r=this.currentLevelIndex,a=e.attrs["PATHWAY-ID"],l=e.details,u=l==null?void 0:l.age;this.log(`Loading level index ${r}${(t==null?void 0:t.msn)!==void 0?" at sn "+t.msn+" part "+t.part:""}${a?" Pathway "+a:""}${u&&l.live?" age "+u.toFixed(1)+(l.type&&" "+l.type||""):""} ${n}`),this.hls.trigger(L.LEVEL_LOADING,{url:n,level:r,levelInfo:e,pathwayId:e.attrs["PATHWAY-ID"],id:0,deliveryDirectives:t||null})}get nextLoadLevel(){return this.manualLevelIndex!==-1?this.manualLevelIndex:this.hls.nextAutoLevel}set nextLoadLevel(e){this.level=e,this.manualLevelIndex===-1&&(this.hls.nextAutoLevel=e)}removeLevel(e){var t;if(this._levels.length===1)return;const n=this._levels.filter((a,l)=>l!==e?!0:(this.steering&&this.steering.removeLevel(a),a===this.currentLevel&&(this.currentLevel=null,this.currentLevelIndex=-1,a.details&&a.details.fragments.forEach(u=>u.level=-1)),!1));I0(n),this._levels=n,this.currentLevelIndex>-1&&(t=this.currentLevel)!=null&&t.details&&(this.currentLevelIndex=this.currentLevel.details.fragments[0].level),this.manualLevelIndex>-1&&(this.manualLevelIndex=this.currentLevelIndex);const r=n.length-1;this._firstLevel=Math.min(this._firstLevel,r),this._startLevel&&(this._startLevel=Math.min(this._startLevel,r)),this.hls.trigger(L.LEVELS_UPDATED,{levels:n})}onLevelsUpdated(e,{levels:t}){this._levels=t}checkMaxAutoUpdated(){const{autoLevelCapping:e,maxAutoLevel:t,maxHdcpLevel:n}=this.hls;this._maxAutoLevel!==t&&(this._maxAutoLevel=t,this.hls.trigger(L.MAX_AUTO_LEVEL_UPDATED,{autoLevelCapping:e,levels:this.levels,maxAutoLevel:t,minAutoLevel:this.hls.minAutoLevel,maxHdcpLevel:n}))}}function ig(i){const e={};i.forEach(t=>{const n=t.groupId||"";t.id=e[n]=e[n]||0,e[n]++})}function gy(){return self.SourceBuffer||self.WebKitSourceBuffer}function yy(){if(!Er())return!1;const e=gy();return!e||e.prototype&&typeof e.prototype.appendBuffer=="function"&&typeof e.prototype.remove=="function"}function bI(){if(!yy())return!1;const i=Er();return typeof(i==null?void 0:i.isTypeSupported)=="function"&&(["avc1.42E01E,mp4a.40.2","av01.0.01M.08","vp09.00.50.08"].some(e=>i.isTypeSupported(ki(e,"video")))||["mp4a.40.2","fLaC"].some(e=>i.isTypeSupported(ki(e,"audio"))))}function CI(){var i;const e=gy();return typeof(e==null||(i=e.prototype)==null?void 0:i.changeType)=="function"}const kI=100;class DI extends hd{constructor(e,t,n){super(e,t,n,"stream-controller",pe.MAIN),this.audioCodecSwap=!1,this.level=-1,this._forceStartLoad=!1,this._hasEnoughToStart=!1,this.altAudio=0,this.audioOnly=!1,this.fragPlaying=null,this.fragLastKbps=0,this.couldBacktrack=!1,this.backtrackFragment=null,this.audioCodecSwitch=!1,this.videoBuffer=null,this.onMediaPlaying=()=>{this.tick()},this.onMediaSeeked=()=>{const r=this.media,a=r?r.currentTime:null;if(a===null||!ce(a)||(this.log(`Media seeked to ${a.toFixed(3)}`),!this.getBufferedFrag(a)))return;const l=this.getFwdBufferInfoAtPos(r,a,pe.MAIN,0);if(l===null||l.len===0){this.warn(`Main forward buffer length at ${a} on "seeked" event ${l?l.len:"empty"})`);return}this.tick()},this.registerListeners()}registerListeners(){super.registerListeners();const{hls:e}=this;e.on(L.MANIFEST_PARSED,this.onManifestParsed,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.LEVEL_LOADED,this.onLevelLoaded,this),e.on(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.on(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.on(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.on(L.BUFFER_CREATED,this.onBufferCreated,this),e.on(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.on(L.FRAG_BUFFERED,this.onFragBuffered,this)}unregisterListeners(){super.unregisterListeners();const{hls:e}=this;e.off(L.MANIFEST_PARSED,this.onManifestParsed,this),e.off(L.LEVEL_LOADED,this.onLevelLoaded,this),e.off(L.FRAG_LOAD_EMERGENCY_ABORTED,this.onFragLoadEmergencyAborted,this),e.off(L.AUDIO_TRACK_SWITCHING,this.onAudioTrackSwitching,this),e.off(L.AUDIO_TRACK_SWITCHED,this.onAudioTrackSwitched,this),e.off(L.BUFFER_CREATED,this.onBufferCreated,this),e.off(L.BUFFER_FLUSHED,this.onBufferFlushed,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this),e.off(L.FRAG_BUFFERED,this.onFragBuffered,this)}onHandlerDestroying(){this.onMediaPlaying=this.onMediaSeeked=null,this.unregisterListeners(),super.onHandlerDestroying()}startLoad(e,t){if(this.levels){const{lastCurrentTime:n,hls:r}=this;if(this.stopLoad(),this.setInterval(kI),this.level=-1,!this.startFragRequested){let a=r.startLevel;a===-1&&(r.config.testBandwidth&&this.levels.length>1?(a=0,this.bitrateTest=!0):a=r.firstAutoLevel),r.nextLoadLevel=a,this.level=r.loadLevel,this._hasEnoughToStart=!!t}n>0&&e===-1&&!t&&(this.log(`Override startPosition with lastCurrentTime @${n.toFixed(3)}`),e=n),this.state=Q.IDLE,this.nextLoadPosition=this.lastCurrentTime=e+this.timelineOffset,this.startPosition=t?-1:e,this.tick()}else this._forceStartLoad=!0,this.state=Q.STOPPED}stopLoad(){this._forceStartLoad=!1,super.stopLoad()}doTick(){switch(this.state){case Q.WAITING_LEVEL:{const{levels:t,level:n}=this,r=t==null?void 0:t[n],a=r==null?void 0:r.details;if(a&&(!a.live||this.levelLastLoaded===r&&!this.waitForLive(r))){if(this.waitForCdnTuneIn(a))break;this.state=Q.IDLE;break}else if(this.hls.nextLoadLevel!==this.level){this.state=Q.IDLE;break}break}case Q.FRAG_LOADING_WAITING_RETRY:{var e;const t=self.performance.now(),n=this.retryDate;if(!n||t>=n||(e=this.media)!=null&&e.seeking){const{levels:r,level:a}=this,l=r==null?void 0:r[a];this.resetStartWhenNotLoaded(l||null),this.state=Q.IDLE}}break}this.state===Q.IDLE&&this.doTickIdle(),this.onTickEnd()}onTickEnd(){var e;super.onTickEnd(),(e=this.media)!=null&&e.readyState&&this.media.seeking===!1&&(this.lastCurrentTime=this.media.currentTime),this.checkFragmentChanged()}doTickIdle(){const{hls:e,levelLastLoaded:t,levels:n,media:r}=this;if(t===null||!r&&!this.primaryPrefetch&&(this.startFragRequested||!e.config.startFragPrefetch)||this.altAudio&&this.audioOnly)return;const a=this.buffering?e.nextLoadLevel:e.loadLevel;if(!(n!=null&&n[a]))return;const l=n[a],u=this.getMainFwdBufferInfo();if(u===null)return;const f=this.getLevelDetails();if(f&&this._streamEnded(u,f)){const T={};this.altAudio===2&&(T.type="video"),this.hls.trigger(L.BUFFER_EOS,T),this.state=Q.ENDED;return}if(!this.buffering)return;e.loadLevel!==a&&e.manualLevel===-1&&this.log(`Adapting to level ${a} from level ${this.level}`),this.level=e.nextLoadLevel=a;const c=l.details;if(!c||this.state===Q.WAITING_LEVEL||this.waitForLive(l)){this.level=a,this.state=Q.WAITING_LEVEL,this.startFragRequested=!1;return}const h=u.len,m=this.getMaxBufferLength(l.maxBitrate);if(h>=m)return;this.backtrackFragment&&this.backtrackFragment.start>u.end&&(this.backtrackFragment=null);const g=this.backtrackFragment?this.backtrackFragment.start:u.end;let E=this.getNextFragment(g,c);if(this.couldBacktrack&&!this.fragPrevious&&E&&st(E)&&this.fragmentTracker.getState(E)!==ot.OK){var y;const S=((y=this.backtrackFragment)!=null?y:E).sn-c.startSN,A=c.fragments[S-1];A&&E.cc===A.cc&&(E=A,this.fragmentTracker.removeFragment(A))}else this.backtrackFragment&&u.len&&(this.backtrackFragment=null);if(E&&this.isLoopLoading(E,g)){if(!E.gap){const S=this.audioOnly&&!this.altAudio?Ge.AUDIO:Ge.VIDEO,A=(S===Ge.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;A&&this.afterBufferFlushed(A,S,pe.MAIN)}E=this.getNextFragmentLoopLoading(E,c,u,pe.MAIN,m)}E&&(E.initSegment&&!E.initSegment.data&&!this.bitrateTest&&(E=E.initSegment),this.loadFragment(E,l,g))}loadFragment(e,t,n){const r=this.fragmentTracker.getState(e);r===ot.NOT_LOADED||r===ot.PARTIAL?st(e)?this.bitrateTest?(this.log(`Fragment ${e.sn} of level ${e.level} is being downloaded to test bitrate and will not be buffered`),this._loadBitrateTestFrag(e,t)):super.loadFragment(e,t,n):this._loadInitSegment(e,t):this.clearTrackerIfNeeded(e)}getBufferedFrag(e){return this.fragmentTracker.getBufferedFrag(e,pe.MAIN)}followingBufferedFrag(e){return e?this.getBufferedFrag(e.end+.5):null}immediateLevelSwitch(){this.abortCurrentFrag(),this.flushMainBuffer(0,Number.POSITIVE_INFINITY)}nextLevelSwitch(){const{levels:e,media:t}=this;if(t!=null&&t.readyState){let n;const r=this.getAppendedFrag(t.currentTime);r&&r.start>1&&this.flushMainBuffer(0,r.start-1);const a=this.getLevelDetails();if(a!=null&&a.live){const u=this.getMainFwdBufferInfo();if(!u||u.len<a.targetduration*2)return}if(!t.paused&&e){const u=this.hls.nextLoadLevel,f=e[u],c=this.fragLastKbps;c&&this.fragCurrent?n=this.fragCurrent.duration*f.maxBitrate/(1e3*c)+1:n=0}else n=0;const l=this.getBufferedFrag(t.currentTime+n);if(l){const u=this.followingBufferedFrag(l);if(u){this.abortCurrentFrag();const f=u.maxStartPTS?u.maxStartPTS:u.start,c=u.duration,h=Math.max(l.end,f+Math.min(Math.max(c-this.config.maxFragLookUpTolerance,c*(this.couldBacktrack?.5:.125)),c*(this.couldBacktrack?.75:.25)));this.flushMainBuffer(h,Number.POSITIVE_INFINITY)}}}}abortCurrentFrag(){const e=this.fragCurrent;switch(this.fragCurrent=null,this.backtrackFragment=null,e&&(e.abortRequests(),this.fragmentTracker.removeFragment(e)),this.state){case Q.KEY_LOADING:case Q.FRAG_LOADING:case Q.FRAG_LOADING_WAITING_RETRY:case Q.PARSING:case Q.PARSED:this.state=Q.IDLE;break}this.nextLoadPosition=this.getLoadPosition()}flushMainBuffer(e,t){super.flushMainBuffer(e,t,this.altAudio===2?"video":null)}onMediaAttached(e,t){super.onMediaAttached(e,t);const n=t.media;Zt(n,"playing",this.onMediaPlaying),Zt(n,"seeked",this.onMediaSeeked)}onMediaDetaching(e,t){const{media:n}=this;n&&(mn(n,"playing",this.onMediaPlaying),mn(n,"seeked",this.onMediaSeeked)),this.videoBuffer=null,this.fragPlaying=null,super.onMediaDetaching(e,t),!t.transferMedia&&(this._hasEnoughToStart=!1)}onManifestLoading(){super.onManifestLoading(),this.log("Trigger BUFFER_RESET"),this.hls.trigger(L.BUFFER_RESET,void 0),this.couldBacktrack=!1,this.fragLastKbps=0,this.fragPlaying=this.backtrackFragment=null,this.altAudio=0,this.audioOnly=!1}onManifestParsed(e,t){let n=!1,r=!1;t.levels.forEach(a=>{const l=a.audioCodec;l&&(n=n||l.indexOf("mp4a.40.2")!==-1,r=r||l.indexOf("mp4a.40.5")!==-1)}),this.audioCodecSwitch=n&&r&&!CI(),this.audioCodecSwitch&&this.log("Both AAC/HE-AAC audio found in levels; declaring level codec as HE-AAC"),this.levels=t.levels,this.startFragRequested=!1}onLevelLoading(e,t){const{levels:n}=this;if(!n||this.state!==Q.IDLE)return;const r=t.levelInfo;(!r.details||r.details.live&&(this.levelLastLoaded!==r||r.details.expired)||this.waitForCdnTuneIn(r.details))&&(this.state=Q.WAITING_LEVEL)}onLevelLoaded(e,t){var n;const{levels:r,startFragRequested:a}=this,l=t.level,u=t.details,f=u.totalduration;if(!r){this.warn(`Levels were reset while loading level ${l}`);return}this.log(`Level ${l} loaded [${u.startSN},${u.endSN}]${u.lastPartSn?`[part-${u.lastPartSn}-${u.lastPartIndex}]`:""}, cc [${u.startCC}, ${u.endCC}] duration:${f}`);const c=t.levelInfo,h=this.fragCurrent;h&&(this.state===Q.FRAG_LOADING||this.state===Q.FRAG_LOADING_WAITING_RETRY)&&h.level!==t.level&&h.loader&&this.abortCurrentFrag();let m=0;if(u.live||(n=c.details)!=null&&n.live){var g;if(this.checkLiveUpdate(u),u.deltaUpdateFailed)return;m=this.alignPlaylists(u,c.details,(g=this.levelLastLoaded)==null?void 0:g.details)}if(c.details=u,this.levelLastLoaded=c,a||this.setStartPosition(u,m),this.hls.trigger(L.LEVEL_UPDATED,{details:u,level:l}),this.state===Q.WAITING_LEVEL){if(this.waitForCdnTuneIn(u))return;this.state=Q.IDLE}a&&u.live&&this.synchronizeToLiveEdge(u),this.tick()}synchronizeToLiveEdge(e){const{config:t,media:n}=this;if(!n)return;const r=this.hls.liveSyncPosition,a=this.getLoadPosition(),l=e.fragmentStart,u=e.edge,f=a>=l-t.maxFragLookUpTolerance&&a<=u;if(r!==null&&n.duration>r&&(a<r||!f)){const h=t.liveMaxLatencyDuration!==void 0?t.liveMaxLatencyDuration:t.liveMaxLatencyDurationCount*e.targetduration;if((!f&&n.readyState<4||a<u-h)&&(this._hasEnoughToStart||(this.nextLoadPosition=r),n.readyState))if(this.warn(`Playback: ${a.toFixed(3)} is located too far from the end of live sliding playlist: ${u}, reset currentTime to : ${r.toFixed(3)}`),this.config.liveSyncMode==="buffered"){var c;const m=Ie.bufferInfo(n,r,0);if(!(m!=null&&(c=m.buffered)!=null&&c.length)){n.currentTime=r;return}if(m.start<=a){n.currentTime=r;return}const{nextStart:E}=Ie.bufferedInfo(m.buffered,a,0);E&&(n.currentTime=E)}else n.currentTime=r}}_handleFragmentLoadProgress(e){var t;const n=e.frag,{part:r,payload:a}=e,{levels:l}=this;if(!l){this.warn(`Levels were reset while fragment load was in progress. Fragment ${n.sn} of level ${n.level} will not be buffered`);return}const u=l[n.level];if(!u){this.warn(`Level ${n.level} not found on progress`);return}const f=u.details;if(!f){this.warn(`Dropping fragment ${n.sn} of level ${n.level} after level details were reset`),this.fragmentTracker.removeFragment(n);return}const c=u.videoCodec,h=f.PTSKnown||!f.live,m=(t=n.initSegment)==null?void 0:t.data,g=this._getAudioCodec(u),E=this.transmuxer=this.transmuxer||new Y0(this.hls,pe.MAIN,this._handleTransmuxComplete.bind(this),this._handleTransmuxerFlush.bind(this)),y=r?r.index:-1,T=y!==-1,S=new dd(n.level,n.sn,n.stats.chunkCount,a.byteLength,y,T),A=this.initPTS[n.cc];E.push(a,m,g,c,n,r,f.totalduration,h,S,A)}onAudioTrackSwitching(e,t){const n=this.hls,r=this.altAudio===2;if(Po(t.url,n))this.altAudio=1;else{if(this.mediaBuffer!==this.media){this.log("Switching on main audio, use media.buffered to schedule main fragment loading"),this.mediaBuffer=this.media;const l=this.fragCurrent;l&&(this.log("Switching to main audio track, cancel main fragment load"),l.abortRequests(),this.fragmentTracker.removeFragment(l)),this.resetTransmuxer(),this.resetLoadingState()}else this.audioOnly&&this.resetTransmuxer();if(r){this.fragmentTracker.removeAllFragments(),n.once(L.BUFFER_FLUSHED,()=>{var l;(l=this.hls)==null||l.trigger(L.AUDIO_TRACK_SWITCHED,t)}),n.trigger(L.BUFFER_FLUSHING,{startOffset:0,endOffset:Number.POSITIVE_INFINITY,type:null});return}n.trigger(L.AUDIO_TRACK_SWITCHED,t)}}onAudioTrackSwitched(e,t){const n=Po(t.url,this.hls);if(n){const r=this.videoBuffer;r&&this.mediaBuffer!==r&&(this.log("Switching on alternate audio, use video.buffered to schedule main fragment loading"),this.mediaBuffer=r)}this.altAudio=n?2:0,this.tick()}onBufferCreated(e,t){const n=t.tracks;let r,a,l=!1;for(const u in n){const f=n[u];if(f.id==="main"){if(a=u,r=f,u==="video"){const c=n[u];c&&(this.videoBuffer=c.buffer)}}else l=!0}l&&r?(this.log(`Alternate track found, use ${a}.buffered to schedule main fragment loading`),this.mediaBuffer=r.buffer):this.mediaBuffer=this.media}onFragBuffered(e,t){const{frag:n,part:r}=t,a=n.type===pe.MAIN;if(a){if(this.fragContextChanged(n)){this.warn(`Fragment ${n.sn}${r?" p: "+r.index:""} of level ${n.level} finished buffering, but was aborted. state: ${this.state}`),this.state===Q.PARSED&&(this.state=Q.IDLE);return}const u=r?r.stats:n.stats;this.fragLastKbps=Math.round(8*u.total/(u.buffering.end-u.loading.first)),st(n)&&(this.fragPrevious=n),this.fragBufferedComplete(n,r)}const l=this.media;l&&(!this._hasEnoughToStart&&Ie.getBuffered(l).length&&(this._hasEnoughToStart=!0,this.seekToStartPos()),a&&this.tick())}get hasEnoughToStart(){return this._hasEnoughToStart}onError(e,t){var n;if(t.fatal){this.state=Q.ERROR;return}switch(t.details){case H.FRAG_GAP:case H.FRAG_PARSING_ERROR:case H.FRAG_DECRYPT_ERROR:case H.FRAG_LOAD_ERROR:case H.FRAG_LOAD_TIMEOUT:case H.KEY_LOAD_ERROR:case H.KEY_LOAD_TIMEOUT:this.onFragmentOrKeyLoadError(pe.MAIN,t);break;case H.LEVEL_LOAD_ERROR:case H.LEVEL_LOAD_TIMEOUT:case H.LEVEL_PARSING_ERROR:!t.levelRetry&&this.state===Q.WAITING_LEVEL&&((n=t.context)==null?void 0:n.type)===De.LEVEL&&(this.state=Q.IDLE);break;case H.BUFFER_ADD_CODEC_ERROR:case H.BUFFER_APPEND_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.resetLoadingState();break;case H.BUFFER_FULL_ERROR:if(t.parent!=="main")return;this.reduceLengthAndFlushBuffer(t)&&this.flushMainBuffer(0,Number.POSITIVE_INFINITY);break;case H.INTERNAL_EXCEPTION:this.recoverWorkerError(t);break}}onFragLoadEmergencyAborted(){this.state=Q.IDLE,this._hasEnoughToStart||(this.startFragRequested=!1,this.nextLoadPosition=this.lastCurrentTime),this.tickImmediate()}onBufferFlushed(e,{type:t}){if(t!==Ge.AUDIO||!this.altAudio){const n=(t===Ge.VIDEO?this.videoBuffer:this.mediaBuffer)||this.media;n&&(this.afterBufferFlushed(n,t,pe.MAIN),this.tick())}}onLevelsUpdated(e,t){this.level>-1&&this.fragCurrent&&(this.level=this.fragCurrent.level,this.level===-1&&this.resetWhenMissingContext(this.fragCurrent)),this.levels=t.levels}swapAudioCodec(){this.audioCodecSwap=!this.audioCodecSwap}seekToStartPos(){const{media:e}=this;if(!e)return;const t=e.currentTime;let n=this.startPosition;if(n>=0&&t<n){if(e.seeking){this.log(`could not seek to ${n}, already seeking at ${t}`);return}const r=this.timelineOffset;r&&n&&(n+=r);const a=this.getLevelDetails(),l=Ie.getBuffered(e),u=l.length?l.start(0):0,f=u-n,c=Math.max(this.config.maxBufferHole,this.config.maxFragLookUpTolerance);(this.config.startOnSegmentBoundary||f>0&&(f<c||this.loadingParts&&f<2*((a==null?void 0:a.partTarget)||0)))&&(this.log(`adjusting start position by ${f} to match buffer start`),n+=f,this.startPosition=n),t<n&&(this.log(`seek to target start position ${n} from current time ${t} buffer start ${u}`),e.currentTime=n)}}_getAudioCodec(e){let t=this.config.defaultAudioCodec||e.audioCodec;return this.audioCodecSwap&&t&&(this.log("Swapping audio codec"),t.indexOf("mp4a.40.5")!==-1?t="mp4a.40.2":t="mp4a.40.5"),t}_loadBitrateTestFrag(e,t){e.bitrateTest=!0,this._doFragLoad(e,t).then(n=>{const{hls:r}=this,a=n==null?void 0:n.frag;if(!a||this.fragContextChanged(a))return;t.fragmentError=0,this.state=Q.IDLE,this.startFragRequested=!1,this.bitrateTest=!1;const l=a.stats;l.parsing.start=l.parsing.end=l.buffering.start=l.buffering.end=self.performance.now(),r.trigger(L.FRAG_LOADED,n),a.bitrateTest=!1})}_handleTransmuxComplete(e){var t;const n=this.playlistType,{hls:r}=this,{remuxResult:a,chunkMeta:l}=e,u=this.getCurrentContext(l);if(!u){this.resetWhenMissingContext(l);return}const{frag:f,part:c,level:h}=u,{video:m,text:g,id3:E,initSegment:y}=a,{details:T}=h,S=this.altAudio?void 0:a.audio;if(this.fragContextChanged(f)){this.fragmentTracker.removeFragment(f);return}if(this.state=Q.PARSING,y){if(y!=null&&y.tracks){const b=f.initSegment||f;this._bufferInitSegment(h,y.tracks,b,l),r.trigger(L.FRAG_PARSING_INIT_SEGMENT,{frag:b,id:n,tracks:y.tracks})}const A=y.initPTS,w=y.timescale,I=this.initPTS[f.cc];ce(A)&&(!I||I.baseTime!==A||I.timescale!==w)&&(this.initPTS[f.cc]={baseTime:A,timescale:w},r.trigger(L.INIT_PTS_FOUND,{frag:f,id:n,initPTS:A,timescale:w}))}if(m&&T){S&&m.type==="audiovideo"&&this.logMuxedErr(f);const A=T.fragments[f.sn-1-T.startSN],w=f.sn===T.startSN,I=!A||f.cc>A.cc;if(a.independent!==!1){const{startPTS:b,endPTS:P,startDTS:G,endDTS:D}=m;if(c)c.elementaryStreams[m.type]={startPTS:b,endPTS:P,startDTS:G,endDTS:D};else if(m.firstKeyFrame&&m.independent&&l.id===1&&!I&&(this.couldBacktrack=!0),m.dropped&&m.independent){const M=this.getMainFwdBufferInfo(),B=(M?M.end:this.getLoadPosition())+this.config.maxBufferHole,O=m.firstKeyFramePTS?m.firstKeyFramePTS:b;if(!w&&B<O-this.config.maxBufferHole&&!I){this.backtrack(f);return}else I&&(f.gap=!0);f.setElementaryStreamInfo(m.type,f.start,P,f.start,D,!0)}else w&&b-(T.appliedTimelineOffset||0)>Ro&&(f.gap=!0);f.setElementaryStreamInfo(m.type,b,P,G,D),this.backtrackFragment&&(this.backtrackFragment=f),this.bufferFragmentData(m,f,c,l,w||I)}else if(w||I)f.gap=!0;else{this.backtrack(f);return}}if(S){const{startPTS:A,endPTS:w,startDTS:I,endDTS:b}=S;c&&(c.elementaryStreams[Ge.AUDIO]={startPTS:A,endPTS:w,startDTS:I,endDTS:b}),f.setElementaryStreamInfo(Ge.AUDIO,A,w,I,b),this.bufferFragmentData(S,f,c,l)}if(T&&E!=null&&(t=E.samples)!=null&&t.length){const A={id:n,frag:f,details:T,samples:E.samples};r.trigger(L.FRAG_PARSING_METADATA,A)}if(T&&g){const A={id:n,frag:f,details:T,samples:g.samples};r.trigger(L.FRAG_PARSING_USERDATA,A)}}logMuxedErr(e){this.warn(`${st(e)?"Media":"Init"} segment with muxed audiovideo where only video expected: ${e.url}`)}_bufferInitSegment(e,t,n,r){if(this.state!==Q.PARSING)return;this.audioOnly=!!t.audio&&!t.video,this.altAudio&&!this.audioOnly&&(delete t.audio,t.audiovideo&&this.logMuxedErr(n));const{audio:a,video:l,audiovideo:u}=t;if(a){const c=e.audioCodec;let h=vo(a.codec,c);h==="mp4a"&&(h="mp4a.40.5");const m=navigator.userAgent.toLowerCase();if(this.audioCodecSwitch){h&&(h.indexOf("mp4a.40.5")!==-1?h="mp4a.40.2":h="mp4a.40.5");const g=a.metadata;g&&"channelCount"in g&&(g.channelCount||1)!==1&&m.indexOf("firefox")===-1&&(h="mp4a.40.5")}h&&h.indexOf("mp4a.40.5")!==-1&&m.indexOf("android")!==-1&&a.container!=="audio/mpeg"&&(h="mp4a.40.2",this.log(`Android: force audio codec to ${h}`)),c&&c!==h&&this.log(`Swapping manifest audio codec "${c}" for "${h}"`),a.levelCodec=h,a.id=pe.MAIN,this.log(`Init audio buffer, container:${a.container}, codecs[selected/level/parsed]=[${h||""}/${c||""}/${a.codec}]`),delete t.audiovideo}if(l){l.levelCodec=e.videoCodec,l.id=pe.MAIN;const c=l.codec;if((c==null?void 0:c.length)===4)switch(c){case"hvc1":case"hev1":l.codec="hvc1.1.6.L120.90";break;case"av01":l.codec="av01.0.04M.08";break;case"avc1":l.codec="avc1.42e01e";break}this.log(`Init video buffer, container:${l.container}, codecs[level/parsed]=[${e.videoCodec||""}/${c}]${l.codec!==c?" parsed-corrected="+l.codec:""}${l.supplemental?" supplemental="+l.supplemental:""}`),delete t.audiovideo}u&&(this.log(`Init audiovideo buffer, container:${u.container}, codecs[level/parsed]=[${e.codecs}/${u.codec}]`),delete t.video,delete t.audio);const f=Object.keys(t);if(f.length){if(this.hls.trigger(L.BUFFER_CODECS,t),!this.hls)return;f.forEach(c=>{const m=t[c].initSegment;m!=null&&m.byteLength&&this.hls.trigger(L.BUFFER_APPENDING,{type:c,data:m,frag:n,part:null,chunkMeta:r,parent:n.type})})}this.tickImmediate()}getMainFwdBufferInfo(){const e=this.mediaBuffer&&this.altAudio===2?this.mediaBuffer:this.media;return this.getFwdBufferInfo(e,pe.MAIN)}get maxBufferLength(){const{levels:e,level:t}=this,n=e==null?void 0:e[t];return n?this.getMaxBufferLength(n.maxBitrate):this.config.maxBufferLength}backtrack(e){this.couldBacktrack=!0,this.backtrackFragment=e,this.resetTransmuxer(),this.flushBufferGap(e),this.fragmentTracker.removeFragment(e),this.fragPrevious=null,this.nextLoadPosition=e.start,this.state=Q.IDLE}checkFragmentChanged(){const e=this.media;let t=null;if(e&&e.readyState>1&&e.seeking===!1){const n=e.currentTime;if(Ie.isBuffered(e,n)?t=this.getAppendedFrag(n):Ie.isBuffered(e,n+.1)&&(t=this.getAppendedFrag(n+.1)),t){this.backtrackFragment=null;const r=this.fragPlaying,a=t.level;(!r||t.sn!==r.sn||r.level!==a)&&(this.fragPlaying=t,this.hls.trigger(L.FRAG_CHANGED,{frag:t}),(!r||r.level!==a)&&this.hls.trigger(L.LEVEL_SWITCHED,{level:a}))}}}get nextLevel(){const e=this.nextBufferedFrag;return e?e.level:-1}get currentFrag(){var e;if(this.fragPlaying)return this.fragPlaying;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;return ce(t)?this.getAppendedFrag(t):null}get currentProgramDateTime(){var e;const t=((e=this.media)==null?void 0:e.currentTime)||this.lastCurrentTime;if(ce(t)){const n=this.getLevelDetails(),r=this.currentFrag||(n?Hr(null,n.fragments,t):null);if(r){const a=r.programDateTime;if(a!==null){const l=a+(t-r.start)*1e3;return new Date(l)}}}return null}get currentLevel(){const e=this.currentFrag;return e?e.level:-1}get nextBufferedFrag(){const e=this.currentFrag;return e?this.followingBufferedFrag(e):null}get forceStartLoad(){return this._forceStartLoad}}class PI{constructor(e){this.config=void 0,this.keyUriToKeyInfo={},this.emeController=null,this.config=e}abort(e){for(const n in this.keyUriToKeyInfo){const r=this.keyUriToKeyInfo[n].loader;if(r){var t;if(e&&e!==((t=r.context)==null?void 0:t.frag.type))return;r.abort()}}}detach(){for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e];(t.mediaKeySessionContext||t.decryptdata.isCommonEncryption)&&delete this.keyUriToKeyInfo[e]}}destroy(){this.detach();for(const e in this.keyUriToKeyInfo){const t=this.keyUriToKeyInfo[e].loader;t&&t.destroy()}this.keyUriToKeyInfo={}}createKeyLoadError(e,t=H.KEY_LOAD_ERROR,n,r,a){return new Gn({type:xe.NETWORK_ERROR,details:t,fatal:!1,frag:e,response:a,error:n,networkDetails:r})}loadClear(e,t,n){if(this.emeController&&this.config.emeEnabled&&!this.emeController.getSelectedKeySystemFormats().length){if(t.length)for(let r=0,a=t.length;r<a;r++){const l=t[r];if(e.cc<=l.cc&&(!st(e)||!st(l)||e.sn<l.sn)||!n&&r==a-1)return this.emeController.selectKeySystemFormat(l).then(u=>{if(!this.emeController)return;l.setKeyFormat(u);const f=Fc(u);if(f)return this.emeController.getKeySystemAccess([f])})}if(this.config.requireKeySystemAccessOnStart){const r=xo(this.config);if(r.length)return this.emeController.getKeySystemAccess(r)}}return null}load(e){return!e.decryptdata&&e.encrypted&&this.emeController&&this.config.emeEnabled?this.emeController.selectKeySystemFormat(e).then(t=>this.loadInternal(e,t)):this.loadInternal(e)}loadInternal(e,t){var n,r;t&&e.setKeyFormat(t);const a=e.decryptdata;if(!a){const c=new Error(t?`Expected frag.decryptdata to be defined after setting format ${t}`:"Missing decryption data on fragment in onKeyLoading");return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,c))}const l=a.uri;if(!l)return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,new Error(`Invalid key URI: "${l}"`)));let u=this.keyUriToKeyInfo[l];if((n=u)!=null&&n.decryptdata.key)return a.key=u.decryptdata.key,Promise.resolve({frag:e,keyInfo:u});if((r=u)!=null&&r.keyLoadPromise){var f;switch((f=u.mediaKeySessionContext)==null?void 0:f.keyStatus){case void 0:case"status-pending":case"usable":case"usable-in-future":return u.keyLoadPromise.then(c=>(a.key=c.keyInfo.decryptdata.key,{frag:e,keyInfo:u}))}}switch(u=this.keyUriToKeyInfo[l]={decryptdata:a,keyLoadPromise:null,loader:null,mediaKeySessionContext:null},a.method){case"ISO-23001-7":case"SAMPLE-AES":case"SAMPLE-AES-CENC":case"SAMPLE-AES-CTR":return a.keyFormat==="identity"?this.loadKeyHTTP(u,e):this.loadKeyEME(u,e);case"AES-128":case"AES-256":case"AES-256-CTR":return this.loadKeyHTTP(u,e);default:return Promise.reject(this.createKeyLoadError(e,H.KEY_LOAD_ERROR,new Error(`Key supplied with unsupported METHOD: "${a.method}"`)))}}loadKeyEME(e,t){const n={frag:t,keyInfo:e};if(this.emeController&&this.config.emeEnabled){const r=this.emeController.loadKey(n);if(r)return(e.keyLoadPromise=r.then(a=>(e.mediaKeySessionContext=a,n))).catch(a=>{throw e.keyLoadPromise=null,a})}return Promise.resolve(n)}loadKeyHTTP(e,t){const n=this.config,r=n.loader,a=new r(n);return t.keyLoader=e.loader=a,e.keyLoadPromise=new Promise((l,u)=>{const f={keyInfo:e,frag:t,responseType:"arraybuffer",url:e.decryptdata.uri},c=n.keyLoadPolicy.default,h={loadPolicy:c,timeout:c.maxLoadTimeMs,maxRetry:0,retryDelay:0,maxRetryDelay:0},m={onSuccess:(g,E,y,T)=>{const{frag:S,keyInfo:A,url:w}=y;if(!S.decryptdata||A!==this.keyUriToKeyInfo[w])return u(this.createKeyLoadError(S,H.KEY_LOAD_ERROR,new Error("after key load, decryptdata unset or changed"),T));A.decryptdata.key=S.decryptdata.key=new Uint8Array(g.data),S.keyLoader=null,A.loader=null,l({frag:S,keyInfo:A})},onError:(g,E,y,T)=>{this.resetLoader(E),u(this.createKeyLoadError(t,H.KEY_LOAD_ERROR,new Error(`HTTP Error ${g.code} loading key ${g.text}`),y,Be({url:f.url,data:void 0},g)))},onTimeout:(g,E,y)=>{this.resetLoader(E),u(this.createKeyLoadError(t,H.KEY_LOAD_TIMEOUT,new Error("key loading timed out"),y))},onAbort:(g,E,y)=>{this.resetLoader(E),u(this.createKeyLoadError(t,H.INTERNAL_ABORTED,new Error("key loading aborted"),y))}};a.load(f,h,m)})}resetLoader(e){const{frag:t,keyInfo:n,url:r}=e,a=n.loader;t.keyLoader===a&&(t.keyLoader=null,n.loader=null),delete this.keyUriToKeyInfo[r],a&&a.destroy()}}function ag(i){const{type:e}=i;switch(e){case De.AUDIO_TRACK:return pe.AUDIO;case De.SUBTITLE_TRACK:return pe.SUBTITLE;default:return pe.MAIN}}function vc(i,e){let t=i.url;return(t===void 0||t.indexOf("data:")===0)&&(t=e.url),t}class OI{constructor(e){this.hls=void 0,this.loaders=Object.create(null),this.variableList=null,this.onManifestLoaded=this.checkAutostartLoad,this.hls=e,this.registerListeners()}startLoad(e){}stopLoad(){this.destroyInternalLoaders()}registerListeners(){const{hls:e}=this;e.on(L.MANIFEST_LOADING,this.onManifestLoading,this),e.on(L.LEVEL_LOADING,this.onLevelLoading,this),e.on(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.on(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.on(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}unregisterListeners(){const{hls:e}=this;e.off(L.MANIFEST_LOADING,this.onManifestLoading,this),e.off(L.LEVEL_LOADING,this.onLevelLoading,this),e.off(L.AUDIO_TRACK_LOADING,this.onAudioTrackLoading,this),e.off(L.SUBTITLE_TRACK_LOADING,this.onSubtitleTrackLoading,this),e.off(L.LEVELS_UPDATED,this.onLevelsUpdated,this)}createInternalLoader(e){const t=this.hls.config,n=t.pLoader,r=t.loader,a=n||r,l=new a(t);return this.loaders[e.type]=l,l}getInternalLoader(e){return this.loaders[e.type]}resetInternalLoader(e){this.loaders[e]&&delete this.loaders[e]}destroyInternalLoaders(){for(const e in this.loaders){const t=this.loaders[e];t&&t.destroy(),this.resetInternalLoader(e)}}destroy(){this.variableList=null,this.unregisterListeners(),this.destroyInternalLoaders()}onManifestLoading(e,t){const{url:n}=t;this.variableList=null,this.load({id:null,level:0,responseType:"text",type:De.MANIFEST,url:n,deliveryDirectives:null,levelOrTrack:null})}onLevelLoading(e,t){const{id:n,level:r,pathwayId:a,url:l,deliveryDirectives:u,levelInfo:f}=t;this.load({id:n,level:r,pathwayId:a,responseType:"text",type:De.LEVEL,url:l,deliveryDirectives:u,levelOrTrack:f})}onAudioTrackLoading(e,t){const{id:n,groupId:r,url:a,deliveryDirectives:l,track:u}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:De.AUDIO_TRACK,url:a,deliveryDirectives:l,levelOrTrack:u})}onSubtitleTrackLoading(e,t){const{id:n,groupId:r,url:a,deliveryDirectives:l,track:u}=t;this.load({id:n,groupId:r,level:null,responseType:"text",type:De.SUBTITLE_TRACK,url:a,deliveryDirectives:l,levelOrTrack:u})}onLevelsUpdated(e,t){const n=this.loaders[De.LEVEL];if(n){const r=n.context;r&&!t.levels.some(a=>a===r.levelOrTrack)&&(n.abort(),delete this.loaders[De.LEVEL])}}load(e){var t;const n=this.hls.config;let r=this.getInternalLoader(e);if(r){const c=this.hls.logger,h=r.context;if(h&&h.levelOrTrack===e.levelOrTrack&&(h.url===e.url||h.deliveryDirectives&&!e.deliveryDirectives)){h.url===e.url?c.log(`[playlist-loader]: ignore ${e.url} ongoing request`):c.log(`[playlist-loader]: ignore ${e.url} in favor of ${h.url}`);return}c.log(`[playlist-loader]: aborting previous loader for type: ${e.type}`),r.abort()}let a;if(e.type===De.MANIFEST?a=n.manifestLoadPolicy.default:a=Ue({},n.playlistLoadPolicy.default,{timeoutRetry:null,errorRetry:null}),r=this.createInternalLoader(e),ce((t=e.deliveryDirectives)==null?void 0:t.part)){let c;if(e.type===De.LEVEL&&e.level!==null?c=this.hls.levels[e.level].details:e.type===De.AUDIO_TRACK&&e.id!==null?c=this.hls.audioTracks[e.id].details:e.type===De.SUBTITLE_TRACK&&e.id!==null&&(c=this.hls.subtitleTracks[e.id].details),c){const h=c.partTarget,m=c.targetduration;if(h&&m){const g=Math.max(h*3,m*.8)*1e3;a=Ue({},a,{maxTimeToFirstByteMs:Math.min(g,a.maxTimeToFirstByteMs),maxLoadTimeMs:Math.min(g,a.maxTimeToFirstByteMs)})}}}const l=a.errorRetry||a.timeoutRetry||{},u={loadPolicy:a,timeout:a.maxLoadTimeMs,maxRetry:l.maxNumRetry||0,retryDelay:l.retryDelayMs||0,maxRetryDelay:l.maxRetryDelayMs||0},f={onSuccess:(c,h,m,g)=>{const E=this.getInternalLoader(m);this.resetInternalLoader(m.type);const y=c.data;if(y.indexOf("#EXTM3U")!==0){this.handleManifestParsingError(c,m,new Error("no EXTM3U delimiter"),g||null,h);return}h.parsing.start=performance.now(),wn.isMediaPlaylist(y)||m.type!==De.MANIFEST?this.handleTrackOrLevelPlaylist(c,h,m,g||null,E):this.handleMasterPlaylist(c,h,m,g)},onError:(c,h,m,g)=>{this.handleNetworkError(h,m,!1,c,g)},onTimeout:(c,h,m)=>{this.handleNetworkError(h,m,!0,void 0,c)}};r.load(e,u,f)}checkAutostartLoad(){if(!this.hls)return;const{config:{autoStartLoad:e,startPosition:t},forceStartLoad:n}=this.hls;(e||n)&&(this.hls.logger.log(`${e?"auto":"force"} startLoad with configured startPosition ${t}`),this.hls.startLoad(t))}handleMasterPlaylist(e,t,n,r){const a=this.hls,l=e.data,u=vc(e,n),f=wn.parseMasterPlaylist(l,u);if(f.playlistParsingError){this.handleManifestParsingError(e,n,f.playlistParsingError,r,t);return}const{contentSteering:c,levels:h,sessionData:m,sessionKeys:g,startTimeOffset:E,variableList:y}=f;this.variableList=y;const{AUDIO:T=[],SUBTITLES:S,"CLOSED-CAPTIONS":A}=wn.parseMasterPlaylistMedia(l,u,f);T.length&&!T.some(I=>!I.url)&&h[0].audioCodec&&!h[0].attrs.AUDIO&&(this.hls.logger.log("[playlist-loader]: audio codec signaled in quality level, but no embedded audio track signaled, create one"),T.unshift({type:"main",name:"main",groupId:"main",default:!1,autoselect:!1,forced:!1,id:-1,attrs:new qe({}),bitrate:0,url:""})),a.trigger(L.MANIFEST_LOADED,{levels:h,audioTracks:T,subtitles:S,captions:A,contentSteering:c,url:u,stats:t,networkDetails:r,sessionData:m,sessionKeys:g,startTimeOffset:E,variableList:y})}handleTrackOrLevelPlaylist(e,t,n,r,a){const l=this.hls,{id:u,level:f,type:c}=n,h=vc(e,n),m=ce(f)?f:ce(u)?u:0,g=ag(n),E=wn.parseLevelPlaylist(e.data,h,m,g,0,this.variableList);if(c===De.MANIFEST){const y={attrs:new qe({}),bitrate:0,details:E,name:"",url:h};E.requestScheduled=t.loading.start+L0(E,0),l.trigger(L.MANIFEST_LOADED,{levels:[y],audioTracks:[],url:h,stats:t,networkDetails:r,sessionData:null,sessionKeys:null,contentSteering:null,startTimeOffset:null,variableList:null})}t.parsing.end=performance.now(),n.levelDetails=E,this.handlePlaylistLoaded(E,e,t,n,r,a)}handleManifestParsingError(e,t,n,r,a){this.hls.trigger(L.ERROR,{type:xe.NETWORK_ERROR,details:H.MANIFEST_PARSING_ERROR,fatal:t.type===De.MANIFEST,url:e.url,err:n,error:n,reason:n.message,response:e,context:t,networkDetails:r,stats:a})}handleNetworkError(e,t,n=!1,r,a){let l=`A network ${n?"timeout":"error"+(r?" (status "+r.code+")":"")} occurred while loading ${e.type}`;e.type===De.LEVEL?l+=`: ${e.level} id: ${e.id}`:(e.type===De.AUDIO_TRACK||e.type===De.SUBTITLE_TRACK)&&(l+=` id: ${e.id} group-id: "${e.groupId}"`);const u=new Error(l);this.hls.logger.warn(`[playlist-loader]: ${l}`);let f=H.UNKNOWN,c=!1;const h=this.getInternalLoader(e);switch(e.type){case De.MANIFEST:f=n?H.MANIFEST_LOAD_TIMEOUT:H.MANIFEST_LOAD_ERROR,c=!0;break;case De.LEVEL:f=n?H.LEVEL_LOAD_TIMEOUT:H.LEVEL_LOAD_ERROR,c=!1;break;case De.AUDIO_TRACK:f=n?H.AUDIO_TRACK_LOAD_TIMEOUT:H.AUDIO_TRACK_LOAD_ERROR,c=!1;break;case De.SUBTITLE_TRACK:f=n?H.SUBTITLE_TRACK_LOAD_TIMEOUT:H.SUBTITLE_LOAD_ERROR,c=!1;break}h&&this.resetInternalLoader(e.type);const m={type:xe.NETWORK_ERROR,details:f,fatal:c,url:e.url,loader:h,context:e,error:u,networkDetails:t,stats:a};if(r){const g=(t==null?void 0:t.url)||e.url;m.response=Be({url:g,data:void 0},r)}this.hls.trigger(L.ERROR,m)}handlePlaylistLoaded(e,t,n,r,a,l){const u=this.hls,{type:f,level:c,id:h,groupId:m,deliveryDirectives:g}=r,E=vc(t,r),y=ag(r),T=typeof r.level=="number"&&y===pe.MAIN?c:void 0;if(!e.fragments.length){const A=e.playlistParsingError=new Error("No Segments found in Playlist");u.trigger(L.ERROR,{type:xe.NETWORK_ERROR,details:H.LEVEL_EMPTY_ERROR,fatal:!1,url:E,error:A,reason:A.message,response:t,context:r,level:T,parent:y,networkDetails:a,stats:n});return}e.targetduration||(e.playlistParsingError=new Error("Missing Target Duration"));const S=e.playlistParsingError;if(S){if(this.hls.logger.warn(S),!u.config.ignorePlaylistParsingErrors){u.trigger(L.ERROR,{type:xe.NETWORK_ERROR,details:H.LEVEL_PARSING_ERROR,fatal:!1,url:E,error:S,reason:S.message,response:t,context:r,level:T,parent:y,networkDetails:a,stats:n});return}e.playlistParsingError=null}switch(e.live&&l&&(l.getCacheAge&&(e.ageHeader=l.getCacheAge()||0),(!l.getCacheAge||isNaN(e.ageHeader))&&(e.ageHeader=0)),f){case De.MANIFEST:case De.LEVEL:u.trigger(L.LEVEL_LOADED,{details:e,levelInfo:r.levelOrTrack||u.levels[0],level:T||0,id:h||0,stats:n,networkDetails:a,deliveryDirectives:g,withoutMultiVariant:f===De.MANIFEST});break;case De.AUDIO_TRACK:u.trigger(L.AUDIO_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:h||0,groupId:m||"",stats:n,networkDetails:a,deliveryDirectives:g});break;case De.SUBTITLE_TRACK:u.trigger(L.SUBTITLE_TRACK_LOADED,{details:e,track:r.levelOrTrack,id:h||0,groupId:m||"",stats:n,networkDetails:a,deliveryDirectives:g});break}}}class jt{static get version(){return Oi}static isMSESupported(){return yy()}static isSupported(){return bI()}static getMediaSource(){return Er()}static get Events(){return L}static get MetadataSchema(){return Gt}static get ErrorTypes(){return xe}static get ErrorDetails(){return H}static get DefaultConfig(){return jt.defaultConfig?jt.defaultConfig:yI}static set DefaultConfig(e){jt.defaultConfig=e}constructor(e={}){this.config=void 0,this.userConfig=void 0,this.logger=void 0,this.coreComponents=void 0,this.networkControllers=void 0,this._emitter=new md,this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.abrController=void 0,this.bufferController=void 0,this.capLevelController=void 0,this.latencyController=void 0,this.levelController=void 0,this.streamController=void 0,this.audioStreamController=void 0,this.subtititleStreamController=void 0,this.audioTrackController=void 0,this.subtitleTrackController=void 0,this.interstitialsController=void 0,this.gapController=void 0,this.emeController=void 0,this.cmcdController=void 0,this._media=null,this._url=null,this._sessionId=void 0,this.triggeringException=void 0,this.started=!1;const t=this.logger=eL(e.debug||!1,"Hls instance",e.assetPlayerId),n=this.config=EI(jt.DefaultConfig,e,t);this.userConfig=e,n.progressive&&xI(n,t);const{abrController:r,bufferController:a,capLevelController:l,errorController:u,fpsController:f}=n,c=new u(this),h=this.abrController=new r(this),m=new KL(this),g=n.interstitialsController,E=g?this.interstitialsController=new g(this,jt):null,y=this.bufferController=new a(this,m),T=this.capLevelController=new l(this),S=new f(this),A=new OI(this),w=n.contentSteeringController,I=w?new w(this):null,b=this.levelController=new _I(this,I),P=new II(this),G=new PI(this.config),D=this.streamController=new DI(this,m,G),M=this.gapController=new AI(this,m);T.setStreamController(D),S.setStreamController(D);const B=[A,b,D];E&&B.splice(1,0,E),I&&B.splice(1,0,I),this.networkControllers=B;const O=[h,y,M,T,S,P,m];this.audioTrackController=this.createController(n.audioTrackController,B);const X=n.audioStreamController;X&&B.push(this.audioStreamController=new X(this,m,G)),this.subtitleTrackController=this.createController(n.subtitleTrackController,B);const re=n.subtitleStreamController;re&&B.push(this.subtititleStreamController=new re(this,m,G)),this.createController(n.timelineController,O),G.emeController=this.emeController=this.createController(n.emeController,O),this.cmcdController=this.createController(n.cmcdController,O),this.latencyController=this.createController(wI,O),this.coreComponents=O,B.push(c);const de=c.onErrorOut;typeof de=="function"&&this.on(L.ERROR,de,c),this.on(L.MANIFEST_LOADED,A.onManifestLoaded,A)}createController(e,t){if(e){const n=new e(this);return t&&t.push(n),n}return null}on(e,t,n=this){this._emitter.on(e,t,n)}once(e,t,n=this){this._emitter.once(e,t,n)}removeAllListeners(e){this._emitter.removeAllListeners(e)}off(e,t,n=this,r){this._emitter.off(e,t,n,r)}listeners(e){return this._emitter.listeners(e)}emit(e,t,n){return this._emitter.emit(e,t,n)}trigger(e,t){if(this.config.debug)return this.emit(e,e,t);try{return this.emit(e,e,t)}catch(n){if(this.logger.error("An internal error happened while handling event "+e+'. Error message: "'+n.message+'". Here is a stacktrace:',n),!this.triggeringException){this.triggeringException=!0;const r=e===L.ERROR;this.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.INTERNAL_EXCEPTION,fatal:r,event:e,error:n}),this.triggeringException=!1}}return!1}listenerCount(e){return this._emitter.listenerCount(e)}destroy(){this.logger.log("destroy"),this.trigger(L.DESTROYING,void 0),this.detachMedia(),this.removeAllListeners(),this._autoLevelCapping=-1,this._url=null,this.networkControllers.forEach(t=>t.destroy()),this.networkControllers.length=0,this.coreComponents.forEach(t=>t.destroy()),this.coreComponents.length=0;const e=this.config;e.xhrSetup=e.fetchSetup=void 0,this.userConfig=null}attachMedia(e){if(!e||"media"in e&&!e.media){const a=new Error(`attachMedia failed: invalid argument (${e})`);this.trigger(L.ERROR,{type:xe.OTHER_ERROR,details:H.ATTACH_MEDIA_ERROR,fatal:!0,error:a});return}this.logger.log("attachMedia"),this._media&&(this.logger.warn("media must be detached before attaching"),this.detachMedia());const t="media"in e,n=t?e.media:e,r=t?e:{media:n};this._media=n,this.trigger(L.MEDIA_ATTACHING,r)}detachMedia(){this.logger.log("detachMedia"),this.trigger(L.MEDIA_DETACHING,{}),this._media=null}transferMedia(){this._media=null;const e=this.bufferController.transferMedia();return this.trigger(L.MEDIA_DETACHING,{transferMedia:e}),e}loadSource(e){this.stopLoad();const t=this.media,n=this._url,r=this._url=sd.buildAbsoluteURL(self.location.href,e,{alwaysNormalize:!0});this._autoLevelCapping=-1,this._maxHdcpLevel=null,this.logger.log(`loadSource:${r}`),t&&n&&(n!==r||this.bufferController.hasSourceTypes())&&(this.detachMedia(),this.attachMedia(t)),this.trigger(L.MANIFEST_LOADING,{url:e})}get url(){return this._url}get hasEnoughToStart(){return this.streamController.hasEnoughToStart}get startPosition(){return this.streamController.startPositionValue}startLoad(e=-1,t){this.logger.log(`startLoad(${e+(t?", <skip seek to start>":"")})`),this.started=!0,this.resumeBuffering();for(let n=0;n<this.networkControllers.length&&(this.networkControllers[n].startLoad(e,t),!(!this.started||!this.networkControllers));n++);}stopLoad(){this.logger.log("stopLoad"),this.started=!1;for(let e=0;e<this.networkControllers.length&&(this.networkControllers[e].stopLoad(),!(this.started||!this.networkControllers));e++);}get loadingEnabled(){return this.started}get bufferingEnabled(){return this.streamController.bufferingEnabled}resumeBuffering(){this.bufferingEnabled||(this.logger.log("resume buffering"),this.networkControllers.forEach(e=>{e.resumeBuffering&&e.resumeBuffering()}))}pauseBuffering(){this.bufferingEnabled&&(this.logger.log("pause buffering"),this.networkControllers.forEach(e=>{e.pauseBuffering&&e.pauseBuffering()}))}get inFlightFragments(){const e={[pe.MAIN]:this.streamController.inFlightFrag};return this.audioStreamController&&(e[pe.AUDIO]=this.audioStreamController.inFlightFrag),this.subtititleStreamController&&(e[pe.SUBTITLE]=this.subtititleStreamController.inFlightFrag),e}swapAudioCodec(){this.logger.log("swapAudioCodec"),this.streamController.swapAudioCodec()}recoverMediaError(){this.logger.log("recoverMediaError");const e=this._media,t=e==null?void 0:e.currentTime;this.detachMedia(),e&&(this.attachMedia(e),t&&this.startLoad(t))}removeLevel(e){this.levelController.removeLevel(e)}get sessionId(){let e=this._sessionId;return e||(e=this._sessionId=A1()),e}get levels(){const e=this.levelController.levels;return e||[]}get latestLevelDetails(){return this.streamController.getLevelDetails()||null}get loadLevelObj(){return this.levelController.loadLevelObj}get currentLevel(){return this.streamController.currentLevel}set currentLevel(e){this.logger.log(`set currentLevel:${e}`),this.levelController.manualLevel=e,this.streamController.immediateLevelSwitch()}get nextLevel(){return this.streamController.nextLevel}set nextLevel(e){this.logger.log(`set nextLevel:${e}`),this.levelController.manualLevel=e,this.streamController.nextLevelSwitch()}get loadLevel(){return this.levelController.level}set loadLevel(e){this.logger.log(`set loadLevel:${e}`),this.levelController.manualLevel=e}get nextLoadLevel(){return this.levelController.nextLoadLevel}set nextLoadLevel(e){this.levelController.nextLoadLevel=e}get firstLevel(){return Math.max(this.levelController.firstLevel,this.minAutoLevel)}set firstLevel(e){this.logger.log(`set firstLevel:${e}`),this.levelController.firstLevel=e}get startLevel(){const e=this.levelController.startLevel;return e===-1&&this.abrController.forcedAutoLevel>-1?this.abrController.forcedAutoLevel:e}set startLevel(e){this.logger.log(`set startLevel:${e}`),e!==-1&&(e=Math.max(e,this.minAutoLevel)),this.levelController.startLevel=e}get capLevelToPlayerSize(){return this.config.capLevelToPlayerSize}set capLevelToPlayerSize(e){const t=!!e;t!==this.config.capLevelToPlayerSize&&(t?this.capLevelController.startCapping():(this.capLevelController.stopCapping(),this.autoLevelCapping=-1,this.streamController.nextLevelSwitch()),this.config.capLevelToPlayerSize=t)}get autoLevelCapping(){return this._autoLevelCapping}get bandwidthEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimate():NaN}set bandwidthEstimate(e){this.abrController.resetEstimator(e)}get abrEwmaDefaultEstimate(){const{bwEstimator:e}=this.abrController;return e?e.defaultEstimate:NaN}get ttfbEstimate(){const{bwEstimator:e}=this.abrController;return e?e.getEstimateTTFB():NaN}set autoLevelCapping(e){this._autoLevelCapping!==e&&(this.logger.log(`set autoLevelCapping:${e}`),this._autoLevelCapping=e,this.levelController.checkMaxAutoUpdated())}get maxHdcpLevel(){return this._maxHdcpLevel}set maxHdcpLevel(e){bL(e)&&this._maxHdcpLevel!==e&&(this._maxHdcpLevel=e,this.levelController.checkMaxAutoUpdated())}get autoLevelEnabled(){return this.levelController.manualLevel===-1}get manualLevel(){return this.levelController.manualLevel}get minAutoLevel(){const{levels:e,config:{minAutoBitrate:t}}=this;if(!e)return 0;const n=e.length;for(let r=0;r<n;r++)if(e[r].maxBitrate>=t)return r;return 0}get maxAutoLevel(){const{levels:e,autoLevelCapping:t,maxHdcpLevel:n}=this;let r;if(t===-1&&e!=null&&e.length?r=e.length-1:r=t,n)for(let a=r;a--;){const l=e[a].attrs["HDCP-LEVEL"];if(l&&l<=n)return a}return r}get firstAutoLevel(){return this.abrController.firstAutoLevel}get nextAutoLevel(){return this.abrController.nextAutoLevel}set nextAutoLevel(e){this.abrController.nextAutoLevel=e}get playingDate(){return this.streamController.currentProgramDateTime}get mainForwardBufferInfo(){return this.streamController.getMainFwdBufferInfo()}get maxBufferLength(){return this.streamController.maxBufferLength}setAudioOption(e){var t;return((t=this.audioTrackController)==null?void 0:t.setAudioOption(e))||null}setSubtitleOption(e){var t;return((t=this.subtitleTrackController)==null?void 0:t.setSubtitleOption(e))||null}get allAudioTracks(){const e=this.audioTrackController;return e?e.allAudioTracks:[]}get audioTracks(){const e=this.audioTrackController;return e?e.audioTracks:[]}get audioTrack(){const e=this.audioTrackController;return e?e.audioTrack:-1}set audioTrack(e){const t=this.audioTrackController;t&&(t.audioTrack=e)}get allSubtitleTracks(){const e=this.subtitleTrackController;return e?e.allSubtitleTracks:[]}get subtitleTracks(){const e=this.subtitleTrackController;return e?e.subtitleTracks:[]}get subtitleTrack(){const e=this.subtitleTrackController;return e?e.subtitleTrack:-1}get media(){return this._media}set subtitleTrack(e){const t=this.subtitleTrackController;t&&(t.subtitleTrack=e)}get subtitleDisplay(){const e=this.subtitleTrackController;return e?e.subtitleDisplay:!1}set subtitleDisplay(e){const t=this.subtitleTrackController;t&&(t.subtitleDisplay=e)}get lowLatencyMode(){return this.config.lowLatencyMode}set lowLatencyMode(e){this.config.lowLatencyMode=e}get liveSyncPosition(){return this.latencyController.liveSyncPosition}get latency(){return this.latencyController.latency}get maxLatency(){return this.latencyController.maxLatency}get targetLatency(){return this.latencyController.targetLatency}set targetLatency(e){this.latencyController.targetLatency=e}get drift(){return this.latencyController.drift}get forceStartLoad(){return this.streamController.forceStartLoad}get pathways(){return this.levelController.pathways}get pathwayPriority(){return this.levelController.pathwayPriority}set pathwayPriority(e){this.levelController.pathwayPriority=e}get bufferedToEnd(){var e;return!!((e=this.bufferController)!=null&&e.bufferedToEnd)}get interstitialsManager(){var e;return((e=this.interstitialsController)==null?void 0:e.interstitialsManager)||null}getMediaDecodingInfo(e,t=this.allAudioTracks){const n=f0(t);return c0(e,n,navigator.mediaCapabilities)}}jt.defaultConfig=void 0;const vy=({rtspUrl:i,volume:e,onVolumeChange:t,autoplay:n=!1})=>{const r=W.useRef(null),a=W.useRef(null),[l,u]=W.useState(!1),[f,c]=W.useState(!1),[h,m]=W.useState(!1),[g,E]=W.useState(null),[y,T]=W.useState(null),[S,A]=W.useState("rtsp"),[w,I]=W.useState(0);W.useEffect(()=>{r.current&&(r.current.volume=e)},[e]),W.useEffect(()=>(i&&B(),()=>b()),[i]);const b=()=>{a.current&&(a.current.destroy(),a.current=null)},P=async()=>{try{const{getStreamStatus:ee}=await Hm(async()=>{const{getStreamStatus:J}=await Promise.resolve().then(()=>jm);return{getStreamStatus:J}},[]),$=await ee();return T($),$}catch(ee){return console.error("Failed to check stream status:",ee),ee.isDemoMode?{isRunning:!1,hlsAvailable:!1,mode:"demo",hasFFmpeg:!1}:null}},G=async()=>{var ee,$;try{m(!0),E(null);const{startStream:J}=await Hm(async()=>{const{startStream:q}=await Promise.resolve().then(()=>jm);return{startStream:q}},void 0);try{const q=await J(i);if(q.mode==="demo"||q.note&&q.note.includes("not available")){A("demo"),E(`RTSP streaming not supported: ${q.note}`),setTimeout(()=>{D()},2e3);return}A("hls"),setTimeout(()=>{const C=q.hlsUrl||"http://localhost:5000/hls/stream.m3u8";M(C)},3e3)}catch(q){console.error("Stream API error:",q),A("demo"),($=(ee=q.response)==null?void 0:ee.data)!=null&&$.suggestions?E(`RTSP streaming failed: ${q.response.data.error}. ${q.response.data.note}`):E(`RTSP streaming failed: ${q.message||"Unknown error"}`),setTimeout(()=>{D()},2e3);return}}catch(J){console.error("RTSP stream error:",J),J.isDemoMode?(A("demo"),E("Backend server not available. RTSP streaming requires a backend server with FFmpeg support."),setTimeout(()=>{D()},2e3)):(E(`RTSP stream failed: ${J.message||"Unknown error occurred"}`),A("error"),m(!1))}},D=()=>{if(!r.current)return;m(!1),A("demo");const ee="https://commondatastorage.googleapis.com/gtv-videos-bucket/sample/BigBuckBunny.mp4";r.current.src=ee,r.current.loop=!0,n&&r.current.play().catch(()=>{console.log("Autoplay blocked, user interaction required")})},M=ee=>{if(r.current)if(b(),A("hls"),jt.isSupported()){const $=new jt({enableWorker:!1,lowLatencyMode:!0,backBufferLength:30,maxBufferLength:60,maxMaxBufferLength:120,startLevel:-1,capLevelToPlayerSize:!0});a.current=$,$.loadSource(ee),$.attachMedia(r.current),$.on(jt.Events.MANIFEST_PARSED,()=>{var J;console.log("HLS manifest parsed successfully"),m(!1),E(null),I(0),n&&((J=r.current)==null||J.play())}),$.on(jt.Events.ERROR,(J,q)=>{if(console.error("HLS Error:",q),q.fatal){switch(q.type){case jt.ErrorTypes.NETWORK_ERROR:E("Network error loading RTSP stream. Check if the RTSP URL is accessible.");break;case jt.ErrorTypes.MEDIA_ERROR:E("Media error in RTSP stream. The stream format may not be supported.");break;default:E("Fatal error loading RTSP stream.");break}A("error"),m(!1)}})}else r.current.canPlayType("application/vnd.apple.mpegurl")?(r.current.src=ee,r.current.addEventListener("error",$=>{console.error("Video error:",$),E("Error loading RTSP stream in Safari"),A("error"),m(!1)}),r.current.addEventListener("loadeddata",()=>{var $;m(!1),E(null),n&&(($=r.current)==null||$.play())})):(E("HLS not supported in this browser. RTSP streaming requires HLS support."),A("error"),m(!1))},B=async()=>{m(!0),E(null);const ee=await P();ee!=null&&ee.hlsAvailable&&(ee!=null&&ee.isRunning)?(console.log("Loading existing HLS stream"),M(ee.hlsUrl)):(console.log("Starting new RTSP stream conversion"),await G())},O=()=>{w<3?(I(ee=>ee+1),E(null),B()):E("Maximum retry attempts reached. Please check your RTSP URL and network connection.")},X=()=>{r.current&&(l?r.current.pause():r.current.play().catch(ee=>{console.error("Play error:",ee),E("Failed to play stream. User interaction may be required.")}))},re=()=>{r.current&&(r.current.muted=!f,c(!f))},de=ee=>{const $=parseFloat(ee.target.value);t($)},ae=()=>{r.current&&r.current.requestFullscreen&&r.current.requestFullscreen()},oe=()=>{switch(S){case"hls":return"text-green-400";case"demo":return"text-yellow-400";case"error":return"text-red-400";default:return"text-gray-400"}},ie=()=>{switch(S){case"hls":return"RTSP → HLS Live";case"demo":return"Demo Mode";case"error":return"Stream Error";default:return"Connecting..."}};return _.jsxs("div",{className:"relative",children:[S==="demo"&&_.jsxs("div",{className:"bg-yellow-600 text-white px-4 py-2 text-sm flex items-center",children:[_.jsx(wm,{className:"w-4 h-4 mr-2"}),_.jsx("strong",{children:"Demo Mode:"})," FFmpeg not available. Install FFmpeg to enable RTSP streaming."]}),S==="hls"&&_.jsxs("div",{className:"bg-green-600 text-white px-4 py-2 text-sm flex items-center",children:[_.jsx(uS,{className:"w-4 h-4 mr-2"}),_.jsx("strong",{children:"Live RTSP Stream:"})," ",i]}),_.jsxs("div",{className:"aspect-video bg-black relative",children:[_.jsx("video",{ref:r,className:"w-full h-full object-cover",muted:f,onPlay:()=>u(!0),onPause:()=>u(!1),onLoadStart:()=>m(!0),onCanPlay:()=>m(!1),crossOrigin:"anonymous",playsInline:!0}),h&&_.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center",children:_.jsxs("div",{className:"text-center text-white",children:[_.jsx("div",{className:"animate-spin rounded-full h-12 w-12 border-b-2 border-blue-500 mx-auto mb-4"}),_.jsx("p",{className:"text-lg font-semibold",children:S==="demo"?"Loading demo video...":"Converting RTSP stream..."}),S!=="demo"&&_.jsxs("div",{className:"text-sm text-gray-400 mt-2 space-y-1",children:[_.jsxs("p",{children:["Processing: ",i]}),_.jsx("p",{children:"Converting to web-compatible HLS format"}),_.jsx("p",{children:"This may take a few moments..."})]})]})}),g&&S==="error"&&_.jsx("div",{className:"absolute inset-0 bg-black bg-opacity-75 flex items-center justify-center",children:_.jsxs("div",{className:"text-center text-white max-w-md px-4",children:[_.jsx(wm,{className:"w-12 h-12 text-red-500 mx-auto mb-4"}),_.jsx("h3",{className:"text-lg font-semibold mb-2",children:"RTSP Stream Error"}),_.jsxs("div",{className:"mb-4 text-sm space-y-2",children:[_.jsx("p",{children:g}),_.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 p-2 rounded",children:[_.jsx("p",{children:_.jsx("strong",{children:"Common causes:"})}),_.jsxs("ul",{className:"list-disc list-inside mt-1 space-y-1",children:[_.jsx("li",{children:"Environment doesn't support FFmpeg execution"}),_.jsx("li",{children:"RTSP URL is not accessible"}),_.jsx("li",{children:"Network connectivity issues"}),_.jsx("li",{children:"Containerized environment restrictions"})]})]})]}),_.jsxs("div",{className:"space-y-2",children:[_.jsxs("p",{className:"text-xs text-gray-400",children:["RTSP URL: ",i]}),_.jsxs("p",{className:"text-xs text-gray-400",children:["Retry attempts: ",w,"/3"]})]}),_.jsxs("div",{className:"flex space-x-2 mt-4",children:[_.jsx("button",{onClick:O,disabled:w>=3,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors disabled:opacity-50",children:"Retry RTSP"}),_.jsx("button",{onClick:D,className:"bg-gray-600 hover:bg-gray-700 text-white px-4 py-2 rounded transition-colors",children:"Use Demo Video"})]})]})})]}),_.jsx("div",{className:"absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black to-transparent p-4",children:_.jsxs("div",{className:"flex items-center justify-between",children:[_.jsxs("div",{className:"flex items-center space-x-4",children:[_.jsx("button",{onClick:X,disabled:h||g&&S==="error",className:"bg-blue-600 hover:bg-blue-700 text-white p-2 rounded-full transition-colors disabled:opacity-50",children:l?_.jsx(tS,{className:"w-6 h-6"}):_.jsx(wo,{className:"w-6 h-6"})}),_.jsxs("div",{className:"flex items-center space-x-2",children:[_.jsx("button",{onClick:re,className:"text-white hover:text-blue-400 transition-colors",children:f?_.jsx(lS,{className:"w-5 h-5"}):_.jsx(oS,{className:"w-5 h-5"})}),_.jsx("input",{type:"range",min:"0",max:"1",step:"0.1",value:e,onChange:de,className:"w-24 h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"})]})]}),_.jsxs("div",{className:"flex items-center space-x-4",children:[_.jsx("div",{className:`text-xs ${oe()}`,children:ie()}),_.jsx("button",{onClick:ae,className:"text-white hover:text-blue-400 transition-colors",children:_.jsx(eS,{className:"w-5 h-5"})})]})]})})]})},NI=()=>{const[i,e]=W.useState(null),[t,n]=W.useState(!0),[r,a]=W.useState(.5),[l,u]=W.useState(!1);return W.useEffect(()=>{(async()=>{try{const c=await qo();e(c),u(!1)}catch(c){console.error("Failed to load settings:",c),c.isDemoMode&&(u(!0),e({rtspUrl:"rtsp://localhost:8554/mystream",volume:.5,autoplay:!1}))}finally{n(!1)}})()},[]),t?_.jsx("div",{className:"flex items-center justify-center min-h-screen",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):_.jsxs("div",{className:"min-h-screen bg-gradient-to-br from-gray-900 via-gray-800 to-gray-900",children:[l&&_.jsx("div",{className:"bg-yellow-600 text-white px-4 py-3 text-center",children:_.jsxs("p",{className:"text-sm",children:[_.jsx("strong",{children:"Demo Mode:"})," Backend server not available. Some features may be limited."]})}),_.jsx("div",{className:"relative overflow-hidden",children:_.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-24",children:_.jsxs("div",{className:"text-center",children:[_.jsxs("h1",{className:"text-4xl md:text-6xl font-bold text-white mb-6",children:["Professional",_.jsx("span",{className:"text-blue-400",children:" Livestream"}),_.jsx("br",{}),"Overlay Management"]}),_.jsx("p",{className:"text-xl text-gray-300 mb-8 max-w-3xl mx-auto",children:"Stream with custom overlays, manage your content in real-time, and deliver professional broadcasts with our powerful overlay system."}),_.jsxs("div",{className:"flex flex-col sm:flex-row gap-4 justify-center",children:[_.jsxs(Ls,{to:"/player",className:"inline-flex items-center px-8 py-3 border border-transparent text-base font-medium rounded-md text-white bg-blue-600 hover:bg-blue-700 transition-colors",children:[_.jsx(wo,{className:"w-5 h-5 mr-2"}),"Watch Livestream"]}),_.jsxs(Ls,{to:"/overlays",className:"inline-flex items-center px-8 py-3 border border-gray-600 text-base font-medium rounded-md text-gray-300 hover:bg-gray-700 transition-colors",children:[_.jsx(Sc,{className:"w-5 h-5 mr-2"}),"Manage Overlays"]})]})]})})}),_.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:_.jsxs("div",{className:"bg-gray-800 rounded-lg p-8 shadow-xl",children:[_.jsxs("h2",{className:"text-3xl font-bold text-white mb-6 flex items-center",children:[_.jsx(_m,{className:"w-8 h-8 mr-3 text-blue-400"}),"RTSP Live Stream Preview"]}),_.jsx("div",{className:"rounded-lg overflow-hidden relative",children:i!=null&&i.rtspUrl?_.jsx(vy,{rtspUrl:i.rtspUrl,volume:r,onVolumeChange:a,autoplay:!1}):_.jsx("div",{className:"aspect-video bg-gray-900 rounded-lg flex items-center justify-center",children:_.jsxs("div",{className:"text-center text-gray-400",children:[_.jsx(_m,{className:"w-16 h-16 mx-auto mb-4"}),_.jsx("p",{children:"Configure RTSP URL in Settings to preview stream"}),_.jsx(Ls,{to:"/settings",className:"mt-4 inline-block bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded transition-colors",children:"Go to Settings"})]})})}),i&&_.jsxs("div",{className:"mt-4 text-sm text-gray-400",children:[_.jsxs("p",{children:["RTSP Source: ",i.rtspUrl]}),_.jsx("p",{className:"text-xs mt-1",children:l?"Demo mode - showing sample video instead of RTSP stream":"Stream is converted to HLS format for web playback"})]})]})}),_.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-16",children:[_.jsx("h2",{className:"text-3xl font-bold text-white text-center mb-12",children:"Powerful Features"}),_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-3 gap-8",children:[_.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 text-center",children:[_.jsx(wo,{className:"w-12 h-12 text-blue-400 mx-auto mb-4"}),_.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"RTSP Streaming"}),_.jsx("p",{className:"text-gray-400",children:"Stream from any RTSP source with professional-grade playback controls and quality settings."})]}),_.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 text-center",children:[_.jsx(Sc,{className:"w-12 h-12 text-blue-400 mx-auto mb-4"}),_.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Custom Overlays"}),_.jsx("p",{className:"text-gray-400",children:"Add logos, text, and graphics with drag-and-drop positioning and real-time resizing."})]}),_.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 text-center",children:[_.jsx(Lg,{className:"w-12 h-12 text-blue-400 mx-auto mb-4"}),_.jsx("h3",{className:"text-xl font-semibold text-white mb-2",children:"Full Control"}),_.jsx("p",{className:"text-gray-400",children:"Complete CRUD API for managing overlays, settings, and stream configurations."})]})]})]})]})},FI=({overlays:i})=>_.jsx("div",{className:"absolute inset-0 pointer-events-none",children:i.map(e=>_.jsxs("div",{className:"absolute",style:{left:`${e.position.x}%`,top:`${e.position.y}%`,width:`${e.size.width}px`,height:`${e.size.height}px`,transform:`rotate(${e.rotation||0}deg)`,opacity:e.opacity||1,zIndex:e.zIndex||1},children:[e.type==="text"&&_.jsx("div",{className:"text-white font-bold",style:{fontSize:`${e.fontSize||16}px`,color:e.color||"#ffffff",fontFamily:e.fontFamily||"Arial",textShadow:"2px 2px 4px rgba(0,0,0,0.8)"},children:e.content}),e.type==="image"&&_.jsx("img",{src:e.src,alt:e.alt||"Overlay",className:"w-full h-full object-contain"}),e.type==="logo"&&_.jsx("div",{className:"w-full h-full flex items-center justify-center bg-blue-600 text-white font-bold rounded",children:e.content})]},e.id))}),MI=()=>{const[i,e]=W.useState(.5),[t,n]=W.useState(null),[r,a]=W.useState([]),[l,u]=W.useState(!0);W.useEffect(()=>{(async()=>{try{const[h,m]=await Promise.all([qo(),rd()]);n(h),a(m),e(h.volume||.5)}catch(h){console.error("Failed to load data:",h)}finally{u(!1)}})()},[]);const f=c=>{e(c)};return l?_.jsx("div",{className:"flex items-center justify-center min-h-screen",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):_.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:_.jsxs("div",{className:"bg-gray-800 rounded-lg overflow-hidden shadow-xl",children:[_.jsxs("div",{className:"relative",children:[_.jsx(vy,{rtspUrl:(t==null?void 0:t.rtspUrl)||"",volume:i,onVolumeChange:f,autoplay:t==null?void 0:t.autoplay}),_.jsx(FI,{overlays:r})]}),_.jsxs("div",{className:"p-6 bg-gray-800",children:[_.jsx("h2",{className:"text-2xl font-bold text-white mb-2",children:"Live Stream"}),t&&_.jsxs("div",{className:"space-y-2 text-sm text-gray-400",children:[_.jsxs("p",{children:["Source: ",t.rtspUrl]}),_.jsxs("p",{children:["Active Overlays: ",r.length]}),_.jsx("p",{children:"Stream Type: RTSP → HLS"})]})]})]})})},UI=({overlay:i,onSave:e,onCancel:t})=>{const[n,r]=W.useState({name:(i==null?void 0:i.name)||"",type:(i==null?void 0:i.type)||"text",content:(i==null?void 0:i.content)||"",src:(i==null?void 0:i.src)||"",position:(i==null?void 0:i.position)||{x:50,y:50},size:(i==null?void 0:i.size)||{width:200,height:100},color:(i==null?void 0:i.color)||"#ffffff",fontSize:(i==null?void 0:i.fontSize)||16,fontFamily:(i==null?void 0:i.fontFamily)||"Arial",opacity:(i==null?void 0:i.opacity)||1,rotation:(i==null?void 0:i.rotation)||0,visible:(i==null?void 0:i.visible)!==void 0?i.visible:!0}),a=u=>{const{name:f,value:c,type:h,checked:m}=u.target;if(f.includes(".")){const[g,E]=f.split(".");r(y=>({...y,[g]:{...y[g],[E]:h==="number"?parseFloat(c):c}}))}else r(g=>({...g,[f]:h==="checkbox"?m:h==="number"?parseFloat(c):c}))},l=u=>{u.preventDefault(),e(n)};return _.jsx("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center p-4 z-50",children:_.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 w-full max-w-2xl max-h-[90vh] overflow-y-auto",children:[_.jsxs("div",{className:"flex justify-between items-center mb-6",children:[_.jsx("h2",{className:"text-2xl font-bold text-white",children:i?"Edit Overlay":"Create Overlay"}),_.jsx("button",{onClick:t,className:"text-gray-400 hover:text-white transition-colors",children:_.jsx(cS,{className:"w-6 h-6"})})]}),_.jsxs("form",{onSubmit:l,className:"space-y-6",children:[_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Name"}),_.jsx("input",{type:"text",name:"name",value:n.name,onChange:a,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Type"}),_.jsxs("select",{name:"type",value:n.type,onChange:a,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[_.jsx("option",{value:"text",children:"Text"}),_.jsx("option",{value:"image",children:"Image"}),_.jsx("option",{value:"logo",children:"Logo"})]})]})]}),n.type==="text"&&_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Content"}),_.jsx("input",{type:"text",name:"content",value:n.content,onChange:a,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),n.type==="image"&&_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Image URL"}),_.jsx("input",{type:"url",name:"src",value:n.src,onChange:a,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),n.type==="logo"&&_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Logo Text"}),_.jsx("input",{type:"text",name:"content",value:n.content,onChange:a,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",required:!0})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Position X (%)"}),_.jsx("input",{type:"number",name:"position.x",value:n.position.x,onChange:a,min:"0",max:"100",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Position Y (%)"}),_.jsx("input",{type:"number",name:"position.y",value:n.position.y,onChange:a,min:"0",max:"100",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Width (px)"}),_.jsx("input",{type:"number",name:"size.width",value:n.size.width,onChange:a,min:"10",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Height (px)"}),_.jsx("input",{type:"number",name:"size.height",value:n.size.height,onChange:a,min:"10",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),n.type==="text"&&_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Font Size (px)"}),_.jsx("input",{type:"number",name:"fontSize",value:n.fontSize,onChange:a,min:"8",max:"72",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Color"}),_.jsx("input",{type:"color",name:"color",value:n.color,onChange:a,className:"w-full h-10 bg-gray-700 border border-gray-600 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),_.jsxs("div",{className:"grid grid-cols-2 gap-4",children:[_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Opacity"}),_.jsx("input",{type:"range",name:"opacity",value:n.opacity,onChange:a,min:"0",max:"1",step:"0.1",className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),_.jsx("span",{className:"text-sm text-gray-400",children:n.opacity})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Rotation (degrees)"}),_.jsx("input",{type:"range",name:"rotation",value:n.rotation,onChange:a,min:"-180",max:"180",className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),_.jsxs("span",{className:"text-sm text-gray-400",children:[n.rotation,"°"]})]})]}),_.jsxs("div",{className:"flex items-center",children:[_.jsx("input",{type:"checkbox",name:"visible",checked:n.visible,onChange:a,className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),_.jsx("label",{className:"ml-2 text-sm text-gray-300",children:"Visible"})]}),_.jsxs("div",{className:"flex justify-end space-x-4",children:[_.jsx("button",{type:"button",onClick:t,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors",children:"Cancel"}),_.jsx("button",{type:"submit",className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors",children:"Save Overlay"})]})]})]})})},BI=()=>{const[i,e]=W.useState([]),[t,n]=W.useState(!0),[r,a]=W.useState(null),[l,u]=W.useState(!1);W.useEffect(()=>{f()},[]);const f=async()=>{try{const y=await rd();e(y)}catch(y){console.error("Failed to load overlays:",y)}finally{n(!1)}},c=()=>{a(null),u(!0)},h=y=>{a(y),u(!0)},m=async y=>{if(window.confirm("Are you sure you want to delete this overlay?"))try{await Xg(y),f()}catch(T){console.error("Failed to delete overlay:",T)}},g=async y=>{try{await _c(y.id,{...y,visible:!y.visible}),f()}catch(T){console.error("Failed to update overlay:",T)}},E=async y=>{try{r?await _c(r.id,y):await qg(y),f(),u(!1),a(null)}catch(T){console.error("Failed to save overlay:",T)}};return t?_.jsx("div",{className:"flex items-center justify-center min-h-screen",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):_.jsxs("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[_.jsxs("div",{className:"flex justify-between items-center mb-8",children:[_.jsx("h1",{className:"text-3xl font-bold text-white",children:"Overlay Manager"}),_.jsxs("button",{onClick:c,className:"bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-lg flex items-center transition-colors",children:[_.jsx(nS,{className:"w-5 h-5 mr-2"}),"Create Overlay"]})]}),_.jsx("div",{className:"grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6",children:i.map(y=>_.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 shadow-lg",children:[_.jsxs("div",{className:"flex justify-between items-start mb-4",children:[_.jsxs("div",{children:[_.jsx("h3",{className:"text-lg font-semibold text-white",children:y.name}),_.jsx("p",{className:"text-sm text-gray-400 capitalize",children:y.type})]}),_.jsxs("div",{className:"flex space-x-2",children:[_.jsx("button",{onClick:()=>g(y),className:`p-2 rounded ${y.visible?"bg-green-600 hover:bg-green-700":"bg-gray-600 hover:bg-gray-700"} text-white transition-colors`,children:y.visible?_.jsx(Jx,{className:"w-4 h-4"}):_.jsx(Qx,{className:"w-4 h-4"})}),_.jsx("button",{onClick:()=>h(y),className:"bg-blue-600 hover:bg-blue-700 text-white p-2 rounded transition-colors",children:_.jsx(iS,{className:"w-4 h-4"})}),_.jsx("button",{onClick:()=>m(y.id),className:"bg-red-600 hover:bg-red-700 text-white p-2 rounded transition-colors",children:_.jsx(aS,{className:"w-4 h-4"})})]})]}),_.jsxs("div",{className:"space-y-2 text-sm text-gray-400",children:[_.jsxs("p",{children:["Position: ",y.position.x,"%, ",y.position.y,"%"]}),_.jsxs("p",{children:["Size: ",y.size.width,"x",y.size.height,"px"]}),y.type==="text"&&_.jsxs("p",{children:['Content: "',y.content,'"']}),y.type==="image"&&_.jsxs("p",{children:["Source: ",y.src]})]}),_.jsxs("div",{className:"mt-4 p-3 bg-gray-700 rounded",children:[_.jsx("p",{className:"text-xs text-gray-400",children:"Preview"}),_.jsx("div",{className:"mt-2 h-16 bg-gray-900 rounded relative overflow-hidden",children:_.jsxs("div",{className:"absolute",style:{left:`${y.position.x*.5}%`,top:`${y.position.y*.3}%`,transform:"scale(0.5)",transformOrigin:"top left"},children:[y.type==="text"&&_.jsx("div",{className:"text-white font-bold",style:{fontSize:`${y.fontSize||16}px`,color:y.color||"#ffffff"},children:y.content}),y.type==="logo"&&_.jsx("div",{className:"w-16 h-8 bg-blue-600 text-white text-xs flex items-center justify-center rounded",children:y.content})]})})]})]},y.id))}),i.length===0&&_.jsxs("div",{className:"text-center py-12",children:[_.jsx("p",{className:"text-gray-400 text-lg",children:"No overlays created yet."}),_.jsx("button",{onClick:c,className:"mt-4 bg-blue-600 hover:bg-blue-700 text-white px-6 py-3 rounded-lg transition-colors",children:"Create Your First Overlay"})]}),l&&_.jsx(UI,{overlay:r,onSave:E,onCancel:()=>{u(!1),a(null)}})]})},$I=()=>{const[i,e]=W.useState({rtspUrl:"",volume:.5,autoplay:!1,quality:"auto",bufferSize:5,reconnectAttempts:3}),[t,n]=W.useState(!0),[r,a]=W.useState(!1),[l,u]=W.useState(!1);W.useEffect(()=>{f()},[]);const f=async()=>{try{const m=await qo();e(m),u(!1)}catch(m){console.error("Failed to load settings:",m),m.isDemoMode&&(u(!0),e({rtspUrl:"rtsp://localhost:8554/mystream",volume:.5,autoplay:!1,quality:"auto",bufferSize:5,reconnectAttempts:3}))}finally{n(!1)}},c=m=>{const{name:g,value:E,type:y,checked:T}=m.target;e(S=>({...S,[g]:y==="checkbox"?T:y==="number"?parseFloat(E):E}))},h=async m=>{if(m.preventDefault(),l){alert("Demo Mode: Settings cannot be saved without backend server. This is a frontend-only deployment.");return}a(!0);try{await Qg(i),alert("Settings saved successfully!")}catch(g){console.error("Failed to save settings:",g),alert("Failed to save settings. Please try again.")}finally{a(!1)}};return t?_.jsx("div",{className:"flex items-center justify-center min-h-screen",children:_.jsx("div",{className:"animate-spin rounded-full h-32 w-32 border-b-2 border-blue-500"})}):_.jsxs("div",{className:"max-w-4xl mx-auto px-4 sm:px-6 lg:px-8 py-8",children:[l&&_.jsxs("div",{className:"mb-6 bg-yellow-600 text-white p-4 rounded-lg flex items-center",children:[_.jsx("div",{className:"flex-shrink-0",children:_.jsx("svg",{className:"w-5 h-5",fill:"currentColor",viewBox:"0 0 20 20",children:_.jsx("path",{fillRule:"evenodd",d:"M8.257 3.099c.765-1.36 2.722-1.36 3.486 0l5.58 9.92c.75 1.334-.213 2.98-1.742 2.98H4.42c-1.53 0-2.493-1.646-1.743-2.98l5.58-9.92zM11 13a1 1 0 11-2 0 1 1 0 012 0zm-1-8a1 1 0 00-1 1v3a1 1 0 002 0V6a1 1 0 00-1-1z",clipRule:"evenodd"})})}),_.jsxs("div",{className:"ml-3",children:[_.jsx("h3",{className:"text-sm font-medium",children:"Demo Mode Active"}),_.jsx("p",{className:"text-sm mt-1",children:"Backend server not available. Settings cannot be saved in this deployment. For full functionality, deploy both frontend and backend servers."})]})]}),_.jsxs("div",{className:"bg-gray-800 rounded-lg p-6 shadow-xl",children:[_.jsx("h1",{className:"text-3xl font-bold text-white mb-6",children:"Settings"}),_.jsxs("form",{onSubmit:h,className:"space-y-6",children:[_.jsxs("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[_.jsxs("div",{className:"md:col-span-2",children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"RTSP Stream URL"}),_.jsx("input",{type:"url",name:"rtspUrl",value:i.rtspUrl,onChange:c,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",placeholder:"rtsp://example.com/stream",required:!0}),_.jsx("p",{className:"mt-1 text-sm text-gray-400",children:"Enter the RTSP URL for your livestream source"})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Default Volume"}),_.jsx("input",{type:"range",name:"volume",value:i.volume,onChange:c,min:"0",max:"1",step:"0.1",className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),_.jsxs("span",{className:"text-sm text-gray-400",children:["Volume: ",Math.round(i.volume*100),"%"]})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Quality"}),_.jsxs("select",{name:"quality",value:i.quality,onChange:c,className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500",children:[_.jsx("option",{value:"auto",children:"Auto"}),_.jsx("option",{value:"1080p",children:"1080p"}),_.jsx("option",{value:"720p",children:"720p"}),_.jsx("option",{value:"480p",children:"480p"}),_.jsx("option",{value:"360p",children:"360p"})]})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Buffer Size (seconds)"}),_.jsx("input",{type:"number",name:"bufferSize",value:i.bufferSize,onChange:c,min:"1",max:"30",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]}),_.jsxs("div",{children:[_.jsx("label",{className:"block text-sm font-medium text-gray-300 mb-2",children:"Reconnect Attempts"}),_.jsx("input",{type:"number",name:"reconnectAttempts",value:i.reconnectAttempts,onChange:c,min:"0",max:"10",className:"w-full px-3 py-2 bg-gray-700 border border-gray-600 rounded-md text-white focus:outline-none focus:ring-2 focus:ring-blue-500"})]})]}),_.jsxs("div",{className:"flex items-center",children:[_.jsx("input",{type:"checkbox",name:"autoplay",checked:i.autoplay,onChange:c,className:"w-4 h-4 text-blue-600 bg-gray-700 border-gray-600 rounded focus:ring-blue-500"}),_.jsx("label",{className:"ml-2 text-sm text-gray-300",children:"Auto-play stream on page load"})]}),_.jsxs("div",{className:"flex justify-end space-x-4",children:[_.jsxs("button",{type:"button",onClick:f,className:"px-4 py-2 bg-gray-600 hover:bg-gray-700 text-white rounded-md transition-colors flex items-center",children:[_.jsx(rS,{className:"w-4 h-4 mr-2"}),"Reset"]}),_.jsxs("button",{type:"submit",disabled:r||l,className:"px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white rounded-md transition-colors flex items-center disabled:opacity-50",children:[_.jsx(sS,{className:"w-4 h-4 mr-2"}),l?"Demo Mode":r?"Saving...":"Save Settings"]})]})]})]}),_.jsxs("div",{className:"mt-8 bg-gray-800 rounded-lg p-6",children:[_.jsx("h2",{className:"text-xl font-bold text-white mb-4",children:"API Information"}),l&&_.jsx("div",{className:"mb-4 p-3 bg-yellow-900 border border-yellow-600 rounded",children:_.jsxs("p",{className:"text-yellow-200 text-sm",children:[_.jsx("strong",{children:"Demo Mode:"})," Backend API not available. Deploy backend server for full functionality."]})}),_.jsxs("div",{className:"space-y-2 text-sm text-gray-300",children:[_.jsxs("p",{children:[_.jsx("strong",{children:"Base URL:"})," ",l?"Not Available (Demo Mode)":"http://localhost:3001/api"]}),_.jsxs("p",{children:[_.jsx("strong",{children:"Overlays Endpoint:"})," /overlays"]}),_.jsxs("p",{children:[_.jsx("strong",{children:"Settings Endpoint:"})," /settings"]}),_.jsxs("p",{children:[_.jsx("strong",{children:"Health Check:"})," /health"]}),l&&_.jsx("p",{className:"text-yellow-400 text-xs mt-2",children:"* API endpoints are not functional in demo mode"})]})]})]})},GI=()=>{const i=Sr(),e=[{path:"/",icon:Zx,label:"Home"},{path:"/player",icon:wo,label:"Player"},{path:"/overlays",icon:Sc,label:"Overlays"},{path:"/settings",icon:Lg,label:"Settings"}];return _.jsx("nav",{className:"fixed top-0 left-0 right-0 bg-gray-800 border-b border-gray-700 z-50",children:_.jsx("div",{className:"max-w-7xl mx-auto px-4 sm:px-6 lg:px-8",children:_.jsxs("div",{className:"flex items-center justify-between h-16",children:[_.jsx("div",{className:"flex items-center",children:_.jsx("h1",{className:"text-xl font-bold text-white",children:"StreamOverlay"})}),_.jsx("div",{className:"flex space-x-4",children:e.map(({path:t,icon:n,label:r})=>_.jsxs(Ls,{to:t,className:`flex items-center px-3 py-2 rounded-md text-sm font-medium transition-colors ${i.pathname===t?"bg-blue-600 text-white":"text-gray-300 hover:bg-gray-700 hover:text-white"}`,children:[_.jsx(n,{className:"w-4 h-4 mr-2"}),r]},t))})]})})})};function jI(){return _.jsx(Bx,{children:_.jsxs("div",{className:"min-h-screen bg-gray-900 text-white",children:[_.jsx(GI,{}),_.jsx("main",{className:"pt-16",children:_.jsxs(px,{children:[_.jsx(Ai,{path:"/",element:_.jsx(NI,{})}),_.jsx(Ai,{path:"/player",element:_.jsx(MI,{})}),_.jsx(Ai,{path:"/overlays",element:_.jsx(BI,{})}),_.jsx(Ai,{path:"/settings",element:_.jsx($I,{})})]})})]})})}LE.createRoot(document.getElementById("root")).render(_.jsx(W.StrictMode,{children:_.jsx(jI,{})}));
